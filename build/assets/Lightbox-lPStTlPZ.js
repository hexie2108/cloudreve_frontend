import{r as m,n as mt,j as l,gK as pt,x as _e,bW as xt,bq as bt,br as St,bc as lt,d$ as ut,y as Ze,fJ as Ct,gL as vt,ai as Me,w as dt,h as Mt,bd as yt,bo as Rt,ad as Ke,O as Oe,aG as ve,aO as jt,dI as Pt,gM as Tt,cq as kt,bp as It,bw as ft,gN as Et,dF as Xt,d3 as Yt,bj as Ot,gO as wt,c0 as $t,gP as Vt,gQ as _t,fM as Ft,ee as Lt,gR as Wt,cL as At,gS as Dt}from"./index-BhmhgD6-.js";import{editorSupportedExt as zt}from"./ImageEditor-5vEVlCce.js";import"./codemirror-TlZy3ty4.js";import"./tslib.es6-CRos2fHm.js";function Fe(e){const{current:n}=m.useRef({fn:e,curr:void 0});if(n.fn=e,!n.curr){const t=Object.create(null);Object.keys(e).forEach(s=>{t[s]=(...r)=>n.fn[s].call(n.fn,...r)}),n.curr=t}return n.curr}function et(e){return m.useReducer((n,t)=>({...n,...typeof t=="function"?t(n):t}),e)}m.createContext(void 0);const Bt=mt(l.jsx("path",{d:"M20.998 6.25A3.25 3.25 0 0 0 17.748 3H6.25A3.25 3.25 0 0 0 3 6.25v11.499a3.25 3.25 0 0 0 3.25 3.25h4.914l.356-1.424l.02-.076H6.25c-.204 0-.4-.035-.582-.1l5.807-5.685l.083-.07a.75.75 0 0 1 .966.07l2.079 2.036l1.06-1.06l-2.09-2.048l-.128-.116a2.25 2.25 0 0 0-3.02.116l-5.822 5.7a1.746 1.746 0 0 1-.103-.593v-11.5c0-.966.783-1.75 1.75-1.75h11.499c.966 0 1.75.784 1.75 1.75v4.983c.478-.19.993-.264 1.5-.22zm-3.495 2.502a2.252 2.252 0 1 0-4.504 0a2.252 2.252 0 0 0 4.504 0m-3.004 0a.752.752 0 1 1 1.504 0a.752.752 0 0 1-1.504 0m4.6 3.917l-5.902 5.901a2.685 2.685 0 0 0-.707 1.248l-.457 1.83c-.2.797.522 1.518 1.318 1.319l1.83-.458a2.685 2.685 0 0 0 1.248-.706L22.33 15.9a2.286 2.286 0 0 0-3.233-3.232"}),"ImageEdit");function Nt(e){return l.jsx("svg",{width:"44",height:"44",viewBox:"0 0 768 768",...e,children:l.jsx("path",{d:"M640.5 352.5v63h-390l178.5 180-45 45-256.5-256.5 256.5-256.5 45 45-178.5 180h390z"})})}function Ht(e){return l.jsx("svg",{width:"44",height:"44",viewBox:"0 0 768 768",...e,children:l.jsx("path",{d:"M384 127.5l256.5 256.5-256.5 256.5-45-45 178.5-180h-390v-63h390l-178.5-180z"})})}function qt({container:e=document.body,...n}){return pt.createPortal(l.jsx("div",{...n}),e)}function Ut(e,n,t){return m.useMemo(()=>{const s=e.length;return t?e.concat(e).concat(e).slice(s+n-1,s+n+2):e.slice(Math.max(n-1,0),Math.min(n+2,s+1))},[e,n,t])}function Gt(e,n){const t=m.useRef(e);function s(r){t.current=r}return m.useMemo(()=>{n(s)},[e]),[t.current,s]}function Kt(e,n){const[,t]=m.useReducer(c=>!c,!1),s=m.useRef(0),[r,i]=Gt(e,c=>{e?(c(e),s.current=1):s.current=2});function u(){t(),s.current===2&&(i(!1),n&&n()),s.current=0}return[r,s.current,u]}function xe(e,n,t){const s=m.useRef(n);s.current=n,m.useEffect(()=>{function r(i){s.current(i)}return e&&window.addEventListener(e,r,t),()=>{e&&window.removeEventListener(e,r)}},[e])}const Qt=typeof window>"u"||/ServerSideRendering/.test(navigator&&navigator.userAgent),tt=Qt?m.useEffect:m.useLayoutEffect,Jt=200,$e=400,ot="cubic-bezier(0.25, 0.8, 0.25, 1)",st=40,pe=20,it=20,Zt=1,en=1,tn=6,ht=3,nn=.2,on=250,sn={T:0,L:0,W:0,H:0,FIT:void 0};function an(e,n,t,s,r){const[i,u]=m.useState(sn),[c,h]=m.useState(0),f=m.useRef(),g=Fe({OK:()=>e&&h(4)});m.useEffect(()=>{if(f.current||(f.current=Date.now()),!!t){if(rn(n,u),e){if(Date.now()-f.current<on){h(1),requestAnimationFrame(()=>{h(2),requestAnimationFrame(()=>d(3))}),setTimeout(g.OK,s);return}h(4);return}d(5)}},[e,t]);function d(x){r(!1),h(x)}return[c,i]}function rn(e,n){const t=e&&e.current;if(t&&t.nodeType===1){const{top:s,left:r,width:i,height:u}=t.getBoundingClientRect(),c=t.tagName==="IMG";n({T:s,L:r,W:i,H:u,FIT:c?getComputedStyle(t).objectFit:void 0})}}function Ve(e,{leading:n=!1,maxWait:t,wait:s=t||0}){const r=m.useRef(e);r.current=e;const i=m.useRef(0),u=m.useRef(),c=()=>u.current&&clearTimeout(u.current),h=m.useCallback((...f)=>{const g=Date.now();function d(){i.current=g,c(),r.current.apply(null,f)}const x=i.current,y=g-x;if(x===0&&(n&&d(),i.current=g),t!==void 0){if(y>t){d();return}}else y<s&&(i.current=g);c(),u.current=setTimeout(()=>{d(),i.current=0},s)},[s,t,n]);return h.cancel=c,h}function cn(e,n,t,s,r){const i=m.useRef(!1),[{lead:u,scale:c},h]=et({lead:!0,scale:t}),f=Ve(async g=>{r(!0),h({lead:!1,scale:g})},{wait:s});return tt(()=>{if(!i.current){i.current=!0;return}r(!1),h({lead:!0}),f(t)},[t]),u?[e*c,n*c,t/c]:[e*t,n*t,1]}function ln(e,n,t,s,r,i,u,c,h,f,g){const[d,x,y]=cn(u,c,h,f,g),[v,M]=an(n,t,s,f,g),{T:L,L:R,W:w,H:C,FIT:p}=M,O=e/2,P=innerHeight/2,J=O-u*h/2,j=P-c*h/2,I=v<3||v>4,W=I?w?R:O:r+J,V=I?w?L:P:i+j,_=w/(u*h)||.01,T=I&&p?d*(C/w):x;return[W,V,d,T,v===0?y:I?_:y,I?p?1:0:1,v,p]}function un(e,n){const t=m.useRef(0),s=Ve((...r)=>{t.current=0,e(...r)},{wait:300});return function(...i){t.current+=1,s(...i),t.current>=2&&(s.cancel(),t.current=0,n(...i))}}const gt=()=>{const e=m.useRef(!1);return m.useEffect(()=>(e.current=!0,()=>{e.current=!1}),[]),e},dn=(e,n,t,s)=>{if(n&&e===1||s==="x")return"x";if(t&&e>1||s==="y")return"y"},ne=(e,n,t,s)=>{const r=t*n,i=(r-s)/2;let u,c=e;return r<=s?(u=1,c=0):e>0&&i-e<=0?(u=2,c=i):e<0&&i+e<=0&&(u=3,c=-i),[u,c]};function Qe(e,n,t,s,r,i,u=innerWidth/2,c=innerHeight/2,h=0,f=0){const[g]=ne(e,i,t,innerWidth),[d]=ne(n,i,s,innerHeight),x=innerWidth/2,y=innerHeight/2,v=x+e,M=y+n,L=u-(u-v)*(i/r)-x,R=c-(c-M)*(i/r)-y,w=s/t>=ht&&t*i===innerWidth;return{x:L+(w?0:g?h/2:h),y:R+(d?f/2:f),lastCX:u,lastCY:c}}function nt(e,n,t){const s=e%180!==0;return s?[t,n,s]:[n,t,s]}const at=(e,n,t)=>re(e,n,t,$e/4,s=>s,()=>re(n,e,t));function fn(e,n,t,s){const r=Fe({X:i=>e(i),Y:i=>n(i),S:i=>t(i)});return(i,u,c,h,f,g,d,x,y,v,M)=>{const[L,R]=nt(v,f,g),[w,C]=ne(i,x,L,s),[p,O]=ne(u,x,R,innerHeight),P=Date.now()-M;if(P>=Jt||x!==d||Math.abs(y-d)>1){const{x:_,y:T}=Qe(i,u,f,g,d,x),X=w?C:_!==i?_:null,B=p?O:T!==u?T:null;X!==null&&re(i,X,r.X),B!==null&&re(u,B,r.Y),x!==d&&re(d,x,r.S);return}const J=(i-c)/P,j=(u-h)/P,I=Math.sqrt(J**2+j**2);let W=!1,V=!1;mn(I,_=>{const T=i+_*(J/I),X=u+_*(j/I),[B,E]=ne(T,d,L,innerWidth),[H,A]=ne(X,d,R,innerHeight);if(B&&!W&&(W=!0,w?re(T,E,r.X):at(E,T+(T-E),r.X)),H&&!V&&(V=!0,p?re(X,A,r.Y):at(A,X+(X-A),r.Y)),W&&V)return!1;const $=W||r.X(E),ce=V||r.Y(A);return $&&ce})}}const hn=-.001,gn=2e-4;function mn(e,n){let t=e,s=0,r,i=0;const u=f=>{r||(r=f);const g=f-r,d=Math.sign(e),x=d*hn,y=Math.sign(-t)*t**2*gn,v=t*g+(x+y)*g**2/2;if(t+=(x+y)*g,s+=v,r=f,d*t<=0){h();return}if(n(s)){c();return}h()};c();function c(){i=requestAnimationFrame(u)}function h(){cancelAnimationFrame(i)}}const pn=e=>1-(1-e)**4;function re(e,n,t,s=$e,r=pn,i){const u=n-e;if(u===0)return;const c=Date.now();let h=0;const f=()=>{const d=Math.min(1,(Date.now()-c)/s);if(t(e+r(d)*u)&&d<1){g();return}cancelAnimationFrame(h),d>=1&&i&&i()};g();function g(){h=requestAnimationFrame(f)}}function xn({file:e,version:n,loaded:t,broken:s,className:r,onPhotoLoad:i,loadingElement:u,brokenElement:c,...h}){const f=gt(),g=_e(),[d,x]=xt.useState(void 0);m.useEffect(()=>{g(bt({uris:[St(e)],entity:n})).then(M=>{x(M.urls[0].url)}).catch(M=>{f.current&&i({broken:!0})})},[]);function y(M){const{naturalWidth:L,naturalHeight:R}=M.target;f.current&&i({loaded:!0,naturalWidth:L,naturalHeight:R})}function v(){f.current&&i({broken:!0})}return e&&!s?l.jsxs(l.Fragment,{children:[d&&l.jsx("img",{className:`PhotoView__Photo${r?` ${r}`:""}`,src:d,draggable:!1,onLoad:y,onError:v,alt:"",...h}),!t&&l.jsx(lt,{sx:{position:"absolute",top:0},fgColor:"#fff",bgColor:ut[800]})]}):c?l.jsx("span",{className:"PhotoView__icon",children:typeof c=="function"?c({src:d??""}):c}):null}function rt(e){const{clientX:n,clientY:t}=e.touches[0];if(e.touches.length>=2){const{clientX:s,clientY:r}=e.touches[1];return[(n+s)/2,(t+r)/2,Math.sqrt((s-n)**2+(r-t)**2)]}return[n,t,0]}function Ge(e,n,t,s){const[r,i,u]=nt(t,s,innerHeight);let c=0,h=r,f=i;const g=e/n*i,d=n/e*r;return e<r&&n<i?(h=e,f=n):e<r&&n>=i?h=g:e>=r&&n<i||e/n>r/i?f=d:n/e>=ht&&!u?(f=d,c=(f-i)/2):h=g,{width:h,height:f,x:0,y:c,pause:!0}}const Q=typeof window<"u"&&"ontouchstart"in window,Je=(e,n,t)=>Math.max(Math.min(e,t),n),we=(e,n=0,t=0)=>Je(e,en*(1-t),Math.max(tn,n)*(1+t)),bn={naturalWidth:void 0,naturalHeight:void 0,width:void 0,height:void 0,loaded:void 0,broken:!1,x:0,y:0,touched:!1,maskTouched:!1,rotate:0,scale:1,CX:0,CY:0,lastX:0,lastY:0,lastCX:0,lastCY:0,lastScale:1,touchTime:0,touchLength:0,pause:!0,stopRaf:!0,reach:void 0};function Sn({item:{render:e,file:n,version:t,width:s=0,height:r=0,originRef:i,loadMorePlaceholder:u,key:c},visible:h,speed:f,easing:g,wrapClassName:d,className:x,style:y,loadingElement:v,brokenElement:M,onPhotoTap:L,onMaskTap:R,onReachMove:w,onReachUp:C,onPhotoResize:p,isActive:O,expose:P}){const[J,j]=et(bn),I=m.useRef(0),W=gt(),{naturalWidth:V=s,naturalHeight:_=r,width:T=s,height:X=r,loaded:B=!n,broken:E,x:H,y:A,touched:$,stopRaf:ce,maskTouched:oe,rotate:N,scale:k,CX:se,CY:ie,lastX:ye,lastY:le,lastCX:Le,lastCY:We,lastScale:Ae,touchTime:Re,touchLength:ue,pause:je,reach:b}=J,F=Ze(o=>o.globalState.sidebarOpen)?window.innerWidth-300:window.innerWidth,Z=Fe({onScale:o=>de(we(o)),onRotate(o){N!==o&&(P({rotate:o}),j({rotate:o,...Ge(V,_,o,F)}))}});function de(o,a,S){k!==o&&(P({scale:o}),j({scale:o,...Qe(H,A,T,X,k,o,a,S),...o<=1&&{x:0,y:0}}))}const D=Ve((o,a,S=0)=>{if(($||oe)&&O){const[Y,G]=nt(N,T,X);if(S===0&&I.current===0){const Ye=Math.abs(o-se)<=it,Ue=Math.abs(a-ie)<=it;if(Ye&&Ue){j({lastCX:o,lastCY:a});return}I.current=Ye?a>ie?3:2:1}const te=o-Le,me=a-We;let K;if(S===0){const[Ye]=ne(te+ye,k,Y,F),[Ue]=ne(me+le,k,G,innerHeight);K=dn(I.current,Ye,Ue,b),K!==void 0&&w(K,o,a,k)}if(K==="x"||oe){j({reach:"x"});return}const Ce=we(k+(S-ue)/100/2*k,V/T,nn);P({scale:Ce}),j({touchLength:S,reach:K,scale:Ce,...Qe(H,A,T,X,k,Ce,o,a,te,me)})}},{maxWait:8});function fe(o){return ce||$?!1:(W.current&&j({...o,pause:h}),W.current)}const ae=fn(o=>fe({x:o}),o=>fe({y:o}),o=>(W.current&&(P({scale:o}),j({scale:o})),!$&&W.current),F),ze=un(L,(o,a)=>{if(!b){const S=k!==1?1:Math.max(2,V/T);de(S,o,a)}});function ee(o,a){if(I.current=0,($||oe)&&O){j({touched:!1,maskTouched:!1,pause:!1,stopRaf:!1,reach:void 0});const S=we(k,V/T);if(ae(H,A,ye,le,T,X,k,S,Ae,N,Re),C(o,a),se===o&&ie===a){if($){ze(o,a);return}oe&&R(o,a)}}}xe(Q?void 0:"mousemove",o=>{D(o.clientX,o.clientY)}),xe(Q?void 0:"mouseup",o=>{ee(o.clientX,o.clientY)}),xe(Q?"touchmove":void 0,o=>{const a=rt(o);D(...a)},{passive:!1}),xe(Q?"touchend":void 0,({changedTouches:o})=>{const a=o[0];ee(a.clientX,a.clientY)},{passive:!1}),xe("resize",Ve(()=>{B&&!$&&(j(Ge(V,_,N,F)),p())},{maxWait:8})),tt(()=>{O&&P({scale:k,rotate:N,...Z})},[O]);function q(o){j({...o,...o.loaded&&Ge(o.naturalWidth||0,o.naturalHeight||0,N,F)})}function be(o,a,S=0){j({touched:!0,CX:o,CY:a,lastCX:o,lastCY:a,lastX:H,lastY:A,lastScale:k,touchLength:S,touchTime:Date.now()})}function Be(o){if(!b){const a=we(k-o.deltaY/100/2,V/T);j({stopRaf:!0}),de(a,o.clientX,o.clientY)}}function Pe(o){j({maskTouched:!0,CX:o.clientX,CY:o.clientY,lastX:H,lastY:A})}function Ne(o){o.stopPropagation(),be(...rt(o))}function He(o){o.stopPropagation(),o.button===0&&be(o.clientX,o.clientY,0)}const[Te,qe,z,he,ge,ke,U,Se]=ln(F,h,i,B,H,A,T,X,k,f,o=>j({pause:o})),Ie=U<4?f/2:U>4?f:0,Ee=`transform ${f}ms ${g}`,Xe={className:x,onMouseDown:Q?void 0:He,onTouchStart:Q?Ne:void 0,onWheel:Be,style:{width:z,height:he,opacity:ke,objectFit:U===4?void 0:Se,transform:N?`rotate(${N}deg)`:void 0,transition:U>2?`${Ee}, opacity ${f}ms ease, height ${Ie}ms ${g}`:void 0}};return l.jsx("div",{className:`PhotoView__PhotoWrap${d?` ${d}`:""}`,style:y,onMouseDown:!Q&&O?Pe:void 0,onTouchStart:Q&&O?o=>Pe(o.touches[0]):void 0,children:l.jsxs("div",{className:"PhotoView__PhotoBox",style:{transform:`matrix(${ge}, 0, 0, ${ge}, ${Te}, ${qe})`,transition:$||je?void 0:Ee,willChange:O?"transform":void 0},children:[n?l.jsx(xn,{file:n,version:t,loaded:B,broken:E,...Xe,onPhotoLoad:q,loadingElement:v,brokenElement:M}):e&&e({attrs:Xe,scale:ge,rotate:N}),u&&l.jsx(Cn,{},c)]})})}const Cn=()=>{const e=_e(),{ref:n,inView:t}=Ct({triggerOnce:!0});return m.useEffect(()=>{t&&e(vt(Me.main))},[t]),l.jsx(lt,{ref:n,fgColor:"#fff",bgColor:ut[800]})},ct={x:0,touched:!1,pause:!1,lastCX:void 0,lastCY:void 0,bg:void 0,lastBg:void 0,overlay:!0,minimal:!0,scale:1,rotate:0};function vn(e){var o;const{loop:n=3,speed:t,easing:s,photoClosable:r,maskClosable:i=!0,maskOpacity:u=Zt,pullClosable:c=!0,bannerVisible:h=!0,overlayRender:f,toolbarRender:g,className:d,maskClassName:x,photoClassName:y,photoWrapClassName:v,loadingElement:M,brokenElement:L,images:R,index:w=0,onIndexChange:C,visible:p,onClose:O,afterClose:P,portalContainer:J,moreFiles:j}=e,{t:I}=dt(),W=Mt(),V=yt(W.breakpoints.down("sm")),_=_e(),T=m.useRef(null),X=Ze(a=>a.globalState.sidebarOpen),[B,E]=et(ct),[H,A]=m.useState(0),$=X?window.innerWidth-300:window.innerWidth,{x:ce,touched:oe,pause:N,lastCX:k,lastCY:se,bg:ie=u,lastBg:ye,overlay:le,minimal:Le,scale:We,rotate:Ae,onScale:Re,onRotate:ue}=B,je=e.hasOwnProperty("index"),b=je?w:H,De=je?C:A,F=m.useRef(b),Z=R.length,de=R[b],D=typeof n=="boolean"?n:Z>n,[fe,ae,ze]=Kt(p,P);m.useEffect(()=>(setTimeout(()=>{document.body.style.overflow="hidden"},500),()=>{setTimeout(()=>{document.body.style.overflow=V?"initial":"hidden"},500)}),[]),tt(()=>{if(fe){E({pause:!0,x:b*-($+pe)}),F.current=b;return}E(ct)},[fe]);const{close:ee,changeIndex:q}=Fe({close(a){ue&&ue(0),E({overlay:!0,lastBg:ie}),O(a)},changeIndex(a,S=!1){const Y=D?F.current+(a-b):a,G=Z-1,te=Je(Y,0,G),me=D?Y:te,K=$+pe;E({touched:!1,lastCX:void 0,lastCY:void 0,x:-K*me,pause:S}),F.current=me;const Ce=a<0?G:a>G?0:a;De&&De(D?Ce:te)}});xe("keydown",a=>{if(p)switch(a.key){case"ArrowLeft":q(b-1,!0);break;case"ArrowRight":q(b+1,!0);break;case"Escape":ee();break}});function be(a){return a?ee():E({overlay:!le})}const Be=a=>()=>{E({x:-(a+pe)*b,lastCX:void 0,lastCY:void 0,pause:!0}),F.current=b};function Pe(a,S){if(se===void 0){E({touched:!0,lastCY:a,bg:ie,minimal:!0});return}const Y=u===null?null:Je(u,.01,u-Math.abs(a-se)/100/4);E({touched:!0,lastCY:se,bg:S===1?Y:u,minimal:S===1})}function Ne(a){if(k===void 0){E({touched:!0,lastCX:a,x:ce,pause:!1});return}const S=a-k;let Y=S;!D&&(b===0&&S>0||b===Z-1&&S<0)&&(Y=S/2),E({touched:!0,lastCX:k,x:-($+pe)*F.current+Y,pause:!1})}function He(a,S,Y,G){a==="x"?Ne(S):a==="y"&&Pe(Y,G)}function Te(a,S){const Y=a-(k??a),G=S-(se??S);let te=!1;if(Y<-st){q(b+1);return}if(Y>st){q(b-1);return}const K=-($+pe)*F.current;Math.abs(G)>100&&Le&&c&&(te=!0,ee()),E({touched:!1,x:K,lastCX:void 0,lastCY:void 0,bg:u,overlay:te?!0:le})}const qe=Ut(R,b,D),z=(o=R[b])==null?void 0:o.file,he=Rt(z?[z]:[]);if(m.useEffect(()=>{Te(0,0)},[X]),!fe)return null;const ge=le&&!ae,ke=p?ie:ye,U=Re&&ue&&{images:R,index:b,visible:p,onClose:ee,onIndexChange:q,overlayVisible:ge,overlay:de&&de.overlay,scale:We,rotate:Ae,onScale:Re,onRotate:ue},Se=t?t(ae):$e,Ie=s?s(ae):ot,Ee=t?t(3):$e+200,Xe=s?s(3):ot;return l.jsx(Ke,{ref:T,children:l.jsxs(qt,{className:`PhotoView-Portal${ge?"":" PhotoView-Slider__clean"}${p?"":" PhotoView-Slider__willClose"}${d?` ${d}`:""}`,style:{width:X?"calc(100% - 300px)":"100%"},role:"dialog",onClick:a=>a.stopPropagation(),container:J,children:[l.jsx("div",{className:`PhotoView-Slider__Backdrop${x?` ${x}`:""}${ae===1?" PhotoView-Slider__fadeIn":ae===2?" PhotoView-Slider__fadeOut":""}`,style:{background:ke?`rgba(0, 0, 0, ${ke})`:void 0,transitionTimingFunction:Ie,transitionDuration:`${oe?0:Se}ms`,animationDuration:`${Se}ms`},onAnimationEnd:ze}),h&&l.jsxs("div",{className:"PhotoView-Slider__BannerWrap",children:[l.jsxs("div",{className:"PhotoView-Slider__Counter",children:[b+1," / ",j?Z-1:Z,j?"+":""]}),l.jsxs("div",{className:"PhotoView-Slider__BannerRight",children:[g&&U&&g(U),z&&he.showDownload&&l.jsx(Oe,{title:I("application:fileManager.download"),children:l.jsx(ve,{onClick:()=>{var a;return _(jt(z,(a=R[b])==null?void 0:a.version))},children:l.jsx(Pt,{fontSize:"small"})})}),z&&he.showInfo&&l.jsx(Oe,{title:I("application:fileManager.details"),children:l.jsx(ve,{onClick:()=>_(Tt({open:!0,target:R[b].file})),children:l.jsx(kt,{fontSize:"small"})})}),z&&he&&It(he)&&zt.includes(ft(z.name)??"")&&l.jsx(Oe,{title:I("application:fileManager.edit"),children:l.jsx(ve,{onClick:()=>{var a;return _(Et(z,(a=R[b])==null?void 0:a.version))},children:l.jsx(Bt,{fontSize:"small"})})}),z&&l.jsx(Oe,{title:I("application:fileManager.moreActions"),children:l.jsx(ve,{onClick:a=>_(Xt(Me.main,z,!1,a)),children:l.jsx(Yt,{fontSize:"small"})})}),l.jsx(ve,{onClick:ee,children:l.jsx(Ot,{fontSize:"small"})})]})]}),qe.map((a,S)=>{const Y=!D&&b===0?b+S:F.current-1+S;return l.jsx(Sn,{item:a,speed:Se,easing:Ie,visible:p,onReachMove:He,onReachUp:Te,onPhotoTap:()=>be(r),onMaskTap:()=>be(i),wrapClassName:v,className:y,style:{left:`${($+pe)*Y}px`,transform:`translate3d(${ce}px, 0px, 0)`,transition:oe||N?void 0:`transform ${Ee}ms ${Xe}`},loadingElement:M,brokenElement:L,onPhotoResize:Be($),isActive:F.current===Y,expose:E},D?`${a.key}/${a.src}/${Y}`:a.key)}),!Q&&h&&l.jsxs(l.Fragment,{children:[(D||b!==0)&&l.jsx("div",{className:"PhotoView-Slider__ArrowLeft",onClick:()=>q(b-1,!0),children:l.jsx(Nt,{})}),(D||b+1<Z)&&l.jsx("div",{className:"PhotoView-Slider__ArrowRight",onClick:()=>q(b+1,!0),children:l.jsx(Ht,{})})]}),f&&U&&l.jsx("div",{className:"PhotoView-Slider__Overlay",children:f(U)})]})})}const Pn=({viewer:e,onClose:n})=>{var w;const t=wt(!0,!0),s=m.useRef(void 0),{enqueueSnackbar:r,closeSnackbar:i}=$t(),{t:u}=dt(),c=_e(),[h,f]=m.useState(!0),[g,d]=m.useState((e==null?void 0:e.index)??0),x=m.useRef(!1),y=Ze(C=>{var p;return((p=C.fileManager[Me.main].list)==null?void 0:p.files)??[]}),v=Vt(Me.main),M=m.useMemo(()=>{if(!e)return[];let C=0;const p=[];let O;return e.version?(d(C),p.push({key:e.file.id+e.version,file:e.file,version:e.version}),C++):e.index==-1?(d(C),p.push({key:e.file.id,file:e.file}),C++):y.forEach(P=>{!x.current&&P.path==e.file.path?(O=C,d(C),p.push({key:P.id,file:P}),C++):e.exts.includes(ft(P.name)??"")&&(C++,p.push({key:P.id,file:P}))}),v.moreItems&&p.push({loadMorePlaceholder:!0,key:`${v.currentPage} - ${v.nextToken}`}),v.useEndlessLoading&&(O??g)>=p.length&&d(p.length-1),v.usePagination&&x.current&&(d(0),(p.length==0||p[0].loadMorePlaceholder)&&(f(!1),r(u("application:fileManager.noMoreImages"),{variant:"warning",preventDuplicate:!0}))),x.current=!0,p},[e==null?void 0:e.file,e==null?void 0:e.index,e==null?void 0:e.version,e==null?void 0:e.exts,y,v.moreItems]),L=m.useCallback(C=>{d(C)},[d,c,v,M]);m.useEffect(()=>{var p;const C=(p=M[g])==null?void 0:p.file;C&&c(_t(C))},[(w=M[g])==null?void 0:w.file]),m.useEffect(()=>{M.length==0&&R()},[M.length]);const R=m.useCallback(()=>{var p;const C=(p=M[g])==null?void 0:p.file;(e==null?void 0:e.index)!=-1&&C&&c(Ft({index:Me.main,value:[C]})),n()},[n,e==null?void 0:e.index,M,g,c]);return l.jsxs(Lt,{theme:t,children:[l.jsx(vn,{moreFiles:v.moreItems,images:M,onClose:()=>f(!1),afterClose:R,visible:h,index:g,onIndexChange:L,brokenElement:l.jsx(Ke,{sx:{color:"white",textAlign:"center"},children:l.jsx(Wt,{fontSize:"large"})}),portalContainer:s.current}),l.jsx(At,{ref:s,sx:{bgcolor:"rgb(0 0 0 / 0%)",zIndex:C=>C.zIndex.drawer+1},open:h,children:l.jsx(Ke,{children:l.jsx(Dt,{inPhotoViewer:!0})})})]})};export{Pn as default};
