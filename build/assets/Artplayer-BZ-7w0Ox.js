import{f9 as Tr,h1 as _i,gV as yi,r as dn,bw as sl,bx as Li,j as nl,ad as al}from"./index-BhmhgD6-.js";import{C as ol}from"./FrameManagerBundle-BVRMRuHw.js";import"./codemirror-TlZy3ty4.js";import"./SettingForm-CxIiT_vO.js";import"./DarkThemeSwitcher-CxPmHxlM.js";import"./Storage-HJ4WwPFN.js";var cr={exports:{}};cr.exports;(function(c,e){/*!
 * artplayer.js v5.2.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2025 Harvey Zack
 * Released under the MIT License.
 */(function(t,i,r,s,n){var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof yi<"u"?yi:{},a=typeof o[s]=="function"&&o[s],l=a.cache||{},d=typeof _i=="function"&&_i.bind(c);function u(p,_){if(!l[p]){if(!t[p]){var y=typeof o[s]=="function"&&o[s];if(!_&&y)return y(p,!0);if(a)return a(p,!0);if(d&&typeof p=="string")return d(p);var b=Error("Cannot find module '"+p+"'");throw b.code="MODULE_NOT_FOUND",b}T.resolve=function(R){var M=t[p][1][R];return M??R},T.cache={};var I=l[p]=new u.Module(p);t[p][0].call(I.exports,T,I,I.exports,this)}return l[p].exports;function T(R){var M=T.resolve(R);return M===!1?{}:u(M)}}u.isParcelRequire=!0,u.Module=function(p){this.id=p,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=a,u.register=function(p,_){t[p]=[function(y,b){b.exports=_},{}]},Object.defineProperty(u,"root",{get:function(){return o[s]}}),o[s]=u;for(var h=0;h<i.length;h++)u(i[h]);{var f=u(r);c.exports=f}})({"5lTcX":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("bundle-text:./style/index.less"),o=s.interopDefault(n),a=t("option-validator"),l=s.interopDefault(a),d=t("./utils/emitter"),u=s.interopDefault(d),h=t("./utils"),f=t("./scheme"),p=s.interopDefault(f),_=t("./config"),y=s.interopDefault(_),b=t("./template"),I=s.interopDefault(b),T=t("./i18n"),R=s.interopDefault(T),M=t("./player"),N=s.interopDefault(M),P=t("./control"),L=s.interopDefault(P),A=t("./contextmenu"),x=s.interopDefault(A),k=t("./info"),U=s.interopDefault(k),K=t("./subtitle"),$=s.interopDefault(K),j=t("./events"),Q=s.interopDefault(j),ie=t("./hotkey"),ee=s.interopDefault(ie),F=t("./layer"),O=s.interopDefault(F),H=t("./loading"),W=s.interopDefault(H),ae=t("./notice"),le=s.interopDefault(ae),ye=t("./mask"),me=s.interopDefault(ye),re=t("./icons"),oe=s.interopDefault(re),fe=t("./setting"),be=s.interopDefault(fe),xe=t("./storage"),Ce=s.interopDefault(xe),ze=t("./plugins"),Ye=s.interopDefault(ze);let ot=0,ve=[];class _e extends u.default{constructor(Qe,Ze){super(),this.id=++ot;let ut=h.mergeDeep(_e.option,Qe);if(ut.container=Qe.container,this.option=(0,l.default)(ut,p.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.template=new I.default(this),this.events=new Q.default(this),this.storage=new Ce.default(this),this.icons=new oe.default(this),this.i18n=new R.default(this),this.notice=new le.default(this),this.player=new N.default(this),this.layers=new O.default(this),this.controls=new L.default(this),this.contextmenu=new x.default(this),this.subtitle=new $.default(this),this.info=new U.default(this),this.loading=new W.default(this),this.hotkey=new ee.default(this),this.mask=new me.default(this),this.setting=new be.default(this),this.plugins=new Ye.default(this),typeof Ze=="function"&&this.on("ready",()=>Ze.call(this,this)),_e.DEBUG){let st=pt=>console.log(`[ART.${this.id}] -> ${pt}`);st("Version@"+_e.version),st("Env@"+_e.env),st("Build@"+_e.build);for(let pt=0;pt<y.default.events.length;pt++)this.on("video:"+y.default.events[pt],Et=>st("Event@"+Et.type))}ve.push(this)}static get instances(){return ve}static get version(){return"5.2.2"}static get env(){return"production"}static get build(){return"2025-01-19 17:32:44"}static get config(){return y.default}static get utils(){return h}static get scheme(){return p.default}static get Emitter(){return u.default}static get validator(){return l.default}static get kindOf(){return l.default.kindOf}static get html(){return I.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,proxy:void 0,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],thumbnails:{url:"",number:60,column:10,width:0,height:0,scale:1},subtitle:{url:"",type:"",style:{},name:"",escape:!0,encoding:"utf-8",onVttLoad:Qe=>Qe},moreVideoAttr:{controls:!1,preload:h.isSafari?"auto":"metadata"},i18n:{},icons:{},cssVar:{},customType:{},lang:navigator==null?void 0:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(Qe=!0){this.events.destroy(),this.template.destroy(Qe),ve.splice(ve.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}r.default=_e,_e.STYLE=o.default,_e.DEBUG=!1,_e.CONTEXTMENU=!0,_e.NOTICE_TIME=2e3,_e.SETTING_WIDTH=250,_e.SETTING_ITEM_WIDTH=200,_e.SETTING_ITEM_HEIGHT=35,_e.RESIZE_TIME=200,_e.SCROLL_TIME=200,_e.SCROLL_GAP=50,_e.AUTO_PLAYBACK_MAX=10,_e.AUTO_PLAYBACK_MIN=5,_e.AUTO_PLAYBACK_TIMEOUT=3e3,_e.RECONNECT_TIME_MAX=5,_e.RECONNECT_SLEEP_TIME=1e3,_e.CONTROL_HIDE_TIME=3e3,_e.DBCLICK_TIME=300,_e.DBCLICK_FULLSCREEN=!0,_e.MOBILE_DBCLICK_PLAY=!0,_e.MOBILE_CLICK_PLAY=!1,_e.AUTO_ORIENTATION_TIME=200,_e.INFO_LOOP_TIME=1e3,_e.FAST_FORWARD_VALUE=3,_e.FAST_FORWARD_TIME=1e3,_e.TOUCH_MOVE_RATIO=.5,_e.VOLUME_STEP=.1,_e.SEEK_STEP=5,_e.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],_e.ASPECT_RATIO=["default","4:3","16:9"],_e.FLIP=["normal","horizontal","vertical"],_e.FULLSCREEN_WEB_IN_BODY=!1,_e.LOG_VERSION=!0,_e.USE_RAF=!1,h.isBrowser&&(window.Artplayer=_e,h.setStyleText("artplayer-style",o.default),setTimeout(()=>{_e.LOG_VERSION&&console.log(`%c ArtPlayer %c ${_e.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},100))},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(t,i,r){i.exports='.art-video-player{--art-theme:red;--art-font-color:#fff;--art-background-color:#000;--art-text-shadow-color:#00000080;--art-transition-duration:.2s;--art-padding:10px;--art-border-radius:3px;--art-progress-height:6px;--art-progress-color:#ffffff40;--art-hover-color:#ffffff40;--art-loaded-color:#ffffff40;--art-state-size:80px;--art-state-opacity:.8;--art-bottom-height:100px;--art-bottom-offset:20px;--art-bottom-gap:5px;--art-highlight-width:8px;--art-highlight-color:#ffffff80;--art-control-height:46px;--art-control-opacity:.75;--art-control-icon-size:36px;--art-control-icon-scale:1.1;--art-volume-height:120px;--art-volume-handle-size:14px;--art-lock-size:36px;--art-indicator-scale:0;--art-indicator-size:16px;--art-fullscreen-web-index:9999;--art-settings-icon-size:24px;--art-settings-max-height:300px;--art-selector-max-height:300px;--art-contextmenus-min-width:250px;--art-subtitle-font-size:20px;--art-subtitle-gap:5px;--art-subtitle-bottom:15px;--art-subtitle-border:#000;--art-widget-background:#000000d9;--art-tip-background:#000000b3;--art-scrollbar-size:4px;--art-scrollbar-background:#ffffff40;--art-scrollbar-background-hover:#ffffff80;--art-mini-progress-height:2px}.art-bg-cover{background-position:50%;background-repeat:no-repeat;background-size:cover}.art-bottom-gradient{background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x}.art-backdrop-filter{backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.art-video-player{zoom:1;text-align:left;user-select:none;box-sizing:border-box;color:var(--art-font-color);background-color:var(--art-background-color);text-shadow:0 0 2px var(--art-text-shadow-color);-webkit-tap-highlight-color:#0000;-ms-touch-action:manipulation;touch-action:manipulation;-ms-high-contrast-adjust:none;direction:ltr;outline:0;width:100%;height:100%;margin:0 auto;padding:0;font-family:PingFang SC,Helvetica Neue,Microsoft YaHei,Roboto,Arial,sans-serif;font-size:14px;line-height:1.3;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box}.art-video-player ::-webkit-scrollbar{width:var(--art-scrollbar-size);height:var(--art-scrollbar-size)}.art-video-player ::-webkit-scrollbar-thumb{background-color:var(--art-scrollbar-background)}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:var(--art-scrollbar-background-hover)}.art-video-player img{vertical-align:top;max-width:100%}.art-video-player svg{fill:var(--art-font-color)}.art-video-player a{color:var(--art-font-color);text-decoration:none}.art-icon{justify-content:center;align-items:center;line-height:1;display:flex}.art-video-player.art-backdrop .art-contextmenus,.art-video-player.art-backdrop .art-info,.art-video-player.art-backdrop .art-settings,.art-video-player.art-backdrop .art-layer-auto-playback,.art-video-player.art-backdrop .art-selector-list,.art-video-player.art-backdrop .art-volume-inner{backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-video{z-index:10;cursor:pointer;width:100%;height:100%;position:absolute;inset:0}.art-poster{z-index:11;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;width:100%;height:100%;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;text-align:center;pointer-events:none;justify-content:center;align-items:center;gap:var(--art-subtitle-gap);bottom:var(--art-subtitle-bottom);font-size:var(--art-subtitle-font-size);transition:bottom var(--art-transition-duration)ease;text-shadow:var(--art-subtitle-border)1px 0 1px,var(--art-subtitle-border)0 1px 1px,var(--art-subtitle-border)-1px 0 1px,var(--art-subtitle-border)0 -1px 1px,var(--art-subtitle-border)1px 1px 1px,var(--art-subtitle-border)-1px -1px 1px,var(--art-subtitle-border)1px -1px 1px,var(--art-subtitle-border)-1px 1px 1px;flex-direction:column;width:100%;padding:0 5%;display:none;position:absolute}.art-video-player.art-subtitle-show .art-subtitle{display:flex}.art-video-player.art-control-show .art-subtitle{bottom:calc(var(--art-control-height) + var(--art-subtitle-bottom))}.art-danmuku{z-index:30;pointer-events:none;width:100%;height:100%;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;pointer-events:none;width:100%;height:100%;display:none;position:absolute;inset:0}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:flex}.art-video-player .art-mask{z-index:50;pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:flex;position:absolute;inset:0}.art-video-player .art-mask .art-state{opacity:0;width:var(--art-state-size);height:var(--art-state-size);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;display:flex;transform:scale(2)}.art-video-player.art-mask-show .art-state{cursor:pointer;pointer-events:auto;opacity:var(--art-state-opacity);transform:scale(1)}.art-video-player.art-loading-show .art-state{display:none}.art-video-player .art-loading{z-index:70;pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;opacity:0;pointer-events:none;padding:0 var(--art-padding);transition:all var(--art-transition-duration)ease;background-size:100% var(--art-bottom-height);background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:flex-end;width:100%;height:100%;display:flex;position:absolute;inset:0;overflow:hidden}.art-video-player .art-bottom .art-controls,.art-video-player .art-bottom .art-progress{transform:translateY(var(--art-bottom-offset));transition:transform var(--art-transition-duration)ease}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1}.art-video-player.art-control-show .art-bottom .art-controls,.art-video-player.art-hover .art-bottom .art-controls,.art-video-player.art-control-show .art-bottom .art-progress,.art-video-player.art-hover .art-bottom .art-progress{transform:translateY(0)}.art-bottom .art-progress{z-index:0;pointer-events:auto;padding-bottom:var(--art-bottom-gap);position:relative}.art-bottom .art-progress .art-control-progress{cursor:pointer;height:var(--art-progress-height);justify-content:center;align-items:center;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner{transition:height var(--art-transition-duration)ease;background-color:var(--art-progress-color);align-items:center;width:100%;height:50%;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-hover{z-index:0;background-color:var(--art-hover-color);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;background-color:var(--art-loaded-color);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;background-color:var(--art-theme);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;pointer-events:none;width:100%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{z-index:0;pointer-events:auto;transform:translateX(calc(var(--art-highlight-width)/-2));background-color:var(--art-highlight-color);width:100%;height:100%;position:absolute;inset:0 auto 0 0;width:var(--art-highlight-width)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{z-index:40;width:var(--art-indicator-size);height:var(--art-indicator-size);transform:scale(var(--art-indicator-scale));margin-left:calc(var(--art-indicator-size)/-2);transition:transform var(--art-transition-duration)ease;border-radius:50%;justify-content:center;align-items:center;display:flex;position:absolute;left:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{pointer-events:none;width:100%;height:100%}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:active{transform:scale(1)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;border-radius:var(--art-border-radius);white-space:nowrap;background-color:var(--art-tip-background);padding:3px 5px;font-size:12px;line-height:1;display:none;position:absolute;top:-25px;left:0}.art-bottom .art-progress .art-control-progress:hover .art-control-progress-inner{height:100%}.art-bottom .art-progress .art-control-thumbnails{bottom:calc(var(--art-bottom-gap) + 10px);border-radius:var(--art-border-radius);pointer-events:none;background-color:var(--art-widget-background);display:none;position:absolute;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{transform:scale(1)}.art-controls{z-index:10;pointer-events:auto;height:var(--art-control-height);justify-content:space-between;align-items:center;display:flex;position:relative}.art-controls .art-controls-left,.art-controls .art-controls-right{height:100%;display:flex}.art-controls .art-controls-center{flex:1;justify-content:center;align-items:center;height:100%;padding:0 10px;display:none}.art-controls .art-controls-right{justify-content:flex-end}.art-controls .art-control{cursor:pointer;white-space:nowrap;opacity:var(--art-control-opacity);min-height:var(--art-control-height);min-width:var(--art-control-height);transition:opacity var(--art-transition-duration)ease;flex-shrink:0;justify-content:center;align-items:center;display:flex}.art-controls .art-control .art-icon{height:var(--art-control-icon-size);width:var(--art-control-icon-size);transform:scale(var(--art-control-icon-scale));transition:transform var(--art-transition-duration)ease}.art-controls .art-control .art-icon:active{transform:scale(calc(var(--art-control-icon-scale)*.8))}.art-controls .art-control:hover{opacity:1}.art-control-volume{position:relative}.art-control-volume .art-volume-panel{text-align:center;cursor:default;opacity:0;pointer-events:none;left:0;right:0;bottom:var(--art-control-height);width:var(--art-control-height);height:var(--art-volume-height);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;padding:0 5px;font-size:12px;display:flex;position:absolute;transform:translateY(10px)}.art-control-volume .art-volume-panel .art-volume-inner{border-radius:var(--art-border-radius);background-color:var(--art-widget-background);flex-direction:column;align-items:center;gap:10px;width:100%;height:100%;padding:10px 0 12px;display:flex}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider{cursor:pointer;flex:1;justify-content:center;width:100%;display:flex;position:relative}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle{border-radius:var(--art-border-radius);background-color:#ffffff40;justify-content:center;width:2px;display:flex;position:relative;overflow:hidden}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle .art-volume-loaded{z-index:0;background-color:var(--art-theme);width:100%;height:100%;position:absolute;inset:0}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-indicator{width:var(--art-volume-handle-size);height:var(--art-volume-handle-size);margin-top:calc(var(--art-volume-handle-size)/-2);background-color:var(--art-theme);transition:transform var(--art-transition-duration)ease;border-radius:100%;flex-shrink:0;position:absolute;transform:scale(1)}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider:active .art-volume-indicator{transform:scale(.9)}.art-control-volume:hover .art-volume-panel{opacity:1;pointer-events:auto;transform:translateY(0)}.art-video-player .art-notice{z-index:80;padding:var(--art-padding);pointer-events:none;width:100%;height:auto;display:none;position:absolute;inset:0 0 auto}.art-video-player .art-notice .art-notice-inner{border-radius:var(--art-border-radius);background-color:var(--art-tip-background);padding:5px;line-height:1;display:inline-flex}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);min-width:var(--art-contextmenus-min-width);flex-direction:column;padding:5px 0;font-size:12px;display:none;position:absolute}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;border-bottom:1px solid #ffffff1a;padding:10px 15px;display:flex}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 8px}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--art-theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;border-radius:var(--art-border-radius);max-height:var(--art-settings-max-height);left:auto;right:var(--art-padding);bottom:var(--art-control-height);transition:all var(--art-transition-duration)ease;background-color:var(--art-widget-background);flex-direction:column;display:none;position:absolute;overflow:hidden auto}.art-video-player .art-settings .art-setting-panel{flex-direction:column;display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item{cursor:pointer;transition:background-color var(--art-transition-duration)ease;justify-content:space-between;align-items:center;padding:0 5px;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--art-theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{flex-shrink:0;justify-content:center;align-items:center;gap:5px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:var(--art-settings-icon-size);width:var(--art-settings-icon-size);justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{justify-content:center;align-items:center;gap:5px;font-size:12px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{justify-content:center;align-items:center;min-width:32px;height:24px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{appearance:none;background-color:#fff3;outline:none;width:80px;height:3px}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:flex}.art-video-player .art-info{left:var(--art-padding);top:var(--art-padding);z-index:100;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);padding:10px;font-size:12px;display:none;position:absolute}.art-video-player .art-info .art-info-panel{flex-direction:column;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item{align-items:center;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item .art-info-title{text-align:right;width:100px}.art-video-player .art-info .art-info-panel .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;width:250px;overflow:hidden}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio]{overflow:hidden}.art-video-player[data-aspect-ratio] .art-video{object-fit:fill;box-sizing:content-box}.art-fullscreen{--art-progress-height:8px;--art-indicator-size:20px;--art-control-height:60px;--art-control-icon-scale:1.3}.art-fullscreen-web{--art-progress-height:8px;--art-indicator-size:20px;--art-control-height:60px;--art-control-icon-scale:1.3;z-index:var(--art-fullscreen-web-index);width:100%;height:100%;position:fixed;inset:0}.art-mini-popup{z-index:9999;border-radius:var(--art-border-radius);cursor:move;user-select:none;background:#000;width:320px;height:180px;transition:opacity .2s;position:fixed;overflow:hidden;box-shadow:0 0 5px #00000080}.art-mini-popup svg{fill:#fff}.art-mini-popup .art-video{pointer-events:none}.art-mini-popup .art-mini-close{z-index:20;cursor:pointer;opacity:0;transition:opacity .2s;position:absolute;top:10px;right:10px}.art-mini-popup .art-mini-state{z-index:30;pointer-events:none;opacity:0;background-color:#00000040;justify-content:center;align-items:center;width:100%;height:100%;transition:opacity .2s;display:flex;position:absolute;inset:0}.art-mini-popup .art-mini-state .art-icon{opacity:.75;cursor:pointer;pointer-events:auto;transition:transform .2s;transform:scale(3)}.art-mini-popup .art-mini-state .art-icon:active{transform:scale(2.5)}.art-mini-popup.art-mini-droging{opacity:.9}.art-mini-popup:hover .art-mini-close,.art-mini-popup:hover .art-mini-state{opacity:1}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-lock{height:var(--art-lock-size);width:var(--art-lock-size);top:50%;left:var(--art-padding);background-color:var(--art-tip-background);border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;transform:translateY(-50%)}.art-video-player .art-layer-auto-playback{border-radius:var(--art-border-radius);left:var(--art-padding);bottom:calc(var(--art-control-height) + var(--art-bottom-gap) + 10px);background-color:var(--art-widget-background);align-items:center;gap:10px;padding:10px;line-height:1;display:none;position:absolute}.art-video-player .art-layer-auto-playback .art-auto-playback-close{cursor:pointer;justify-content:center;align-items:center;display:flex}.art-video-player .art-layer-auto-playback .art-auto-playback-close svg{fill:var(--art-theme);width:15px;height:15px}.art-video-player .art-layer-auto-playback .art-auto-playback-jump{color:var(--art-theme);cursor:pointer}.art-video-player.art-lock .art-subtitle{bottom:var(--art-subtitle-bottom)!important}.art-video-player.art-mini-progress-bar .art-bottom,.art-video-player.art-lock .art-bottom{opacity:1;background-image:none;padding:0}.art-video-player.art-mini-progress-bar .art-bottom .art-controls,.art-video-player.art-lock .art-bottom .art-controls,.art-video-player.art-mini-progress-bar .art-bottom .art-progress,.art-video-player.art-lock .art-bottom .art-progress{transform:translateY(calc(var(--art-control-height) + var(--art-bottom-gap) + var(--art-progress-height)/4))}.art-video-player.art-mini-progress-bar .art-bottom .art-progress-indicator,.art-video-player.art-lock .art-bottom .art-progress-indicator{display:none!important}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-control-selector{justify-content:center;display:flex;position:relative}.art-control-selector .art-selector-list{text-align:center;border-radius:var(--art-border-radius);opacity:0;pointer-events:none;bottom:var(--art-control-height);max-height:var(--art-selector-max-height);background-color:var(--art-widget-background);transition:all var(--art-transition-duration)ease;flex-direction:column;align-items:center;display:flex;position:absolute;overflow:hidden auto;transform:translateY(10px)}.art-control-selector .art-selector-list .art-selector-item{flex-shrink:0;justify-content:center;align-items:center;width:100%;padding:10px 15px;line-height:1;display:flex}.art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-control-selector .art-selector-list .art-selector-item:hover,.art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--art-theme)}.art-control-selector:hover .art-selector-list{opacity:1;pointer-events:auto;transform:translateY(0)}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}.art-video-player.art-mobile{--art-bottom-gap:10px;--art-control-height:38px;--art-control-icon-scale:1;--art-state-size:60px;--art-settings-max-height:180px;--art-selector-max-height:180px;--art-indicator-scale:1;--art-control-opacity:1}.art-video-player.art-mobile .art-controls-left{margin-left:calc(var(--art-padding)/-1)}.art-video-player.art-mobile .art-controls-right{margin-right:calc(var(--art-padding)/-1)}'},{}],bAWi2:[function(t,i,r){var s;s=function(){function n(f){return(n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(f)}var o=Object.prototype.toString,a=function(f){if(f===void 0)return"undefined";if(f===null)return"null";var p=n(f);if(p==="boolean")return"boolean";if(p==="string")return"string";if(p==="number")return"number";if(p==="symbol")return"symbol";if(p==="function")return l(f)==="GeneratorFunction"?"generatorfunction":"function";if(Array.isArray?Array.isArray(f):f instanceof Array)return"array";if(f.constructor&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f))return"buffer";if(function(_){try{if(typeof _.length=="number"&&typeof _.callee=="function")return!0}catch(y){if(y.message.indexOf("callee")!==-1)return!0}return!1}(f))return"arguments";if(f instanceof Date||typeof f.toDateString=="function"&&typeof f.getDate=="function"&&typeof f.setDate=="function")return"date";if(f instanceof Error||typeof f.message=="string"&&f.constructor&&typeof f.constructor.stackTraceLimit=="number")return"error";if(f instanceof RegExp||typeof f.flags=="string"&&typeof f.ignoreCase=="boolean"&&typeof f.multiline=="boolean"&&typeof f.global=="boolean")return"regexp";switch(l(f)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(typeof f.throw=="function"&&typeof f.return=="function"&&typeof f.next=="function")return"generator";switch(p=o.call(f)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return p.slice(8,-1).toLowerCase().replace(/\s/g,"")};function l(f){return f.constructor?f.constructor.name:null}function d(f,p){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return u(f,p,_),h(f,p,_),function(y,b,I){var T=a(b),R=a(y);if(T==="object"){if(R!=="object")throw Error("[Type Error]: '".concat(I.join("."),"' require 'object' type, but got '").concat(R,"'"));Object.keys(b).forEach(function(M){var N=y[M],P=b[M],L=I.slice();L.push(M),u(N,P,L),h(N,P,L),d(N,P,L)})}if(T==="array"){if(R!=="array")throw Error("[Type Error]: '".concat(I.join("."),"' require 'array' type, but got '").concat(R,"'"));y.forEach(function(M,N){var P=y[N],L=b[N]||b[0],A=I.slice();A.push(N),u(P,L,A),h(P,L,A),d(P,L,A)})}}(f,p,_),f}function u(f,p,_){if(a(p)==="string"){var y=a(f);if(p[0]==="?"&&(p=p.slice(1)+"|undefined"),!(-1<p.indexOf("|")?p.split("|").map(function(b){return b.toLowerCase().trim()}).filter(Boolean).some(function(b){return y===b}):p.toLowerCase().trim()===y))throw Error("[Type Error]: '".concat(_.join("."),"' require '").concat(p,"' type, but got '").concat(y,"'"))}}function h(f,p,_){if(a(p)==="function"){var y=p(f,a(f),_);if(y!==!0){var b=a(y);throw b==="string"?Error(y):b==="error"?y:Error("[Validator Error]: The scheme for '".concat(_.join("."),"' validator require return true, but got '").concat(y,"'"))}}}return d.kindOf=a,d},i.exports=s()},{}],"66mFZ":[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=class{on(s,n,o){let a=this.e||(this.e={});return(a[s]||(a[s]=[])).push({fn:n,ctx:o}),this}once(s,n,o){let a=this;function l(...d){a.off(s,l),n.apply(o,d)}return l._=n,this.on(s,l,o)}emit(s,...n){let o=((this.e||(this.e={}))[s]||[]).slice();for(let a=0;a<o.length;a+=1)o[a].fn.apply(o[a].ctx,n);return this}off(s,n){let o=this.e||(this.e={}),a=o[s],l=[];if(a&&n)for(let d=0,u=a.length;d<u;d+=1)a[d].fn!==n&&a[d].fn._!==n&&l.push(a[d]);return l.length?o[s]=l:delete o[s],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(t,i,r){r.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},r.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},r.exportAll=function(s,n){return Object.keys(s).forEach(function(o){o==="default"||o==="__esModule"||Object.prototype.hasOwnProperty.call(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[o]}})}),n},r.export=function(s,n,o){Object.defineProperty(s,n,{enumerable:!0,get:o})}},{}],"71aH7":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./dom");s.exportAll(n,r);var o=t("./error");s.exportAll(o,r);var a=t("./subtitle");s.exportAll(a,r);var l=t("./file");s.exportAll(l,r);var d=t("./property");s.exportAll(d,r);var u=t("./time");s.exportAll(u,r);var h=t("./format");s.exportAll(h,r);var f=t("./compatibility");s.exportAll(f,r)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"query",()=>o),s.export(r,"queryAll",()=>a),s.export(r,"addClass",()=>l),s.export(r,"removeClass",()=>d),s.export(r,"hasClass",()=>u),s.export(r,"append",()=>h),s.export(r,"remove",()=>f),s.export(r,"setStyle",()=>p),s.export(r,"setStyles",()=>_),s.export(r,"getStyle",()=>y),s.export(r,"sublings",()=>b),s.export(r,"inverseClass",()=>I),s.export(r,"tooltip",()=>T),s.export(r,"isInViewport",()=>R),s.export(r,"includeFromEvent",()=>M),s.export(r,"replaceElement",()=>N),s.export(r,"createElement",()=>P),s.export(r,"getIcon",()=>L),s.export(r,"setStyleText",()=>A),s.export(r,"supportsFlex",()=>x),s.export(r,"getRect",()=>k),s.export(r,"loadImg",()=>U);var n=t("./compatibility");function o(K,$=document){return $.querySelector(K)}function a(K,$=document){return Array.from($.querySelectorAll(K))}function l(K,$){return K.classList.add($)}function d(K,$){return K.classList.remove($)}function u(K,$){return K.classList.contains($)}function h(K,$){return $ instanceof Element?K.appendChild($):K.insertAdjacentHTML("beforeend",String($)),K.lastElementChild||K.lastChild}function f(K){return K.parentNode.removeChild(K)}function p(K,$,j){return K.style[$]=j,K}function _(K,$){for(let j in $)p(K,j,$[j]);return K}function y(K,$,j=!0){let Q=window.getComputedStyle(K,null).getPropertyValue($);return j?parseFloat(Q):Q}function b(K){return Array.from(K.parentElement.children).filter($=>$!==K)}function I(K,$){b(K).forEach(j=>d(j,$)),l(K,$)}function T(K,$,j="top"){n.isMobile||(K.setAttribute("aria-label",$),l(K,"hint--rounded"),l(K,`hint--${j}`))}function R(K,$=0){let j=K.getBoundingClientRect(),Q=window.innerHeight||document.documentElement.clientHeight,ie=window.innerWidth||document.documentElement.clientWidth,ee=j.top-$<=Q&&j.top+j.height+$>=0,F=j.left-$<=ie+$&&j.left+j.width+$>=0;return ee&&F}function M(K,$){return K.composedPath&&K.composedPath().indexOf($)>-1}function N(K,$){return $.parentNode.replaceChild(K,$),K}function P(K){return document.createElement(K)}function L(K="",$=""){let j=P("i");return l(j,"art-icon"),l(j,`art-icon-${K}`),h(j,$),j}function A(K,$){let j=document.getElementById(K);j||((j=document.createElement("style")).id=K,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.head.appendChild(j)}):(document.head||document.documentElement).appendChild(j)),j.textContent=$}function x(){let K=document.createElement("div");return K.style.display="flex",K.style.display==="flex"}function k(K){return K.getBoundingClientRect()}function U(K,$){return new Promise((j,Q)=>{let ie=new Image;ie.onload=function(){if($&&$!==1){let ee=document.createElement("canvas"),F=ee.getContext("2d");ee.width=ie.width*$,ee.height=ie.height*$,F.drawImage(ie,0,0,ee.width,ee.height),ee.toBlob(O=>{let H=URL.createObjectURL(O),W=new Image;W.onload=function(){j(W)},W.onerror=function(){URL.revokeObjectURL(H),Q(Error(`Image load failed: ${K}`))},W.src=H})}else j(ie)},ie.onerror=function(){Q(Error(`Image load failed: ${K}`))},ie.src=K})}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"userAgent",()=>n),s.export(r,"isSafari",()=>o),s.export(r,"isWechat",()=>a),s.export(r,"isIE",()=>l),s.export(r,"isAndroid",()=>d),s.export(r,"isIOS",()=>u),s.export(r,"isIOS13",()=>h),s.export(r,"isMobile",()=>f),s.export(r,"isBrowser",()=>p);let n=typeof navigator<"u"?navigator.userAgent:"",o=/^((?!chrome|android).)*safari/i.test(n),a=/MicroMessenger/i.test(n),l=/MSIE|Trident/i.test(n),d=/android/i.test(n),u=/iPad|iPhone|iPod/i.test(n)&&!window.MSStream,h=u||n.includes("Macintosh")&&navigator.maxTouchPoints>=1,f=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n)||h,p=typeof window<"u"},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ArtPlayerError",()=>n),s.export(r,"errorHandle",()=>o);class n extends Error{constructor(l,d){super(l),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,d||this.constructor),this.name="ArtPlayerError"}}function o(a,l){if(!a)throw new n(l);return a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(l){return`WEBVTT \r
\r
`.concat(l.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(d,u,h)=>{let f=h.slice(0,3);return h.length===1&&(f=h+"00"),h.length===2&&(f=h+"0"),`${u},${f}`}).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`))}function o(l){return URL.createObjectURL(new Blob([l],{type:"text/vtt"}))}function a(l){let d=RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function u(h=""){return h.split(/[:.]/).map((f,p,_)=>{if(p===_.length-1){if(f.length===1)return`.${f}00`;if(f.length===2)return`.${f}0`}else if(f.length===1)return(p===0?"0":":0")+f;return p===0?f:p===_.length-1?`.${f}`:`:${f}`}).join("")}return`WEBVTT

`+l.split(/\r?\n/).map(h=>{let f=h.match(d);return f?{start:u(f[1].trim()),end:u(f[2].trim()),text:f[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(p=>p.trim()).join(`
`)}:null}).filter(h=>h).map((h,f)=>h?f+1+`
${h.start} --> ${h.end}
${h.text}`:"").filter(h=>h.trim()).join(`

`)}s.defineInteropFlag(r),s.export(r,"srtToVtt",()=>n),s.export(r,"vttToBlob",()=>o),s.export(r,"assToVtt",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){let l=document.createElement("a");l.style.display="none",l.href=o,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l)}s.defineInteropFlag(r),s.export(r,"getExt",()=>function o(a){return a.includes("?")?o(a.split("?")[0]):a.includes("#")?o(a.split("#")[0]):a.trim().toLowerCase().split(".").pop()}),s.export(r,"download",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"def",()=>n),s.export(r,"has",()=>a),s.export(r,"get",()=>l),s.export(r,"mergeDeep",()=>function d(...u){let h=f=>f&&typeof f=="object"&&!Array.isArray(f);return u.reduce((f,p)=>(Object.keys(p).forEach(_=>{let y=f[_],b=p[_];Array.isArray(y)&&Array.isArray(b)?f[_]=y.concat(...b):h(y)&&h(b)?f[_]=d(y,b):f[_]=b}),f),{})});let n=Object.defineProperty,{hasOwnProperty:o}=Object.prototype;function a(d,u){return o.call(d,u)}function l(d,u){return Object.getOwnPropertyDescriptor(d,u)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(l=0){return new Promise(d=>setTimeout(d,l))}function o(l,d){let u;return function(...h){clearTimeout(u),u=setTimeout(()=>(u=null,l.apply(this,h)),d)}}function a(l,d){let u=!1;return function(...h){u||(l.apply(this,h),u=!0,setTimeout(function(){u=!1},d))}}s.defineInteropFlag(r),s.export(r,"sleep",()=>n),s.export(r,"debounce",()=>o),s.export(r,"throttle",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(u,h,f){return Math.max(Math.min(u,Math.max(h,f)),Math.min(h,f))}function o(u){return u.charAt(0).toUpperCase()+u.slice(1)}function a(u){if(!u)return"00:00";let h=Math.floor(u/3600),f=Math.floor((u-3600*h)/60),p=Math.floor(u-3600*h-60*f);return(h>0?[h,f,p]:[f,p]).map(_=>_<10?`0${_}`:String(_)).join(":")}function l(u){return u.replace(/[&<>'"]/g,h=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[h]||h)}function d(u){let h={"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&quot;":'"'},f=RegExp(`(${Object.keys(h).join("|")})`,"g");return u.replace(f,p=>h[p]||p)}s.defineInteropFlag(r),s.export(r,"clamp",()=>n),s.export(r,"capitalize",()=>o),s.export(r,"secondToTime",()=>a),s.export(r,"escape",()=>l),s.export(r,"unescape",()=>d)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ComponentOption",()=>p);var n=t("../utils");let o="array",a="boolean",l="string",d="number",u="object",h="function";function f(_,y,b){return(0,n.errorHandle)(y===l||y===d||_ instanceof Element,`${b.join(".")} require '${l}' or 'Element' type`)}let p={html:f,disable:`?${a}`,name:`?${l}`,index:`?${d}`,style:`?${u}`,click:`?${h}`,mounted:`?${h}`,tooltip:`?${l}|${d}`,width:`?${d}`,selector:`?${o}`,onSelect:`?${h}`,switch:`?${a}`,onSwitch:`?${h}`,range:`?${o}`,onRange:`?${h}`,onChange:`?${h}`};r.default={id:l,container:f,url:l,poster:l,type:l,theme:l,lang:l,volume:d,isLive:a,muted:a,autoplay:a,autoSize:a,autoMini:a,loop:a,flip:a,playbackRate:a,aspectRatio:a,screenshot:a,setting:a,hotkey:a,pip:a,mutex:a,backdrop:a,fullscreen:a,fullscreenWeb:a,subtitleOffset:a,miniProgressBar:a,useSSR:a,playsInline:a,lock:a,fastForward:a,autoPlayback:a,autoOrientation:a,airplay:a,proxy:`?${h}`,plugins:[h],layers:[p],contextmenu:[p],settings:[p],controls:[{...p,position:(_,y,b)=>{let I=["top","left","right"];return(0,n.errorHandle)(I.includes(_),`${b.join(".")} only accept ${I.toString()} as parameters`)}}],quality:[{default:`?${a}`,html:l,url:l}],highlight:[{time:d,text:l}],thumbnails:{url:l,number:d,column:d,width:d,height:d,scale:d},subtitle:{url:l,name:l,type:l,style:u,escape:a,encoding:l,onVttLoad:h},moreVideoAttr:u,i18n:u,icons:u,cssVar:u,customType:u}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=t("./utils");class n{constructor(a){this.art=a;let{option:l,constructor:d}=a;l.container instanceof Element?this.$container=l.container:(this.$container=(0,s.query)(l.container),(0,s.errorHandle)(this.$container,`No container element found by ${l.container}`)),(0,s.errorHandle)((0,s.supportsFlex)(),"The current browser does not support flex layout");let u=this.$container.tagName.toLowerCase();(0,s.errorHandle)(u==="div",`Unsupported container element type, only support 'div' but got '${u}'`),(0,s.errorHandle)(d.instances.every(h=>h.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=a.id,this.init()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">5.2.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span>x<span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-contextmenus"></div></div>'}query(a){return(0,s.query)(a,this.$container)}init(){let{option:a}=this.art;if(a.useSSR||(this.$container.innerHTML=n.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$contextmenu=this.query(".art-contextmenus"),a.proxy){let l=a.proxy.call(this.art,this.art);(0,s.errorHandle)(l instanceof HTMLVideoElement||l instanceof HTMLCanvasElement,"Function 'option.proxy' needs to return 'HTMLVideoElement' or 'HTMLCanvasElement'"),(0,s.replaceElement)(l,this.$video),l.className="art-video",this.$video=l}a.backdrop&&(0,s.addClass)(this.$player,"art-backdrop"),s.isMobile&&(0,s.addClass)(this.$player,"art-mobile")}destroy(a){a?this.$container.innerHTML="":(0,s.addClass)(this.$player,"art-destroy")}}r.default=n},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("../utils"),o=t("./zh-cn"),a=s.interopDefault(o);r.default=class{constructor(l){this.art=l,this.languages={"zh-cn":a.default},this.language={},this.update(l.option.i18n)}init(){let l=this.art.option.lang.toLowerCase();this.language=this.languages[l]||{}}get(l){return this.language[l]||l}update(l){this.languages=(0,n.mergeDeep)(this.languages,l),this.init()}}},{"../utils":"71aH7","./zh-cn":"5Y91w","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5Y91w":[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let s={"Video Info":"统计信息",Close:"关闭","Video Load Failed":"加载失败",Volume:"音量",Play:"播放",Pause:"暂停",Rate:"速度",Mute:"静音","Video Flip":"画面翻转",Horizontal:"水平",Vertical:"垂直",Reconnect:"重新连接","Show Setting":"显示设置","Hide Setting":"隐藏设置",Screenshot:"截图","Play Speed":"播放速度","Aspect Ratio":"画面比例",Default:"默认",Normal:"正常",Open:"打开","Switch Video":"切换","Switch Subtitle":"切换字幕",Fullscreen:"全屏","Exit Fullscreen":"退出全屏","Web Fullscreen":"网页全屏","Exit Web Fullscreen":"退出网页全屏","Mini Player":"迷你播放器","PIP Mode":"开启画中画","Exit PIP Mode":"退出画中画","PIP Not Supported":"不支持画中画","Fullscreen Not Supported":"不支持全屏","Subtitle Offset":"字幕偏移","Last Seen":"上次看到","Jump Play":"跳转播放",AirPlay:"隔空播放","AirPlay Not Available":"隔空播放不可用"};r.default=s,typeof window<"u"&&(window["artplayer-i18n-zh-cn"]=s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],a90nx:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./urlMix"),o=s.interopDefault(n),a=t("./attrMix"),l=s.interopDefault(a),d=t("./playMix"),u=s.interopDefault(d),h=t("./pauseMix"),f=s.interopDefault(h),p=t("./toggleMix"),_=s.interopDefault(p),y=t("./seekMix"),b=s.interopDefault(y),I=t("./volumeMix"),T=s.interopDefault(I),R=t("./currentTimeMix"),M=s.interopDefault(R),N=t("./durationMix"),P=s.interopDefault(N),L=t("./switchMix"),A=s.interopDefault(L),x=t("./playbackRateMix"),k=s.interopDefault(x),U=t("./aspectRatioMix"),K=s.interopDefault(U),$=t("./screenshotMix"),j=s.interopDefault($),Q=t("./fullscreenMix"),ie=s.interopDefault(Q),ee=t("./fullscreenWebMix"),F=s.interopDefault(ee),O=t("./pipMix"),H=s.interopDefault(O),W=t("./loadedMix"),ae=s.interopDefault(W),le=t("./playedMix"),ye=s.interopDefault(le),me=t("./playingMix"),re=s.interopDefault(me),oe=t("./autoSizeMix"),fe=s.interopDefault(oe),be=t("./rectMix"),xe=s.interopDefault(be),Ce=t("./flipMix"),ze=s.interopDefault(Ce),Ye=t("./miniMix"),ot=s.interopDefault(Ye),ve=t("./posterMix"),_e=s.interopDefault(ve),Je=t("./autoHeightMix"),Qe=s.interopDefault(Je),Ze=t("./cssVarMix"),ut=s.interopDefault(Ze),st=t("./themeMix"),pt=s.interopDefault(st),Et=t("./typeMix"),Yt=s.interopDefault(Et),St=t("./stateMix"),wt=s.interopDefault(St),bi=t("./subtitleOffsetMix"),ai=s.interopDefault(bi),oi=t("./airplayMix"),Nt=s.interopDefault(oi),Lr=t("./qualityMix"),Rr=s.interopDefault(Lr),Ir=t("./thumbnailsMix"),wr=s.interopDefault(Ir),Dr=t("./optionInit"),Cr=s.interopDefault(Dr),kr=t("./eventInit"),Pr=s.interopDefault(kr);r.default=class{constructor(Fe){(0,o.default)(Fe),(0,l.default)(Fe),(0,u.default)(Fe),(0,f.default)(Fe),(0,_.default)(Fe),(0,b.default)(Fe),(0,T.default)(Fe),(0,M.default)(Fe),(0,P.default)(Fe),(0,A.default)(Fe),(0,k.default)(Fe),(0,K.default)(Fe),(0,j.default)(Fe),(0,ie.default)(Fe),(0,F.default)(Fe),(0,H.default)(Fe),(0,ae.default)(Fe),(0,ye.default)(Fe),(0,re.default)(Fe),(0,fe.default)(Fe),(0,xe.default)(Fe),(0,ze.default)(Fe),(0,ot.default)(Fe),(0,_e.default)(Fe),(0,Qe.default)(Fe),(0,ut.default)(Fe),(0,pt.default)(Fe),(0,Yt.default)(Fe),(0,wt.default)(Fe),(0,ai.default)(Fe),(0,Nt.default)(Fe),(0,Rr.default)(Fe),(0,wr.default)(Fe),(0,Pr.default)(Fe),(0,Cr.default)(Fe)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./cssVarMix":"1CaTA","./themeMix":"2FqhO","./typeMix":"1fQQs","./stateMix":"iBOQW","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./qualityMix":"5SdyX","./thumbnailsMix":"4HcqV","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{option:l,template:{$video:d}}=a;(0,n.def)(a,"url",{get:()=>d.src,async set(u){if(u){let h=a.url,f=l.type||(0,n.getExt)(u),p=l.customType[f];f&&p?(await(0,n.sleep)(),a.loading.show=!0,p.call(a,d,u,a)):(URL.revokeObjectURL(h),d.src=u),h!==a.url&&(a.option.url=u,a.isReady&&h&&a.once("video:canplay",()=>{a.emit("restart",u)}))}else await(0,n.sleep)(),a.loading.show=!0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$video:l}}=a;(0,n.def)(a,"attr",{value(d,u){if(u===void 0)return l[d];l[d]=u}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,notice:d,option:u,constructor:{instances:h},template:{$video:f}}=a;(0,n.def)(a,"play",{value:async function(){let p=await f.play();if(d.show=l.get("Play"),a.emit("play"),u.mutex)for(let _=0;_<h.length;_++){let y=h[_];y!==a&&y.pause()}return p}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$video:l},i18n:d,notice:u}=a;(0,n.def)(a,"pause",{value(){let h=l.pause();return u.show=d.get("Pause"),a.emit("pause"),h}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"toggle",{value:()=>a.playing?a.pause():a.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{notice:l}=a;(0,n.def)(a,"seek",{set(d){a.currentTime=d,a.emit("seek",a.currentTime),a.duration&&(l.show=`${(0,n.secondToTime)(a.currentTime)} / ${(0,n.secondToTime)(a.duration)}`)}}),(0,n.def)(a,"forward",{set(d){a.seek=a.currentTime+d}}),(0,n.def)(a,"backward",{set(d){a.seek=a.currentTime-d}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$video:l},i18n:d,notice:u,storage:h}=a;(0,n.def)(a,"volume",{get:()=>l.volume||0,set:f=>{l.volume=(0,n.clamp)(f,0,1),u.show=`${d.get("Volume")}: ${parseInt(100*l.volume,10)}`,l.volume!==0&&h.set("volume",l.volume)}}),(0,n.def)(a,"muted",{get:()=>l.muted,set:f=>{l.muted=f,a.emit("muted",f)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"currentTime",{get:()=>l.currentTime||0,set:d=>{Number.isNaN(d=parseFloat(d))||(l.currentTime=(0,n.clamp)(d,0,a.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"duration",{get:()=>{let{duration:l}=a.template.$video;return l===1/0?0:l||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){function l(d,u){return new Promise((h,f)=>{if(d===a.url)return;let{playing:p,aspectRatio:_,playbackRate:y}=a;a.pause(),a.url=d,a.notice.show="",a.once("video:error",f),a.once("video:loadedmetadata",()=>{a.currentTime=u}),a.once("video:canplay",async()=>{a.playbackRate=y,a.aspectRatio=_,p&&await a.play(),a.notice.show="",h()})})}(0,n.def)(a,"switchQuality",{value:d=>l(d,a.currentTime)}),(0,n.def)(a,"switchUrl",{value:d=>l(d,0)}),(0,n.def)(a,"switch",{set:a.switchUrl})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$video:l},i18n:d,notice:u}=a;(0,n.def)(a,"playbackRate",{get:()=>l.playbackRate,set(h){h?h!==l.playbackRate&&(l.playbackRate=h,u.show=`${d.get("Rate")}: ${h===1?d.get("Normal"):`${h}x`}`):a.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,notice:d,template:{$video:u,$player:h}}=a;(0,n.def)(a,"aspectRatio",{get:()=>h.dataset.aspectRatio||"default",set(f){if(f||(f="default"),f==="default")(0,n.setStyle)(u,"width",null),(0,n.setStyle)(u,"height",null),(0,n.setStyle)(u,"margin",null),delete h.dataset.aspectRatio;else{let p=f.split(":").map(Number),{clientWidth:_,clientHeight:y}=h,b=p[0]/p[1];_/y>b?((0,n.setStyle)(u,"width",`${b*y}px`),(0,n.setStyle)(u,"height","100%"),(0,n.setStyle)(u,"margin","0 auto")):((0,n.setStyle)(u,"width","100%"),(0,n.setStyle)(u,"height",`${_/b}px`),(0,n.setStyle)(u,"margin","auto 0")),h.dataset.aspectRatio=f}d.show=`${l.get("Aspect Ratio")}: ${f==="default"?l.get("Default"):f}`,a.emit("aspectRatio",f)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{notice:l,template:{$video:d}}=a,u=(0,n.createElement)("canvas");(0,n.def)(a,"getDataURL",{value:()=>new Promise((h,f)=>{try{u.width=d.videoWidth,u.height=d.videoHeight,u.getContext("2d").drawImage(d,0,0),h(u.toDataURL("image/png"))}catch(p){l.show=p,f(p)}})}),(0,n.def)(a,"getBlobUrl",{value:()=>new Promise((h,f)=>{try{u.width=d.videoWidth,u.height=d.videoHeight,u.getContext("2d").drawImage(d,0,0),u.toBlob(p=>{h(URL.createObjectURL(p))})}catch(p){l.show=p,f(p)}})}),(0,n.def)(a,"screenshot",{value:async h=>{let f=await a.getDataURL(),p=h||`artplayer_${(0,n.secondToTime)(d.currentTime)}`;return(0,n.download)(f,`${p}.png`),a.emit("screenshot",f),f}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>l);var n=t("../libs/screenfull"),o=s.interopDefault(n),a=t("../utils");function l(d){let{i18n:u,notice:h,template:{$video:f,$player:p}}=d,_=b=>{o.default.on("change",()=>{b.emit("fullscreen",o.default.isFullscreen),o.default.isFullscreen?(b.state="fullscreen",(0,a.addClass)(p,"art-fullscreen")):(0,a.removeClass)(p,"art-fullscreen"),b.emit("resize")}),o.default.on("error",I=>{b.emit("fullscreenError",I)}),(0,a.def)(b,"fullscreen",{get:()=>o.default.isFullscreen,async set(I){I?await o.default.request(p):await o.default.exit()}})},y=b=>{b.proxy(document,"webkitfullscreenchange",()=>{b.emit("fullscreen",b.fullscreen),b.emit("resize")}),(0,a.def)(b,"fullscreen",{get:()=>document.fullscreenElement===f,set(I){I?(b.state="fullscreen",f.webkitEnterFullscreen()):f.webkitExitFullscreen()}})};d.once("video:loadedmetadata",()=>{o.default.isEnabled?_(d):f.webkitSupportsFullscreen?y(d):(0,a.def)(d,"fullscreen",{get:()=>!1,set(){h.show=u.get("Fullscreen Not Supported")}}),(0,a.def)(d,"fullscreen",(0,a.get)(d,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=(()=>{if(typeof document>"u")return!1;let l=s[0],d={};for(let u of s)if(u[1]in document){for(let[h,f]of u.entries())d[l[h]]=f;return d}return!1})(),o={change:n.fullscreenchange,error:n.fullscreenerror},a={request:(l=document.documentElement,d)=>new Promise((u,h)=>{let f=()=>{a.off("change",f),u()};a.on("change",f);let p=l[n.requestFullscreen](d);p instanceof Promise&&p.then(f).catch(h)}),exit:()=>new Promise((l,d)=>{if(!a.isFullscreen){l();return}let u=()=>{a.off("change",u),l()};a.on("change",u);let h=document[n.exitFullscreen]();h instanceof Promise&&h.then(u).catch(d)}),toggle:(l,d)=>a.isFullscreen?a.exit():a.request(l,d),onchange(l){a.on("change",l)},onerror(l){a.on("error",l)},on(l,d){let u=o[l];u&&document.addEventListener(u,d,!1)},off(l,d){let u=o[l];u&&document.removeEventListener(u,d,!1)},raw:n};Object.defineProperties(a,{isFullscreen:{get:()=>!!document[n.fullscreenElement]},element:{enumerable:!0,get:()=>document[n.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>!!document[n.fullscreenEnabled]}}),n||(a={isEnabled:!1}),r.default=a},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{constructor:l,template:{$container:d,$player:u}}=a,h="";(0,n.def)(a,"fullscreenWeb",{get:()=>(0,n.hasClass)(u,"art-fullscreen-web"),set(f){f?(h=u.style.cssText,l.FULLSCREEN_WEB_IN_BODY&&(0,n.append)(document.body,u),a.state="fullscreenWeb",(0,n.setStyle)(u,"width","100%"),(0,n.setStyle)(u,"height","100%"),(0,n.addClass)(u,"art-fullscreen-web"),a.emit("fullscreenWeb",!0)):(l.FULLSCREEN_WEB_IN_BODY&&(0,n.append)(d,u),h&&(u.style.cssText=h,h=""),(0,n.removeClass)(u,"art-fullscreen-web"),a.emit("fullscreenWeb",!1)),a.emit("resize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,notice:d,template:{$video:u}}=a;document.pictureInPictureEnabled?function(h){let{template:{$video:f},proxy:p,notice:_}=h;f.disablePictureInPicture=!1,(0,n.def)(h,"pip",{get:()=>document.pictureInPictureElement,set(y){y?(h.state="pip",f.requestPictureInPicture().catch(b=>{throw _.show=b,b})):document.exitPictureInPicture().catch(b=>{throw _.show=b,b})}}),p(f,"enterpictureinpicture",()=>{h.emit("pip",!0)}),p(f,"leavepictureinpicture",()=>{h.emit("pip",!1)})}(a):u.webkitSupportsPresentationMode?function(h){let{$video:f}=h.template;f.webkitSetPresentationMode("inline"),(0,n.def)(h,"pip",{get:()=>f.webkitPresentationMode==="picture-in-picture",set(p){p?(h.state="pip",f.webkitSetPresentationMode("picture-in-picture"),h.emit("pip",!0)):(f.webkitSetPresentationMode("inline"),h.emit("pip",!1))}})}(a):(0,n.def)(a,"pip",{get:()=>!1,set(){d.show=l.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"loaded",{get:()=>a.loadedTime/l.duration}),(0,n.def)(a,"loadedTime",{get:()=>l.buffered.length?l.buffered.end(l.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"played",{get:()=>a.currentTime/a.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"playing",{get:()=>typeof l.playing=="boolean"?l.playing:l.currentTime>0&&!l.paused&&!l.ended&&l.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{$container:l,$player:d,$video:u}=a.template;(0,n.def)(a,"autoSize",{value(){let{videoWidth:h,videoHeight:f}=u,{width:p,height:_}=(0,n.getRect)(l),y=h/f;p/_>y?((0,n.setStyle)(d,"width",`${_*y/p*100}%`),(0,n.setStyle)(d,"height","100%")):((0,n.setStyle)(d,"width","100%"),(0,n.setStyle)(d,"height",`${p/y/_*100}%`)),a.emit("autoSize",{width:a.width,height:a.height})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"rect",{get:()=>(0,n.getRect)(a.template.$player)});let l=["bottom","height","left","right","top","width"];for(let d=0;d<l.length;d++){let u=l[d];(0,n.def)(a,u,{get:()=>a.rect[u]})}(0,n.def)(a,"x",{get:()=>a.left+window.pageXOffset}),(0,n.def)(a,"y",{get:()=>a.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$player:l},i18n:d,notice:u}=a;(0,n.def)(a,"flip",{get:()=>l.dataset.flip||"normal",set(h){h||(h="normal"),h==="normal"?delete l.dataset.flip:l.dataset.flip=h,u.show=`${d.get("Video Flip")}: ${d.get((0,n.capitalize)(h))}`,a.emit("flip",h)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{icons:l,proxy:d,storage:u,template:{$player:h,$video:f}}=a,p=!1,_=0,y=0;function b(){let{$mini:R}=a.template;R&&((0,n.removeClass)(h,"art-mini"),(0,n.setStyle)(R,"display","none"),h.prepend(f),a.emit("mini",!1))}function I(R,M){a.playing?((0,n.setStyle)(R,"display","none"),(0,n.setStyle)(M,"display","flex")):((0,n.setStyle)(R,"display","flex"),(0,n.setStyle)(M,"display","none"))}function T(){let{$mini:R}=a.template,M=(0,n.getRect)(R),N=window.innerHeight-M.height-50,P=window.innerWidth-M.width-50;u.set("top",N),u.set("left",P),(0,n.setStyle)(R,"top",`${N}px`),(0,n.setStyle)(R,"left",`${P}px`)}(0,n.def)(a,"mini",{get:()=>(0,n.hasClass)(h,"art-mini"),set(R){if(R){a.state="mini",(0,n.addClass)(h,"art-mini");let M=function(){let{$mini:L}=a.template;if(L)return(0,n.append)(L,f),(0,n.setStyle)(L,"display","flex");{let A=(0,n.createElement)("div");(0,n.addClass)(A,"art-mini-popup"),(0,n.append)(document.body,A),a.template.$mini=A,(0,n.append)(A,f);let x=(0,n.append)(A,'<div class="art-mini-close"></div>');(0,n.append)(x,l.close),d(x,"click",b);let k=(0,n.append)(A,'<div class="art-mini-state"></div>'),U=(0,n.append)(k,l.play),K=(0,n.append)(k,l.pause);return d(U,"click",()=>a.play()),d(K,"click",()=>a.pause()),I(U,K),a.on("video:playing",()=>I(U,K)),a.on("video:pause",()=>I(U,K)),a.on("video:timeupdate",()=>I(U,K)),d(A,"mousedown",$=>{p=$.button===0,_=$.pageX,y=$.pageY}),a.on("document:mousemove",$=>{if(p){(0,n.addClass)(A,"art-mini-droging");let j=$.pageX-_,Q=$.pageY-y;(0,n.setStyle)(A,"transform",`translate(${j}px, ${Q}px)`)}}),a.on("document:mouseup",()=>{if(p){p=!1,(0,n.removeClass)(A,"art-mini-droging");let $=(0,n.getRect)(A);u.set("left",$.left),u.set("top",$.top),(0,n.setStyle)(A,"left",`${$.left}px`),(0,n.setStyle)(A,"top",`${$.top}px`),(0,n.setStyle)(A,"transform",null)}}),A}}(),N=u.get("top"),P=u.get("left");N&&P?((0,n.setStyle)(M,"top",`${N}px`),(0,n.setStyle)(M,"left",`${P}px`),(0,n.isInViewport)(M)||T()):T(),a.emit("mini",!0)}else b()}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$poster:l}}=a;(0,n.def)(a,"poster",{get:()=>{try{return l.style.backgroundImage.match(/"(.*)"/)[1]}catch{return""}},set(d){(0,n.setStyle)(l,"backgroundImage",`url(${d})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{template:{$container:l,$video:d}}=a;(0,n.def)(a,"autoHeight",{value(){let{clientWidth:u}=l,{videoHeight:h,videoWidth:f}=d,p=u/f*h;(0,n.setStyle)(l,"height",p+"px"),a.emit("autoHeight",p)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1CaTA":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{$player:l}=a.template;(0,n.def)(a,"cssVar",{value:(d,u)=>u?l.style.setProperty(d,u):getComputedStyle(l).getPropertyValue(d)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"theme",{get:()=>a.cssVar("--art-theme"),set(l){a.cssVar("--art-theme",l)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"type",{get:()=>a.option.type,set(l){a.option.type=l}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iBOQW:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let l=["mini","pip","fullscreen","fullscreenWeb"];(0,n.def)(a,"state",{get:()=>l.find(d=>a[d])||"standard",set(d){for(let u=0;u<l.length;u++){let h=l[u];h!==d&&a[h]&&(a[h]=!1)}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{notice:l,i18n:d,template:u}=a;(0,n.def)(a,"subtitleOffset",{get:()=>{var h;return((h=u.$track)==null?void 0:h.offset)||0},set(h){let{cues:f}=a.subtitle;if(!u.$track||f.length===0)return;let p=(0,n.clamp)(h,-10,10);u.$track.offset=p;for(let _=0;_<f.length;_++){let y=f[_];y.originalStartTime=y.originalStartTime??y.startTime,y.originalEndTime=y.originalEndTime??y.endTime,y.startTime=(0,n.clamp)(y.originalStartTime+p,0,a.duration),y.endTime=(0,n.clamp)(y.originalEndTime+p,0,a.duration)}a.subtitle.update(),l.show=`${d.get("Subtitle Offset")}: ${h}s`,a.emit("subtitleOffset",h)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,notice:d,proxy:u,template:{$video:h}}=a,f=!0;window.WebKitPlaybackTargetAvailabilityEvent&&h.webkitShowPlaybackTargetPicker?u(h,"webkitplaybacktargetavailabilitychanged",p=>{switch(p.availability){case"available":f=!0;break;case"not-available":f=!1}}):f=!1,(0,n.def)(a,"airplay",{value(){f?(h.webkitShowPlaybackTargetPicker(),a.emit("airplay")):d.show=l.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5SdyX":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){(0,n.def)(a,"quality",{set(l){let{controls:d,notice:u,i18n:h}=a,f=l.find(p=>p.default)||l[0];d.update({name:"quality",position:"right",index:10,style:{marginRight:"10px"},html:(f==null?void 0:f.html)||"",selector:l,onSelect:async p=>(await a.switchQuality(p.url),u.show=`${h.get("Switch Video")}: ${p.html}`,p.html)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4HcqV":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{events:l,option:d,template:{$progress:u,$video:h}}=a,f=null,p=null,_=!1,y=!1,b=!1;l.hover(u,()=>{b=!0},()=>{b=!1}),a.on("setBar",async(I,T,R)=>{var A;let M=(A=a.controls)==null?void 0:A.thumbnails,{url:N,scale:P}=d.thumbnails;if(!M||!N)return;let L=I==="played"&&R&&n.isMobile;if(I==="hover"||L){if(_||(_=!0,p=await(0,n.loadImg)(N,P),y=!0),!y||!b)return;let x=u.clientWidth*T;(0,n.setStyle)(M,"display","flex"),x>0&&x<u.clientWidth?function(k){var W;let U=(W=a.controls)==null?void 0:W.thumbnails;if(!U)return;let{number:K,column:$,width:j,height:Q,scale:ie}=d.thumbnails,ee=j*ie||p.naturalWidth/$,F=Q*ie||ee/(h.videoWidth/h.videoHeight),O=Math.floor(k/(u.clientWidth/K)),H=Math.ceil(O/$)-1;(0,n.setStyle)(U,"backgroundImage",`url(${p.src})`),(0,n.setStyle)(U,"height",`${F}px`),(0,n.setStyle)(U,"width",`${ee}px`),(0,n.setStyle)(U,"backgroundPosition",`-${(O%$||$-1)*ee}px -${H*F}px`),k<=ee/2?(0,n.setStyle)(U,"left",0):k>u.clientWidth-ee/2?(0,n.setStyle)(U,"left",`${u.clientWidth-ee}px`):(0,n.setStyle)(U,"left",`${k-ee/2}px`)}(x):n.isMobile||(0,n.setStyle)(M,"display","none"),L&&(clearTimeout(f),f=setTimeout(()=>{(0,n.setStyle)(M,"display","none")},500))}}),(0,n.def)(a,"thumbnails",{get:()=>a.option.thumbnails,set(I){I.url&&!a.option.isLive&&(a.option.thumbnails=I,clearTimeout(f),f=null,p=null,_=!1,y=!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{option:l,storage:d,template:{$video:u,$poster:h}}=a;for(let p in l.moreVideoAttr)a.attr(p,l.moreVideoAttr[p]);l.muted&&(a.muted=l.muted),l.volume&&(u.volume=(0,n.clamp)(l.volume,0,1));let f=d.get("volume");for(let p in typeof f=="number"&&(u.volume=(0,n.clamp)(f,0,1)),l.poster&&(0,n.setStyle)(h,"backgroundImage",`url(${l.poster})`),l.autoplay&&(u.autoplay=l.autoplay),l.playsInline&&(u.playsInline=!0,u["webkit-playsinline"]=!0),l.theme&&(l.cssVar["--art-theme"]=l.theme),l.cssVar)a.cssVar(p,l.cssVar[p]);a.url=l.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>l);var n=t("../config"),o=s.interopDefault(n),a=t("../utils");function l(d){let{i18n:u,notice:h,option:f,constructor:p,proxy:_,template:{$player:y,$video:b,$poster:I}}=d,T=0;for(let R=0;R<o.default.events.length;R++)_(b,o.default.events[R],M=>{d.emit(`video:${M.type}`,M)});d.on("video:canplay",()=>{T=0,d.loading.show=!1}),d.once("video:canplay",()=>{d.loading.show=!1,d.controls.show=!0,d.mask.show=!0,d.isReady=!0,d.emit("ready")}),d.on("video:ended",()=>{f.loop?(d.seek=0,d.play(),d.controls.show=!1,d.mask.show=!1):(d.controls.show=!0,d.mask.show=!0)}),d.on("video:error",async R=>{T<p.RECONNECT_TIME_MAX?(await(0,a.sleep)(p.RECONNECT_SLEEP_TIME),T+=1,d.url=f.url,h.show=`${u.get("Reconnect")}: ${T}`,d.emit("error",R,T)):(d.mask.show=!0,d.loading.show=!1,d.controls.show=!0,(0,a.addClass)(y,"art-error"),await(0,a.sleep)(p.RECONNECT_SLEEP_TIME),h.show=u.get("Video Load Failed"))}),d.on("video:loadedmetadata",()=>{d.emit("resize"),a.isMobile&&(d.loading.show=!1,d.controls.show=!0,d.mask.show=!0)}),d.on("video:loadstart",()=>{d.loading.show=!0,d.mask.show=!1,d.controls.show=!0}),d.on("video:pause",()=>{d.controls.show=!0,d.mask.show=!0}),d.on("video:play",()=>{d.mask.show=!1,(0,a.setStyle)(I,"display","none")}),d.on("video:playing",()=>{d.mask.show=!1}),d.on("video:progress",()=>{d.playing&&(d.loading.show=!1)}),d.on("video:seeked",()=>{d.loading.show=!1,d.mask.show=!0}),d.on("video:seeking",()=>{d.loading.show=!0,d.mask.show=!1}),d.on("video:timeupdate",()=>{d.mask.show=!1}),d.on("video:waiting",()=>{d.loading.show=!0,d.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("../utils/component"),o=s.interopDefault(n),a=t("./fullscreen"),l=s.interopDefault(a),d=t("./fullscreenWeb"),u=s.interopDefault(d),h=t("./pip"),f=s.interopDefault(h),p=t("./playAndPause"),_=s.interopDefault(p),y=t("./progress"),b=s.interopDefault(y),I=t("./time"),T=s.interopDefault(I),R=t("./volume"),M=s.interopDefault(R),N=t("./setting"),P=s.interopDefault(N),L=t("./screenshot"),A=s.interopDefault(L),x=t("./airplay"),k=s.interopDefault(x),U=t("../utils");class K extends o.default{constructor(j){super(j),this.isHover=!1,this.name="control",this.timer=Date.now();let{constructor:Q}=j,{$player:ie,$bottom:ee}=this.art.template;j.on("mousemove",()=>{U.isMobile||(this.show=!0)}),j.on("click",()=>{U.isMobile?this.toggle():this.show=!0}),j.on("document:mousemove",F=>{this.isHover=(0,U.includeFromEvent)(F,ee)}),j.on("video:timeupdate",()=>{!j.setting.show&&!this.isHover&&!j.isInput&&j.playing&&this.show&&Date.now()-this.timer>=Q.CONTROL_HIDE_TIME&&(this.show=!1)}),j.on("control",F=>{F?((0,U.removeClass)(ie,"art-hide-cursor"),(0,U.addClass)(ie,"art-hover"),this.timer=Date.now()):((0,U.addClass)(ie,"art-hide-cursor"),(0,U.removeClass)(ie,"art-hover"))}),this.init()}init(){let{option:j}=this.art;j.isLive||this.add((0,b.default)({name:"progress",position:"top",index:10})),this.add({name:"thumbnails",position:"top",index:20}),this.add((0,_.default)({name:"playAndPause",position:"left",index:10})),this.add((0,M.default)({name:"volume",position:"left",index:20})),j.isLive||this.add((0,T.default)({name:"time",position:"left",index:30})),j.quality.length&&(0,U.sleep)().then(()=>{this.art.quality=j.quality}),j.screenshot&&!U.isMobile&&this.add((0,A.default)({name:"screenshot",position:"right",index:20})),j.setting&&this.add((0,P.default)({name:"setting",position:"right",index:30})),j.pip&&this.add((0,f.default)({name:"pip",position:"right",index:40})),j.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,k.default)({name:"airplay",position:"right",index:50})),j.fullscreenWeb&&this.add((0,u.default)({name:"fullscreenWeb",position:"right",index:60})),j.fullscreen&&this.add((0,l.default)({name:"fullscreen",position:"right",index:70}));for(let Q=0;Q<j.controls.length;Q++)this.add(j.controls[Q])}add(j){let Q=typeof j=="function"?j(this.art):j,{$progress:ie,$controlsLeft:ee,$controlsRight:F}=this.art.template;switch(Q.position){case"top":this.$parent=ie;break;case"left":this.$parent=ee;break;case"right":this.$parent=F;break;default:(0,U.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(Q)}check(j){j.$control_value.innerHTML=j.html;for(let Q=0;Q<j.$control_option.length;Q++){let ie=j.$control_option[Q];ie.default=ie===j,ie.default&&(0,U.inverseClass)(ie.$control_item,"art-current")}}selector(j,Q,ie){let{proxy:ee}=this.art.events;(0,U.addClass)(Q,"art-control-selector");let F=(0,U.createElement)("div");(0,U.addClass)(F,"art-selector-value"),(0,U.append)(F,j.html),Q.innerText="",(0,U.append)(Q,F);let O=(0,U.createElement)("div");(0,U.addClass)(O,"art-selector-list"),(0,U.append)(Q,O);for(let W=0;W<j.selector.length;W++){let ae=j.selector[W],le=(0,U.createElement)("div");(0,U.addClass)(le,"art-selector-item"),ae.default&&(0,U.addClass)(le,"art-current"),le.dataset.index=W,le.dataset.value=ae.value,le.innerHTML=ae.html,(0,U.append)(O,le),(0,U.def)(ae,"$control_option",{get:()=>j.selector}),(0,U.def)(ae,"$control_item",{get:()=>le}),(0,U.def)(ae,"$control_value",{get:()=>F})}let H=ee(O,"click",async W=>{let ae=W.composedPath()||[],le=j.selector.find(ye=>ye.$control_item===ae.find(me=>ye.$control_item===me));this.check(le),j.onSelect&&(F.innerHTML=await j.onSelect.call(this.art,le,le.$control_item,W))});ie.push(H)}}r.default=K},{"../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./screenshot":"4KCF5","./airplay":"4IS2d","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./dom"),o=t("./error"),a=t("option-validator"),l=s.interopDefault(a),d=t("../scheme");r.default=class{constructor(u){this.id=0,this.art=u,this.cache=new Map,this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.update=this.update.bind(this)}get show(){return(0,n.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(u){let{$player:h}=this.art.template,f=`art-${this.name}-show`;u?(0,n.addClass)(h,f):(0,n.removeClass)(h,f),this.art.emit(this.name,u)}toggle(){this.show=!this.show}add(u){let h=typeof u=="function"?u(this.art):u;if(h.html=h.html||"",(0,l.default)(h,d.ComponentOption),!this.$parent||!this.name||h.disable)return;let f=h.name||`${this.name}${this.id}`,p=this.cache.get(f);(0,o.errorHandle)(!p,`Can't add an existing [${f}] to the [${this.name}]`),this.id+=1;let _=(0,n.createElement)("div");(0,n.addClass)(_,`art-${this.name}`),(0,n.addClass)(_,`art-${this.name}-${f}`);let y=Array.from(this.$parent.children);_.dataset.index=h.index||this.id;let b=y.find(T=>Number(T.dataset.index)>=Number(_.dataset.index));b?b.insertAdjacentElement("beforebegin",_):(0,n.append)(this.$parent,_),h.html&&(0,n.append)(_,h.html),h.style&&(0,n.setStyles)(_,h.style),h.tooltip&&(0,n.tooltip)(_,h.tooltip);let I=[];if(h.click){let T=this.art.events.proxy(_,"click",R=>{R.preventDefault(),h.click.call(this.art,this,R)});I.push(T)}return h.selector&&["left","right"].includes(h.position)&&this.selector(h,_,I),this[f]=_,this.cache.set(f,{$ref:_,events:I,option:h}),h.mounted&&h.mounted.call(this.art,_),_}remove(u){let h=this.cache.get(u);(0,o.errorHandle)(h,`Can't find [${u}] from the [${this.name}]`),h.option.beforeUnmount&&h.option.beforeUnmount.call(this.art,h.$ref);for(let f=0;f<h.events.length;f++)this.art.events.remove(h.events[f]);this.cache.delete(u),delete this[u],(0,n.remove)(h.$ref)}update(u){let h=this.cache.get(u.name);return h&&(u=Object.assign(h.option,u),this.remove(u.name)),this.add(u)}}},{"./dom":"bSNiV","./error":"hwmZz","option-validator":"bAWi2","../scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("Fullscreen"),mounted:d=>{let{proxy:u,icons:h,i18n:f}=l,p=(0,n.append)(d,h.fullscreenOn),_=(0,n.append)(d,h.fullscreenOff);(0,n.setStyle)(_,"display","none"),u(d,"click",()=>{l.fullscreen=!l.fullscreen}),l.on("fullscreen",y=>{y?((0,n.tooltip)(d,f.get("Exit Fullscreen")),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(_,"display","inline-flex")):((0,n.tooltip)(d,f.get("Fullscreen")),(0,n.setStyle)(p,"display","inline-flex"),(0,n.setStyle)(_,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("Web Fullscreen"),mounted:d=>{let{proxy:u,icons:h,i18n:f}=l,p=(0,n.append)(d,h.fullscreenWebOn),_=(0,n.append)(d,h.fullscreenWebOff);(0,n.setStyle)(_,"display","none"),u(d,"click",()=>{l.fullscreenWeb=!l.fullscreenWeb}),l.on("fullscreenWeb",y=>{y?((0,n.tooltip)(d,f.get("Exit Web Fullscreen")),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(_,"display","inline-flex")):((0,n.tooltip)(d,f.get("Web Fullscreen")),(0,n.setStyle)(p,"display","inline-flex"),(0,n.setStyle)(_,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("PIP Mode"),mounted:d=>{let{proxy:u,icons:h,i18n:f}=l;(0,n.append)(d,h.pip),u(d,"click",()=>{l.pip=!l.pip}),l.on("pip",p=>{(0,n.tooltip)(d,f.get(p?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,mounted:d=>{let{proxy:u,icons:h,i18n:f}=l,p=(0,n.append)(d,h.play),_=(0,n.append)(d,h.pause);function y(){(0,n.setStyle)(p,"display","flex"),(0,n.setStyle)(_,"display","none")}function b(){(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(_,"display","flex")}(0,n.tooltip)(p,f.get("Play")),(0,n.tooltip)(_,f.get("Pause")),u(p,"click",()=>{l.play()}),u(_,"click",()=>{l.pause()}),l.playing?b():y(),l.on("video:playing",()=>{b()}),l.on("video:pause",()=>{y()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"getPosFromEvent",()=>o),s.export(r,"setCurrentTime",()=>a),s.export(r,"default",()=>l);var n=t("../utils");function o(d,u){let{$progress:h}=d.template,{left:f}=(0,n.getRect)(h),p=n.isMobile?u.touches[0].clientX:u.clientX,_=(0,n.clamp)(p-f,0,h.clientWidth),y=_/h.clientWidth*d.duration,b=(0,n.secondToTime)(y),I=(0,n.clamp)(_/h.clientWidth,0,1);return{second:y,time:b,width:_,percentage:I}}function a(d,u){if(d.isRotate){let h=u.touches[0].clientY/d.height,f=h*d.duration;d.emit("setBar","played",h,u),d.seek=f}else{let{second:h,percentage:f}=o(d,u);d.emit("setBar","played",f,u),d.seek=h}}function l(d){return u=>{let{icons:h,option:f,proxy:p}=u;return{...d,html:'<div class="art-control-progress-inner"><div class="art-progress-hover"></div><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:_=>{let y=null,b=!1,I=(0,n.query)(".art-progress-hover",_),T=(0,n.query)(".art-progress-loaded",_),R=(0,n.query)(".art-progress-played",_),M=(0,n.query)(".art-progress-highlight",_),N=(0,n.query)(".art-progress-indicator",_),P=(0,n.query)(".art-progress-tip",_);function L(A,x){let{width:k,time:U}=x||o(u,A);P.innerText=U;let K=P.clientWidth;k<=K/2?(0,n.setStyle)(P,"left",0):k>_.clientWidth-K/2?(0,n.setStyle)(P,"left",`${_.clientWidth-K}px`):(0,n.setStyle)(P,"left",`${k-K/2}px`)}h.indicator?(0,n.append)(N,h.indicator):(0,n.setStyle)(N,"backgroundColor","var(--art-theme)"),u.on("setBar",function(A,x,k){let U=A==="played"&&k&&n.isMobile;A==="loaded"&&(0,n.setStyle)(T,"width",`${100*x}%`),A==="hover"&&(0,n.setStyle)(I,"width",`${100*x}%`),A==="played"&&((0,n.setStyle)(R,"width",`${100*x}%`),(0,n.setStyle)(N,"left",`${100*x}%`)),U&&((0,n.setStyle)(P,"display","flex"),L(k,{width:_.clientWidth*x,time:(0,n.secondToTime)(x*u.duration)}),clearTimeout(y),y=setTimeout(()=>{(0,n.setStyle)(P,"display","none")},500))}),u.on("video:loadedmetadata",function(){M.innerText="";for(let A=0;A<f.highlight.length;A++){let x=f.highlight[A],k=(0,n.clamp)(x.time,0,u.duration)/u.duration*100,U=`<span data-text="${x.text}" data-time="${x.time}" style="left: ${k}%"></span>`;(0,n.append)(M,U)}}),u.on("video:progress",()=>{u.emit("setBar","loaded",u.loaded)}),u.constructor.USE_RAF?u.on("raf",()=>{u.emit("setBar","played",u.played)}):u.on("video:timeupdate",()=>{u.emit("setBar","played",u.played)}),u.on("video:ended",()=>{u.emit("setBar","played",1)}),u.emit("setBar","loaded",u.loaded||0),n.isMobile||(p(_,"click",A=>{A.target!==N&&a(u,A)}),p(_,"mousemove",A=>{let{percentage:x}=o(u,A);u.emit("setBar","hover",x,A),(0,n.setStyle)(P,"display","flex"),(0,n.includeFromEvent)(A,M)?function(k){let{width:U}=o(u,k),{text:K}=k.target.dataset;P.innerText=K;let $=P.clientWidth;U<=$/2?(0,n.setStyle)(P,"left",0):U>_.clientWidth-$/2?(0,n.setStyle)(P,"left",`${_.clientWidth-$}px`):(0,n.setStyle)(P,"left",`${U-$/2}px`)}(A):L(A)}),p(_,"mouseleave",A=>{(0,n.setStyle)(P,"display","none"),u.emit("setBar","hover",0,A)}),p(_,"mousedown",A=>{b=A.button===0}),u.on("document:mousemove",A=>{if(b){let{second:x,percentage:k}=o(u,A);u.emit("setBar","played",k,A),u.seek=x}}),u.on("document:mouseup",()=>{b&&(b=!1)}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,style:n.isMobile?{fontSize:"12px",padding:"0 5px"}:{cursor:"auto",padding:"0 10px"},mounted:d=>{function u(){let f=`${(0,n.secondToTime)(l.currentTime)} / ${(0,n.secondToTime)(l.duration)}`;f!==d.innerText&&(d.innerText=f)}u();let h=["video:loadedmetadata","video:timeupdate","video:progress"];for(let f=0;f<h.length;f++)l.on(h[f],u)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,mounted:d=>{let{proxy:u,icons:h}=l,f=(0,n.append)(d,h.volume),p=(0,n.append)(d,h.volumeClose),_=(0,n.append)(d,'<div class="art-volume-panel"></div>'),y=(0,n.append)(_,'<div class="art-volume-inner"></div>'),b=(0,n.append)(y,'<div class="art-volume-val"></div>'),I=(0,n.append)(y,'<div class="art-volume-slider"></div>'),T=(0,n.append)(I,'<div class="art-volume-handle"></div>'),R=(0,n.append)(T,'<div class="art-volume-loaded"></div>'),M=(0,n.append)(I,'<div class="art-volume-indicator"></div>');function N(L){let{top:A,height:x}=(0,n.getRect)(I);return 1-(L.clientY-A)/x}function P(){if(l.muted||l.volume===0)(0,n.setStyle)(f,"display","none"),(0,n.setStyle)(p,"display","flex"),(0,n.setStyle)(M,"top","100%"),(0,n.setStyle)(R,"top","100%"),b.innerText=0;else{let L=100*l.volume;(0,n.setStyle)(f,"display","flex"),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(M,"top",`${100-L}%`),(0,n.setStyle)(R,"top",`${100-L}%`),b.innerText=Math.floor(L)}}if(P(),l.on("video:volumechange",P),u(f,"click",()=>{l.muted=!0}),u(p,"click",()=>{l.muted=!1}),n.isMobile)(0,n.setStyle)(_,"display","none");else{let L=!1;u(I,"mousedown",A=>{L=A.button===0,l.volume=N(A)}),l.on("document:mousemove",A=>{L&&(l.muted=!1,l.volume=N(A))}),l.on("document:mouseup",()=>{L&&(L=!1)})}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("Show Setting"),mounted:d=>{let{proxy:u,icons:h,i18n:f}=l;(0,n.append)(d,h.setting),u(d,"click",()=>{l.setting.toggle(),l.setting.resize()}),l.on("setting",p=>{(0,n.tooltip)(d,f.get(p?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("Screenshot"),mounted:d=>{let{proxy:u,icons:h}=l;(0,n.append)(d,h.screenshot),u(d,"click",()=>{l.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>({...a,tooltip:l.i18n.get("AirPlay"),mounted:d=>{let{proxy:u,icons:h}=l;(0,n.append)(d,h.airplay),u(d,"click",()=>l.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("../utils"),o=t("../utils/component"),a=s.interopDefault(o),l=t("./playbackRate"),d=s.interopDefault(l),u=t("./aspectRatio"),h=s.interopDefault(u),f=t("./flip"),p=s.interopDefault(f),_=t("./info"),y=s.interopDefault(_),b=t("./version"),I=s.interopDefault(b),T=t("./close"),R=s.interopDefault(T);class M extends a.default{constructor(P){super(P),this.name="contextmenu",this.$parent=P.template.$contextmenu,n.isMobile||this.init()}init(){let{option:P,proxy:L,template:{$player:A,$contextmenu:x}}=this.art;P.playbackRate&&this.add((0,d.default)({name:"playbackRate",index:10})),P.aspectRatio&&this.add((0,h.default)({name:"aspectRatio",index:20})),P.flip&&this.add((0,p.default)({name:"flip",index:30})),this.add((0,y.default)({name:"info",index:40})),this.add((0,I.default)({name:"version",index:50})),this.add((0,R.default)({name:"close",index:60}));for(let k=0;k<P.contextmenu.length;k++)this.add(P.contextmenu[k]);L(A,"contextmenu",k=>{if(!this.art.constructor.CONTEXTMENU)return;k.preventDefault(),this.show=!0;let U=k.clientX,K=k.clientY,{height:$,width:j,left:Q,top:ie}=(0,n.getRect)(A),{height:ee,width:F}=(0,n.getRect)(x),O=U-Q,H=K-ie;U+F>Q+j&&(O=j-F),K+ee>ie+$&&(H=$-ee),(0,n.setStyles)(x,{top:`${H}px`,left:`${O}px`})}),L(A,"click",k=>{(0,n.includeFromEvent)(k,x)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}r.default=M},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>{let{i18n:d,constructor:{PLAYBACK_RATE:u}}=l,h=u.map(f=>`<span data-value="${f}">${f===1?d.get("Normal"):f.toFixed(1)}</span>`).join("");return{...a,html:`${d.get("Play Speed")}: ${h}`,click:(f,p)=>{let{value:_}=p.target.dataset;_&&(l.playbackRate=Number(_),f.show=!1)},mounted:f=>{let p=(0,n.query)('[data-value="1"]',f);p&&(0,n.inverseClass)(p,"art-current"),l.on("video:ratechange",()=>{let _=(0,n.queryAll)("span",f).find(y=>Number(y.dataset.value)===l.playbackRate);_&&(0,n.inverseClass)(_,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>{let{i18n:d,constructor:{ASPECT_RATIO:u}}=l,h=u.map(f=>`<span data-value="${f}">${f==="default"?d.get("Default"):f}</span>`).join("");return{...a,html:`${d.get("Aspect Ratio")}: ${h}`,click:(f,p)=>{let{value:_}=p.target.dataset;_&&(l.aspectRatio=_,f.show=!1)},mounted:f=>{let p=(0,n.query)('[data-value="default"]',f);p&&(0,n.inverseClass)(p,"art-current"),l.on("aspectRatio",_=>{let y=(0,n.queryAll)("span",f).find(b=>b.dataset.value===_);y&&(0,n.inverseClass)(y,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return l=>{let{i18n:d,constructor:{FLIP:u}}=l,h=u.map(f=>`<span data-value="${f}">${d.get((0,n.capitalize)(f))}</span>`).join("");return{...a,html:`${d.get("Video Flip")}: ${h}`,click:(f,p)=>{let{value:_}=p.target.dataset;_&&(l.flip=_.toLowerCase(),f.show=!1)},mounted:f=>{let p=(0,n.query)('[data-value="normal"]',f);p&&(0,n.inverseClass)(p,"art-current"),l.on("flip",_=>{let y=(0,n.queryAll)("span",f).find(b=>b.dataset.value===_);y&&(0,n.inverseClass)(y,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return a=>({...o,html:a.i18n.get("Video Info"),click:l=>{a.info.show=!0,l.show=!1}})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return{...o,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 5.2.2</a>'}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return a=>({...o,html:a.i18n.get("Close"),click:l=>{l.show=!1}})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./utils"),o=t("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(u){super(u),this.name="info",n.isMobile||this.init()}init(){let{proxy:u,constructor:h,template:{$infoPanel:f,$infoClose:p,$video:_}}=this.art;u(p,"click",()=>{this.show=!1});let y=null,b=(0,n.queryAll)("[data-video]",f)||[];this.art.on("destroy",()=>clearTimeout(y)),function I(){for(let T=0;T<b.length;T++){let R=b[T],M=_[R.dataset.video],N=typeof M=="number"?M.toFixed(2):M;R.innerText!==N&&(R.innerText=N)}y=setTimeout(I,h.INFO_LOOP_TIME)}()}}r.default=l},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./utils"),o=t("./utils/component"),a=s.interopDefault(o),l=t("option-validator"),d=s.interopDefault(l),u=t("./scheme"),h=s.interopDefault(u);class f extends a.default{constructor(_){super(_),this.name="subtitle",this.option=null,this.destroyEvent=()=>null,this.init(_.option.subtitle);let y=!1;_.on("video:timeupdate",()=>{if(!this.url)return;let b=this.art.template.$video.webkitDisplayingFullscreen;typeof b=="boolean"&&b!==y&&(y=b,this.createTrack(b?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(_){this.switch(_)}get textTrack(){var _,y;return(y=(_=this.art.template.$video)==null?void 0:_.textTracks)==null?void 0:y[0]}get activeCues(){return this.textTrack?Array.from(this.textTrack.activeCues):[]}get cues(){return this.textTrack?Array.from(this.textTrack.cues):[]}style(_,y){let{$subtitle:b}=this.art.template;return typeof _=="object"?(0,n.setStyles)(b,_):(0,n.setStyle)(b,_,y)}update(){let{option:{subtitle:_},template:{$subtitle:y}}=this.art;y.innerHTML="",this.activeCues.length&&(this.art.emit("subtitleBeforeUpdate",this.activeCues),y.innerHTML=this.activeCues.map((b,I)=>b.text.split(/\r?\n/).filter(T=>T.trim()).map(T=>`<div class="art-subtitle-line" data-group="${I}">${_.escape?(0,n.escape)(T):T}</div>`).join("")).join(""),this.art.emit("subtitleAfterUpdate",this.activeCues))}async switch(_,y={}){let{i18n:b,notice:I,option:T}=this.art,R={...T.subtitle,...y,url:_},M=await this.init(R);return y.name&&(I.show=`${b.get("Switch Subtitle")}: ${y.name}`),M}createTrack(_,y){let{template:b,proxy:I,option:T}=this.art,{$video:R,$track:M}=b,N=(0,n.createElement)("track");N.default=!0,N.kind=_,N.src=y,N.label=T.subtitle.name||"Artplayer",N.track.mode="hidden",N.onload=()=>{this.art.emit("subtitleLoad",this.cues,this.option)},this.art.events.remove(this.destroyEvent),M.onload=null,(0,n.remove)(M),(0,n.append)(R,N),b.$track=N,this.destroyEvent=I(this.textTrack,"cuechange",()=>this.update())}async init(_){let{notice:y,template:{$subtitle:b}}=this.art;return this.textTrack?((0,d.default)(_,h.default.subtitle),_.url?(this.option=_,this.style(_.style),fetch(_.url).then(I=>I.arrayBuffer()).then(I=>{let T=new TextDecoder(_.encoding).decode(I);switch(_.type||(0,n.getExt)(_.url)){case"srt":{let R=(0,n.srtToVtt)(T),M=_.onVttLoad(R);return(0,n.vttToBlob)(M)}case"ass":{let R=(0,n.assToVtt)(T),M=_.onVttLoad(R);return(0,n.vttToBlob)(M)}case"vtt":{let R=_.onVttLoad(T);return(0,n.vttToBlob)(R)}default:return _.url}}).then(I=>(b.innerHTML="",this.url===I||(URL.revokeObjectURL(this.url),this.createTrack("metadata",I)),I)).catch(I=>{throw b.innerHTML="",y.show=I,I})):void 0):null}}r.default=f},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./clickInit"),o=s.interopDefault(n),a=t("./hoverInit"),l=s.interopDefault(a),d=t("./moveInit"),u=s.interopDefault(d),h=t("./resizeInit"),f=s.interopDefault(h),p=t("./gestureInit"),_=s.interopDefault(p),y=t("./viewInit"),b=s.interopDefault(y),I=t("./documentInit"),T=s.interopDefault(I),R=t("./updateInit"),M=s.interopDefault(R),N=t("./restoreInit"),P=s.interopDefault(N);r.default=class{constructor(L){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),(0,o.default)(L,this),(0,l.default)(L,this),(0,u.default)(L,this),(0,f.default)(L,this),(0,_.default)(L,this),(0,b.default)(L,this),(0,T.default)(L,this),(0,M.default)(L,this),(0,P.default)(L,this)}proxy(L,A,x,k={}){if(Array.isArray(A))return A.map(K=>this.proxy(L,K,x,k));L.addEventListener(A,x,k);let U=()=>L.removeEventListener(A,x,k);return this.destroyEvents.push(U),U}hover(L,A,x){A&&this.proxy(L,"mouseenter",A),x&&this.proxy(L,"mouseleave",x)}remove(L){let A=this.destroyEvents.indexOf(L);A>-1&&(L(),this.destroyEvents.splice(A,1))}destroy(){for(let L=0;L<this.destroyEvents.length;L++)this.destroyEvents[L]()}}},{"./clickInit":"6UrCm","./hoverInit":"4jWHi","./moveInit":"eqaUm","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","./documentInit":"hoLfM","./updateInit":"cl8m3","./restoreInit":"bK8As","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a,l){let{constructor:d,template:{$player:u,$video:h}}=a;l.proxy(document,["click","contextmenu"],p=>{(0,n.includeFromEvent)(p,u)?(a.isInput=p.target.tagName==="INPUT",a.isFocus=!0,a.emit("focus",p)):(a.isInput=!1,a.isFocus=!1,a.emit("blur",p))});let f=[];l.proxy(h,"click",p=>{let _=Date.now();f.push(_);let{MOBILE_CLICK_PLAY:y,DBCLICK_TIME:b,MOBILE_DBCLICK_PLAY:I,DBCLICK_FULLSCREEN:T}=d,R=f.filter(M=>_-M<=b);switch(R.length){case 1:a.emit("click",p),n.isMobile?!a.isLock&&y&&a.toggle():a.toggle(),f=R;break;case 2:a.emit("dblclick",p),n.isMobile?!a.isLock&&I&&a.toggle():T&&(a.fullscreen=!a.fullscreen),f=[];break;default:f=[]}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a,l){let{$player:d}=a.template;l.hover(d,u=>{(0,n.addClass)(d,"art-hover"),a.emit("hover",!0,u)},u=>{(0,n.removeClass)(d,"art-hover"),a.emit("hover",!1,u)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eqaUm:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){let{$player:l}=o.template;a.proxy(l,"mousemove",d=>{o.emit("mousemove",d)})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a,l){let{option:d,constructor:u}=a;a.on("resize",()=>{let{aspectRatio:f,notice:p}=a;a.state==="standard"&&d.autoSize&&a.autoSize(),a.aspectRatio=f,p.show=""});let h=(0,n.debounce)(()=>a.emit("resize"),u.RESIZE_TIME);l.proxy(window,["orientationchange","resize"],()=>h()),screen&&screen.orientation&&screen.orientation.onchange&&l.proxy(screen.orientation,"change",()=>h())}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>a);var n=t("../utils"),o=t("../control/progress");function a(l,d){if(n.isMobile&&!l.option.isLive){let{$video:u,$progress:h}=l.template,f=null,p=!1,_=0,y=0,b=0,I=R=>{if(R.touches.length===1&&!l.isLock){f===h&&(0,o.setCurrentTime)(l,R),p=!0;let{pageX:M,pageY:N}=R.touches[0];_=M,y=N,b=l.currentTime}},T=R=>{if(R.touches.length===1&&p&&l.duration){let{pageX:M,pageY:N}=R.touches[0],P=function(x,k,U,K){var $=k-K,j=U-x,Q=0;if(2>Math.abs(j)&&2>Math.abs($))return Q;var ie=180*Math.atan2($,j)/Math.PI;return ie>=-45&&ie<45?Q=4:ie>=45&&ie<135?Q=1:ie>=-135&&ie<-45?Q=2:(ie>=135&&ie<=180||ie>=-180&&ie<-135)&&(Q=3),Q}(_,y,M,N),L=[3,4].includes(P),A=[1,2].includes(P);if(L&&!l.isRotate||A&&l.isRotate){let x=(0,n.clamp)((M-_)/l.width,-1,1),k=(0,n.clamp)((N-y)/l.height,-1,1),U=l.isRotate?k:x,K=f===u?l.constructor.TOUCH_MOVE_RATIO:1,$=(0,n.clamp)(b+l.duration*U*K,0,l.duration);l.seek=$,l.emit("setBar","played",(0,n.clamp)($/l.duration,0,1),R),l.notice.show=`${(0,n.secondToTime)($)} / ${(0,n.secondToTime)(l.duration)}`}}};d.proxy(h,"touchstart",R=>{f=h,I(R)}),d.proxy(u,"touchstart",R=>{f=u,I(R)}),d.proxy(u,"touchmove",T),d.proxy(h,"touchmove",T),d.proxy(document,"touchend",()=>{p&&(_=0,y=0,b=0,p=!1,f=null)})}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a,l){let{option:d,constructor:u,template:{$container:h}}=a,f=(0,n.throttle)(()=>{a.emit("view",(0,n.isInViewport)(h,u.SCROLL_GAP))},u.SCROLL_TIME);l.proxy(window,"scroll",()=>f()),a.on("view",p=>{d.autoMini&&(a.mini=!p)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hoLfM:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){a.proxy(document,"mousemove",l=>{o.emit("document:mousemove",l)}),a.proxy(document,"mouseup",l=>{o.emit("document:mouseup",l)})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cl8m3:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){if(o.constructor.USE_RAF){let a=null;(function l(){o.playing&&o.emit("raf"),o.isDestroy||(a=requestAnimationFrame(l))})(),o.on("destroy",()=>{cancelAnimationFrame(a)})}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bK8As:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=t("./utils");r.default=class{constructor(n){this.art=n,this.keys={},n.option.hotkey&&!s.isMobile&&this.init()}init(){let{proxy:n,constructor:o}=this.art;this.add("Escape",()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add("Space",()=>{this.art.toggle()}),this.add("ArrowLeft",()=>{this.art.backward=o.SEEK_STEP}),this.add("ArrowUp",()=>{this.art.volume+=o.VOLUME_STEP}),this.add("ArrowRight",()=>{this.art.forward=o.SEEK_STEP}),this.add("ArrowDown",()=>{this.art.volume-=o.VOLUME_STEP}),n(document,"keydown",a=>{if(this.art.isFocus){let l=document.activeElement.tagName.toUpperCase(),d=document.activeElement.getAttribute("contenteditable");if(l!=="INPUT"&&l!=="TEXTAREA"&&d!==""&&d!=="true"&&!a.altKey&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey){let u=this.keys[a.code];if(u){a.preventDefault();for(let h=0;h<u.length;h++)u[h].call(this.art,a);this.art.emit("hotkey",a)}}}this.art.emit("keydown",a)})}add(n,o){return this.keys[n]?this.keys[n].push(o):this.keys[n]=[o],this}remove(n,o){if(this.keys[n]){let a=this.keys[n].indexOf(o);a!==-1&&this.keys[n].splice(a,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./utils/component"),o=s.interopDefault(n);class a extends o.default{constructor(d){super(d);let{option:u,template:{$layer:h}}=d;this.name="layer",this.$parent=h;for(let f=0;f<u.layers.length;f++)this.add(u.layers[f])}}r.default=a},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./utils"),o=t("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(u){super(u),this.name="loading",(0,n.append)(u.template.$loading,u.icons.loading)}}r.default=l},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=t("./utils");r.default=class{constructor(n){this.art=n,this.timer=null}set show(n){let{constructor:o,template:{$player:a,$noticeInner:l}}=this.art;n?(l.innerText=n instanceof Error?n.message.trim():n,(0,s.addClass)(a,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{l.innerText="",(0,s.removeClass)(a,"art-notice-show")},o.NOTICE_TIME)):(0,s.removeClass)(a,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./utils"),o=t("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(u){super(u),this.name="mask";let{template:h,icons:f,events:p}=u,_=(0,n.append)(h.$state,f.state),y=(0,n.append)(h.$state,f.error);(0,n.setStyle)(y,"display","none"),u.on("destroy",()=>{(0,n.setStyle)(_,"display","none"),(0,n.setStyle)(y,"display",null)}),p.proxy(h.$state,"click",()=>u.play())}}r.default=l},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("../utils"),o=t("bundle-text:./loading.svg"),a=s.interopDefault(o),l=t("bundle-text:./state.svg"),d=s.interopDefault(l),u=t("bundle-text:./check.svg"),h=s.interopDefault(u),f=t("bundle-text:./play.svg"),p=s.interopDefault(f),_=t("bundle-text:./pause.svg"),y=s.interopDefault(_),b=t("bundle-text:./volume.svg"),I=s.interopDefault(b),T=t("bundle-text:./volume-close.svg"),R=s.interopDefault(T),M=t("bundle-text:./screenshot.svg"),N=s.interopDefault(M),P=t("bundle-text:./setting.svg"),L=s.interopDefault(P),A=t("bundle-text:./arrow-left.svg"),x=s.interopDefault(A),k=t("bundle-text:./arrow-right.svg"),U=s.interopDefault(k),K=t("bundle-text:./playback-rate.svg"),$=s.interopDefault(K),j=t("bundle-text:./aspect-ratio.svg"),Q=s.interopDefault(j),ie=t("bundle-text:./config.svg"),ee=s.interopDefault(ie),F=t("bundle-text:./pip.svg"),O=s.interopDefault(F),H=t("bundle-text:./lock.svg"),W=s.interopDefault(H),ae=t("bundle-text:./unlock.svg"),le=s.interopDefault(ae),ye=t("bundle-text:./fullscreen-off.svg"),me=s.interopDefault(ye),re=t("bundle-text:./fullscreen-on.svg"),oe=s.interopDefault(re),fe=t("bundle-text:./fullscreen-web-off.svg"),be=s.interopDefault(fe),xe=t("bundle-text:./fullscreen-web-on.svg"),Ce=s.interopDefault(xe),ze=t("bundle-text:./switch-on.svg"),Ye=s.interopDefault(ze),ot=t("bundle-text:./switch-off.svg"),ve=s.interopDefault(ot),_e=t("bundle-text:./flip.svg"),Je=s.interopDefault(_e),Qe=t("bundle-text:./error.svg"),Ze=s.interopDefault(Qe),ut=t("bundle-text:./close.svg"),st=s.interopDefault(ut),pt=t("bundle-text:./airplay.svg"),Et=s.interopDefault(pt);r.default=class{constructor(Yt){let St={loading:a.default,state:d.default,play:p.default,pause:y.default,check:h.default,volume:I.default,volumeClose:R.default,screenshot:N.default,setting:L.default,pip:O.default,arrowLeft:x.default,arrowRight:U.default,playbackRate:$.default,aspectRatio:Q.default,config:ee.default,lock:W.default,flip:Je.default,unlock:le.default,fullscreenOff:me.default,fullscreenOn:oe.default,fullscreenWebOff:be.default,fullscreenWebOn:Ce.default,switchOn:Ye.default,switchOff:ve.default,error:Ze.default,close:st.default,airplay:Et.default,...Yt.option.icons};for(let wt in St)(0,n.def)(this,wt,{get:()=>(0,n.getIcon)(wt,St[wt])})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24"><path fill="#fff" d="M9.5 9.325v5.35q0 .575.525.875t1.025-.05l4.15-2.65q.475-.3.475-.85t-.475-.85L11.05 8.5q-.5-.35-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Z"/></svg>'},{}],lmgoP:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 32 32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 32 32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(t,i,r){i.exports='<svg height="24" viewBox="0 0 24 24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(t,i,r){i.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="a"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#a')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(t,i,r){i.exports='<svg height="24" viewBox="0 0 24 24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(t,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(t,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(t,i,r){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(t,i,r){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(t,i,r){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(t,i,r){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(t,i,r){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(t,i,r){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(t,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(t,i,r){i.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(t,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(t,i,r){i.exports='<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("./flip"),o=s.interopDefault(n),a=t("./aspectRatio"),l=s.interopDefault(a),d=t("./playbackRate"),u=s.interopDefault(d),h=t("./subtitleOffset"),f=s.interopDefault(h),p=t("../utils/component"),_=s.interopDefault(p),y=t("../utils");class b extends _.default{constructor(T){super(T);let{option:R,controls:M,template:{$setting:N}}=T;this.name="setting",this.$parent=N,this.id=0,this.active=null,this.cache=new Map,this.option=[...this.builtin,...R.settings],R.setting&&(this.format(),this.render(),T.on("blur",()=>{this.show&&(this.show=!1,this.render())}),T.on("focus",P=>{let L=(0,y.includeFromEvent)(P,M.setting),A=(0,y.includeFromEvent)(P,this.$parent);!this.show||L||A||(this.show=!1,this.render())}),T.on("resize",()=>this.resize()))}get builtin(){let T=[],{option:R}=this.art;return R.playbackRate&&T.push((0,u.default)(this.art)),R.aspectRatio&&T.push((0,l.default)(this.art)),R.flip&&T.push((0,o.default)(this.art)),R.subtitleOffset&&T.push((0,f.default)(this.art)),T}traverse(T,R=this.option){var M;for(let N=0;N<R.length;N++){let P=R[N];T(P),(M=P.selector)!=null&&M.length&&this.traverse.call(this,T,P.selector)}}check(T){T.$parent.tooltip=T.html,this.traverse(R=>{R.default=R===T,R.default&&R.$item&&(0,y.inverseClass)(R.$item,"art-current")},T.$option),this.render(T.$parents)}format(T=this.option,R,M,N=[]){for(let P=0;P<T.length;P++){let L=T[P];if(L!=null&&L.name?((0,y.errorHandle)(!N.includes(L.name),`The [${L.name}] is already exist in [setting]`),N.push(L.name)):L.name=`setting-${this.id++}`,!L.$formatted){(0,y.def)(L,"$parent",{get:()=>R}),(0,y.def)(L,"$parents",{get:()=>M}),(0,y.def)(L,"$option",{get:()=>T});let A=[];(0,y.def)(L,"$events",{get:()=>A}),(0,y.def)(L,"$formatted",{get:()=>!0})}this.format(L.selector||[],L,T,N)}this.option=T}find(T=""){let R=null;return this.traverse(M=>{M.name===T&&(R=M)}),R}resize(){var L,A;let{controls:T,constructor:{SETTING_WIDTH:R,SETTING_ITEM_HEIGHT:M},template:{$player:N,$setting:P}}=this.art;if(T.setting&&this.show){let x=((A=(L=this.active[0])==null?void 0:L.$parent)==null?void 0:A.width)||R,{left:k,width:U}=(0,y.getRect)(T.setting),{left:K,width:$}=(0,y.getRect)(N),j=k-K+U/2-x/2,Q=this.active===this.option?this.active.length*M:(this.active.length+1)*M;if((0,y.setStyle)(P,"height",`${Q}px`),(0,y.setStyle)(P,"width",`${x}px`),this.art.isRotate||y.isMobile)return;j+x>$?((0,y.setStyle)(P,"left",null),(0,y.setStyle)(P,"right",null)):((0,y.setStyle)(P,"left",`${j}px`),(0,y.setStyle)(P,"right","auto"))}}inactivate(T){for(let R=0;R<T.$events.length;R++)this.art.events.remove(T.$events[R]);T.$events.length=0}remove(T){let R=this.find(T);(0,y.errorHandle)(R,`Can't find [${T}] in the [setting]`);let M=R.$option.indexOf(R);R.$option.splice(M,1),this.inactivate(R),R.$item&&(0,y.remove)(R.$item),this.render()}update(T){let R=this.find(T.name);return R?(this.inactivate(R),Object.assign(R,T),this.format(),this.creatItem(R,!0),this.render(),R):this.add(T)}add(T,R=this.option){return R.push(T),this.format(),this.creatItem(T),this.render(),T}creatHeader(T){if(!this.cache.has(T.$option))return;let R=this.cache.get(T.$option),{proxy:M,icons:{arrowLeft:N},constructor:{SETTING_ITEM_HEIGHT:P}}=this.art,L=(0,y.createElement)("div");(0,y.setStyle)(L,"height",`${P}px`),(0,y.addClass)(L,"art-setting-item"),(0,y.addClass)(L,"art-setting-item-back");let A=(0,y.append)(L,'<div class="art-setting-item-left"></div>'),x=(0,y.createElement)("div");(0,y.addClass)(x,"art-setting-item-left-icon"),(0,y.append)(x,N),(0,y.append)(A,x),(0,y.append)(A,T.$parent.html);let k=M(L,"click",()=>this.render(T.$parents));T.$parent.$events.push(k),(0,y.append)(R,L)}creatItem(T,R=!1){var ie,ee;if(!this.cache.has(T.$option))return;let M=this.cache.get(T.$option),N=T.$item,P="selector";(0,y.has)(T,"switch")&&(P="switch"),(0,y.has)(T,"range")&&(P="range");let{icons:L,proxy:A,constructor:x}=this.art,k=(0,y.createElement)("div");(0,y.addClass)(k,"art-setting-item"),(0,y.setStyle)(k,"height",`${x.SETTING_ITEM_HEIGHT}px`),k.dataset.name=T.name||"",k.dataset.value=T.value||"";let U=(0,y.append)(k,'<div class="art-setting-item-left"></div>'),K=(0,y.append)(k,'<div class="art-setting-item-right"></div>'),$=(0,y.createElement)("div");switch((0,y.addClass)($,"art-setting-item-left-icon"),P){case"switch":case"range":(0,y.append)($,T.icon||L.config);break;case"selector":(ie=T.selector)!=null&&ie.length?(0,y.append)($,T.icon||L.config):(0,y.append)($,L.check)}(0,y.append)(U,$),(0,y.def)(T,"$icon",{configurable:!0,get:()=>$}),(0,y.def)(T,"icon",{configurable:!0,get:()=>$.innerHTML,set(F){$.innerHTML="",(0,y.append)($,F)}});let j=(0,y.createElement)("div");(0,y.addClass)(j,"art-setting-item-left-text"),(0,y.append)(j,T.html||""),(0,y.append)(U,j),(0,y.def)(T,"$html",{configurable:!0,get:()=>j}),(0,y.def)(T,"html",{configurable:!0,get:()=>j.innerHTML,set(F){j.innerHTML="",(0,y.append)(j,F)}});let Q=(0,y.createElement)("div");switch((0,y.addClass)(Q,"art-setting-item-right-tooltip"),(0,y.append)(Q,T.tooltip||""),(0,y.append)(K,Q),(0,y.def)(T,"$tooltip",{configurable:!0,get:()=>Q}),(0,y.def)(T,"tooltip",{configurable:!0,get:()=>Q.innerHTML,set(F){Q.innerHTML="",(0,y.append)(Q,F)}}),P){case"switch":{let F=(0,y.createElement)("div");(0,y.addClass)(F,"art-setting-item-right-icon");let O=(0,y.append)(F,L.switchOn),H=(0,y.append)(F,L.switchOff);(0,y.setStyle)(T.switch?H:O,"display","none"),(0,y.append)(K,F),(0,y.def)(T,"$switch",{configurable:!0,get:()=>F});let W=T.switch;(0,y.def)(T,"switch",{configurable:!0,get:()=>W,set(ae){W=ae,ae?((0,y.setStyle)(H,"display","none"),(0,y.setStyle)(O,"display",null)):((0,y.setStyle)(H,"display",null),(0,y.setStyle)(O,"display","none"))}});break}case"range":{let F=(0,y.createElement)("div");(0,y.addClass)(F,"art-setting-item-right-icon");let O=(0,y.append)(F,'<input type="range">');O.value=T.range[0],O.min=T.range[1],O.max=T.range[2],O.step=T.range[3],(0,y.addClass)(O,"art-setting-range"),(0,y.append)(K,F),(0,y.def)(T,"$range",{configurable:!0,get:()=>O});let H=[...T.range];(0,y.def)(T,"range",{configurable:!0,get:()=>H,set(W){H=[...W],O.value=W[0],O.min=W[1],O.max=W[2],O.step=W[3]}})}break;case"selector":if((ee=T.selector)!=null&&ee.length){let F=(0,y.createElement)("div");(0,y.addClass)(F,"art-setting-item-right-icon"),(0,y.append)(F,L.arrowRight),(0,y.append)(K,F)}}switch(P){case"switch":if(T.onSwitch){let F=A(k,"click",async O=>{T.switch=await T.onSwitch.call(this.art,T,k,O)});T.$events.push(F)}break;case"range":if(T.$range){if(T.onRange){let F=A(T.$range,"change",async O=>{T.range[0]=T.$range.valueAsNumber,T.tooltip=await T.onRange.call(this.art,T,k,O)});T.$events.push(F)}if(T.onChange){let F=A(T.$range,"input",async O=>{T.range[0]=T.$range.valueAsNumber,T.tooltip=await T.onChange.call(this.art,T,k,O)});T.$events.push(F)}}break;case"selector":{let F=A(k,"click",async O=>{var H;(H=T.selector)!=null&&H.length?this.render(T.selector):(this.check(T),T.$parent.onSelect&&(T.$parent.tooltip=await T.$parent.onSelect.call(this.art,T,k,O)))});T.$events.push(F),T.default&&(0,y.addClass)(k,"art-current")}}(0,y.def)(T,"$item",{configurable:!0,get:()=>k}),R?(0,y.replaceElement)(k,N):(0,y.append)(M,k),T.mounted&&setTimeout(()=>T.mounted.call(this.art,T.$item,T),0)}render(T=this.option){var R;if(this.active=T,this.cache.has(T)){let M=this.cache.get(T);(0,y.inverseClass)(M,"art-current")}else{let M=(0,y.createElement)("div");this.cache.set(T,M),(0,y.addClass)(M,"art-setting-panel"),(0,y.append)(this.$parent,M),(0,y.inverseClass)(M,"art-current"),(R=T[0])!=null&&R.$parent&&this.creatHeader(T[0]);for(let N=0;N<T.length;N++)this.creatItem(T[N])}this.resize()}}r.default=b},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,icons:d,constructor:{SETTING_ITEM_WIDTH:u,FLIP:h}}=a;function f(_){return l.get((0,n.capitalize)(_))}function p(){let _=a.setting.find(`flip-${a.flip}`);a.setting.check(_)}return{width:u,name:"flip",html:l.get("Video Flip"),tooltip:f(a.flip),icon:d.flip,selector:h.map(_=>({value:_,name:`flip-${_}`,default:_===a.flip,html:f(_)})),onSelect:_=>(a.flip=_.value,_.html),mounted:()=>{p(),a.on("flip",()=>p())}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){let{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:d,ASPECT_RATIO:u}}=o;function h(p){return p==="default"?a.get("Default"):p}function f(){let p=o.setting.find(`aspect-ratio-${o.aspectRatio}`);o.setting.check(p)}return{width:d,name:"aspect-ratio",html:a.get("Aspect Ratio"),icon:l.aspectRatio,tooltip:h(o.aspectRatio),selector:u.map(p=>({value:p,name:`aspect-ratio-${p}`,default:p===o.aspectRatio,html:h(p)})),onSelect:p=>(o.aspectRatio=p.value,p.html),mounted:()=>{f(),o.on("aspectRatio",()=>f())}}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){let{i18n:a,icons:l,constructor:{SETTING_ITEM_WIDTH:d,PLAYBACK_RATE:u}}=o;function h(p){return p===1?a.get("Normal"):p.toFixed(1)}function f(){let p=o.setting.find(`playback-rate-${o.playbackRate}`);o.setting.check(p)}return{width:d,name:"playback-rate",html:a.get("Play Speed"),tooltip:h(o.playbackRate),icon:l.playbackRate,selector:u.map(p=>({value:p,name:`playback-rate-${p}`,default:p===o.playbackRate,html:h(p)})),onSelect:p=>(o.playbackRate=p.value,p.html),mounted:()=>{f(),o.on("video:ratechange",()=>f())}}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){let{i18n:a,icons:l,constructor:d}=o;return{width:d.SETTING_ITEM_WIDTH,name:"subtitle-offset",html:a.get("Subtitle Offset"),icon:l.subtitle,tooltip:"0s",range:[0,-10,10,.1],onChange:u=>(o.subtitleOffset=u.range[0],u.range[0]+"s"),mounted:(u,h)=>{o.on("subtitleOffset",f=>{h.$range.value=f,h.tooltip=f+"s"})}}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(t,i,r){t("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(s){try{let n=JSON.parse(window.localStorage.getItem(this.name))||{};return s?n[s]:n}catch{return s?this.settings[s]:this.settings}}set(s,n){try{let o=Object.assign({},this.get(),{[s]:n});window.localStorage.setItem(this.name,JSON.stringify(o))}catch{this.settings[s]=n}}del(s){try{let n=this.get();delete n[s],window.localStorage.setItem(this.name,JSON.stringify(n))}catch{delete this.settings[s]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=t("../utils"),o=t("./miniProgressBar"),a=s.interopDefault(o),l=t("./autoOrientation"),d=s.interopDefault(l),u=t("./autoPlayback"),h=s.interopDefault(u),f=t("./fastForward"),p=s.interopDefault(f),_=t("./lock"),y=s.interopDefault(_);r.default=class{constructor(b){this.art=b,this.id=0;let{option:I}=b;I.miniProgressBar&&!I.isLive&&this.add(a.default),I.lock&&n.isMobile&&this.add(y.default),I.autoPlayback&&!I.isLive&&this.add(h.default),I.autoOrientation&&n.isMobile&&this.add(d.default),I.fastForward&&n.isMobile&&!I.isLive&&this.add(p.default);for(let T=0;T<I.plugins.length;T++)this.add(I.plugins[T])}add(b){this.id+=1;let I=b.call(this.art,this.art);return I instanceof Promise?I.then(T=>this.next(b,T)):this.next(b,I)}next(b,I){let T=I&&I.name||b.name||`plugin${this.id}`;return(0,n.errorHandle)(!(0,n.has)(this,T),`Cannot add a plugin that already has the same name: ${T}`),(0,n.def)(this,T,{value:I}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){return a.on("control",l=>{l?(0,n.removeClass)(a.template.$player,"art-mini-progress-bar"):(0,n.addClass)(a.template.$player,"art-mini-progress-bar")}),{name:"mini-progress-bar"}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{constructor:l,template:{$player:d,$video:u}}=a;return a.on("fullscreenWeb",h=>{if(h){let{videoWidth:f,videoHeight:p}=u,{clientWidth:_,clientHeight:y}=document.documentElement;(f>p&&_<y||f<p&&_>y)&&setTimeout(()=>{(0,n.setStyle)(d,"width",`${y}px`),(0,n.setStyle)(d,"height",`${_}px`),(0,n.setStyle)(d,"transform-origin","0 0"),(0,n.setStyle)(d,"transform",`rotate(90deg) translate(0, -${_}px)`),(0,n.addClass)(d,"art-auto-orientation"),a.isRotate=!0,a.emit("resize")},l.AUTO_ORIENTATION_TIME)}else(0,n.hasClass)(d,"art-auto-orientation")&&((0,n.removeClass)(d,"art-auto-orientation"),a.isRotate=!1,a.emit("resize"))}),a.on("fullscreen",async h=>{var p;if(!((p=screen==null?void 0:screen.orientation)!=null&&p.lock))return;let f=screen.orientation.type;if(h){let{videoWidth:_,videoHeight:y}=u,{clientWidth:b,clientHeight:I}=document.documentElement;if(_>y&&b<I||_<y&&b>I){let T=f.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(T),(0,n.addClass)(d,"art-auto-orientation-fullscreen")}}else(0,n.hasClass)(d,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(f),(0,n.removeClass)(d,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,n.hasClass)(d,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{i18n:l,icons:d,storage:u,constructor:h,proxy:f,template:{$poster:p}}=a,_=a.layers.add({name:"auto-playback",html:'<div class="art-auto-playback-close"></div><div class="art-auto-playback-last"></div><div class="art-auto-playback-jump"></div>'}),y=(0,n.query)(".art-auto-playback-last",_),b=(0,n.query)(".art-auto-playback-jump",_),I=(0,n.query)(".art-auto-playback-close",_);(0,n.append)(I,d.close);let T=null;function R(){let M=(u.get("times")||{})[a.option.id||a.option.url];clearTimeout(T),(0,n.setStyle)(_,"display","none"),M&&M>=h.AUTO_PLAYBACK_MIN&&((0,n.setStyle)(_,"display","flex"),y.innerText=`${l.get("Last Seen")} ${(0,n.secondToTime)(M)}`,b.innerText=l.get("Jump Play"),f(I,"click",()=>{(0,n.setStyle)(_,"display","none")}),f(b,"click",()=>{a.seek=M,a.play(),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(_,"display","none")}),a.once("video:timeupdate",()=>{T=setTimeout(()=>{(0,n.setStyle)(_,"display","none")},h.AUTO_PLAYBACK_TIMEOUT)}))}return a.on("video:timeupdate",()=>{if(a.playing){let M=u.get("times")||{},N=Object.keys(M);N.length>h.AUTO_PLAYBACK_MAX&&delete M[N[0]],M[a.option.id||a.option.url]=a.currentTime,u.set("times",M)}}),a.on("ready",R),a.on("restart",R),{name:"auto-playback",get times(){return u.get("times")||{}},clear:()=>u.del("times"),delete(M){let N=u.get("times")||{};return delete N[M],u.set("times",N),N}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{constructor:l,proxy:d,template:{$player:u,$video:h}}=a,f=null,p=!1,_=1,y=()=>{clearTimeout(f),p&&(p=!1,a.playbackRate=_,(0,n.removeClass)(u,"art-fast-forward"))};return d(h,"touchstart",b=>{b.touches.length===1&&a.playing&&!a.isLock&&(f=setTimeout(()=>{p=!0,_=a.playbackRate,a.playbackRate=l.FAST_FORWARD_VALUE,(0,n.addClass)(u,"art-fast-forward")},l.FAST_FORWARD_TIME))}),d(document,"touchmove",y),d(document,"touchend",y),{name:"fastForward",get state(){return(0,n.hasClass)(u,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=t("../utils");function o(a){let{layers:l,icons:d,template:{$player:u}}=a;function h(){return(0,n.hasClass)(u,"art-lock")}function f(){(0,n.addClass)(u,"art-lock"),a.isLock=!0,a.emit("lock",!0)}function p(){(0,n.removeClass)(u,"art-lock"),a.isLock=!1,a.emit("lock",!1)}return l.add({name:"lock",mounted(_){let y=(0,n.append)(_,d.lock),b=(0,n.append)(_,d.unlock);(0,n.setStyle)(y,"display","none"),a.on("lock",I=>{I?((0,n.setStyle)(y,"display","inline-flex"),(0,n.setStyle)(b,"display","none")):((0,n.setStyle)(y,"display","none"),(0,n.setStyle)(b,"display","inline-flex"))})},click(){h()?p():f()}}),{name:"lock",get state(){return h()},set state(_){_?f():p()}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(cr,cr.exports);var ll=cr.exports;const cl=Tr(ll);var dr={exports:{}};dr.exports;(function(c,e){/*!
 * artplayer-plugin-chapter.js v1.0.0
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */(function(t,i,r,s,n){var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof yi<"u"?yi:{},a=typeof o[s]=="function"&&o[s],l=a.cache||{},d=typeof _i=="function"&&_i.bind(c);function u(p,_){if(!l[p]){if(!t[p]){var y=typeof o[s]=="function"&&o[s];if(!_&&y)return y(p,!0);if(a)return a(p,!0);if(d&&typeof p=="string")return d(p);var b=Error("Cannot find module '"+p+"'");throw b.code="MODULE_NOT_FOUND",b}T.resolve=function(R){var M=t[p][1][R];return M??R},T.cache={};var I=l[p]=new u.Module(p);t[p][0].call(I.exports,T,I,I.exports,this)}return l[p].exports;function T(R){var M=T.resolve(R);return M===!1?{}:u(M)}}u.isParcelRequire=!0,u.Module=function(p){this.id=p,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=a,u.register=function(p,_){t[p]=[function(y,b){b.exports=_},{}]},Object.defineProperty(u,"root",{get:function(){return o[s]}}),o[s]=u;for(var h=0;h<i.length;h++)u(i[h]);{var f=u(r);c.exports=f}})({eSFsM:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>a);var n=t("bundle-text:./style.less"),o=s.interopDefault(n);function a(l={}){return d=>{let{$player:u}=d.template,{setStyle:h,append:f,clamp:p,query:_,isMobile:y,addClass:b,removeClass:I}=d.constructor.utils,T='<div class="art-chapter"><div class="art-chapter-inner"><div class="art-progress-hover"></div><div class="art-progress-loaded"></div><div class="art-progress-played"></div></div></div>',R=null,M=[],N=d.query(".art-control-progress"),P=d.query(".art-control-progress-inner"),L=f(P,'<div class="art-chapters"></div>'),A=f(P,'<div class="art-chapter-title"></div>');function x({$chapter:U,width:K}){let $=U.dataset.title.trim();if($){h(A,"display","flex"),A.innerText=$;let j=A.clientWidth;K<=j/2?h(A,"left",0):K>P.clientWidth-j/2?h(A,"left",`${P.clientWidth-j}px`):h(A,"left",`${K-j/2}px`)}else h(A,"display","none")}function k(U=[]){if(M=[],L.innerText="",I(u,"artplayer-plugin-chapter"),Array.isArray(U)&&U.length&&d.duration){U=U.sort((K,$)=>K.start-$.start);for(let K=0;K<U.length;K++){let $=U[K],j=U[K+1];if($.end===1/0&&($.end=d.duration),typeof $.start!="number"||typeof $.end!="number"||typeof $.title!="string")throw Error("Illegal chapter data type");if($.start<0||$.end>d.duration||$.start>=$.end||j&&$.end>j.start)throw Error("Illegal chapter time point")}U[0].start>0&&U.unshift({start:0,end:U[0].start,title:""}),U[U.length-1].end<d.duration&&U.push({start:U[U.length-1].end,end:d.duration,title:""});for(let K=0;K<U.length-1;K++)U[K].end!==U[K+1].start&&U.splice(K+1,0,{start:U[K].end,end:U[K+1].start,title:""});M=U.map(K=>{let $=f(L,T),j=p(K.start,0,d.duration),Q=p(K.end,0,d.duration),ie=Q-j,ee=ie/d.duration;return $.dataset.start=j,$.dataset.end=Q,$.dataset.duration=ie,$.dataset.title=K.title.trim(),$.style.width=`${100*ee}%`,{$chapter:$,$hover:_(".art-progress-hover",$),$loaded:_(".art-progress-loaded",$),$played:_(".art-progress-played",$)}}),b(u,"artplayer-plugin-chapter"),d.emit("setBar","loaded",d.loaded||0)}}return d.on("setBar",(U,K,$)=>{if(M.length)for(let j=0;j<M.length;j++){let{$chapter:Q,$loaded:ie,$played:ee,$hover:F}=M[j],O={hover:F,loaded:ie,played:ee}[U];if(!O)return;let H=L.clientWidth*K,W=d.duration*K,ae=parseFloat(Q.dataset.duration),le=parseFloat(Q.dataset.start),ye=parseFloat(Q.dataset.end);if(W<le&&h(O,"width",0),W>ye&&h(O,"width","100%"),W>=le&&W<=ye){let me=(W-le)/ae;h(O,"width",`${100*me}%`),y?U==="played"&&$&&(x({$chapter:Q,width:H}),clearTimeout(R),R=setTimeout(()=>{h(A,"display","none")},500)):U==="hover"&&x({$chapter:Q,width:H})}}}),y||d.proxy(N,"mouseleave",()=>{M.length&&h(A,"display","none")}),d.once("video:loadedmetadata",()=>k(l.chapters)),{name:"artplayerPluginChapter",update:({chapters:U})=>k(U)}}}if(typeof document<"u"){let l="artplayer-plugin-chapter",d=document.getElementById(l);if(d)d.textContent=o.default;else{let u=document.createElement("style");u.id=l,u.textContent=o.default,document.head.appendChild(u)}}typeof window<"u"&&(window.artplayerPluginChapter=a)},{"bundle-text:./style.less":"9CXLk","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9CXLk":[function(t,i,r){i.exports=".artplayer-plugin-chapter .art-control-progress-inner{background-color:#0000!important;height:100%!important}.artplayer-plugin-chapter .art-control-progress-inner>.art-progress-hover,.artplayer-plugin-chapter .art-control-progress-inner>.art-progress-loaded,.artplayer-plugin-chapter .art-control-progress-inner>.art-progress-played{display:none!important}.artplayer-plugin-chapter .art-control-thumbnails{bottom:calc(var(--art-bottom-gap) + 64px)!important}.artplayer-plugin-chapter .art-chapters{z-index:0;align-items:center;gap:4px;height:100%;display:flex;position:absolute;inset:0;transform:scaleY(1.25)}.artplayer-plugin-chapter .art-chapters .art-chapter{align-items:center;height:100%;display:flex}.artplayer-plugin-chapter .art-chapters .art-chapter .art-chapter-inner{cursor:pointer;transition:height var(--art-transition-duration)ease;background-color:var(--art-progress-color);border-radius:10px;width:100%;height:50%;position:relative;overflow:hidden}.artplayer-plugin-chapter .art-chapters .art-chapter:hover .art-chapter-inner{height:100%}.artplayer-plugin-chapter .art-chapter-title{z-index:70;border-radius:var(--art-border-radius);white-space:nowrap;background-color:var(--art-tip-background);padding:3px 5px;font-size:14px;line-height:1;display:none;position:absolute;top:-50px;left:0}"},{}],"9pCYc":[function(t,i,r){r.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},r.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},r.exportAll=function(s,n){return Object.keys(s).forEach(function(o){o==="default"||o==="__esModule"||Object.prototype.hasOwnProperty.call(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[o]}})}),n},r.export=function(s,n,o){Object.defineProperty(s,n,{enumerable:!0,get:o})}},{}]},["eSFsM"],"eSFsM","parcelRequire4dc0")})(dr,dr.exports);var dl=dr.exports;const ul=Tr(dl);var ur={exports:{}};ur.exports;(function(c,e){/*!
 * artplayer-plugin-hls-control.js v1.0.1
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */(function(t,i,r,s,n){var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof yi<"u"?yi:{},a=typeof o[s]=="function"&&o[s],l=a.cache||{},d=typeof _i=="function"&&_i.bind(c);function u(p,_){if(!l[p]){if(!t[p]){var y=typeof o[s]=="function"&&o[s];if(!_&&y)return y(p,!0);if(a)return a(p,!0);if(d&&typeof p=="string")return d(p);var b=Error("Cannot find module '"+p+"'");throw b.code="MODULE_NOT_FOUND",b}T.resolve=function(R){var M=t[p][1][R];return M??R},T.cache={};var I=l[p]=new u.Module(p);t[p][0].call(I.exports,T,I,I.exports,this)}return l[p].exports;function T(R){var M=T.resolve(R);return M===!1?{}:u(M)}}u.isParcelRequire=!0,u.Module=function(p){this.id=p,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=a,u.register=function(p,_){t[p]=[function(y,b){b.exports=_},{}]},Object.defineProperty(u,"root",{get:function(){return o[s]}}),o[s]=u;for(var h=0;h<i.length;h++)u(i[h]);{var f=u(r);c.exports=f}})({haa6A:[function(t,i,r){var s=t("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>u);var n=t("bundle-text:./quality.svg"),o=s.interopDefault(n),a=t("bundle-text:./audio.svg"),l=s.interopDefault(a);function d(h,f){let p=new Map;return h.filter(_=>{let y=_[f];return y===void 0||!p.has(y)&&p.set(y,1)})}function u(h={}){return f=>{let{$video:p}=f.template,{errorHandle:_}=f.constructor.utils;function y(){var b;_(((b=f.hls)==null?void 0:b.media)===p,'Cannot find instance of HLS from "art.hls"'),function(I){if(!I.levels.length)return;let T=h.quality||{},R=T.auto||"Auto",M=T.title||"Quality",N=T.getName||(k=>k.name||k.height+"P"),P=I.levels[I.currentLevel],L=P?N(P):R,A=d(I.levels.map((k,U)=>({html:N(k,U),value:U,default:I.currentLevel===U})),"html").sort((k,U)=>U.value-k.value);A.push({html:R,value:-1,default:I.currentLevel===-1});let x=k=>(I.currentLevel=k.value,f.notice.show=`${M}: ${k.html}`,T.control&&f.controls.check(k),T.setting&&f.setting.check(k),k.html);T.control&&f.controls.update({name:"hls-quality",position:"right",html:L,style:{padding:"0 10px"},selector:A,onSelect:x}),T.setting&&f.setting.update({name:"hls-quality",tooltip:L,html:M,icon:o.default,width:200,selector:A,onSelect:x})}(f.hls),function(I){if(!I.audioTracks.length)return;let T=h.audio||{},R=T.auto||"Auto",M=T.title||"Audio",N=T.getName||(k=>k.name||k.lang||k.language),P=I.audioTracks[I.audioTrack],L=P?N(P):R,A=d(I.audioTracks.map((k,U)=>({html:N(k,U),value:k.id,default:I.audioTrack===k.id})),"html"),x=k=>(I.audioTrack=k.value,f.notice.show=`${M}: ${k.html}`,T.control&&f.controls.check(k),T.setting&&f.setting.check(k),k.html);T.control&&f.controls.update({name:"hls-audio",position:"right",html:L,style:{padding:"0 10px"},selector:A,onSelect:x}),T.setting&&f.setting.update({name:"hls-audio",tooltip:L,html:M,icon:l.default,width:200,selector:A,onSelect:x})}(f.hls)}return f.on("ready",y),f.on("restart",y),{name:"artplayerPluginHlsControl",update:y}}}typeof window<"u"&&(window.artplayerPluginHlsControl=u)},{"bundle-text:./quality.svg":"5aI3W","bundle-text:./audio.svg":"kbgg8","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aI3W":[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18"><path fill="#fff" d="M0 96c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v320c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zm323.8 106.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6-26.5-33.1c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4S78.8 416 88 416h336c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"/></svg>'},{}],kbgg8:[function(t,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" height="18"><path fill="#fff" d="M256 80C149.9 80 62.4 159.4 49.6 262c9.4-3.8 19.6-6 30.4-6 26.5 0 48 21.5 48 48v128c0 26.5-21.5 48-48 48-44.2 0-80-35.8-80-80V288C0 146.6 114.6 32 256 32s256 114.6 256 256v112c0 44.2-35.8 80-80 80-26.5 0-48-21.5-48-48V304c0-26.5 21.5-48 48-48 10.8 0 21 2.1 30.4 6C449.6 159.4 362.1 80 256 80z"/></svg>'},{}],"9pCYc":[function(t,i,r){r.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},r.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},r.exportAll=function(s,n){return Object.keys(s).forEach(function(o){o==="default"||o==="__esModule"||Object.prototype.hasOwnProperty.call(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[o]}})}),n},r.export=function(s,n,o){Object.defineProperty(s,n,{enumerable:!0,get:o})}},{}]},["haa6A"],"haa6A","parcelRequire4dc0")})(ur,ur.exports);var hl=ur.exports;const fl=Tr(hl),ge=Number.isFinite||function(c){return typeof c=="number"&&isFinite(c)},pl=Number.isSafeInteger||function(c){return typeof c=="number"&&Math.abs(c)<=ml},ml=Number.MAX_SAFE_INTEGER||9007199254740991;let Se=function(c){return c.NETWORK_ERROR="networkError",c.MEDIA_ERROR="mediaError",c.KEY_SYSTEM_ERROR="keySystemError",c.MUX_ERROR="muxError",c.OTHER_ERROR="otherError",c}({}),J=function(c){return c.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",c.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",c.KEY_SYSTEM_NO_SESSION="keySystemNoSession",c.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",c.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",c.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",c.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",c.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",c.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",c.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",c.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",c.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",c.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",c.MANIFEST_LOAD_ERROR="manifestLoadError",c.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",c.MANIFEST_PARSING_ERROR="manifestParsingError",c.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",c.LEVEL_EMPTY_ERROR="levelEmptyError",c.LEVEL_LOAD_ERROR="levelLoadError",c.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",c.LEVEL_PARSING_ERROR="levelParsingError",c.LEVEL_SWITCH_ERROR="levelSwitchError",c.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",c.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",c.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",c.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",c.FRAG_LOAD_ERROR="fragLoadError",c.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",c.FRAG_DECRYPT_ERROR="fragDecryptError",c.FRAG_PARSING_ERROR="fragParsingError",c.FRAG_GAP="fragGap",c.REMUX_ALLOC_ERROR="remuxAllocError",c.KEY_LOAD_ERROR="keyLoadError",c.KEY_LOAD_TIMEOUT="keyLoadTimeOut",c.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",c.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",c.BUFFER_APPEND_ERROR="bufferAppendError",c.BUFFER_APPENDING_ERROR="bufferAppendingError",c.BUFFER_STALLED_ERROR="bufferStalledError",c.BUFFER_FULL_ERROR="bufferFullError",c.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",c.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",c.ASSET_LIST_LOAD_ERROR="assetListLoadError",c.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",c.ASSET_LIST_PARSING_ERROR="assetListParsingError",c.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",c.INTERNAL_EXCEPTION="internalException",c.INTERNAL_ABORTED="aborted",c.ATTACH_MEDIA_ERROR="attachMediaError",c.UNKNOWN="unknown",c}({}),C=function(c){return c.MEDIA_ATTACHING="hlsMediaAttaching",c.MEDIA_ATTACHED="hlsMediaAttached",c.MEDIA_DETACHING="hlsMediaDetaching",c.MEDIA_DETACHED="hlsMediaDetached",c.MEDIA_ENDED="hlsMediaEnded",c.STALL_RESOLVED="hlsStallResolved",c.BUFFER_RESET="hlsBufferReset",c.BUFFER_CODECS="hlsBufferCodecs",c.BUFFER_CREATED="hlsBufferCreated",c.BUFFER_APPENDING="hlsBufferAppending",c.BUFFER_APPENDED="hlsBufferAppended",c.BUFFER_EOS="hlsBufferEos",c.BUFFERED_TO_END="hlsBufferedToEnd",c.BUFFER_FLUSHING="hlsBufferFlushing",c.BUFFER_FLUSHED="hlsBufferFlushed",c.MANIFEST_LOADING="hlsManifestLoading",c.MANIFEST_LOADED="hlsManifestLoaded",c.MANIFEST_PARSED="hlsManifestParsed",c.LEVEL_SWITCHING="hlsLevelSwitching",c.LEVEL_SWITCHED="hlsLevelSwitched",c.LEVEL_LOADING="hlsLevelLoading",c.LEVEL_LOADED="hlsLevelLoaded",c.LEVEL_UPDATED="hlsLevelUpdated",c.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",c.LEVELS_UPDATED="hlsLevelsUpdated",c.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",c.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",c.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",c.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",c.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",c.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",c.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",c.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",c.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",c.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",c.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",c.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",c.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",c.CUES_PARSED="hlsCuesParsed",c.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",c.INIT_PTS_FOUND="hlsInitPtsFound",c.FRAG_LOADING="hlsFragLoading",c.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",c.FRAG_LOADED="hlsFragLoaded",c.FRAG_DECRYPTED="hlsFragDecrypted",c.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",c.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",c.FRAG_PARSING_METADATA="hlsFragParsingMetadata",c.FRAG_PARSED="hlsFragParsed",c.FRAG_BUFFERED="hlsFragBuffered",c.FRAG_CHANGED="hlsFragChanged",c.FPS_DROP="hlsFpsDrop",c.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",c.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",c.ERROR="hlsError",c.DESTROYING="hlsDestroying",c.KEY_LOADING="hlsKeyLoading",c.KEY_LOADED="hlsKeyLoaded",c.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",c.BACK_BUFFER_REACHED="hlsBackBufferReached",c.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",c.ASSET_LIST_LOADING="hlsAssetListLoading",c.ASSET_LIST_LOADED="hlsAssetListLoaded",c.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",c.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",c.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",c.INTERSTITIAL_STARTED="hlsInterstitialStarted",c.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",c.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",c.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",c.INTERSTITIAL_ENDED="hlsInterstitialEnded",c.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",c.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",c.EVENT_CUE_ENTER="hlsEventCueEnter",c}({});var Be={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ee={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ci{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class gl{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ci(e),this.fast_=new ci(t),this.defaultTTFB_=r,this.ttfb_=new ci(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new ci(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new ci(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new ci(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function _l(c,e,t){return(e=vl(e))in c?Object.defineProperty(c,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):c[e]=t,c}function Ke(){return Ke=Object.assign?Object.assign.bind():function(c){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(c[i]=t[i])}return c},Ke.apply(null,arguments)}function un(c,e){var t=Object.keys(c);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(c);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(c,r).enumerable})),t.push.apply(t,i)}return t}function Ge(c){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?un(Object(t),!0).forEach(function(i){_l(c,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(t)):un(Object(t)).forEach(function(i){Object.defineProperty(c,i,Object.getOwnPropertyDescriptor(t,i))})}return c}function yl(c,e){if(typeof c!="object"||!c)return c;var t=c[Symbol.toPrimitive];if(t!==void 0){var i=t.call(c,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(c)}function vl(c){var e=yl(c,"string");return typeof e=="symbol"?e:e+""}class qt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Qt,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const Qt=function(){},El={trace:Qt,debug:Qt,log:Qt,warn:Qt,info:Qt,error:Qt};function cs(){return Ke({},El)}function Sl(c,e){const t=self.console[c];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${c}] >`):Qt}function hn(c,e,t){return e[c]?e[c].bind(e):Sl(c,t)}const ds=cs();function bl(c,e,t){const i=cs();if(typeof console=="object"&&c===!0||typeof c=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=hn(s,c,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.2`)}catch{return cs()}r.forEach(s=>{ds[s]=hn(s,c)})}else Ke(ds,i);return i}const Ne=ds;function Jt(c=!0){return typeof self>"u"?void 0:(c||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Tl(c){return typeof self<"u"&&c===self.ManagedMediaSource}function La(c,e){const t=Object.keys(c),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(n=>i.indexOf(n)===-1)}function vt(c,e=!1){if(typeof TextDecoder<"u"){const l=new TextDecoder("utf-8").decode(c);if(e){const d=l.indexOf("\0");return d!==-1?l.substring(0,d):l}return l.replace(/\0/g,"")}const t=c.length;let i,r,s,n="",o=0;for(;o<t;){if(i=c[o++],i===0&&e)return n;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=c[o++],n+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=c[o++],s=c[o++],n+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return n}const kt={hexDump:function(c){let e="";for(let t=0;t<c.length;t++){let i=c[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function xl(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Ur={exports:{}},fn;function Al(){return fn||(fn=1,function(c,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(a,l,d){if(d=d||{},a=a.trim(),l=l.trim(),!l){if(!d.alwaysNormalize)return a;var u=o.parseURL(a);if(!u)throw new Error("Error trying to parse base URL.");return u.path=o.normalizePath(u.path),o.buildURLFromParts(u)}var h=o.parseURL(l);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return d.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):l;var f=o.parseURL(a);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var p=r.exec(f.path);f.netLoc=p[1],f.path=p[2]}f.netLoc&&!f.path&&(f.path="/");var _={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(_.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)_.path=f.path,h.params||(_.params=f.params,h.query||(_.query=f.query));else{var y=f.path,b=y.substring(0,y.lastIndexOf("/")+1)+h.path;_.path=o.normalizePath(b)}return _.path===null&&(_.path=d.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(_)},parseURL:function(a){var l=i.exec(a);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(s,"");a.length!==(a=a.replace(n,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};c.exports=o})()}(Ur)),Ur.exports}var Rs=Al();class Is{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var He={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Ra{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Rl(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[He.AUDIO]:null,[He.VIDEO]:null,[He.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Is),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Rs.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[He.AUDIO]=null,e[He.VIDEO]=null,e[He.AUDIOVIDEO]=null}}function at(c){return c.sn!=="initSegment"}class $r extends Ra{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(ge(e)&&ge(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ge(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ge(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return at(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,n=!1){const{elementaryStreams:o}=this,a=o[e];if(!a){o[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:n};return}a.startPTS=Math.min(a.startPTS,t),a.endPTS=Math.max(a.endPTS,i),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,s)}}class Ll extends Ra{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Ia(c,e){const t=Object.getPrototypeOf(c);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||Ia(t,e)}}function Rl(c,e){const t=Ia(c,e);t&&(t.enumerable=!0,Object.defineProperty(c,e,t))}const hr=Math.pow(2,32)-1,Il=[].push,wa={video:1,audio:2,id3:3,text:4};function it(c){return String.fromCharCode.apply(null,c)}function Da(c,e){const t=c[e]<<8|c[e+1];return t<0?65536+t:t}function Re(c,e){const t=Ca(c,e);return t<0?4294967296+t:t}function pn(c,e){let t=Re(c,e);return t*=Math.pow(2,32),t+=Re(c,e+4),t}function Ca(c,e){return c[e]<<24|c[e+1]<<16|c[e+2]<<8|c[e+3]}function Gr(c,e,t){c[e]=t>>24,c[e+1]=t>>16&255,c[e+2]=t>>8&255,c[e+3]=t&255}function wl(c){const e=c.byteLength;for(let t=0;t<e;){const i=Re(c,t);if(i>8&&c[t+4]===109&&c[t+5]===111&&c[t+6]===111&&c[t+7]===102)return!0;t=i>1?t+i:e}return!1}function De(c,e){const t=[];if(!e.length)return t;const i=c.byteLength;for(let r=0;r<i;){const s=Re(c,r),n=it(c.subarray(r+4,r+8)),o=s>1?r+s:i;if(n===e[0])if(e.length===1)t.push(c.subarray(r+8,o));else{const a=De(c.subarray(r+8,o),e.slice(1));a.length&&Il.apply(t,a)}r=o}return t}function Dl(c){const e=[],t=c[0];let i=8;const r=Re(c,i);i+=4;let s=0,n=0;t===0?(s=Re(c,i),n=Re(c,i+4),i+=8):(s=pn(c,i),n=pn(c,i+8),i+=16),i+=2;let o=c.length+n;const a=Da(c,i);i+=2;for(let l=0;l<a;l++){let d=i;const u=Re(c,d);d+=4;const h=u&2147483647;if((u&2147483648)>>>31===1)return Ne.warn("SIDX has hierarchical references (not supported)"),null;const p=Re(c,d);d+=4,e.push({referenceSize:h,subsegmentDuration:p,info:{duration:p/r,start:o,end:o+h-1}}),o+=h,d+=4,i=d}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:a,references:e}}function ka(c){const e=[],t=De(c,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],n=De(s,["tkhd"])[0];if(n){let o=n[0];const a=Re(n,o===0?12:20),l=De(s,["mdia","mdhd"])[0];if(l){o=l[0];const d=Re(l,o===0?12:20),u=De(s,["mdia","hdlr"])[0];if(u){const h=it(u.subarray(8,12)),f={soun:He.AUDIO,vide:He.VIDEO}[h],p=De(s,["mdia","minf","stbl","stsd"])[0],_=Cl(p);f?(e[a]={timescale:d,type:f,stsd:_},e[f]=Ge({timescale:d,id:a},_)):e[a]={timescale:d,type:h,stsd:_}}}}}return De(c,["moov","mvex","trex"]).forEach(r=>{const s=Re(r,4),n=e[s];n&&(n.default={duration:Re(r,12),flags:Re(r,20)})}),e}function Cl(c){const e=c.subarray(8),t=e.subarray(86),i=it(e.subarray(4,8));let r=i,s;const n=i==="enca"||i==="encv";if(n){const l=De(e,[i])[0].subarray(i==="enca"?28:78);De(l,["sinf"]).forEach(u=>{const h=De(u,["schm"])[0];if(h){const f=it(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const p=De(u,["frma"])[0];p&&(r=it(p))}}})}const o=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const a=De(t,["avcC"])[0];a&&a.length>3&&(r+="."+ji(a[1])+ji(a[2])+ji(a[3]),s=Vi(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const a=De(e,[i])[0],l=De(a.subarray(28),["esds"])[0];if(l&&l.length>7){let d=4;if(l[d++]!==3)break;d=Vr(l,d),d+=2;const u=l[d++];if(u&128&&(d+=2),u&64&&(d+=l[d++]),l[d++]!==4)break;d=Vr(l,d);const h=l[d++];if(h===64)r+="."+ji(h);else break;if(d+=12,l[d++]!==5)break;d=Vr(l,d);const f=l[d++];let p=(f&248)>>3;p===31&&(p+=1+((f&7)<<3)+((l[d]&224)>>5)),r+="."+p}break}case"hvc1":case"hev1":{const a=De(t,["hvcC"])[0];if(a&&a.length>12){const l=a[1],d=["","A","B","C"][l>>6],u=l&31,h=Re(a,2),f=(l&32)>>5?"H":"L",p=a[12],_=a.subarray(6,12);r+="."+d+u,r+="."+h.toString(16).toUpperCase(),r+="."+f+p;let y="";for(let b=_.length;b--;){const I=_[b];(I||y)&&(y="."+I.toString(16).toUpperCase()+y)}r+=y}s=Vi(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Vi(r,t)||r;break}case"vp09":{const a=De(t,["vpcC"])[0];if(a&&a.length>6){const l=a[4],d=a[5],u=a[6]>>4&15;r+="."+Ct(l)+"."+Ct(d)+"."+Ct(u)}break}case"av01":{const a=De(t,["av1C"])[0];if(a&&a.length>2){const l=a[1]>>>5,d=a[1]&31,u=a[2]>>>7?"H":"M",h=(a[2]&64)>>6,f=(a[2]&32)>>5,p=l===2&&h?f?12:10:h?10:8,_=(a[2]&16)>>4,y=(a[2]&8)>>3,b=(a[2]&4)>>2,I=a[2]&3;r+="."+l+"."+Ct(d)+u+"."+Ct(p)+"."+_+"."+y+b+I+"."+Ct(1)+"."+Ct(1)+"."+Ct(1)+"."+0,s=Vi("dav1",t)}break}}return{codec:r,encrypted:n,supplemental:s}}function Vi(c,e){const t=De(e,["dvvC"]),i=t.length?t[0]:De(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return c+"."+Ct(r)+"."+Ct(s)}}function Vr(c,e){const t=e+5;for(;c[e++]&128&&e<t;);return e}function ji(c){return("0"+c.toString(16).toUpperCase()).slice(-2)}function Ct(c){return(c<10?"0":"")+c}function kl(c,e){if(!c||!e)return c;const t=e.keyId;return t&&e.isCommonEncryption&&De(c,["moov","trak"]).forEach(r=>{const n=De(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=De(n,["enca"]);const a=o.length>0;a||(o=De(n,["encv"])),o.forEach(l=>{const d=a?l.subarray(28):l.subarray(78);De(d,["sinf"]).forEach(h=>{const f=Pa(h);if(f){const p=f.subarray(8,24);p.some(_=>_!==0)||(Ne.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${kt.hexDump(p)} -> ${kt.hexDump(t)}`),f.set(t,8))}})})}),c}function Pa(c){const e=De(c,["schm"])[0];if(e){const t=it(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return De(c,["schi","tenc"])[0]}return null}function Pl(c,e){return De(e,["moof","traf"]).reduce((t,i)=>{const r=De(i,["tfdt"])[0],s=r[0],n=De(i,["tfhd"]).reduce((o,a)=>{const l=Re(a,4),d=c[l];if(d){let u=Re(r,4);if(s===1){if(u===hr)return Ne.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;u*=hr+1,u+=Re(r,8)}const h=d.timescale||9e4,f=u/h;if(ge(f)&&(o===null||f<o))return f}return o},null);return n!==null&&ge(n)&&(t===null||n<t)?n:t},null)}function Ml(c,e){let t=0,i=0,r=0;const s=De(c,["moof","traf"]);for(let n=0;n<s.length;n++){const o=s[n],a=De(o,["tfhd"])[0],l=Re(a,4),d=e[l];if(!d)continue;const u=d.default,h=Re(a,0)|(u==null?void 0:u.flags);let f=u==null?void 0:u.duration;h&8&&(h&2?f=Re(a,12):f=Re(a,8));const p=d.timescale||9e4,_=De(o,["trun"]);for(let y=0;y<_.length;y++){if(t=Ol(_[y]),!t&&f){const b=Re(_[y],4);t=f*b}d.type===He.VIDEO?i+=t/p:d.type===He.AUDIO&&(r+=t/p)}}if(i===0&&r===0){let n=1/0,o=0,a=0;const l=De(c,["sidx"]);for(let d=0;d<l.length;d++){const u=Dl(l[d]);if(u!=null&&u.references){n=Math.min(n,u.earliestPresentationTime/u.timescale);const h=u.references.reduce((f,p)=>f+p.info.duration||0,0);o=Math.max(o,h+u.earliestPresentationTime/u.timescale),a=o-n}}if(a&&ge(a))return a}return i||r}function Ol(c){const e=Re(c,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const r=Re(c,4);for(let s=0;s<r;s++){if(e&256){const n=Re(c,t);i+=n,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return i}function Bl(c,e,t){De(e,["moof","traf"]).forEach(i=>{De(i,["tfhd"]).forEach(r=>{const s=Re(r,4),n=c[s];if(!n)return;const o=n.timescale||9e4;De(i,["tfdt"]).forEach(a=>{const l=a[0],d=t*o;if(d){let u=Re(a,4);if(l===0)u-=d,u=Math.max(u,0),Gr(a,4,u);else{u*=Math.pow(2,32),u+=Re(a,8),u-=d,u=Math.max(u,0);const h=Math.floor(u/(hr+1)),f=Math.floor(u%(hr+1));Gr(a,4,h),Gr(a,8,f)}}})})})}function Fl(c){const e={valid:null,remainder:null},t=De(c,["moof"]);if(t.length<2)return e.remainder=c,e;const i=t[t.length-1];return e.valid=c.slice(0,i.byteOffset-8),e.remainder=c.slice(i.byteOffset-8),e}function xt(c,e){const t=new Uint8Array(c.length+e.length);return t.set(c),t.set(e,c.length),t}function mn(c,e){const t=[],i=e.samples,r=e.timescale,s=e.id;let n=!1;return De(i,["moof"]).map(a=>{const l=a.byteOffset-8;De(a,["traf"]).map(u=>{const h=De(u,["tfdt"]).map(f=>{const p=f[0];let _=Re(f,4);return p===1&&(_*=Math.pow(2,32),_+=Re(f,8)),_/r})[0];return h!==void 0&&(c=h),De(u,["tfhd"]).map(f=>{const p=Re(f,4),_=Re(f,0)&16777215,y=(_&1)!==0,b=(_&2)!==0,I=(_&8)!==0;let T=0;const R=(_&16)!==0;let M=0;const N=(_&32)!==0;let P=8;p===s&&(y&&(P+=8),b&&(P+=4),I&&(T=Re(f,P),P+=4),R&&(M=Re(f,P),P+=4),N&&(P+=4),e.type==="video"&&(n=xr(e.codec)),De(u,["trun"]).map(L=>{const A=L[0],x=Re(L,0)&16777215,k=(x&1)!==0;let U=0;const K=(x&4)!==0,$=(x&256)!==0;let j=0;const Q=(x&512)!==0;let ie=0;const ee=(x&1024)!==0,F=(x&2048)!==0;let O=0;const H=Re(L,4);let W=8;k&&(U=Re(L,W),W+=4),K&&(W+=4);let ae=U+l;for(let le=0;le<H;le++){if($?(j=Re(L,W),W+=4):j=T,Q?(ie=Re(L,W),W+=4):ie=M,ee&&(W+=4),F&&(A===0?O=Re(L,W):O=Ca(L,W),W+=4),e.type===He.VIDEO){let ye=0;for(;ye<ie;){const me=Re(i,ae);if(ae+=4,Nl(n,i[ae])){const re=i.subarray(ae,ae+me);ws(re,n?2:1,c+O/r,t)}ae+=me,ye+=me+4}}c+=j/r}}))})})}),t}function xr(c){if(!c)return!1;const e=c.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Nl(c,e){if(c){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ws(c,e,t,i){const r=Ma(c);let s=0;s+=e;let n=0,o=0,a=0;for(;s<r.length;){n=0;do{if(s>=r.length)break;a=r[s++],n+=a}while(a===255);o=0;do{if(s>=r.length)break;a=r[s++],o+=a}while(a===255);const l=r.length-s;let d=s;if(o<l)s+=o;else if(o>l){Ne.error(`Malformed SEI payload. ${o} is too small, only ${l} bytes left to parse.`);break}if(n===4){if(r[d++]===181){const h=Da(r,d);if(d+=2,h===49){const f=Re(r,d);if(d+=4,f===1195456820){const p=r[d++];if(p===3){const _=r[d++],y=31&_,b=64&_,I=b?2+y*3:0,T=new Uint8Array(I);if(b){T[0]=_;for(let R=1;R<I;R++)T[R]=r[d++]}i.push({type:p,payloadType:n,pts:t,bytes:T})}}}}}else if(n===5&&o>16){const u=[];for(let p=0;p<16;p++){const _=r[d++].toString(16);u.push(_.length==1?"0"+_:_),(p===3||p===5||p===7||p===9)&&u.push("-")}const h=o-16,f=new Uint8Array(h);for(let p=0;p<h;p++)f[p]=r[d++];i.push({payloadType:n,pts:t,uuid:u.join(""),userData:vt(f),userDataBytes:f})}}}function Ma(c){const e=c.byteLength,t=[];let i=1;for(;i<e-2;)c[i]===0&&c[i+1]===0&&c[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return c;const r=e-t.length,s=new Uint8Array(r);let n=0;for(i=0;i<r;n++,i++)n===t[0]&&(n++,t.shift()),s[i]=c[n];return s}function Ul(c){const e=c[0];let t="",i="",r=0,s=0,n=0,o=0,a=0,l=0;if(e===0){for(;it(c.subarray(l,l+1))!=="\0";)t+=it(c.subarray(l,l+1)),l+=1;for(t+=it(c.subarray(l,l+1)),l+=1;it(c.subarray(l,l+1))!=="\0";)i+=it(c.subarray(l,l+1)),l+=1;i+=it(c.subarray(l,l+1)),l+=1,r=Re(c,12),s=Re(c,16),o=Re(c,20),a=Re(c,24),l=28}else if(e===1){l+=4,r=Re(c,l),l+=4;const u=Re(c,l);l+=4;const h=Re(c,l);for(l+=4,n=2**32*u+h,pl(n)||(n=Number.MAX_SAFE_INTEGER,Ne.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Re(c,l),l+=4,a=Re(c,l),l+=4;it(c.subarray(l,l+1))!=="\0";)t+=it(c.subarray(l,l+1)),l+=1;for(t+=it(c.subarray(l,l+1)),l+=1;it(c.subarray(l,l+1))!=="\0";)i+=it(c.subarray(l,l+1)),l+=1;i+=it(c.subarray(l,l+1)),l+=1}const d=c.subarray(l,c.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:n,presentationTimeDelta:s,eventDuration:o,id:a,payload:d}}function $l(c,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(c,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function Gl(c,e,t){if(c.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const n=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(n.buffer).setUint32(0,t.byteLength,!1),$l([112,115,115,104],new Uint8Array([i,0,0,0]),c,s,r,n,t||new Uint8Array)}function Vl(c){const e=[];if(c instanceof ArrayBuffer){const t=c.byteLength;let i=0;for(;i+32<t;){const r=new DataView(c,i),s=jl(r);e.push(s),i+=s.size}}return e}function jl(c){const e=c.getUint32(0),t=c.byteOffset,i=c.byteLength;if(i<e)return{offset:t,size:i};if(c.getUint32(4)!==1886614376)return{offset:t,size:e};const s=c.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const n=c.buffer,o=kt.hexDump(new Uint8Array(n,t+12,16)),a=c.getUint32(28);let l=null,d=null;if(s===0){if(e-32<a||a<22)return{offset:t,size:e};d=new Uint8Array(n,t+32,a)}else if(s===1){if(!a||i<t+32+a*16+16)return{offset:t,size:e};l=[];for(let u=0;u<a;u++)l.push(new Uint8Array(n,t+32+u*16,16))}return{version:s,systemId:o,kids:l,data:d,offset:t,size:e}}const Oa=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),vi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ba(c,e){const t=vi[e];return!!t&&!!t[c.slice(0,4)]}function us(c,e,t=!0){return!c.split(",").some(i=>!Fa(i,e,t))}function Fa(c,e,t=!0){var i;const r=Jt(t);return(i=r==null?void 0:r.isTypeSupported(ki(c,e)))!=null?i:!1}function ki(c,e){return`${e}/mp4;codecs=${c}`}function gn(c){if(c){const e=c.substring(0,4);return vi.video[e]}return 2}function fr(c){const e=Oa();return c.split(",").reduce((t,i)=>{const s=e&&xr(i)?9:vi.video[i];return s?(s*2+t)/(t?3:2):(vi.audio[i]+t)/(t?2:1)},0)}const jr={};function Hl(c,e=!0){if(jr[c])return jr[c];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[c];for(let r=0;r<t.length;r++){var i;if(Fa(t[r],"audio",e))return jr[c]=t[r],t[r];if(t[r]==="mp3"&&(i=Jt(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return c}const Kl=/flac|opus|mp4a\.40\.34/i;function pr(c,e=!0){return c.replace(Kl,t=>Hl(t.toLowerCase(),e))}function zl(c,e){const t=[];if(c){const i=c.split(",");for(let r=0;r<i.length;r++)Ba(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function ir(c,e){if(c&&(c.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(c)!==-1))return c;if(e){const t=e.split(",");if(t.length>1){if(c){for(let i=t.length;i--;)if(t[i].substring(0,4)===c.substring(0,4))return t[i]}return t[0]}}return e||c}function ql(c){const e=c.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");if(i.length>2){let r=i.shift()+".";r+=parseInt(i.shift()).toString(16),r+=("000"+parseInt(i.shift()).toString(16)).slice(-4),e[t]=r}}return e.join(",")}function Yl(c){if(c.startsWith("av01.")){const e=c.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return c}function _n(c){const e=Jt(c)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Na(c){return c.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Ua={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function $a(c,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:c}}const yn={};function Wl(c,e,t,i,r,s){const n=c.audioCodec?c.audioGroups:null,o=s==null?void 0:s.audioCodec,a=s==null?void 0:s.channels,l=a?parseInt(a):o?1/0:2;let d=null;if(n!=null&&n.length)try{n.length===1&&n[0]?d=e.groups[n[0]].channels:d=n.reduce((u,h)=>{if(h){const f=e.groups[h];if(!f)throw new Error(`Audio track group ${h} not found`);Object.keys(f.channels).forEach(p=>{u[p]=(u[p]||0)+f.channels[p]})}return u},{2:0})}catch{return!0}return c.videoCodec!==void 0&&(c.width>1920&&c.height>1088||c.height>1920&&c.width>1088||c.frameRate>Math.max(i,30)||c.videoRange!=="SDR"&&c.videoRange!==t||c.bitrate>Math.max(r,8e6))||!!d&&ge(l)&&Object.keys(d).some(u=>parseInt(u)>l)}function Ga(c,e,t){const i=c.videoCodec,r=c.audioCodec;if(!i&&!r||!t)return Promise.resolve(Ua);const s=[];if(i){const n={width:c.width,height:c.height,bitrate:Math.ceil(Math.max(c.bitrate*.9,c.averageBitrate)),framerate:c.frameRate||30},o=c.videoRange;o!=="SDR"&&(n.transferFunction=o.toLowerCase());const a=i.split(","),l=navigator.userAgent;if(a.some(d=>xr(d))&&Oa())return Promise.resolve($a(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${l})`),s));s.push.apply(s,a.map(d=>({type:"media-source",video:Ge(Ge({},n),{},{contentType:ki(Yl(d),"video")})})))}return r&&c.audioGroups&&c.audioGroups.forEach(n=>{var o;n&&((o=e.groups[n])==null||o.tracks.forEach(a=>{if(a.groupId===n){const l=a.channels||"",d=parseFloat(l);ge(d)&&d>2&&s.push.apply(s,r.split(",").map(u=>({type:"media-source",audio:{contentType:ki(u,"audio"),channels:""+d}})))}}))}),Promise.all(s.map(n=>{const o=Xl(n);return yn[o]||(yn[o]=t.decodingInfo(n))})).then(n=>({supported:!n.some(o=>!o.supported),configurations:s,decodingInfoResults:n})).catch(n=>({supported:!1,configurations:s,decodingInfoResults:[],error:n}))}function Xl(c){const{audio:e,video:t}=c,i=t||e;if(i){const r=Na(i.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${r}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${r}`}return""}const hs=["NONE","TYPE-0","TYPE-1",null];function Ql(c){return hs.indexOf(c)>-1}const mr=["SDR","PQ","HLG"];function Zl(c){return!!c&&mr.indexOf(c)>-1}var rr={No:"",Yes:"YES",v2:"v2"};function vn(c){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=c,r=i<e/2;return e&&r?t?rr.v2:rr.Yes:rr.No}class En{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Pi{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Sn(this._audioGroups,e)}hasSubtitleGroup(e){return Sn(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Sn(c,e){return!e||!c?!1:c.indexOf(e)!==-1}function Jl(){if(typeof matchMedia=="function"){const c=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(c.media!==e.media)return c.matches===!0}return!1}function ec(c,e){let t=!1,i=[];if(c&&(t=c!=="SDR",i=[c]),e){i=e.allowedVideoRanges||mr.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&Jl(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const tc=c=>{const e=new WeakSet;return(t,i)=>{if(c&&(i=c(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},We=(c,e)=>JSON.stringify(c,tc(e));function ic(c,e,t,i,r){const s=Object.keys(c),n=i==null?void 0:i.channels,o=i==null?void 0:i.audioCodec,a=r==null?void 0:r.videoCodec,l=n&&parseInt(n)===2;let d=!1,u=!1,h=1/0,f=1/0,p=1/0,_=1/0,y=0,b=[];const{preferHDR:I,allowedVideoRanges:T}=ec(e,r);for(let L=s.length;L--;){const A=c[s[L]];d||(d=A.channels[2]>0),h=Math.min(h,A.minHeight),f=Math.min(f,A.minFramerate),p=Math.min(p,A.minBitrate),T.filter(k=>A.videoRanges[k]>0).length>0&&(u=!0)}h=ge(h)?h:0,f=ge(f)?f:0;const R=Math.max(1080,h),M=Math.max(30,f);p=ge(p)?p:t,t=Math.max(p,t),u||(e=void 0);const N=s.length>1;return{codecSet:s.reduce((L,A)=>{const x=c[A];if(A===L)return L;if(b=u?T.filter(k=>x.videoRanges[k]>0):[],N){if(x.minBitrate>t)return Dt(A,`min bitrate of ${x.minBitrate} > current estimate of ${t}`),L;if(!x.hasDefaultAudio)return Dt(A,"no renditions with default or auto-select sound found"),L;if(o&&A.indexOf(o.substring(0,4))%5!==0)return Dt(A,`audio codec preference "${o}" not found`),L;if(n&&!l){if(!x.channels[n])return Dt(A,`no renditions with ${n} channel sound found (channels options: ${Object.keys(x.channels)})`),L}else if((!o||l)&&d&&x.channels[2]===0)return Dt(A,"no renditions with stereo sound found"),L;if(x.minHeight>R)return Dt(A,`min resolution of ${x.minHeight} > maximum of ${R}`),L;if(x.minFramerate>M)return Dt(A,`min framerate of ${x.minFramerate} > maximum of ${M}`),L;if(!b.some(k=>x.videoRanges[k]>0))return Dt(A,`no variants with VIDEO-RANGE of ${We(b)} found`),L;if(a&&A.indexOf(a.substring(0,4))%5!==0)return Dt(A,`video codec preference "${a}" not found`),L;if(x.maxScore<y)return Dt(A,`max score of ${x.maxScore} < selected max of ${y}`),L}return L&&(fr(A)>=fr(L)||x.fragmentError>c[L].fragmentError)?L:(_=x.minIndex,y=x.maxScore,A)},void 0),videoRanges:b,preferHDR:I,minFramerate:f,minBitrate:p,minIndex:_}}function Dt(c,e){Ne.log(`[abr] start candidates with "${c}" ignored because ${e}`)}function Va(c){return c.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function rc(c,e,t,i){return c.slice(t,i+1).reduce((r,s,n)=>{if(!s.codecSet)return r;const o=s.audioGroups;let a=r[s.codecSet];a||(r[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,l),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.minIndex=Math.min(a.minIndex,n),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,o&&o.forEach(d=>{if(!d)return;const u=e.groups[d];u&&(a.hasDefaultAudio=a.hasDefaultAudio||e.hasDefaultAudio?u.hasDefault:u.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(u.channels).forEach(h=>{a.channels[h]=(a.channels[h]||0)+u.channels[h]}))}),r},{})}function bn(c){if(!c)return c;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=c;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function Mt(c,e,t){if("attrs"in c){const i=e.indexOf(c);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(si(c,r,t))return i}return-1}function si(c,e,t){const{groupId:i,name:r,lang:s,assocLang:n,default:o}=c,a=c.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||sc(s,e.lang))&&(s===void 0||e.assocLang===n)&&(o===void 0||e.default===o)&&(a===void 0||e.forced===a)&&(!("characteristics"in c)||nc(c.characteristics||"",e.characteristics))&&(t===void 0||t(c,e))}function sc(c,e="--"){return c.length===e.length?c===e:c.startsWith(e)||e.startsWith(c)}function nc(c,e=""){const t=c.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function ri(c,e){const{audioCodec:t,channels:i}=c;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function ac(c,e,t,i,r){const s=e[i],o=e.reduce((h,f,p)=>{const _=f.uri;return(h[_]||(h[_]=[])).push(p),h},{})[s.uri];o.length>1&&(i=Math.max.apply(Math,o));const a=s.videoRange,l=s.frameRate,d=s.codecSet.substring(0,4),u=Tn(e,i,h=>{if(h.videoRange!==a||h.frameRate!==l||h.codecSet.substring(0,4)!==d)return!1;const f=h.audioGroups,p=t.filter(_=>!f||f.indexOf(_.groupId)!==-1);return Mt(c,p,r)>-1});return u>-1?u:Tn(e,i,h=>{const f=h.audioGroups,p=t.filter(_=>!f||f.indexOf(_.groupId)!==-1);return Mt(c,p,r)>-1})}function Tn(c,e,t){for(let i=e;i>-1;i--)if(t(c[i]))return i;for(let i=e+1;i<c.length;i++)if(t(c[i]))return i;return-1}function gr(c,e){var t;return!!c&&c!==((t=e.loadLevelObj)==null?void 0:t.uri)}class oc extends qt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:s,hls:n}=this,{autoLevelEnabled:o,media:a}=n;if(!r||!a)return;const l=performance.now(),d=s?s.stats:r.stats,u=s?s.duration:r.duration,h=l-d.loading.start,f=n.minAutoLevel,p=r.level,_=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||p<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const y=_>-1&&_!==p,b=!!t||y;if(!b&&(a.paused||!a.playbackRate||!a.readyState))return;const I=n.mainForwardBufferInfo;if(!b&&I===null)return;const T=this.bwEstimator.getEstimateTTFB(),R=Math.abs(a.playbackRate);if(h<=Math.max(T,1e3*(u/(R*2))))return;const M=I?I.len/R:0,N=d.loading.first?d.loading.first-d.loading.start:-1,P=d.loaded&&N>-1,L=this.getBwEstimate(),A=n.levels,x=A[p],k=Math.max(d.loaded,Math.round(u*(r.bitrate||x.averageBitrate)/8));let U=P?h-N:h;U<1&&P&&(U=Math.min(h,d.loaded*8/L));const K=P?d.loaded*1e3/U:0,$=T/1e3,j=K?(k-d.loaded)/K:k*8/L+$;if(j<=M)return;const Q=K?K*8:L,ie=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,ee=this.hls.config.abrBandWidthUpFactor;let F=Number.POSITIVE_INFINITY,O;for(O=p-1;O>f;O--){const le=A[O].maxBitrate,ye=!A[O].details||ie;if(F=this.getTimeToLoadFrag($,Q,u*le,ye),F<Math.min(M,u+$))break}if(F>=j||F>u*10)return;P?this.bwEstimator.sample(h-Math.min(T,N),d.loaded):this.bwEstimator.sampleTTFB(h);const H=A[O].maxBitrate;this.getBwEstimate()*ee>H&&this.resetEstimator(H);const W=this.findBestLevel(H,f,O,0,M,1,1);W>-1&&(O=W),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${M.toFixed(3)} s
      Estimated load time for current fragment: ${j.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${ge(L)?L|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${O} @ ${H|0} bps`),n.nextLoadLevel=n.nextAutoLevel=O,this.clearTimer();const ae=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===O&&O>0){const le=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${O>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${le.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,O>f){let ye=this.findBestLevel(this.hls.levels[f].bitrate,f,O,0,le,1,1);ye===-1&&(ye=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ye,this.resetEstimator(this.hls.levels[ye].bitrate)}}};y||j>F*2?ae():this.timer=self.setInterval(ae,F*1e3),n.trigger(C.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new gl(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(C.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case J.BUFFER_ADD_CODEC_ERROR:case J.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case J.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const n=performance.now(),o=s?s.stats:i.stats,a=n-o.loading.start,l=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&l>-1){const u=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(a-Math.min(u,l),o.loaded)}else this.bwEstimator.sampleTTFB(a)}break}}}getTimeToLoadFrag(e,t,i,r){const s=e+i/t,n=r?e+this.lastLevelLoadSec:0;return s+n}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;ge(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===Ee.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:t.duration,n=this.hls.levels[t.level],o=(n.loaded?n.loaded.bytes:0)+r.loaded,a=(n.loaded?n.loaded.duration:0)+s;n.loaded={bytes:o,duration:a},n.realBitrate=Math.round(8*o/a)}if(t.bitrateTest){const s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(C.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const n=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ee.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;const n=this.hls.firstLevel,o=Math.min(Math.max(n,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${n} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const n=this.hls.levels;if(n.length>Math.max(e,s)&&n[e].loadError<=n[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:n}=i,o=t?t.duration:e?e.duration:0,a=this.getBwEstimate(),l=this.getStarvationDelay();let d=s.abrBandWidthFactor,u=s.abrBandWidthUpFactor;if(l){const y=this.findBestLevel(a,n,r,l,0,d,u);if(y>=0)return this.rebufferNotice=-1,y}let h=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const y=this.bitrateTestDelay;y&&(h=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-y,this.info(`bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),d=u=1)}const f=this.findBestLevel(a,n,r,l,h,d,u);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const p=i.levels[n],_=i.loadLevelObj;return _&&(p==null?void 0:p.bitrate)<_.bitrate?n:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,n,o){var a;const l=r+s,d=this.lastLoadedFragLevel,u=d===-1?this.hls.firstLevel:d,{fragCurrent:h,partCurrent:f}=this,{levels:p,allAudioTracks:_,loadLevel:y,config:b}=this.hls;if(p.length===1)return 0;const I=p[u],T=!!((a=this.hls.latestLevelDetails)!=null&&a.live),R=y===-1||d===-1;let M,N="SDR",P=(I==null?void 0:I.frameRate)||0;const{audioPreference:L,videoPreference:A}=b,x=this.audioTracksByGroup||(this.audioTracksByGroup=Va(_));let k=-1;if(R){if(this.firstSelection!==-1)return this.firstSelection;const Q=this.codecTiers||(this.codecTiers=rc(p,x,t,i)),ie=ic(Q,N,e,L,A),{codecSet:ee,videoRanges:F,minFramerate:O,minBitrate:H,minIndex:W,preferHDR:ae}=ie;k=W,M=ee,N=ae?F[F.length-1]:F[0],P=O,e=Math.max(e,H),this.log(`picked start tier ${We(ie)}`)}else M=I==null?void 0:I.codecSet,N=I==null?void 0:I.videoRange;const U=f?f.duration:h?h.duration:0,K=this.bwEstimator.getEstimateTTFB()/1e3,$=[];for(let Q=i;Q>=t;Q--){var j;const ie=p[Q],ee=Q>u;if(!ie)continue;if(b.useMediaCapabilities&&!ie.supportedResult&&!ie.supportedPromise){const ye=navigator.mediaCapabilities;typeof(ye==null?void 0:ye.decodingInfo)=="function"&&(Wl(ie,x,N,P,e,L)||xr(ie.videoCodec))?(ie.supportedPromise=Ga(ie,x,ye),ie.supportedPromise.then(me=>{if(!this.hls)return;ie.supportedResult=me;const re=this.hls.levels,oe=re.indexOf(ie);me.error?this.warn(`MediaCapabilities decodingInfo error: "${me.error}" for level ${oe} ${We(me)}`):me.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${oe} ${We(me)}`),oe>-1&&re.length>1&&(this.log(`Removing unsupported level ${oe}`),this.hls.removeLevel(oe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):ie.supportedResult=Ua}if((M&&ie.codecSet!==M||N&&ie.videoRange!==N||ee&&P>ie.frameRate||!ee&&P>0&&P<ie.frameRate||ie.supportedResult&&!((j=ie.supportedResult.decodingInfoResults)!=null&&j[0].smooth))&&(!R||Q!==k)){$.push(Q);continue}const F=ie.details,O=(f?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||U;let H;ee?H=o*e:H=n*e;const W=U&&r>=U*2&&s===0?ie.averageBitrate:ie.maxBitrate,ae=this.getTimeToLoadFrag(K,H,W*O,F===void 0);if(H>=W&&(Q===d||ie.loadError===0&&ie.fragmentError===0)&&(ae<=K||!ge(ae)||T&&!this.bitrateTestDelay||ae<l)){const ye=this.forcedAutoLevel;return Q!==y&&(ye===-1||ye!==y)&&($.length&&this.trace(`Skipped level(s) ${$.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${p[$[0]].codecs}" ${p[$[0]].videoRange}; not compatible with "${M}" ${N}`),this.info(`switch candidate:${u}->${Q} adjustedbw(${Math.round(H)})-bitrate=${Math.round(H-W)} ttfb:${K.toFixed(1)} avgDuration:${O.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${ae.toFixed(1)} firstSelection:${R} codecSet:${ie.codecSet} videoRange:${ie.videoRange} hls.loadLevel:${y}`)),R&&(this.firstSelection=Q),Q}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Ds={search:function(c,e){let t=0,i=c.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=c[r];const n=e(s);if(n>0)t=r+1;else if(n<0)i=r-1;else return s}return null}};function lc(c,e,t){if(e===null||!Array.isArray(c)||!c.length||!ge(e))return null;const i=c[0].programDateTime;if(e<(i||0))return null;const r=c[c.length-1].endProgramDateTime;if(e>=(r||0))return null;t=t||0;for(let s=0;s<c.length;++s){const n=c[s];if(dc(e,t,n))return n}return null}function ni(c,e,t=0,i=0,r=.005){let s=null;if(c){s=e[1+c.sn-e[0].sn]||null;const o=c.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&c.level!==s.level&&s.end<=c.end&&(s=e[2+c.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!c||c.level===s.level)&&xn(t,i,s)===0||cc(s,c,Math.min(r,i))))return s;const n=Ds.search(e,xn.bind(null,t,i));return n&&(n!==c||!s)?n:s}function cc(c,e,t){if(e&&e.start===0&&e.level<c.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return c.start<=i}return!1}function xn(c=0,e=0,t){if(t.start<=c&&t.start+t.duration>c)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=c?1:t.start-i>c&&t.start?-1:0}function dc(c,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>c}function ja(c,e){return Ds.search(c,t=>t.cc<e?1:t.cc>e?-1:0)}function uc(c,e,t){if(c&&c.startCC<=e&&c.endCC>=e){const i=t.start,r=t.end;let s=c.fragments;if(!t.relurl){const{fragmentHint:n}=c;n&&(s=s.concat(n))}return Ds.search(s,n=>n.cc<e||n.end<=i?1:n.cc>e||n.start>=r?-1:0)}return null}function _r(c){switch(c.details){case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_TIMEOUT:case J.LEVEL_LOAD_TIMEOUT:case J.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function An(c,e){const t=_r(e);return c.default[`${t?"timeout":"error"}Retry`]}function Cs(c,e){const t=c.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*c.retryDelayMs,c.maxRetryDelayMs)}function Ln(c){return Ge(Ge({},c),{errorRetry:null,timeoutRetry:null})}function yr(c,e,t,i){if(!c)return!1;const r=i==null?void 0:i.code,s=e<c.maxNumRetry&&(hc(r)||!!t);return c.shouldRetry?c.shouldRetry(c,e,t,i,s):s}function hc(c){return c===0&&navigator.onLine===!1||!!c&&(c<400||c>499)}var dt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Rt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class fc extends qt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(C.ERROR,this.onError,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(C.ERROR,this.onError,this),e.off(C.ERROR,this.onErrorOut,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Ee.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case J.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Mi();return}case J.FRAG_GAP:case J.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=dt.SendAlternateToPenaltyBox;return}case J.LEVEL_EMPTY_ERROR:case J.LEVEL_PARSING_ERROR:{var n,o;const l=t.parent===Ee.MAIN?t.level:r.loadLevel;t.details===J.LEVEL_EMPTY_ERROR&&((n=t.context)!=null&&(o=n.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.SUBTITLE_LOAD_ERROR:case J.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===Be.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===Be.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=dt.SendAlternateToPenaltyBox,t.errorAction.flags=Rt.MoveAllAlternatesMatchingHost;return}}return;case J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=r.loadLevelObj,d=l==null?void 0:l.attrs["HDCP-LEVEL"];d?t.errorAction={action:dt.SendAlternateToPenaltyBox,flags:Rt.MoveAllAlternatesMatchingHDCP,hdcpLevel:d}:this.keySystemError(t)}return;case J.BUFFER_ADD_CODEC_ERROR:case J.REMUX_ALLOC_ERROR:case J.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case J.INTERNAL_EXCEPTION:case J.BUFFER_APPENDING_ERROR:case J.BUFFER_FULL_ERROR:case J.LEVEL_SWITCH_ERROR:case J.BUFFER_STALLED_ERROR:case J.BUFFER_SEEK_OVER_HOLE:case J.BUFFER_NUDGE_ON_STALL:t.errorAction=Mi();return}t.type===Se.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=An(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(yr(r,s,_r(e),e.response))return{action:dt.RetryRequest,flags:Rt.None,retryConfig:r,retryCount:s};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:n}=t.config,o=An(e.details.startsWith("key")?n:s,e),a=t.levels.reduce((d,u)=>d+u.fragmentError,0);if(r&&(e.details!==J.FRAG_GAP&&r.fragmentError++,yr(o,a,_r(e),e.response)))return{action:dt.RetryRequest,flags:Rt.None,retryConfig:o,retryCount:a};const l=this.getLevelSwitchAction(e,i);return o&&(l.retryConfig=o,l.retryCount=a),l}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var s,n;const l=e.details;r.loadError++,l===J.BUFFER_APPEND_ERROR&&r.fragmentError++;let d=-1;const{levels:u,loadLevel:h,minAutoLevel:f,maxAutoLevel:p}=i;i.autoLevelEnabled||(i.loadLevel=-1);const _=(s=e.frag)==null?void 0:s.type,b=(_===Ee.AUDIO&&l===J.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(l===J.BUFFER_ADD_CODEC_ERROR||l===J.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:N})=>r.audioCodec!==N),T=e.sourceBufferName==="video"&&(l===J.BUFFER_ADD_CODEC_ERROR||l===J.BUFFER_APPEND_ERROR)&&u.some(({codecSet:N,audioCodec:P})=>r.codecSet!==N&&r.audioCodec===P),{type:R,groupId:M}=(n=e.context)!=null?n:{};for(let N=u.length;N--;){const P=(N+h)%u.length;if(P!==h&&P>=f&&P<=p&&u[P].loadError===0){var o,a;const L=u[P];if(l===J.FRAG_GAP&&_===Ee.MAIN&&e.frag){const A=u[P].details;if(A){const x=ni(e.frag,A.fragments,e.frag.start);if(x!=null&&x.gap)continue}}else{if(R===Be.AUDIO_TRACK&&L.hasAudioGroup(M)||R===Be.SUBTITLE_TRACK&&L.hasSubtitleGroup(M))continue;if(_===Ee.AUDIO&&(o=r.audioGroups)!=null&&o.some(A=>L.hasAudioGroup(A))||_===Ee.SUBTITLE&&(a=r.subtitleGroups)!=null&&a.some(A=>L.hasSubtitleGroup(A))||b&&r.audioCodec===L.audioCodec||!b&&r.audioCodec!==L.audioCodec||T&&r.codecSet===L.codecSet)continue}d=P;break}}if(d>-1&&i.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:dt.SendAlternateToPenaltyBox,flags:Rt.None,nextAutoLevel:d}}return{action:dt.SendAlternateToPenaltyBox,flags:Rt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case dt.DoNothing:break;case dt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==J.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:n}=i;switch(r){case Rt.None:this.switchLevel(e,n);break;case Rt.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=hs[hs.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===J.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Na(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(s)}}}function Mi(c){const e={action:dt.DoNothing,flags:Rt.None};return c&&(e.resolved=!0),e}var rt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class pc{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;const n=s.end;if(s.start<=e&&n!==null&&e<=n)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,s=Object.keys(r);for(let n=s.length;n--;){const o=r[s[n]];if((o==null?void 0:o.body.type)===t&&(!i||o.buffered)){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);const n=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||n>=a.body.sn)return;if(!a.buffered&&(!a.loaded||s)){a.body.type===i&&this.removeFragment(a.body);return}const l=a.range[e];if(l){if(l.time.length===0){this.removeFragment(a.body);return}l.time.some(d=>{const u=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return u&&this.removeFragment(a.body),u})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=di(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const n=!i.relurl;Object.keys(t).forEach(o=>{const a=i.elementaryStreams[o];if(!a)return;const l=t[o],d=n||a.partial===!0;s.range[o]=this.getBufferedTimes(i,e.part,d,l)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Hi(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=Rn(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=di(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},n=e.start,o=e.end,a=e.minEndPTS||o,l=e.maxStartPTS||n;for(let d=0;d<r.length;d++){const u=r.start(d)-this.bufferPadding,h=r.end(d)+this.bufferPadding;if(l>=u&&a<=h){s.time.push({startPTS:Math.max(n,r.start(d)),endPTS:Math.min(o,r.end(d))});break}else if(n<h&&o>u){const f=Math.max(n,r.start(d)),p=Math.min(o,r.end(d));p>f&&(s.partial=!0,s.time.push({startPTS:f,endPTS:p}))}else if(o<=u)break}return s}getPartialFragment(e){let t=null,i,r,s,n=0;const{bufferPadding:o,fragments:a}=this;return Object.keys(a).forEach(l=>{const d=a[l];d&&Hi(d)&&(r=d.body.start-o,s=d.body.end+o,e>=r&&e<=s&&(i=Math.min(e-r,s-e),n<=i&&(t=d.body,n=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Hi(t))}getState(e){const t=di(e),i=this.fragments[t];return i?i.buffered?Hi(i)?rt.PARTIAL:rt.OK:rt.APPENDING:rt.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let n=0;n<i.length;n++){if(r=i.start(n)-this.bufferPadding,s=i.end(n)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,s=di(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s,type:n}=t;if(i.sn==="initSegment")return;const o=i.type;if(r){let l=this.activePartLists[o];l||(this.activePartLists[o]=l=[]),l.push(r)}this.timeRanges=s;const a=s[n];this.detectEvictedFragments(n,a,o,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=di(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const s=t[i[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(n=>{const o=this.fragments[n];if(!o)return;const a=o.body;a.type!==i||r&&!a.gap||a.start<t&&a.end>e&&(o.buffered||s)&&this.removeFragment(a)})}removeFragment(e){const t=di(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=Rn(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(r=>r.clearElementaryStreamInfo())}}function Hi(c){var e,t,i;return c.buffered&&(c.body.gap||((e=c.range.video)==null?void 0:e.partial)||((t=c.range.audio)==null?void 0:t.partial)||((i=c.range.audiovideo)==null?void 0:i.partial))}function di(c){return`${c.type}_${c.level}_${c.sn}`}function Rn(c,e){return c.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var ei={cbc:0,ctr:1};class mc{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case ei.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ei.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function gc(c){const e=c.byteLength,t=e&&new DataView(c.buffer).getUint8(e-1);return t?c.slice(0,e-t):c}class _c{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],n=i[2],o=i[3],a=this.invSubMix,l=a[0],d=a[1],u=a[2],h=a[3],f=new Uint32Array(256);let p=0,_=0,y=0;for(y=0;y<256;y++)y<128?f[y]=y<<1:f[y]=y<<1^283;for(y=0;y<256;y++){let b=_^_<<1^_<<2^_<<3^_<<4;b=b>>>8^b&255^99,e[p]=b,t[b]=p;const I=f[p],T=f[I],R=f[T];let M=f[b]*257^b*16843008;r[p]=M<<24|M>>>8,s[p]=M<<16|M>>>16,n[p]=M<<8|M>>>24,o[p]=M,M=R*16843009^T*65537^I*257^p*16843008,l[b]=M<<24|M>>>8,d[b]=M<<16|M>>>16,u[b]=M<<8|M>>>24,h[b]=M,p?(p=I^f[f[f[R^I]]],_^=f[f[_]]):p=_=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const n=this.ksRows=(s+6+1)*4;let o,a;const l=this.keySchedule=new Uint32Array(n),d=this.invKeySchedule=new Uint32Array(n),u=this.sBox,h=this.rcon,f=this.invSubMix,p=f[0],_=f[1],y=f[2],b=f[3];let I,T;for(o=0;o<n;o++){if(o<s){I=l[o]=t[o];continue}T=I,o%s===0?(T=T<<8|T>>>24,T=u[T>>>24]<<24|u[T>>>16&255]<<16|u[T>>>8&255]<<8|u[T&255],T^=h[o/s|0]<<24):s>6&&o%s===4&&(T=u[T>>>24]<<24|u[T>>>16&255]<<16|u[T>>>8&255]<<8|u[T&255]),l[o]=I=(l[o-s]^T)>>>0}for(a=0;a<n;a++)o=n-a,a&3?T=l[o]:T=l[o-4],a<4||o<=4?d[a]=T:d[a]=p[u[T>>>24]]^_[u[T>>>16&255]]^y[u[T>>>8&255]]^b[u[T&255]],d[a]=d[a]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,n=this.invSBox,o=this.invSubMix,a=o[0],l=o[1],d=o[2],u=o[3],h=this.uint8ArrayToUint32Array_(i);let f=h[0],p=h[1],_=h[2],y=h[3];const b=new Int32Array(e),I=new Int32Array(b.length);let T,R,M,N,P,L,A,x,k,U,K,$,j,Q;const ie=this.networkToHostOrderSwap;for(;t<b.length;){for(k=ie(b[t]),U=ie(b[t+1]),K=ie(b[t+2]),$=ie(b[t+3]),P=k^s[0],L=$^s[1],A=K^s[2],x=U^s[3],j=4,Q=1;Q<r;Q++)T=a[P>>>24]^l[L>>16&255]^d[A>>8&255]^u[x&255]^s[j],R=a[L>>>24]^l[A>>16&255]^d[x>>8&255]^u[P&255]^s[j+1],M=a[A>>>24]^l[x>>16&255]^d[P>>8&255]^u[L&255]^s[j+2],N=a[x>>>24]^l[P>>16&255]^d[L>>8&255]^u[A&255]^s[j+3],P=T,L=R,A=M,x=N,j=j+4;T=n[P>>>24]<<24^n[L>>16&255]<<16^n[A>>8&255]<<8^n[x&255]^s[j],R=n[L>>>24]<<24^n[A>>16&255]<<16^n[x>>8&255]<<8^n[P&255]^s[j+1],M=n[A>>>24]<<24^n[x>>16&255]<<16^n[P>>8&255]<<8^n[L&255]^s[j+2],N=n[x>>>24]<<24^n[P>>16&255]<<16^n[L>>8&255]<<8^n[A&255]^s[j+3],I[t]=ie(T^f),I[t+1]=ie(N^p),I[t+2]=ie(M^_),I[t+3]=ie(R^y),f=k,p=U,_=K,y=$,t=t+4}return I.buffer}}class yc{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=vc(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function vc(c){switch(c){case ei.cbc:return"AES-CBC";case ei.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${c}`)}}const Ec=16;class ks{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?gc(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,n)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,i,r);const a=this.flush();a?s(a.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:s,currentResult:n,remainderData:o}=this;if(r!==ei.cbc||t.byteLength!==16)return Ne.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=xt(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;s&&(i=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new _c),l.expandKey(t);const d=n;return this.currentResult=l.decrypt(a.buffer,0,i),this.currentIV=a.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new yc(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new mc(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ne.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const n=this.flush();if(n)return n.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%Ec;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Ne.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const In=Math.pow(2,17);class Sc{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Ht({type:Se.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){a(Dn(e));return}else e.gap=!1;const l=this.loader=s?new s(r):new n(r),d=wn(e);e.loader=l;const u=Ln(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:In};e.stats=l.stats;const f={onSuccess:(p,_,y,b)=>{this.resetLoader(e,l);let I=p.data;y.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(I.slice(0,16)),I=I.slice(16)),o({frag:e,part:null,payload:I,networkDetails:b})},onError:(p,_,y,b)=>{this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ge({url:i,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:y,stats:b}))},onAbort:(p,_,y)=>{this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:y,stats:p}))},onTimeout:(p,_,y)=>{this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:y,stats:p}))}};t&&(f.onProgress=(p,_,y,b)=>t({frag:e,part:null,payload:y,networkDetails:b})),l.load(d,h,f)})}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){a(Dn(e,t));return}const l=this.loader=s?new s(r):new n(r),d=wn(e,t);e.loader=l;const u=Ln(r.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:In};t.stats=l.stats,l.load(d,h,{onSuccess:(f,p,_,y)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:f.data,networkDetails:y};i(b),o(b)},onError:(f,p,_,y)=>{this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ge({url:d.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:_,stats:y}))},onAbort:(f,p,_)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:_,stats:f}))},onTimeout:(f,p,_)=>{this.resetLoader(e,l),a(new Ht({type:Se.NETWORK_ERROR,details:J.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:_,stats:f}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const a=Math.round(e.duration/t.duration),l=Math.min(Math.round(i.loaded/s),a),u=(a-l)*Math.round(i.loaded/l);i.total=i.loaded+u}else i.total=Math.max(i.loaded,i.total);const n=i.loading,o=r.loading;n.start?n.first+=o.first-o.start:(n.start=o.start,n.first=o.first),n.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function wn(c,e=null){const t=e||c,i={frag:c,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(ge(r)&&ge(s)){var n;let o=r,a=s;if(c.sn==="initSegment"&&bc((n=c.decryptdata)==null?void 0:n.method)){const l=s-r;l%16&&(a=s+(16-l%16)),r!==0&&(i.resetIV=!0,o=r-16)}i.rangeStart=o,i.rangeEnd=a}return i}function Dn(c,e){const t=new Error(`GAP ${c.gap?"tag":"attribute"} found`),i={type:Se.MEDIA_ERROR,details:J.FRAG_GAP,fatal:!1,frag:c,error:t,networkDetails:null};return e&&(i.part=e),(e||c).stats.aborted=!0,new Ht(i)}function bc(c){return c==="AES-128"||c==="AES-256"}class Ht extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ha extends qt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Ps{constructor(e,t,i,r=0,s=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ki(),this.buffering={audio:Ki(),video:Ki(),audiovideo:Ki()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=n}}function Ki(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Cn={length:0,start:()=>0,end:()=>0};class Me{static isBuffered(e,t){if(e){const i=Me.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Me.getBuffered(e);return Me.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=Me.bufferedRanges(e);if(r.length)return Me.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((d,u)=>d.start-u.start||u.end-d.end);let r=-1,s=[];if(i)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(r=d);const u=s.length;if(u){const h=s[u-1].end;e[d].start-h<i?e[d].end>h&&(s[u-1].end=e[d].end):s.push(e[d])}else s.push(e[d])}else s=e;let n=0,o,a=t,l=t;for(let d=0;d<s.length;d++){const u=s[d].start,h=s[d].end;if(r===-1&&t>=u&&t<=h&&(r=d),t+i>=u&&t<h)a=u,l=h,n=l-t;else if(t+i<u){o=u;break}}return{len:n,start:a||0,end:l||0,nextStart:o,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Cn}catch(t){return Ne.log("failed to get media.buffered",t),Cn}}}const Ka=/\{\$([a-zA-Z0-9-_]+)\}/g;function kn(c){return Ka.test(c)}function fs(c,e){if(c.variableList!==null||c.hasVariableRefs){const t=c.variableList;return e.replace(Ka,i=>{const r=i.substring(2,i.length-1),s=t==null?void 0:t[r];return s===void 0?(c.playlistParsingError||(c.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function Pn(c,e,t){let i=c.variableList;i||(c.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const n=new self.URL(t).searchParams;if(n.has(r))s=n.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(n){c.playlistParsingError||(c.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else r=e.NAME,s=e.VALUE;r in i?c.playlistParsingError||(c.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function Tc(c,e,t){const i=e.IMPORT;if(t&&i in t){let r=c.variableList;r||(c.variableList=r={}),r[i]=t[i]}else c.playlistParsingError||(c.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const xc=/^(\d+)x(\d+)$/,Mn=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Xe{constructor(e,t){typeof e=="string"&&(e=Xe.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xc.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={},s='"';for(Mn.lastIndex=0;(i=Mn.exec(e))!==null;){const n=i[1].trim();let o=i[2];const a=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let l=!1;if(a)o=o.slice(1,-1);else switch(n){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":l=!0}if(t&&(a||l))o=fs(t,o);else if(!l&&!a)switch(n){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ne.warn(`${e}: attribute ${n} is missing quotes`)}r[n]=o}return r}}const Ac="com.apple.hls.interstitial";function Lc(c){return c!=="ID"&&c!=="CLASS"&&c!=="CUE"&&c!=="START-DATE"&&c!=="DURATION"&&c!=="END-DATE"&&c!=="END-ON-NEXT"}function Rc(c){return c==="SCTE35-OUT"||c==="SCTE35-IN"||c==="SCTE35-CMD"}class za{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:i,t){const s=t.attr;for(const n in s)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==s[n]){Ne.warn(`DATERANGE tag attribute: "${n}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=n;break}e=Ke(new Xe({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ge(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ne.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ge(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Ac}get isValid(){return!!this.id&&!this._badValueForSameId&&ge(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Ic=10;class wc{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?ge(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Ic}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function pi(c){return c==="AES-128"||c==="AES-256"||c==="AES-256-CTR"}function Ms(c){switch(c){case"AES-128":case"AES-256":return ei.cbc;case"AES-256-CTR":return ei.ctr;default:throw new Error(`invalid full segment method ${c}`)}}function Os(c){return Uint8Array.from(atob(c),e=>e.charCodeAt(0))}function ps(c){return Uint8Array.from(unescape(encodeURIComponent(c)),e=>e.charCodeAt(0))}function Dc(c){const e=ps(c).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Cc(c){const e=function(i,r,s){const n=i[r];i[r]=i[s],i[s]=n};e(c,0,3),e(c,1,2),e(c,4,5),e(c,6,7)}function kc(c){const e=c.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",n=r[1];s?(i.splice(-1,1),t=Os(n)):t=Dc(n)}}return t}const vr=typeof self<"u"?self:void 0;var Ve={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Hr(c){switch(c){case gt.FAIRPLAY:return Ve.FAIRPLAY;case gt.PLAYREADY:return Ve.PLAYREADY;case gt.WIDEVINE:return Ve.WIDEVINE;case gt.CLEARKEY:return Ve.CLEARKEY}}var zi={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Kr(c){if(c===zi.WIDEVINE)return Ve.WIDEVINE;if(c===zi.PLAYREADY)return Ve.PLAYREADY;if(c===zi.CENC||c===zi.CLEARKEY)return Ve.CLEARKEY}function zr(c){switch(c){case Ve.FAIRPLAY:return gt.FAIRPLAY;case Ve.PLAYREADY:return gt.PLAYREADY;case Ve.WIDEVINE:return gt.WIDEVINE;case Ve.CLEARKEY:return gt.CLEARKEY}}function qi(c){const{drmSystems:e,widevineLicenseUrl:t}=c,i=e?[Ve.FAIRPLAY,Ve.WIDEVINE,Ve.PLAYREADY,Ve.CLEARKEY].filter(r=>!!e[r]):[];return!i[Ve.WIDEVINE]&&t&&i.push(Ve.WIDEVINE),i}const qa=function(c){return vr!=null&&(c=vr.navigator)!=null&&c.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Pc(c,e,t,i){let r;switch(c){case Ve.FAIRPLAY:r=["cenc","sinf"];break;case Ve.WIDEVINE:case Ve.PLAYREADY:r=["cenc"];break;case Ve.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${c}`)}return Mc(r,e,t,i)}function Mc(c,e,t,i){return[{initDataTypes:c,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Oc(c){var e;return c.sessionType==="persistent-license"||!!((e=c.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Ya(c){const e=new Uint16Array(c.buffer,c.byteOffset,c.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(n){const o=n.childNodes[0]?n.childNodes[0].nodeValue:n.getAttribute("VALUE");if(o){const a=Os(o).subarray(0,16);return Cc(a),a}}return null}let Yi={};class Oi{static clearKeyUriToKeyIdMap(){Yi={}}constructor(e,t,i,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!pi(e)}isSupported(){if(this.method){if(pi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gt.FAIRPLAY:case gt.WIDEVINE:case gt.PLAYREADY:case gt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(pi(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Ne.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=Bc(e);return new Oi(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=kc(this.uri);if(t)switch(this.keyFormat){case gt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case gt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Gl(i,null,t),this.keyId=Ya(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Yi[this.uri];if(!i){const r=Object.keys(Yi).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),Yi[this.uri]=i}this.keyId=i}return this}}function Bc(c){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=c>>8*(15-t)&255;return e}const On=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Bn=/#EXT-X-MEDIA:(.*)/g,Fc=/^#EXT(?:INF|-X-TARGETDURATION):/m,qr=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Nc=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ot{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return Rs.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Fc.test(e)}static parseMasterPlaylist(e,t){const i=kn(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];On.lastIndex=0;let n;for(;(n=On.exec(e))!=null;)if(n[1]){var o;const l=new Xe(n[1],r),d=fs(r,n[2]),u={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:Ot.resolve(d,t)},h=l.decimalResolution("RESOLUTION");h&&(u.width=h.width,u.height=h.height),Un(l.CODECS,u);const f=l["SUPPLEMENTAL-CODECS"];f&&(u.supplemental={},Un(f,u.supplemental)),(o=u.unknownCodecs)!=null&&o.length||s.push(u),r.levels.push(u)}else if(n[3]){const l=n[3],d=n[4];switch(l){case"SESSION-DATA":{const u=new Xe(d,r),h=u["DATA-ID"];h&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[h]=u);break}case"SESSION-KEY":{const u=Fn(d,t,r);u.encrypted&&u.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(u)):Ne.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const u=new Xe(d,r);Pn(r,u,t)}break}case"CONTENT-STEERING":{const u=new Xe(d,r);r.contentSteering={uri:Ot.resolve(u["SERVER-URI"],t),pathwayId:u["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Nn(d);break}}}const a=s.length>0&&s.length<r.levels.length;return r.levels=a?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const s={},n=i.levels,o={AUDIO:n.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:n.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let a=0;for(Bn.lastIndex=0;(r=Bn.exec(e))!==null;){const l=new Xe(r[1],i),d=l.TYPE;if(d){const u=o[d],h=s[d]||[];s[d]=h;const f=l.LANGUAGE,p=l["ASSOC-LANGUAGE"],_=l.CHANNELS,y=l.CHARACTERISTICS,b=l["INSTREAM-ID"],I={attrs:l,bitrate:0,id:a++,groupId:l["GROUP-ID"]||"",name:l.NAME||f||"",type:d,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:f,url:l.URI?Ot.resolve(l.URI,t):""};if(p&&(I.assocLang=p),_&&(I.channels=_),y&&(I.characteristics=y),b&&(I.instreamId=b),u!=null&&u.length){const T=Ot.findGroup(u,I.groupId)||u[0];$n(I,T,"audioCodec"),$n(I,T,"textCodec")}h.push(I)}}return s}static parseLevelPlaylist(e,t,i,r,s,n){var o;const a={url:t},l=new wc(t),d=l.fragments,u=[];let h=null,f=0,p=0,_=0,y=0,b=0,I=null,T=new $r(r,a),R,M,N,P=-1,L=!1,A=null,x;if(qr.lastIndex=0,l.m3u8=e,l.hasVariableRefs=kn(e),((o=qr.exec(e))==null?void 0:o[0])!=="#EXTM3U")return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;(R=qr.exec(e))!==null;){L&&(L=!1,T=new $r(r,a),T.playlistOffset=_,T.start=_,T.sn=f,T.cc=y,b&&(T.bitrate=b),T.level=i,h&&(T.initSegment=h,h.rawProgramDateTime&&(T.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),A&&(T.setByteRange(A),A=null)));const $=R[1];if($){T.duration=parseFloat($);const j=(" "+R[2]).slice(1);T.title=j||null,T.tagList.push(j?["INF",$,j]:["INF",$])}else if(R[3]){if(ge(T.duration)){T.playlistOffset=_,T.start=_,N&&Vn(T,N,l),T.sn=f,T.level=i,T.cc=y,d.push(T);const j=(" "+R[3]).slice(1);T.relurl=fs(l,j),ms(T,I,u),I=T,_+=T.duration,f++,p=0,L=!0}}else{if(R=R[0].match(Nc),!R){Ne.warn("No matches on slow regex match for level playlist!");continue}for(M=1;M<R.length&&R[M]===void 0;M++);const j=(" "+R[M]).slice(1),Q=(" "+R[M+1]).slice(1),ie=R[M+2]?(" "+R[M+2]).slice(1):null;switch(j){case"BYTERANGE":I?T.setByteRange(Q,I):T.setByteRange(Q);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=Q,T.tagList.push(["PROGRAM-DATE-TIME",Q]),P===-1&&(P=d.length);break;case"PLAYLIST-TYPE":l.type&&Vt(l,j,R),l.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":l.startSN!==0?Vt(l,j,R):d.length>0&&jn(l,j,R),f=l.startSN=parseInt(Q);break;case"SKIP":{l.skippedSegments&&Vt(l,j,R);const ee=new Xe(Q,l),F=ee.decimalInteger("SKIPPED-SEGMENTS");if(ge(F)){l.skippedSegments+=F;for(let H=F;H--;)d.push(null);f+=F}const O=ee.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(O.split("	")));break}case"TARGETDURATION":l.targetduration!==0&&Vt(l,j,R),l.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":l.version!==null&&Vt(l,j,R),l.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Vt(l,j,R),l.live=!1;break;case"#":(Q||ie)&&T.tagList.push(ie?[Q,ie]:[Q]);break;case"DISCONTINUITY":y++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([j]);break;case"BITRATE":T.tagList.push([j,Q]),b=parseInt(Q)*1e3,ge(b)?T.bitrate=b:b=0;break;case"DATERANGE":{const ee=new Xe(Q,l),F=new za(ee,l.dateRanges[ee.ID],l.dateRangeTagCount);l.dateRangeTagCount++,F.isValid||l.skippedSegments?l.dateRanges[F.id]=F:Ne.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),T.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const ee=new Xe(Q,l);"IMPORT"in ee?Tc(l,ee,n):Pn(l,ee,t)}break}case"DISCONTINUITY-SEQUENCE":l.startCC!==0?Vt(l,j,R):d.length>0&&jn(l,j,R),l.startCC=y=parseInt(Q);break;case"KEY":{const ee=Fn(Q,t,l);if(ee.isSupported()){if(ee.method==="NONE"){N=void 0;break}N||(N={}),N[ee.keyFormat]&&(N=Ke({},N)),N[ee.keyFormat]=ee}else Ne.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Q}"`);break}case"START":l.startTimeOffset=Nn(Q);break;case"MAP":{const ee=new Xe(Q,l);if(T.duration){const F=new $r(r,a);Gn(F,ee,i,N),h=F,T.initSegment=h,h.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=h.rawProgramDateTime)}else{const F=T.byteRangeEndOffset;if(F){const O=T.byteRangeStartOffset;A=`${F-O}@${O}`}else A=null;Gn(T,ee,i,N),h=T,L=!0}h.cc=y;break}case"SERVER-CONTROL":{x&&Vt(l,j,R),x=new Xe(Q),l.canBlockReload=x.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=x.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&x.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=x.optionalFloat("PART-HOLD-BACK",0),l.holdBack=x.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{l.partTarget&&Vt(l,j,R);const ee=new Xe(Q);l.partTarget=ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ee=l.partList;ee||(ee=l.partList=[]);const F=p>0?ee[ee.length-1]:void 0,O=p++,H=new Xe(Q,l),W=new Ll(H,T,a,O,F);ee.push(W),T.duration+=W.duration;break}case"PRELOAD-HINT":{const ee=new Xe(Q,l);l.preloadHint=ee;break}case"RENDITION-REPORT":{const ee=new Xe(Q,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(ee);break}default:Ne.warn(`line parsed but not handled: ${R}`);break}}}I&&!I.relurl?(d.pop(),_-=I.duration,l.partList&&(l.fragmentHint=I)):l.partList&&(ms(T,I,u),T.cc=y,l.fragmentHint=T,N&&Vn(T,N,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const k=d.length,U=d[0],K=d[k-1];if(_+=l.skippedSegments*l.targetduration,_>0&&k&&K){l.averagetargetduration=_/k;const $=K.sn;l.endSN=$!=="initSegment"?$:0,l.live||(K.endList=!0),U&&l.startCC===void 0&&(l.startCC=U.cc),P>0&&($c(d,P),U&&u.unshift(U))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(_+=l.fragmentHint.duration),l.totalduration=_,u.length&&l.dateRangeTagCount&&U&&Wa(u,l),l.endCC=y,l}}function Wa(c,e){const t=c.length,i=c[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let n=s.length;n--;){const o=e.dateRanges[s[n]],a=o.startDate.getTime();o.tagAnchor=i.ref;for(let l=t;l--;){const d=Uc(e,a,c,l,r);if(d!==-1){o.tagAnchor=e.fragments[d].ref;break}}}}function Uc(c,e,t,i,r){const s=t[i];if(s){const o=s.programDateTime;if(e>=o||i===0){var n;const a=(((n=t[i+1])==null?void 0:n.start)||r)-s.start;if(e<=o+a*1e3){const l=t[i].sn-c.startSN,d=c.fragments;if(d.length>t.length){const h=(t[i+1]||d[d.length-1]).sn-c.startSN;for(let f=h;f>l;f--){const p=d[f].programDateTime;if(e>=p&&e<p+d[f].duration*1e3)return f}}return l}}}return-1}function Fn(c,e,t){var i,r;const s=new Xe(c,t),n=(i=s.METHOD)!=null?i:"",o=s.URI,a=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,d=(r=s.KEYFORMAT)!=null?r:"identity";o&&s.IV&&!a&&Ne.error(`Invalid IV: ${s.IV}`);const u=o?Ot.resolve(o,e):"",h=(l||"1").split("/").map(Number).filter(Number.isFinite);return new Oi(n,u,d,h,a)}function Nn(c){const t=new Xe(c).decimalFloatingPoint("TIME-OFFSET");return ge(t)?t:null}function Un(c,e){let t=(c||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(s=>Ba(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function $n(c,e,t){const i=e[t];i&&(c[t]=i)}function $c(c,e){let t=c[e];for(let i=e;i--;){const r=c[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function ms(c,e,t){c.rawProgramDateTime?t.push(c):e!=null&&e.programDateTime&&(c.programDateTime=e.endProgramDateTime)}function Gn(c,e,t,i){c.relurl=e.URI,e.BYTERANGE&&c.setByteRange(e.BYTERANGE),c.level=t,c.sn="initSegment",i&&(c.levelkeys=i),c.initSegment=null}function Vn(c,e,t){c.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(c)}function Vt(c,e,t){c.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function jn(c,e,t){c.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Yr(c,e){const t=e.startPTS;if(ge(t)){let i=0,r;e.sn>c.sn?(i=t-c.start,r=c):(i=c.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>c.sn?c.cc===e.cc&&c.minEndPTS?e.setStart(c.start+(c.minEndPTS-c.start)):e.setStart(c.start+c.duration):e.setStart(Math.max(c.start-e.duration,0))}function Xa(c,e,t,i,r,s){i-t<=0&&(Ne.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let o=t,a=i;const l=e.startPTS,d=e.endPTS;if(ge(l)){const y=Math.abs(l-t);ge(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,o=Math.max(t,l),t=Math.min(t,l),r=Math.min(r,e.startDTS),a=Math.min(i,d),i=Math.max(i,d),s=Math.max(s,e.endDTS)}const u=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=o,e.startDTS=r,e.endPTS=i,e.minEndPTS=a,e.endDTS=s;const h=e.sn;if(!c||h<c.startSN||h>c.endSN)return 0;let f;const p=h-c.startSN,_=c.fragments;for(_[p]=e,f=p;f>0;f--)Yr(_[f],_[f-1]);for(f=p;f<_.length-1;f++)Yr(_[f],_[f+1]);return c.fragmentHint&&Yr(_[_.length-1],c.fragmentHint),c.PTSKnown=c.alignedSliding=!0,u}function Gc(c,e){if(c===e)return;let t=null;const i=c.fragments;for(let a=i.length-1;a>=0;a--){const l=i[a].initSegment;if(l){t=l;break}}c.fragmentHint&&delete c.fragmentHint.endPTS;let r;Hc(c,e,(a,l,d,u)=>{if(!e.startCC&&l.cc!==a.cc){var h,f;const p=a.cc-l.cc;for(let _=d;_<u.length;_++)u[_].cc+=p;e.startCC=(h=(f=Ja(c,e.startSN-1))==null?void 0:f.cc)!=null?h:u[0].cc,e.endCC=u[u.length-1].cc}ge(a.startPTS)&&ge(a.endPTS)&&(l.setStart(l.startPTS=a.startPTS),l.startDTS=a.startDTS,l.maxStartPTS=a.maxStartPTS,l.endPTS=a.endPTS,l.endDTS=a.endDTS,l.minEndPTS=a.minEndPTS,l.setDuration(a.endPTS-a.startPTS),l.duration&&(r=l),e.PTSKnown=e.alignedSliding=!0),a.hasStreams&&(l.elementaryStreams=a.elementaryStreams),l.loader=a.loader,a.hasStats&&(l.stats=a.stats),a.initSegment&&(l.initSegment=a.initSegment,t=a.initSegment)});const s=e.fragments,n=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&n.forEach(a=>{var l;a&&(!a.initSegment||a.initSegment.relurl===((l=t)==null?void 0:l.relurl))&&(a.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=s.some(a=>!a),e.deltaUpdateFailed){Ne.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let a=e.skippedSegments;a--;)s.shift();e.startSN=s[0].sn}else{e.endCC=s[s.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=Vc(c.dateRanges,e));const a=c.fragments.filter(l=>l.rawProgramDateTime);if(c.hasProgramDateTime&&!e.hasProgramDateTime)for(let l=1;l<n.length;l++)n[l].programDateTime===null&&ms(n[l],n[l-1],a);Wa(a,e)}jc(c.partList,e.partList,(a,l)=>{l.elementaryStreams=a.elementaryStreams,l.stats=a.stats}),r?Xa(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Qa(c,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=c.driftStartTime,e.driftStart=c.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const a=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=a),e.driftEndTime=o,e.driftEnd=a}else e.driftEndTime=c.driftEndTime,e.driftEnd=c.driftEnd,e.advancedDateTime=c.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=c.requestScheduled)}function Vc(c,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,r=Ke({},c);i&&i.forEach(o=>{delete r[o]});const n=Object.keys(r).length;return n&&Object.keys(t).forEach(o=>{const a=r[o],l=new za(t[o].attr,a);l.isValid?(r[o]=l,a||(l.tagOrder+=n)):Ne.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${We(t[o].attr)}"`)}),r}function jc(c,e,t){if(c&&e){let i=0;for(let r=0,s=c.length;r<=s;r++){const n=c[r],o=e[r+i];n&&o&&n.index===o.index&&n.fragment.sn===o.fragment.sn?t(n,o):i--}}}function Hc(c,e,t){const i=e.skippedSegments,r=Math.max(c.startSN,e.startSN)-e.startSN,s=(c.fragmentHint?1:0)+(i?e.endSN:Math.min(c.endSN,e.endSN))-e.startSN,n=e.startSN-c.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,a=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments;for(let l=r;l<=s;l++){const d=a[n+l];let u=o[l];if(i&&!u&&d&&(u=e.fragments[l]=d),d&&u){if(t(d,u,l,o),d.url&&d.url!==u.url){e.playlistParsingError=Hn(`media sequence mismatch ${u.sn}:`,c,e,d,u);return}else if(d.cc!==u.cc){e.playlistParsingError=Hn(`discontinuity sequence mismatch (${d.cc}!=${u.cc})`,c,e,d,u);return}}}}function Hn(c,e,t,i,r){return new Error(`${c} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Qa(c,e,t=!0){const i=e.startSN+e.skippedSegments-c.startSN,r=c.fragments,s=i>=0;let n=0;if(s&&i<r.length)n=r[i].start;else if(s&&e.startSN===c.endSN+1)n=c.fragmentEnd;else if(s&&t)n=c.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)n=c.fragmentStart;else return;gs(e,n)}function gs(c,e){if(e){const t=c.fragments;for(let i=c.skippedSegments;i<t.length;i++)t[i].addStart(e);c.fragmentHint&&c.fragmentHint.addStart(e)}}function Za(c,e=1/0){let t=1e3*c.targetduration;if(c.updated){const i=c.fragments;if(i.length&&t*4>e){const s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function Ja(c,e,t){if(!c)return null;let i=c.fragments[e-c.startSN];return i||(i=c.fragmentHint,i&&i.sn===e)?i:e<c.startSN&&t&&t.sn===e?t:null}function Kn(c,e,t){return c?eo(c.partList,e,t):null}function eo(c,e,t){if(c)for(let i=c.length;i--;){const r=c[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function to(c){c.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function wi(c,e){for(let i=0,r=c.length;i<r;i++){var t;if(((t=c[i])==null?void 0:t.cc)===e)return c[i]}return null}function Kc(c,e){return!!(c&&e.startCC<c.endCC&&e.endCC>c.startCC)}function zn(c,e){if(c){const t=c.start+e;c.start=c.startPTS=t,c.endPTS=t+c.duration}}function io(c,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)zn(t[i],c);e.fragmentHint&&zn(e.fragmentHint,c),e.alignedSliding=!0}function zc(c,e){c&&(ro(e,c),!e.alignedSliding&&c&&Er(e,c),!e.alignedSliding&&c&&!e.skippedSegments&&Qa(c,e,!1))}function ro(c,e){if(!Kc(e,c))return;const t=Math.min(e.endCC,c.endCC),i=wi(e.fragments,t),r=wi(c.fragments,t);if(!i||!r)return;Ne.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=i.start-r.start;io(s,c)}function Er(c,e){if(!c.hasProgramDateTime||!e.hasProgramDateTime)return;const t=c.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s;const n=Math.min(e.endCC,c.endCC);e.startCC<n&&c.startCC<n&&(r=wi(i,n),s=wi(t,n)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=wi(t,r.cc)||t[Math.floor(t.length/2)]);const o=r.programDateTime,a=s.programDateTime;if(!o||!a)return;const l=(a-o)/1e3-(s.start-r.start);io(l,c)}const qc={toString:function(c){let e="";const t=c.length;for(let i=0;i<t;i++)e+=`[${c.start(i).toFixed(3)}-${c.end(i).toFixed(3)}]`;return e}},ne={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Bs extends Ha{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ne.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:n,fragCurrent:o,media:a,mediaBuffer:l,state:d}=this,u=a?a.currentTime:0,h=Me.bufferInfo(l||a,u,n.maxBufferHole);if(this.log(`media seeking to ${ge(u)?u.toFixed(3):u}, state: ${d}`),this.state===ne.ENDED)this.resetLoadingState();else if(o){const f=n.maxFragLookUpTolerance,p=o.start-f,_=o.start+o.duration+f;if(!h.len||_<h.start||p>h.end){const y=u>_;(u<p||y)&&(y&&o.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(a){this.fragmentTracker.removeFragmentsInRange(u,1/0,this.playlistType,!0);const f=this.lastCurrentTime;if(u>f&&(this.lastCurrentTime=u),!this.loadingParts){const p=Math.max(h.end,u),_=this.shouldLoadParts(this.getLevelDetails(),p);_&&(this.log(`LL-Part loading ON after seeking to ${u.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=_)}}!this.hls.hasEnoughToStart&&!h.len&&(this.log(`setting startPosition to ${u} because of seek before start`),this.nextLoadPosition=this.startPosition=u),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new Sc(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ks(e.config)}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ne.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ne.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const s=e.nextStart;if(s&&s>r&&s<t.edge||this.media.currentTime<e.start)return!1;const o=t.partList;if(o!=null&&o.length){const l=o[o.length-1];return Me.isBuffered(this.media,l.start+l.duration/2)}const a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===ne.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ne.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=s=>{const n=s.frag;if(this.fragContextChanged(n)){this.warn(`${n.type} sn: ${n.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(n,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(n);return}n.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;const n=this.state,o=s.frag;if(this.fragContextChanged(o)){(n===ne.FRAG_LOADING||!this.fragCurrent&&n===ne.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=ne.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(C.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===rt.APPENDING){const s=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,n?n.len:this.config.maxBufferLength),a=this.backtrackFragment;((a?e.sn-a.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===rt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(C.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:n}=i,o=s.decryptdata;if(n&&n.byteLength>0&&o!=null&&o.key&&o.iv&&pi(o.method)){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),o.key.buffer,o.iv.buffer,Ms(o.method)).catch(l=>{throw r.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:s}),l}).then(l=>{const d=self.performance.now();return r.trigger(C.FRAG_DECRYPTED,{frag:s,payload:l,stats:{tstart:a,tdecrypt:d}}),i.payload=l,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ne.STOPPED&&(this.state=ne.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?qc.toString(Me.getBuffered(i)):"(detached)"})`),at(e)){var r;if(e.type!==Ee.SUBTITLE){const n=e.elementaryStreams;if(!Object.keys(n).some(o=>!!n[o])){this.state=ne.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=ne.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,n=!s||s.length===0||s.some(a=>!a),o=new Ps(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!n);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;const n=t==null?void 0:t.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let o=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ne.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger(C.KEY_LOADED,u),this.state===ne.KEY_LOADING&&(this.state=ne.IDLE),u}),this.hls.trigger(C.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments);const a=this.fragPrevious;if(at(e)&&(!a||e.sn!==a.sn)){const u=this.shouldLoadParts(t.details,e.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} loading sn ${a==null?void 0:a.sn}->${e.sn}`),this.loadingParts=u)}if(i=Math.max(e.start,i||0),this.loadingParts&&at(e)){const u=n.partList;if(u&&r){i>e.end&&n.fragmentHint&&(e=n.fragmentHint);const h=this.getNextPart(u,e,i);if(h>-1){const f=u[h];e=this.fragCurrent=f.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${f.index} (${h}/${u.length-1}) of ${this.fragInfo(e,!1,f)}) cc: ${e.cc} [${n.startSN}-${n.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=ne.FRAG_LOADING;let p;return o?p=o.then(_=>!_||this.fragContextChanged(_.frag)?null:this.doFragPartsLoad(e,f,t,r)).catch(_=>this.handleFragLoadError(_)):p=this.doFragPartsLoad(e,f,t,r).catch(_=>this.handleFragLoadError(_)),this.hls.trigger(C.FRAG_LOADING,{frag:e,part:f,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(u,i))return Promise.resolve(null)}}if(at(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${n?"["+n.startSN+"-"+n.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),ge(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ne.FRAG_LOADING;const l=this.config.progressive;let d;return l&&o?d=o.then(u=>!u||this.fragContextChanged(u==null?void 0:u.frag)?null:this.fragmentLoader.load(e,r)).catch(u=>this.handleFragLoadError(u)):d=Promise.all([this.fragmentLoader.load(e,l?r:void 0),o]).then(([u])=>(!l&&u&&r&&r(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger(C.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,i,r){return new Promise((s,n)=>{var o;const a=[],l=(o=i.details)==null?void 0:o.partList,d=u=>{this.fragmentLoader.loadPart(e,u,r).then(h=>{a[u.index]=h;const f=h.part;this.hls.trigger(C.FRAG_LOADED,h);const p=Kn(i.details,e.sn,u.index+1)||eo(l,e.sn,u.index+1);if(p)d(p);else return s({frag:e,part:f,partsLoaded:a})}).catch(n)};d(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===J.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(C.ERROR,t)}else this.hls.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ne.PARSING){!this.fragCurrent&&this.state!==ne.STOPPED&&this.state!==ne.ERROR&&(this.state=ne.IDLE);return}const{frag:i,part:r,level:s}=t,n=self.performance.now();i.stats.parsing.end=n,r&&(r.stats.parsing.end=n);const o=this.getLevelDetails(),l=o&&i.sn>o.endSN||this.shouldLoadParts(o,i.end);l!==this.loadingParts&&(this.log(`LL-Part loading ${l?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=l),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const s=e.partList[0],n=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=n){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:n}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const o=t[r],a=o.details,l=n>-1?Kn(a,s,n):null,d=l?l.fragment:Ja(a,s,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:l,level:o}):null}bufferFragmentData(e,t,i,r,s){var n;if(!e||this.state!==ne.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(o&&a&&(l=xt(o,a)),!((n=l)!=null&&n.length))return;const d={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:l};if(this.hls.trigger(C.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Me.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=Me.bufferInfo(t,i,0),s=e.duration,n=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-n,r.end-n),i+n);e.start-o>n&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!ge(r))return null;const n=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,n)}getFwdBufferInfoAtPos(e,t,i,r){const s=Me.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const n=this.fragmentTracker.getBufferedFrag(t,i);if(n&&(s.nextStart<=n.end||n.gap)){const o=Math.max(Math.min(s.nextStart,n.end)-t,r);return Me.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Ee.MAIN){var i;const r=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,n=i[0].start,o=s.lowLatencyMode&&!!t.partList;let a=null;if(t.live){const u=s.initialLiveManifestSize;if(r<u)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${u})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<n){var l;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),a=this.getInitialLiveFragment(t,i);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,p=a?(h!==-1&&h>=n?h:f)||a.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(l=a)==null?void 0:l.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=n&&(a=i[0]);if(!a){const u=this.loadingParts?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,u,t)}let d=this.filterReplacedPrimary(a,t);if(!d&&a){const u=a.sn-t.startSN;d=this.filterReplacedPrimary(i[u+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===rt.OK||i===rt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let n=null;if(e.gap&&(n=this.getNextFragment(this.nextLoadPosition,t),n&&!n.gap&&i.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(o!==null&&i.len+o.len>=s){const a=n.sn;return this.loopSn!==a&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${a}`),this.loopSn=a),null}}return this.loopSn=void 0,n}get primaryPrefetch(){if(qn(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(qn(this.hls.config)&&e.type!==Ee.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const n=r.event;if(n){if(n.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=i==null?void 0:i.playerQueue;if(s)for(let n=s.length;n--;){const o=s[n].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,n=!0;for(let o=0,a=e.length;o<a;o++){const l=e[o];if(n=n&&!l.independent,r>-1&&i<l.start)break;const d=l.loaded;d?r=-1:(s||l.independent||n)&&l.fragment===t&&(r=o),s=d}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=lc(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const n=t[s-e.startSN];i.cc===n.cc&&(r=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=ja(t,i.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:n,endSN:o}=i;const{fragmentHint:a}=i,{maxFragLookUpTolerance:l}=r,d=i.partList,u=!!(this.loadingParts&&d!=null&&d.length&&a);u&&a&&!this.bitrateTest&&d[d.length-1].fragment.sn===a.sn&&(n=n.concat(a),o=a.sn);let h;if(e<t){var f;const _=e<this.lastCurrentTime||e>t-l||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:l;h=ni(s,n,e,_)}else h=n[n.length-1];if(h){const p=h.sn-i.startSN,_=this.fragmentTracker.getState(h);if((_===rt.OK||_===rt.PARTIAL&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!u||d[0].fragment.sn>h.sn||!i.live&&!u)&&s&&h.level===s.level){const b=n[p+1];h.sn<o&&this.fragmentTracker.getState(b)!==rt.OK?h=b:h=null}}return h}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,n=!t,o=e.alignedSliding&&ge(s);if(n||!o&&!s){zc(i,e);const a=e.fragmentStart;return this.log(`Live playlist sliding: ${a.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),a}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const s=this.startTimeOffset!==null,n=s?this.startTimeOffset:e.startTimeOffset;n!==null&&ge(n)?(i=t+n,n<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${n} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&at(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ne.FRAG_LOADING_WAITING_RETRY)&&(this.state=ne.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const p=this.getCurrentContext(t.chunkMeta);p&&(t.frag=p.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=t.details===J.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const n=t.errorAction,{action:o,flags:a,retryCount:l=0,retryConfig:d}=n||{},u=!!n&&!!d,h=u&&o===dt.RetryRequest,f=u&&!n.resolved&&a===Rt.MoveAllAlternatesMatchingHost;if(!h&&f&&at(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),n.resolved=!0;else if((h||f)&&l<d.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const p=Cs(d,l);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${l+1}/${d.maxNumRetry} in ${p}ms`),n.resolved=!0,this.retryDate=self.performance.now()+p,this.state=ne.FRAG_LOADING_WAITING_RETRY}else if(d&&n)if(this.resetFragmentErrors(e),l<d.maxNumRetry)!s&&o!==dt.RemoveAlternatePermanently&&(n.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${l})`);return}else o===dt.SendAlternateToPenaltyBox?this.state=ne.WAITING_LEVEL:this.state=ne.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ne.PARSING||this.state===ne.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const n=!s;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===Ee.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ne.STOPPED&&(this.state=ne.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=Me.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===ne.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((a,l)=>{const d=e.elementaryStreams[l];if(d){const u=d.endPTS-d.startPTS;if(u<=0)return this.warn(`Could not parse fragment ${e.sn} ${l} duration reliably (${u})`),a||!1;const h=r?0:Xa(s,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS);return this.hls.trigger(C.LEVEL_PTS_UPDATED,{details:s,level:i,drift:h,type:l,frag:e,start:d.startPTS,end:d.endPTS}),!0}return a},!1)){var o;if(i.fragmentError===0&&this.treatAsGap(e,i),((o=this.transmuxer)==null?void 0:o.error)===null){const a=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(a.message),this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:a,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ne.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(C.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ee.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function qn(c){return!!c.interstitialsController&&c.enableInterstitialPlayback!==!1}class so{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=Yc(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Yc(c,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<c.length;r++){const s=c[r];t.set(s,i),i+=s.length}return t}var Wr={exports:{}},Yn;function Wc(){return Yn||(Yn=1,function(c){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(a,l,d){this.fn=a,this.context=l,this.once=d||!1}function s(a,l,d,u,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new r(d,u||a,h),p=t?t+l:l;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],f]:a._events[p].push(f):(a._events[p]=f,a._eventsCount++),a}function n(a,l){--a._eventsCount===0?a._events=new i:delete a._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],d,u;if(this._eventsCount===0)return l;for(u in d=this._events)e.call(d,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},o.prototype.listeners=function(l){var d=t?t+l:l,u=this._events[d];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,f=u.length,p=new Array(f);h<f;h++)p[h]=u[h].fn;return p},o.prototype.listenerCount=function(l){var d=t?t+l:l,u=this._events[d];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,d,u,h,f,p){var _=t?t+l:l;if(!this._events[_])return!1;var y=this._events[_],b=arguments.length,I,T;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,u),!0;case 4:return y.fn.call(y.context,d,u,h),!0;case 5:return y.fn.call(y.context,d,u,h,f),!0;case 6:return y.fn.call(y.context,d,u,h,f,p),!0}for(T=1,I=new Array(b-1);T<b;T++)I[T-1]=arguments[T];y.fn.apply(y.context,I)}else{var R=y.length,M;for(T=0;T<R;T++)switch(y[T].once&&this.removeListener(l,y[T].fn,void 0,!0),b){case 1:y[T].fn.call(y[T].context);break;case 2:y[T].fn.call(y[T].context,d);break;case 3:y[T].fn.call(y[T].context,d,u);break;case 4:y[T].fn.call(y[T].context,d,u,h);break;default:if(!I)for(M=1,I=new Array(b-1);M<b;M++)I[M-1]=arguments[M];y[T].fn.apply(y[T].context,I)}}return!0},o.prototype.on=function(l,d,u){return s(this,l,d,u,!1)},o.prototype.once=function(l,d,u){return s(this,l,d,u,!0)},o.prototype.removeListener=function(l,d,u,h){var f=t?t+l:l;if(!this._events[f])return this;if(!d)return n(this,f),this;var p=this._events[f];if(p.fn)p.fn===d&&(!h||p.once)&&(!u||p.context===u)&&n(this,f);else{for(var _=0,y=[],b=p.length;_<b;_++)(p[_].fn!==d||h&&!p[_].once||u&&p[_].context!==u)&&y.push(p[_]);y.length?this._events[f]=y.length===1?y[0]:y:n(this,f)}return this},o.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&n(this,d)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,c.exports=o}(Wr)),Wr.exports}var Xc=Wc(),Fs=xl(Xc);const Bi="1.6.2",Ei={};function Qc(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Zc(){const c=Ei[Bi];if(c)return c.clientCount++,c;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Ei[Bi]=r,r}function Jc(c){const e=Ei[c];if(e)return e.clientCount++,e;const t=new self.URL(c,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Ei[c]=r,r}function ed(c){const e=Ei[c||Bi];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete Ei[c||Bi],r&&self.URL.revokeObjectURL(r),i.terminate()}}function no(c,e){return e+10<=c.length&&c[e]===51&&c[e+1]===68&&c[e+2]===73&&c[e+3]<255&&c[e+4]<255&&c[e+6]<128&&c[e+7]<128&&c[e+8]<128&&c[e+9]<128}function Ns(c,e){return e+10<=c.length&&c[e]===73&&c[e+1]===68&&c[e+2]===51&&c[e+3]<255&&c[e+4]<255&&c[e+6]<128&&c[e+7]<128&&c[e+8]<128&&c[e+9]<128}function Ar(c,e){let t=0;return t=(c[e]&127)<<21,t|=(c[e+1]&127)<<14,t|=(c[e+2]&127)<<7,t|=c[e+3]&127,t}function Fi(c,e){const t=e;let i=0;for(;Ns(c,e);){i+=10;const r=Ar(c,e+6);i+=r,no(c,e+10)&&(i+=10),e+=i}if(i>0)return c.subarray(t,t+i)}function td(c,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],n=s>>2&15;if(n>12){const f=new Error(`invalid ADTS sampling index:${n}`);c.emit(C.ERROR,C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(s>>6&3)+1,a=e[t+3]>>6&3|(s&1)<<2,l="mp4a.40."+o,d=r[n];let u=n;(o===5||o===29)&&(u-=3);const h=[o<<3|(u&14)>>1,(u&1)<<7|a<<3];return Ne.log(`manifest codec:${i}, parsed codec:${l}, channels:${a}, rate:${d} (ADTS object type:${o} sampling index:${n})`),{config:h,samplerate:d,channelCount:a,codec:l,parsedCodec:l,manifestCodec:i}}function ao(c,e){return c[e]===255&&(c[e+1]&246)===240}function oo(c,e){return c[e+1]&1?7:9}function Us(c,e){return(c[e+3]&3)<<11|c[e+4]<<3|(c[e+5]&224)>>>5}function id(c,e){return e+5<c.length}function Sr(c,e){return e+1<c.length&&ao(c,e)}function rd(c,e){return id(c,e)&&ao(c,e)&&Us(c,e)<=c.length-e}function sd(c,e){if(Sr(c,e)){const t=oo(c,e);if(e+t>=c.length)return!1;const i=Us(c,e);if(i<=t)return!1;const r=e+i;return r===c.length||Sr(c,r)}return!1}function lo(c,e,t,i,r){if(!c.samplerate){const s=td(e,t,i,r);if(!s)return;Ke(c,s)}}function co(c){return 1024*9e4/c}function nd(c,e){const t=oo(c,e);if(e+t<=c.length){const i=Us(c,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function uo(c,e,t,i,r){const s=co(c.samplerate),n=i+r*s,o=nd(e,t);let a;if(o){const{frameLength:u,headerLength:h}=o,f=h+u,p=Math.max(0,t+f-e.length);p?(a=new Uint8Array(f-h),a.set(e.subarray(t+h,e.length),0)):a=e.subarray(t+h,t+f);const _={unit:a,pts:n};return p||c.samples.push(_),{sample:_,length:f,missing:p}}const l=e.length-t;return a=new Uint8Array(l),a.set(e.subarray(t,e.length),0),{sample:{unit:a,pts:n},length:l,missing:-1}}function ad(c,e){return Ns(c,e)&&Ar(c,e+6)+10<=c.length-e}function od(c){if(c.size<2)return;const e=vt(c.data,!0),t=new Uint8Array(c.data.subarray(e.length+1));return{key:c.type,info:e,data:t.buffer}}function ld(c){if(c.size<2)return;if(c.type==="TXXX"){let t=1;const i=vt(c.data.subarray(t),!0);t+=i.length+1;const r=vt(c.data.subarray(t));return{key:c.type,info:i,data:r}}const e=vt(c.data.subarray(1));return{key:c.type,info:"",data:e}}function cd(c){if(c.type==="WXXX"){if(c.size<2)return;let t=1;const i=vt(c.data.subarray(t),!0);t+=i.length+1;const r=vt(c.data.subarray(t));return{key:c.type,info:i,data:r}}const e=vt(c.data);return{key:c.type,info:"",data:e}}function dd(c){return btoa(String.fromCharCode(...c))}function ho(c,e){if(c<0)return-ho(-c,e);const t=Math.pow(10,e);if(Math.abs(c*t%1-.5)<Number.EPSILON){const r=Math.floor(c*t);return(r%2===0?r:r+1)/t}else return Math.round(c*t)/t}function ud(c,e){const t=new URL(c),i=new URL(e);if(t.origin!==i.origin)return c;const r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")}function hd(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function fd(c){return c instanceof ArrayBuffer?c:c.byteOffset==0&&c.byteLength==c.buffer.byteLength?c.buffer:new Uint8Array(c).buffer}function Xr(c,e=0,t=1/0){return pd(c,e,t,Uint8Array)}function pd(c,e,t,i){const r=md(c);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const n=gd(c)?c.byteOffset:0,o=(n+c.byteLength)/s,a=(n+e)/s,l=Math.floor(Math.max(0,Math.min(a,o))),d=Math.floor(Math.min(l+Math.max(t,0),o));return new i(r,l,d-l)}function md(c){return c instanceof ArrayBuffer?c:c.buffer}function gd(c){return c&&c.buffer instanceof ArrayBuffer&&c.byteLength!==void 0&&c.byteOffset!==void 0}function _d(c){const e={key:c.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(c.size<2)return;if(c.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=c.data.subarray(1).indexOf(0);if(i===-1)return;const r=vt(Xr(c.data,1,i)),s=c.data[2+i],n=c.data.subarray(3+i).indexOf(0);if(n===-1)return;const o=vt(Xr(c.data,3+i,n));let a;return r==="-->"?a=vt(Xr(c.data,4+i+n)):a=fd(c.data.subarray(4+i+n)),e.mimeType=r,e.pictureType=s,e.description=o,e.data=a,e}function yd(c){return c.type==="PRIV"?od(c):c.type[0]==="W"?cd(c):c.type==="APIC"?_d(c):ld(c)}function vd(c){const e=String.fromCharCode(c[0],c[1],c[2],c[3]),t=Ar(c,4),i=10;return{type:e,size:t,data:c.subarray(i,i+t)}}const Wi=10,Ed=10;function fo(c){let e=0;const t=[];for(;Ns(c,e);){const i=Ar(c,e+6);c[e+5]>>6&1&&(e+=Wi),e+=Wi;const r=e+i;for(;e+Ed<r;){const s=vd(c.subarray(e)),n=yd(s);n&&t.push(n),e+=s.size+Wi}no(c,e)&&(e+=Wi)}return t}function po(c){return c&&c.key==="PRIV"&&c.info==="com.apple.streaming.transportStreamTimestamp"}function Sd(c){if(c.data.byteLength===8){const e=new Uint8Array(c.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function $s(c){const e=fo(c);for(let t=0;t<e.length;t++){const i=e[t];if(po(i))return Sd(i)}}let yt=function(c){return c.audioId3="org.id3",c.dateRange="com.apple.quicktime.HLS",c.emsg="https://aomedia.org/emsg/ID3",c.misbklv="urn:misb:KLV:bin:1910.1",c}({});function Pt(c="",e=9e4){return{type:c,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Gs{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=xt(this.cachedData,e),this.cachedData=null);let i=Fi(e,0),r=i?i.length:0,s;const n=this._audioTrack,o=this._id3Track,a=i?$s(i):void 0,l=e.length;for((this.basePTS===null||this.frameIndex===0&&ge(a))&&(this.basePTS=bd(a,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:yt.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const d=this.appendFrame(n,e,r);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r+=d.length,s=r):r=l}else ad(e,r)?(i=Fi(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:yt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const d=e.slice(s);this.cachedData?this.cachedData=xt(this.cachedData,d):this.cachedData=d}}return{audioTrack:n,videoTrack:Pt(),id3Track:o,textTrack:Pt()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Pt(),id3Track:this._id3Track,textTrack:Pt()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const bd=(c,e,t)=>{if(ge(c))return c*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let Xi=null;const Td=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],xd=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ad=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ld=[0,1,1,4];function mo(c,e,t,i,r){if(t+24>e.length)return;const s=go(e,t);if(s&&t+s.frameLength<=e.length){const n=s.samplesPerFrame*9e4/s.sampleRate,o=i+r*n,a={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return c.config=[],c.channelCount=s.channelCount,c.samplerate=s.sampleRate,c.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}function go(c,e){const t=c[e+1]>>3&3,i=c[e+1]>>1&3,r=c[e+2]>>4&15,s=c[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const n=c[e+2]>>1&1,o=c[e+3]>>6,a=t===3?3-i:i===3?3:4,l=Td[a*14+r-1]*1e3,u=xd[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,f=Ad[t][i],p=Ld[i],_=f*8*p,y=Math.floor(f*l/u+n)*p;if(Xi===null){const T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Xi=T?parseInt(T[1]):0}return!!Xi&&Xi<=87&&i===2&&l>=224e3&&o===0&&(c[e+3]=c[e+3]|128),{sampleRate:u,channelCount:h,frameLength:y,samplesPerFrame:_}}}function Vs(c,e){return c[e]===255&&(c[e+1]&224)===224&&(c[e+1]&6)!==0}function _o(c,e){return e+1<c.length&&Vs(c,e)}function Rd(c,e){return Vs(c,e)&&4<=c.length-e}function yo(c,e){if(e+1<c.length&&Vs(c,e)){const i=go(c,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===c.length||_o(c,s)}return!1}class Id extends Gs{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Fi(e,0);let r=(i==null?void 0:i.length)||0;if(yo(e,r))return!1;for(let s=e.length;r<s;r++)if(sd(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return rd(e,t)}appendFrame(e,t,i){lo(e,this.observer,t,i,e.manifestCodec);const r=uo(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const vo=(c,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),n=new Uint8Array(1);for(;i>0;){n[0]=c[e];const o=Math.min(i,8),a=8-o;s[0]=4278190080>>>24+a<<a,r[0]=(n[0]&s[0])>>a,t=t?t<<o|r[0]:r[0],e+=1,i-=o}return t};class wd extends Gs{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=Eo(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Fi(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&$s(t)!==void 0&&vo(e,i)<16}}function Eo(c,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],a=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][a*3+s]*2;if(t+d>e.length)return-1;const u=e[t+6]>>5;let h=0;u===2?h+=2:(u&1&&u!==1&&(h+=2),u&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,_=[2,1,2,3,3,4,4,5][u]+f,y=e[t+5]>>3,b=e[t+5]&7,I=new Uint8Array([s<<6|y<<1|b>>2,(b&3)<<6|u<<3|f<<2|a>>4,a<<4&224]),T=1536/o*9e4,R=i+r*T,M=e.subarray(t,t+d);return c.config=I,c.channelCount=_,c.samplerate=o,c.samples.push({unit:M,pts:R}),d}class Dd extends Gs{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Fi(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&$s(t)!==void 0&&vo(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(yo(e,i))return Ne.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Rd(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return mo(e,t,i,this.basePTS,this.frameIndex)}}const Cd=/\/emsg[-/]ID3/i;class kd{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=Pt("video",1),n=this.audioTrack=Pt("audio",1),o=this.txtTrack=Pt("text",1);if(this.id3Track=Pt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const a=ka(e);if(a.video){const{id:l,timescale:d,codec:u,supplemental:h}=a.video;s.id=l,s.timescale=o.timescale=d,s.codec=u,s.supplemental=h}if(a.audio){const{id:l,timescale:d,codec:u}=a.audio;n.id=l,n.timescale=d,n.codec=u}o.id=wa.text,s.sampleDuration=0,s.duration=n.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return wl(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=xt(this.remainderData,e));const o=Fl(i);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=i;const n=this.extractID3Track(r,t);return s.samples=mn(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=mn(e,t),{videoTrack:t,audioTrack:Pt(),id3Track:r,textTrack:Pt()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=De(e.samples,["emsg"]);r&&r.forEach(s=>{const n=Ul(s);if(Cd.test(n.schemeIdUri)){const o=Wn(n,t);let a=n.eventDuration===4294967295?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);const l=n.payload;i.samples.push({data:l,len:l.byteLength,dts:o,pts:o,type:yt.emsg,duration:a})}else if(this.config.enableEmsgKLVMetadata&&n.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=Wn(n,t);i.samples.push({data:n.payload,len:n.payload.byteLength,dts:o,pts:o,type:yt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Wn(c,e){return ge(c.presentationTime)?c.presentationTime/c.timeScale:e+c.presentationTimeDelta/c.timeScale}class Pd{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new ks(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ei.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),n=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(n).then(o=>{const a=new Uint8Array(o);r.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const n=Ma(s.data),o=this.getAvcEncryptedData(n);this.decryptBuffer(o.buffer).then(a=>{s.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(i>=s.length);i++){const n=s[i];if(!(n.data.length<=48||n.type!==1&&n.type!==5)&&(this.decryptAvcSample(e,t,i,r,n),!this.decrypter.isSync()))return}}}}class So{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let s=e.naluState||0;const n=s,o=[];let a=0,l,d,u,h=-1,f=0;for(s===-1&&(h=0,f=this.getNALuType(t,0),s=0,a=1);a<r;){if(l=t[a++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(d=a-s-1,h>=0){const p={data:t.subarray(h,d),type:f};o.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(n&&a<=4-n&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-n)),d>0&&(p.data=xt(p.data,t.subarray(0,d)),p.state=0))}a<r?(u=this.getNALuType(t,a),h=a,f=u,s=0):s=-1}else s=0}if(h>=0&&s>=0){const p={data:t.subarray(h,r),type:f,state:s};o.push(p)}if(o.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=xt(p.data,t))}return e.naluState=s,o}}class Di{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Ne.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Xn extends So{parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let n=this.VideoSample,o,a=!1;i.data=null,n&&s.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(l=>{var d,u;switch(l.type){case 1:{let _=!1;o=!0;const y=l.data;if(a&&y.length>4){const b=this.readSliceType(y);(b===2||b===4||b===7||b===9)&&(_=!0)}if(_){var h;(h=n)!=null&&h.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null)}n||(n=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),n.frame=!0,n.key=_;break}case 5:o=!0,(d=n)!=null&&d.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),n.key=!0,n.frame=!0;break;case 6:{o=!0,ws(l.data,1,i.pts,t.samples);break}case 7:{var f,p;o=!0,a=!0;const _=l.data,y=this.readSPS(_);if(!e.sps||e.width!==y.width||e.height!==y.height||((f=e.pixelRatio)==null?void 0:f[0])!==y.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[_];const b=_.subarray(1,4);let I="avc1.";for(let T=0;T<3;T++){let R=b[T].toString(16);R.length<2&&(R="0"+R),I+=R}e.codec=I}break}case 8:o=!0,e.pps=[l.data];break;case 9:o=!0,e.audFound=!0,(u=n)!=null&&u.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1;break}n&&o&&n.units.push(l)}),r&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Di(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let n=0;n<e;n++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){const t=new Di(e);let i=0,r=0,s=0,n=0,o,a,l;const d=t.readUByte.bind(t),u=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),p=t.skipBits.bind(t),_=t.skipEG.bind(t),y=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);d();const I=d();if(u(5),p(3),d(),y(),I===100||I===110||I===122||I===244||I===44||I===83||I===86||I===118||I===128){const L=h();if(L===3&&p(1),y(),y(),p(1),f())for(a=L!==3?8:12,l=0;l<a;l++)f()&&(l<6?b(16,t):b(64,t))}y();const T=h();if(T===0)h();else if(T===1)for(p(1),_(),_(),o=h(),l=0;l<o;l++)_();y(),p(1);const R=h(),M=h(),N=u(1);N===0&&p(1),p(1),f()&&(i=h(),r=h(),s=h(),n=h());let P=[1,1];if(f()&&f())switch(d()){case 1:P=[1,1];break;case 2:P=[12,11];break;case 3:P=[10,11];break;case 4:P=[16,11];break;case 5:P=[40,33];break;case 6:P=[24,11];break;case 7:P=[20,11];break;case 8:P=[32,11];break;case 9:P=[80,33];break;case 10:P=[18,11];break;case 11:P=[15,11];break;case 12:P=[64,33];break;case 13:P=[160,99];break;case 14:P=[4,3];break;case 15:P=[3,2];break;case 16:P=[2,1];break;case 255:{P=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((R+1)*16-i*2-r*2),height:(2-N)*(M+1)*16-(N?2:4)*(s+n),pixelRatio:P}}}class Qn extends So{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let n=this.VideoSample,o,a=!1;i.data=null,n&&s.length&&!e.audFound&&(this.pushAccessUnit(n,e),n=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(l=>{var d,u;switch(l.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:n||(n=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),n.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,a){var h;(h=n)!=null&&h.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null)}n||(n=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),n.key=!0,n.frame=!0;break;case 19:case 20:o=!0,(d=n)!=null&&d.frame&&!n.key&&(this.pushAccessUnit(n,e),n=this.VideoSample=null),n||(n=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),n.key=!0,n.frame=!0;break;case 39:o=!0,ws(l.data,2,i.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(l.data)),this.initVPS=l.data),e.vps=[l.data];break;case 33:if(o=!0,a=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],l.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(l.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in f.params)e.params[p]=f.params[p]}this.pushParameterSet(e.sps,l.data,e.vps),n||(n=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),n.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(l.data);for(const p in f)e.params[p]=f[p]}this.pushParameterSet(e.pps,l.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(u=n)!=null&&u.frame&&(this.pushAccessUnit(n,e),n=null),n||(n=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:o=!1;break}n&&o&&n.units.push(l)}),r&&n&&(this.pushAccessUnit(n,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Di(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new Di(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),n=t.readBits(5),o=t.readUByte(),a=t.readUByte(),l=t.readUByte(),d=t.readUByte(),u=t.readUByte(),h=t.readUByte(),f=t.readUByte(),p=t.readUByte(),_=t.readUByte(),y=t.readUByte(),b=t.readUByte(),I=[],T=[];for(let ve=0;ve<i;ve++)I.push(t.readBoolean()),T.push(t.readBoolean());if(i>0)for(let ve=i;ve<8;ve++)t.readBits(2);for(let ve=0;ve<i;ve++)I[ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),T[ve]&&t.readUByte();t.readUEG();const R=t.readUEG();R==3&&t.skipBits(1);const M=t.readUEG(),N=t.readUEG(),P=t.readBoolean();let L=0,A=0,x=0,k=0;P&&(L+=t.readUEG(),A+=t.readUEG(),x+=t.readUEG(),k+=t.readUEG());const U=t.readUEG(),K=t.readUEG(),$=t.readUEG(),j=t.readBoolean();for(let ve=j?0:i;ve<=i;ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let _e=0;_e<4;_e++)for(let Je=0;Je<(_e===3?2:6);Je++)if(!t.readBoolean())t.readUEG();else{const Ze=Math.min(64,1<<4+(_e<<1));_e>1&&t.readEG();for(let ut=0;ut<Ze;ut++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const ee=t.readUEG();let F=0;for(let ve=0;ve<ee;ve++){let _e=!1;if(ve!==0&&(_e=t.readBoolean()),_e){ve===ee&&t.readUEG(),t.readBoolean(),t.readUEG();let Je=0;for(let Qe=0;Qe<=F;Qe++){const Ze=t.readBoolean();let ut=!1;Ze||(ut=t.readBoolean()),(Ze||ut)&&Je++}F=Je}else{const Je=t.readUEG(),Qe=t.readUEG();F=Je+Qe;for(let Ze=0;Ze<Je;Ze++)t.readUEG(),t.readBoolean();for(let Ze=0;Ze<Qe;Ze++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ve=t.readUEG();for(let _e=0;_e<ve;_e++){for(let Je=0;Je<$+4;Je++)t.readBits(1);t.readBits(1)}}let H=0,W=1,ae=1,le=!0,ye=1,me=0;t.readBoolean(),t.readBoolean();let re=!1;if(t.readBoolean()){if(t.readBoolean()){const st=t.readUByte(),pt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Et=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];st>0&&st<16?(W=pt[st-1],ae=Et[st-1]):st===255&&(W=t.readBits(16),ae=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),re=t.readBoolean(),re&&(L+=t.readUEG(),A+=t.readUEG(),x+=t.readUEG(),k+=t.readUEG()),t.readBoolean()&&(ye=t.readBits(32),me=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Et=t.readBoolean(),Yt=t.readBoolean();let St=!1;(Et||Yt)&&(St=t.readBoolean(),St&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),St&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let wt=0;wt<=i;wt++){le=t.readBoolean();const bi=le||t.readBoolean();let ai=!1;bi?t.readEG():ai=t.readBoolean();const oi=ai?1:t.readUEG()+1;if(Et)for(let Nt=0;Nt<oi;Nt++)t.readUEG(),t.readUEG(),St&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Yt)for(let Nt=0;Nt<oi;Nt++)t.readUEG(),t.readUEG(),St&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),H=t.readUEG())}let fe=M,be=N;if(P||re){let ve=1,_e=1;R===1?ve=_e=2:R==2&&(ve=2),fe=M-ve*A-ve*L,be=N-_e*k-_e*x}const xe=r?["A","B","C"][r]:"",Ce=o<<24|a<<16|l<<8|d;let ze=0;for(let ve=0;ve<32;ve++)ze=(ze|(Ce>>ve&1)<<31-ve)>>>0;let Ye=ze.toString(16);return n===1&&Ye==="2"&&(Ye="6"),{codecString:`hvc1.${xe}${n}.${Ye}.${s?"H":"L"}${b}.B0`,params:{general_tier_flag:s,general_profile_idc:n,general_profile_space:r,general_profile_compatibility_flags:[o,a,l,d],general_constraint_indicator_flags:[u,h,f,p,_,y],general_level_idc:b,bit_depth:U+8,bit_depth_luma_minus8:U,bit_depth_chroma_minus8:K,min_spatial_segmentation_idc:H,chroma_format_idc:R,frame_rate:{fixed:le,fps:me/ye}},width:fe,height:be,pixelRatio:[W,ae]}}readPPS(e){const t=new Di(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let n=1;return s&&r?n=0:s?n=3:r&&(n=2),{parallelismType:n}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const nt=188;class Zt{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=Zt.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(nt*5,t-nt)+1,r=0;for(;r<i;){let s=!1,n=-1,o=0;for(let a=r;a<t;a+=nt)if(e[a]===71&&(t-a===nt||e[a+nt]===71)){if(o++,n===-1&&(n=a,n!==0&&(i=Math.min(n+nt*99,e.length-nt)+1)),s||(s=_s(e,a)===0),s&&o>1&&(n===0&&o>2||a+nt>i))return n}else{if(o)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:wa[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Zt.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Zt.createTrack("audio",r),this._id3Track=Zt.createTrack("id3"),this._txtTrack=Zt.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s;const n=this._videoTrack,o=this._audioTrack,a=this._id3Track,l=this._txtTrack;let d=n.pid,u=n.pesData,h=o.pid,f=a.pid,p=o.pesData,_=a.pesData,y=null,b=this.pmtParsed,I=this._pmtId,T=e.length;if(this.remainderData&&(e=xt(this.remainderData,e),T=e.length,this.remainderData=null),T<nt&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:n,id3Track:a,textTrack:l};const R=Math.max(0,Zt.syncOffset(e));T-=(T-R)%nt,T<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));let M=0;for(let P=R;P<T;P+=nt)if(e[P]===71){const L=!!(e[P+1]&64),A=_s(e,P),x=(e[P+3]&48)>>4;let k;if(x>1){if(k=P+5+e[P+4],k===P+nt)continue}else k=P+4;switch(A){case d:if(L){if(u&&(s=ui(u,this.logger))){if(this.videoParser===null)switch(n.segmentCodec){case"avc":this.videoParser=new Xn;break;case"hevc":this.videoParser=new Qn;break}this.videoParser!==null&&this.videoParser.parsePES(n,l,s,!1)}u={data:[],size:0}}u&&(u.data.push(e.subarray(k,P+nt)),u.size+=P+nt-k);break;case h:if(L){if(p&&(s=ui(p,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(k,P+nt)),p.size+=P+nt-k);break;case f:L&&(_&&(s=ui(_,this.logger))&&this.parseID3PES(a,s),_={data:[],size:0}),_&&(_.data.push(e.subarray(k,P+nt)),_.size+=P+nt-k);break;case 0:L&&(k+=e[k]+1),I=this._pmtId=Md(e,k);break;case I:{L&&(k+=e[k]+1);const U=Od(e,k,this.typeSupported,i,this.observer,this.logger);d=U.videoPid,d>0&&(n.pid=d,n.segmentCodec=U.segmentVideoCodec),h=U.audioPid,h>0&&(o.pid=h,o.segmentCodec=U.segmentAudioCodec),f=U.id3Pid,f>0&&(a.pid=f),y!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${P} after unknown PID '${y}'. Backtracking to sync byte @${R} to parse all TS packets.`),y=null,P=R-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=A;break}}else M++;M>0&&ys(this.observer,new Error(`Found ${M} TS packet/s that do not start with 0x47`),void 0,this.logger),n.pesData=u,o.pesData=p,a.pesData=_;const N={audioTrack:o,videoTrack:n,id3Track:a,textTrack:l};return r&&this.extractRemainingSamples(N),N}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,n=i.pesData,o=t.pesData,a=r.pesData;let l;if(n&&(l=ui(n,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new Xn;break;case"hevc":this.videoParser=new Qn;break}this.videoParser!==null&&(this.videoParser.parsePES(i,s,l,!0),i.pesData=null)}else i.pesData=n;if(o&&(l=ui(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;a&&(l=ui(a,this.logger))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=a}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new Pd(this.observer,this.config,t);return this.decrypt(r,s)}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const u=r.missing,h=r.sample.unit.byteLength;if(u===-1)s=xt(r.sample.unit,s);else{const f=h-u;r.sample.unit.set(s.subarray(0,u),f),e.samples.push(r.sample),i=r.missing}}let n,o;for(n=i,o=s.length;n<o-1&&!Sr(s,n);n++);if(n!==i){let u;const h=n<o-1;if(h?u=`AAC PES did not start with ADTS header,offset:${n}`:u="No ADTS header found in AAC PES",ys(this.observer,new Error(u),h,this.logger),!h)return}lo(e,this.observer,s,n,this.audioCodec);let a;if(t.pts!==void 0)a=t.pts;else if(r){const u=co(e.samplerate);a=r.sample.pts+u}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,d;for(;n<o;)if(d=uo(e,s,n,a,l),n+=d.length,d.missing){this.aacOverFlow=d;break}else for(l++;n<o-1&&!Sr(s,n);n++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,n=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<r;)if(_o(i,n)){const a=mo(e,i,n,o,s);if(a)n+=a.length,s++;else break}else n++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let n=0,o=0,a;for(;o<s&&(a=Eo(e,i,o,r,n++))>0;)o+=a}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ke({},t,{type:this._videoTrack?yt.emsg:yt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function _s(c,e){return((c[e+1]&31)<<8)+c[e+2]}function Md(c,e){return(c[e+10]&31)<<8|c[e+11]}function Od(c,e,t,i,r,s){const n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(c[e+1]&15)<<8|c[e+2],a=e+3+o-4,l=(c[e+10]&15)<<8|c[e+11];for(e+=12+l;e<a;){const d=_s(c,e),u=(c[e+3]&15)<<8|c[e+4];switch(c[e]){case 207:if(!i){Qr("ADTS AAC",s);break}case 15:n.audioPid===-1&&(n.audioPid=d);break;case 21:n.id3Pid===-1&&(n.id3Pid=d);break;case 219:if(!i){Qr("H.264",s);break}case 27:n.videoPid===-1&&(n.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):n.audioPid===-1&&(n.audioPid=d,n.segmentAudioCodec="mp3");break;case 193:if(!i){Qr("AC-3",s);break}case 129:t.ac3?n.audioPid===-1&&(n.audioPid=d,n.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(n.audioPid===-1&&u>0){let h=e+5,f=u;for(;f>2;){switch(c[h]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=d,n.segmentAudioCodec="ac3");break}const _=c[h+1]+2;h+=_,f-=_}}break;case 194:case 135:return ys(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),n;case 36:n.videoPid===-1&&(n.videoPid=d,n.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=u+5}return n}function ys(c,e,t,i){i.warn(`parsing error: ${e.message}`),c.emit(C.ERROR,C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Qr(c,e){e.log(`${c} with AES-128-CBC encryption found in unencrypted stream`)}function ui(c,e){let t=0,i,r,s,n,o;const a=c.data;if(!c||c.size===0)return null;for(;a[0].length<19&&a.length>1;)a[0]=xt(a[0],a[1]),a.splice(1,1);if(i=a[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>c.size-6)return null;const d=i[7];d&192&&(n=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,d&64?(o=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,n-o>60*9e4&&(e.warn(`${Math.round((n-o)/9e4)}s delta between PTS and DTS, align them`),n=o)):o=n),s=i[8];let u=s+9;if(c.size<=u)return null;c.size-=u;const h=new Uint8Array(c.size);for(let f=0,p=a.length;f<p;f++){i=a[f];let _=i.byteLength;if(u)if(u>_){u-=_;continue}else i=i.subarray(u),_-=u,u=0;h.set(i,t),t+=_}return r&&(r-=s+3),{data:h,pts:n,dts:o,len:r}}return null}class Bd{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Wt=Math.pow(2,32)-1;class Z{static init(){Z.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Z.types)Z.types.hasOwnProperty(e)&&(Z.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Z.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Z.STTS=Z.STSC=Z.STCO=s,Z.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Z.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Z.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Z.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);Z.FTYP=Z.box(Z.types.ftyp,n,a,n,o),Z.DINF=Z.box(Z.types.dinf,Z.box(Z.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(e,4),r=0,i=8;r<s;r++)n.set(t[r],i),i+=t[r].byteLength;return n}static hdlr(e){return Z.box(Z.types.hdlr,Z.HDLR_TYPES[e])}static mdat(e){return Z.box(Z.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(Wt+1)),r=Math.floor(t%(Wt+1));return Z.box(Z.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return Z.box(Z.types.mdia,Z.mdhd(e.timescale||0,e.duration||0),Z.hdlr(e.type),Z.minf(e))}static mfhd(e){return Z.box(Z.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Z.box(Z.types.minf,Z.box(Z.types.smhd,Z.SMHD),Z.DINF,Z.stbl(e)):Z.box(Z.types.minf,Z.box(Z.types.vmhd,Z.VMHD),Z.DINF,Z.stbl(e))}static moof(e,t,i){return Z.box(Z.types.moof,Z.mfhd(e),Z.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=Z.trak(e[t]);return Z.box.apply(null,[Z.types.moov,Z.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(Z.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=Z.trex(e[t]);return Z.box.apply(null,[Z.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(Wt+1)),r=Math.floor(t%(Wt+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Z.box(Z.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Z.box(Z.types.sdtp,i)}static stbl(e){return Z.box(Z.types.stbl,Z.stsd(e),Z.box(Z.types.stts,Z.STTS),Z.box(Z.types.stsc,Z.STSC),Z.box(Z.types.stsz,Z.STSZ),Z.box(Z.types.stco,Z.STCO))}static avc1(e){let t=[],i=[],r,s,n;for(r=0;r<e.sps.length;r++)s=e.sps[r],n=s.byteLength,t.push(n>>>8&255),t.push(n&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],n=s.byteLength,i.push(n>>>8&255),i.push(n&255),i=i.concat(Array.prototype.slice.call(s));const o=Z.box(Z.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),a=e.width,l=e.height,d=e.pixelRatio[0],u=e.pixelRatio[1];return Z.box(Z.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,a&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Z.box(Z.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Z.box(Z.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,u>>24,u>>16&255,u>>8&255,u&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return Z.box(Z.types.mp4a,Z.audioStsd(e),Z.box(Z.types.esds,Z.esds(e)))}static mp3(e){return Z.box(Z.types[".mp3"],Z.audioStsd(e))}static ac3(e){return Z.box(Z.types["ac-3"],Z.audioStsd(e),Z.box(Z.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return Z.box(Z.types.stsd,Z.STSD,Z.mp4a(e));if(t==="ac3"&&e.config)return Z.box(Z.types.stsd,Z.STSD,Z.ac3(e));if(t==="mp3"&&e.codec==="mp3")return Z.box(Z.types.stsd,Z.STSD,Z.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return Z.box(Z.types.stsd,Z.STSD,Z.avc1(e));if(t==="hevc"&&e.vps)return Z.box(Z.types.stsd,Z.STSD,Z.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,n=Math.floor(i/(Wt+1)),o=Math.floor(i%(Wt+1));return Z.box(Z.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const i=Z.sdtp(e),r=e.id,s=Math.floor(t/(Wt+1)),n=Math.floor(t%(Wt+1));return Z.box(Z.types.traf,Z.box(Z.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),Z.box(Z.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255])),Z.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,Z.box(Z.types.trak,Z.tkhd(e),Z.mdia(e))}static trex(e){const t=e.id;return Z.box(Z.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,n=new Uint8Array(s);let o,a,l,d,u,h;for(t+=8+s,n.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<r;o++)a=i[o],l=a.duration,d=a.size,u=a.flags,h=a.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,u.degradPrio&61440,u.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return Z.box(Z.types.trun,n)}static initSegment(e){Z.types||Z.init();const t=Z.moov(e);return xt(Z.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let n=s.length;for(let p=0;p<i.length;p+=1){n+=3;for(let _=0;_<i[p].length;_+=1)n+=2+i[p][_].length}const o=new Uint8Array(n);o.set(s,0),n=s.length;const a=i.length-1;for(let p=0;p<i.length;p+=1){o.set(new Uint8Array([32+p|(p===a?128:0),0,i[p].length]),n),n+=3;for(let _=0;_<i[p].length;_+=1)o.set(new Uint8Array([i[p][_].length>>8,i[p][_].length&255]),n),n+=2,o.set(i[p][_],n),n+=i[p][_].length}const l=Z.box(Z.types.hvcC,o),d=e.width,u=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return Z.box(Z.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,Z.box(Z.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Z.box(Z.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}Z.types=void 0;Z.HDLR_TYPES=void 0;Z.STTS=void 0;Z.STSC=void 0;Z.STCO=void 0;Z.STSZ=void 0;Z.VMHD=void 0;Z.SMHD=void 0;Z.STSD=void 0;Z.FTYP=void 0;Z.DINF=void 0;const bo=9e4;function js(c,e,t=1,i=!1){const r=c*e*t;return i?Math.round(r):r}function Fd(c,e,t=1,i=!1){return js(c,e,1/t,i)}function Ri(c,e=!1){return js(c,1e3,1/bo,e)}function Nd(c,e=1){return js(c,bo,1/e)}const Ud=10*1e3,$d=1024,Gd=1152,Vd=1536;let hi=null,Zr=null;function Zn(c,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:c?2:1,isNonSync:c?0:1}}}class sr{constructor(e,t,i,r){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.ISGenerated=!1,hi===null){const n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);hi=n?parseInt(n[1]):0}if(Zr===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Zr=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((s,n)=>{let o=n.pts,a=o-s;return a<-4294967296&&(t=!0,o=Tt(o,i),a=o-s),a>0?s:o},i);return t&&this.logger.debug("PTS rollover detected"),r}remux(e,t,i,r,s,n,o,a){let l,d,u,h,f,p,_=s,y=s;const b=e.pid>-1,I=t.pid>-1,T=t.samples.length,R=e.samples.length>0,M=o&&T>0||T>1;if((!b||R)&&(!I||M)||this.ISGenerated||o){if(this.ISGenerated){var P,L,A,x;const $=this.videoTrackConfig;($&&(t.width!==$.width||t.height!==$.height||((P=t.pixelRatio)==null?void 0:P[0])!==((L=$.pixelRatio)==null?void 0:L[0])||((A=t.pixelRatio)==null?void 0:A[1])!==((x=$.pixelRatio)==null?void 0:x[1]))||!$&&M||this.nextAudioPts===null&&R)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(e,t,s,n));const k=this.isVideoContiguous;let U=-1,K;if(M&&(U=jd(t.samples),!k&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,U>0){this.logger.warn(`[mp4-remuxer]: Dropped ${U} out of ${T} video samples due to a missing keyframe`);const $=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(U),t.dropped+=U,y+=(t.samples[0].pts-$)/t.inputTimeScale,K=y}else U===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${T} video samples`),p=!1);if(this.ISGenerated){if(R&&M){const $=this.getVideoStartPts(t.samples),Q=(Tt(e.samples[0].pts,$)-$)/t.inputTimeScale;_+=Math.max(0,Q),y+=Math.max(0,-Q)}if(R){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),u=this.generateIS(e,t,s,n)),d=this.remuxAudio(e,_,this.isAudioContiguous,n,I||M||a===Ee.AUDIO?y:void 0),M){const $=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),u=this.generateIS(e,t,s,n)),l=this.remuxVideo(t,y,k,$)}}else M&&(l=this.remuxVideo(t,y,k,0));l&&(l.firstKeyFrame=U,l.independent=U!==-1,l.firstKeyFramePTS=K)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(f=To(i,s,this._initPTS,this._initDTS)),r.samples.length&&(h=xo(r,s,this._initPTS))),{audio:d,video:l,initSegment:u,independent:p,text:h,id3:f}}generateIS(e,t,i,r){const s=e.samples,n=t.samples,o=this.typeSupported,a={},l=this._initPTS;let d=!l||r,u="audio/mp4",h,f,p;if(d&&(h=f=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(u="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}a.audio={id:"audio",container:u,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):Z.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(p=e.inputTimeScale,!l||p!==l.timescale?h=f=s[0].pts-Math.round(p*i):d=!1)}if(t.sps&&t.pps&&n.length){if(t.timescale=t.inputTimeScale,a.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Z.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(p=t.inputTimeScale,!l||p!==l.timescale){const _=this.getVideoStartPts(n),y=Math.round(p*i);f=Math.min(f,Tt(n[0].dts,_)-y),h=Math.min(h,_-y)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(a).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:h,timescale:p},this._initDTS={baseTime:f,timescale:p}):h=p=void 0,{tracks:a,initPTS:h,timescale:p}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,n=e.samples,o=[],a=n.length,l=this._initPTS;let d=this.nextAvcDts,u=8,h=this.videoSampleDuration,f,p,_=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,b=!1;if(!i||d===null){const F=t*s,O=n[0].pts-Tt(n[0].dts,n[0].pts);hi&&d!==null&&Math.abs(F-O-d)<15e3?i=!0:d=F-O}const I=l.baseTime*s/l.timescale;for(let F=0;F<a;F++){const O=n[F];O.pts=Tt(O.pts-I,d),O.dts=Tt(O.dts-I,d),O.dts<n[F>0?F-1:F].dts&&(b=!0)}b&&n.sort(function(F,O){const H=F.dts-O.dts,W=F.pts-O.pts;return H||W}),f=n[0].dts,p=n[n.length-1].dts;const T=p-f,R=T?Math.round(T/(a-1)):h||e.inputTimeScale/30;if(i){const F=f-d,O=F>R,H=F<-1;if((O||H)&&(O?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ri(F,!0)} ms (${F}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ri(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!H||d>=n[0].pts||hi)){f=d;const W=n[0].pts-F;if(O)n[0].dts=f,n[0].pts=W;else{let ae=!0;for(let le=0;le<n.length&&!(n[le].dts>W&&ae);le++){const ye=n[le].pts;if(n[le].dts-=F,n[le].pts-=F,le<n.length-1){const me=n[le+1].pts,re=n[le].pts,oe=me<=re,fe=me<=ye;ae=oe==fe}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Ri(W,!0)}/${Ri(f,!0)}, delta: ${Ri(F,!0)} ms`)}}f=Math.max(0,f);let M=0,N=0,P=f;for(let F=0;F<a;F++){const O=n[F],H=O.units,W=H.length;let ae=0;for(let le=0;le<W;le++)ae+=H[le].data.length;N+=ae,M+=W,O.length=ae,O.dts<P?(O.dts=P,P+=R/4|0||1):P=O.dts,_=Math.min(O.pts,_),y=Math.max(O.pts,y)}p=n[a-1].dts;const L=N+4*M+8;let A;try{A=new Uint8Array(L)}catch(F){this.observer.emit(C.ERROR,C.ERROR,{type:Se.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:L,reason:`fail allocating video mdat ${L}`});return}const x=new DataView(A.buffer);x.setUint32(0,L),A.set(Z.types.mdat,4);let k=!1,U=Number.POSITIVE_INFINITY,K=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,j=Number.NEGATIVE_INFINITY;for(let F=0;F<a;F++){const O=n[F],H=O.units;let W=0;for(let ye=0,me=H.length;ye<me;ye++){const re=H[ye],oe=re.data,fe=re.data.byteLength;x.setUint32(u,fe),u+=4,A.set(oe,u),u+=fe,W+=4+fe}let ae;if(F<a-1)h=n[F+1].dts-O.dts,ae=n[F+1].pts-O.pts;else{const ye=this.config,me=F>0?O.dts-n[F-1].dts:R;if(ae=F>0?O.pts-n[F-1].pts:R,ye.stretchShortVideoTrack&&this.nextAudioPts!==null){const re=Math.floor(ye.maxBufferHole*s),oe=(r?_+r*s:this.nextAudioPts)-O.pts;oe>re?(h=oe-me,h<0?h=me:k=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${oe/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=me}else h=me}const le=Math.round(O.pts-O.dts);U=Math.min(U,h),$=Math.max($,h),K=Math.min(K,ae),j=Math.max(j,ae),o.push(Zn(O.key,h,W,le))}if(o.length){if(hi){if(hi<70){const F=o[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Zr&&j-K<$-U&&R/$<.025&&o[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=f;for(let O=0,H=o.length;O<H;O++){const W=F+o[O].duration,ae=F+o[O].cts;if(O<H-1){const le=W+o[O+1].cts;o[O].duration=le-ae}else o[O].duration=O?o[O-1].duration:R;o[O].cts=0,F=W}}}h=k||!h?R:h,this.nextAvcDts=d=p+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const ee={data1:Z.moof(e.sequenceNumber++,f,Ke(e,{samples:o})),data2:A,startPTS:_/s,endPTS:(y+h)/s,startDTS:f/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ee}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Gd;case"ac3":return Vd;default:return $d}}remuxAudio(e,t,i,r,s){const n=e.inputTimeScale,o=e.samplerate?e.samplerate:n,a=n/o,l=this.getSamplesPerFrame(e),d=l*a,u=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],p=s!==void 0;let _=e.samples,y=h?0:8,b=this.nextAudioPts||-1;const I=t*n,T=u.baseTime*n/u.timescale;if(this.isAudioContiguous=i=i||_.length&&b>0&&(r&&Math.abs(I-b)<9e3||Math.abs(Tt(_[0].pts-T,I)-b)<20*d),_.forEach(function(Q){Q.pts=Tt(Q.pts-T,I)}),!i||b<0){if(_=_.filter(Q=>Q.pts>=0),!_.length)return;s===0?b=0:r&&!p?b=Math.max(0,I):b=_[0].pts}if(e.segmentCodec==="aac"){const Q=this.config.maxAudioFramesDrift;for(let ie=0,ee=b;ie<_.length;ie++){const F=_[ie],O=F.pts,H=O-ee,W=Math.abs(1e3*H/n);if(H<=-Q*d&&p)ie===0&&(this.logger.warn(`Audio frame @ ${(O/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*H/n)} ms.`),this.nextAudioPts=b=ee=O);else if(H>=Q*d&&W<Ud&&p){let ae=Math.round(H/d);ee=O-ae*d,ee<0&&(ae--,ee+=d),ie===0&&(this.nextAudioPts=b=ee),this.logger.warn(`[mp4-remuxer]: Injecting ${ae} audio frame @ ${(ee/n).toFixed(3)}s due to ${Math.round(1e3*H/n)} ms gap.`);for(let le=0;le<ae;le++){const ye=Math.max(ee,0);let me=Bd.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);me||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),me=F.unit.subarray()),_.splice(ie,0,{unit:me,pts:ye}),ee+=d,ie++}}F.pts=ee,ee+=d}}let R=null,M=null,N,P=0,L=_.length;for(;L--;)P+=_[L].unit.byteLength;for(let Q=0,ie=_.length;Q<ie;Q++){const ee=_[Q],F=ee.unit;let O=ee.pts;if(M!==null){const W=f[Q-1];W.duration=Math.round((O-M)/a)}else if(i&&e.segmentCodec==="aac"&&(O=b),R=O,P>0){P+=y;try{N=new Uint8Array(P)}catch(W){this.observer.emit(C.ERROR,C.ERROR,{type:Se.MUX_ERROR,details:J.REMUX_ALLOC_ERROR,fatal:!1,error:W,bytes:P,reason:`fail allocating audio mdat ${P}`});return}h||(new DataView(N.buffer).setUint32(0,P),N.set(Z.types.mdat,4))}else return;N.set(F,y);const H=F.byteLength;y+=H,f.push(Zn(!0,l,H,0)),M=O}const A=f.length;if(!A)return;const x=f[f.length-1];this.nextAudioPts=b=M+a*x.duration;const k=h?new Uint8Array(0):Z.moof(e.sequenceNumber++,R/a,Ke({},e,{samples:f}));e.samples=[];const U=R/n,K=b/n,j={data1:k,data2:N,startPTS:U,endPTS:K,startDTS:U,endDTS:K,type:"audio",hasAudio:!0,hasVideo:!1,nb:A};return this.isAudioContiguous=!0,j}}function Tt(c,e){let t;if(e===null)return c;for(e<c?t=-8589934592:t=8589934592;Math.abs(c-e)>4294967296;)c+=t;return c}function jd(c){for(let e=0;e<c.length;e++)if(c[e].key)return e;return-1}function To(c,e,t,i){const r=c.samples.length;if(!r)return;const s=c.inputTimeScale;for(let o=0;o<r;o++){const a=c.samples[o];a.pts=Tt(a.pts-t.baseTime*s/t.timescale,e*s)/s,a.dts=Tt(a.dts-i.baseTime*s/i.timescale,e*s)/s}const n=c.samples;return c.samples=[],{samples:n}}function xo(c,e,t){const i=c.samples.length;if(!i)return;const r=c.inputTimeScale;for(let n=0;n<i;n++){const o=c.samples[n];o.pts=Tt(o.pts-t.baseTime*r/t.timescale,e*r)/r}c.samples.sort((n,o)=>n.pts-o.pts);const s=c.samples;return c.samples=[],{samples:s}}class Hd{constructor(e,t,i,r){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=r}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(kl(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=ka(e);r.audio&&(t=Jn(r.audio,He.AUDIO)),r.video&&(i=Jn(r.video,He.VIDEO));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:i,supplemental:r.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,i,r,s,n){var o,a;let{initPTS:l,lastEndTime:d}=this;const u={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};ge(d)||(d=this.lastEndTime=s||0);const h=t.samples;if(!(h!=null&&h.length))return u;const f={initPTS:void 0,timescale:1};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(h),p=this.initData),!((a=p)!=null&&a.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const _=Ml(h,p),y=Pl(p,h),b=y===null?s:y;(n||!l)&&(Kd(l,b,s,_)||f.timescale!==l.timescale)&&(f.initPTS=b-s,l&&l.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${l.baseTime/l.timescale} to ${f.initPTS}`),this.initPTS=l={baseTime:f.initPTS,timescale:1});const I=e?b-l.baseTime/l.timescale:d,T=I+_;Bl(p,h,l.baseTime/l.timescale),_>0?this.lastEndTime=T:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const R=!!p.audio,M=!!p.video;let N="";R&&(N+="audio"),M&&(N+="video");const P={data1:h,startPTS:I,startDTS:I,endPTS:T,endDTS:T,type:N,hasAudio:R,hasVideo:M,nb:1,dropped:0};return u.audio=P.type==="audio"?P:void 0,u.video=P.type!=="audio"?P:void 0,u.initSegment=f,u.id3=To(i,s,l,l),r.samples.length&&(u.text=xo(r,s,l)),u}}function Kd(c,e,t,i){if(c===null)return!0;const r=Math.max(i,1),s=e-c.baseTime/c.timescale;return Math.abs(s-t)>r}function Jn(c,e){const t=c==null?void 0:c.codec;return t&&t.length>4?t:e===He.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?pr(t,!1):(Ne.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(Ne.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let Kt;try{Kt=self.performance.now.bind(self.performance)}catch{Kt=Date.now}const nr=[{demux:kd,remux:Hd},{demux:Zt,remux:sr},{demux:Id,remux:sr},{demux:Dd,remux:sr}];nr.splice(2,0,{demux:wd,remux:sr});class ea{constructor(e,t,i,r,s,n){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=Kt();let n=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:a}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:d,trackSwitch:u,accurateTimeOffset:h,timeOffset:f,initSegmentChange:p}=r||o,{audioCodec:_,videoCodec:y,defaultInitPts:b,duration:I,initSegmentData:T}=a,R=zd(n,t);if(R&&pi(R.method)){const L=this.getDecrypter(),A=Ms(R.method);if(L.isSync()){let x=L.softwareDecrypt(n,R.key.buffer,R.iv.buffer,A);if(i.part>-1){const U=L.flush();x=U&&U.buffer}if(!x)return s.executeEnd=Kt(),Jr(i);n=new Uint8Array(x)}else return this.asyncResult=!0,this.decryptionPromise=L.webCryptoDecrypt(n,R.key.buffer,R.iv.buffer,A).then(x=>{const k=this.push(x,null,i);return this.decryptionPromise=null,k}),this.decryptionPromise}const M=this.needsProbing(d,u);if(M){const L=this.configureTransmuxer(n);if(L)return this.logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(C.ERROR,C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),s.executeEnd=Kt(),Jr(i)}(d||u||p||M)&&this.resetInitSegment(T,_,y,I,t),(d||p||M)&&this.resetInitialTimestamp(b),l||this.resetContiguity();const N=this.transmux(n,R,f,h,i);this.asyncResult=Ni(N);const P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,s.executeEnd=Kt(),N}flush(e){const t=e.transmuxing;t.executeStart=Kt();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const n=[],{timeOffset:o}=r;if(i){const u=i.flush();u&&n.push(this.push(u.buffer,null,e))}const{demuxer:a,remuxer:l}=this;if(!a||!l){t.executeEnd=Kt();const u=[Jr(e)];return this.asyncResult?Promise.resolve(u):u}const d=a.flush(o);return Ni(d)?(this.asyncResult=!0,d.then(u=>(this.flushRemux(n,u,e),n))):(this.flushRemux(n,d,e),this.asyncResult?Promise.resolve(n):n)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:n,textTrack:o}=t,{accurateTimeOffset:a,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Ee.MAIN?"level":"track"} ${i.level}`);const d=this.remuxer.remux(r,s,n,o,l,a,!0,this.id);e.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=Kt()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:n,remuxer:o}=this;!n||!o||(n.resetInitSegment(e,t,i,r),o.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let n;return t&&t.method==="SAMPLE-AES"?n=this.transmuxSampleAes(e,t,i,r,s):n=this.transmuxUnencrypted(e,i,r,s),n}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:n,id3Track:o,textTrack:a}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,n,o,a,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(n=>({remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let s;for(let u=0,h=nr.length;u<h;u++){var n;if((n=nr[u].demux)!=null&&n.probe(e,this.logger)){s=nr[u];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,a=this.remuxer,l=s.remux,d=s.demux;(!a||!(a instanceof l))&&(this.remuxer=new l(i,t,r,this.logger)),(!o||!(o instanceof d))&&(this.demuxer=new d(i,t,r,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ks(this.config)),e}}function zd(c,e){let t=null;return c.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Jr=c=>({remuxResult:{},chunkMeta:c});function Ni(c){return"then"in c&&c.then instanceof Function}class qd{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class Yd{constructor(e,t,i,r,s,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=n}}let ta=0;class Ao{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ta++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=a=>{const l=a.data,d=this.hls;if(!(!d||!(l!=null&&l.event)||l.instanceNo!==this.instanceNo))switch(l.event){case"init":{var u;const h=(u=this.workerContext)==null?void 0:u.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":{d.logger[l.data.logType]&&d.logger[l.data.logType](l.data.message);break}default:{l.data=l.data||{},l.data.frag=this.frag,l.data.part=this.part,l.data.id=this.id,d.trigger(l.event,l.data);break}}},this.onWorkerError=a=>{if(!this.hls)return;const l=new Error(`${a.message}  (${a.filename}:${a.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:l})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const n=(a,l)=>{l=l||{},l.frag=this.frag||void 0,a===C.ERROR&&(l=l,l.parent=this.id,l.part=this.part,this.error=l.error),this.hls.trigger(a,l)};this.observer=new Fs,this.observer.on(C.FRAG_DECRYPTED,n),this.observer.on(C.ERROR,n);const o=_n(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const a=this.hls.logger;if(s.workerPath||Qc()){try{s.workerPath?(a.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=Jc(s.workerPath)):(a.log(`injecting Web Worker for "${t}"`),this.workerContext=Zc());const{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:We(s)})}catch(d){a.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new ea(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new ea(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ta++;const t=this.hls.config,i=_n(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:We(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),ed(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,n,o,a,l,d){var u,h;l.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:p}=this,_=n?n.start:s.start,y=s.decryptdata,b=this.frag,I=!(b&&s.cc===b.cc),T=!(b&&l.level===b.level),R=b?l.sn-b.sn:-1,M=this.part?l.part-this.part.index:-1,N=R===0&&l.id>1&&l.id===(b==null?void 0:b.stats.chunkCount),P=!T&&(R===1||R===0&&(M===1||N&&M<=0)),L=self.performance.now();(T||R||s.stats.parsing.start===0)&&(s.stats.parsing.start=L),n&&(M||!P)&&(n.stats.parsing.start=L);const A=!(b&&((u=s.initSegment)==null?void 0:u.url)===((h=b.initSegment)==null?void 0:h.url)),x=new Yd(I,P,a,T,_,A);if(!P||I||A){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===Ee.MAIN?"level":"track"}: ${l.level} id: ${l.id}
        discontinuity: ${I}
        trackSwitch: ${T}
        contiguous: ${P}
        accurateTimeOffset: ${a}
        timeOffset: ${_}
        initSegmentChange: ${A}`);const k=new qd(i,r,t,o,d);this.configureTransmuxer(k)}if(this.frag=s,this.part=n,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:y,chunkMeta:l,state:x},e instanceof ArrayBuffer?[e]:[]);else if(p){const k=p.push(e,y,l,x);Ni(k)?k.then(U=>{this.handleTransmuxComplete(U)}).catch(U=>{this.transmuxerError(U,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(k)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);Ni(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const ia=100;class Wd extends Bs{constructor(e,t,i){super(e,t,i,"audio-stream-controller",Ee.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(C.BUFFER_RESET,this.onBufferReset,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(C.BUFFER_RESET,this.onBufferReset,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){if(i===Ee.MAIN){const n=t.cc,o=this.fragCurrent;if(this.initPTS[n]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${n} found from main: ${r}/${s}`),this.mainAnchor=t,this.state===ne.WAITING_INIT_PTS){const a=this.waitingData;(!a&&!this.loadingParts||a&&a.frag.cc!==n)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&o&&o.cc!==n?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,o.abortRequests(),this.resetLoadingState()):this.state===ne.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),i=e.cc;return uc(t,i,e)||t&&ja(t.fragments,i)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ne.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(ia),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ne.IDLE):this.state=ne.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ne.IDLE:this.doTickIdle();break;case ne.WAITING_TRACK:{const{levels:t,trackId:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=ne.WAITING_INIT_PTS}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((r==null?void 0:r[s])||null),this.state=ne.IDLE}break}case ne.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:r,cache:s,complete:n}=t,o=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=ne.FRAG_LOADING;const a=s.flush().buffer,l={frag:i,part:r,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),n&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${o.cc}`),this.nextLoadPosition=this.findSyncFrag(o).start,this.clearWaitingFragment())}else this.state=ne.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:s}=this,n=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!n.startFragPrefetch)||!(i!=null&&i[s]))return;const o=i[s],a=o.details;if(!a||this.waitForLive(o)||this.waitForCdnTuneIn(a)){this.state=ne.WAITING_TRACK,this.startFragRequested=!1;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,He.AUDIO,Ee.AUDIO));const d=this.getFwdBufferInfo(l,Ee.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,a)){t.trigger(C.BUFFER_EOS,{type:"audio"}),this.state=ne.ENDED;return}const u=d.len,h=t.maxBufferLength,f=a.fragments,p=f[0].start,_=this.getLoadPosition(),y=this.flushing?_:d.end;if(this.switchingTrack&&r){const T=_;a.PTSKnown&&T<p&&(d.end>p||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05)}if(u>=h&&!this.switchingTrack&&y<f[f.length-1].start)return;let b=this.getNextFragment(y,a);if(b&&this.isLoopLoading(b,y)&&(b=this.getNextFragmentLoopLoading(b,a,d,Ee.MAIN,h)),!b){this.bufferFlushed=!0;return}let I=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&I&&at(b)&&!b.endList&&(!a.live||!this.loadingParts&&y<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(I)===rt.OK&&(this.mainFragLoading=I=null),I&&at(I))){if(b.start>I.end){const R=this.fragmentTracker.getFragAtPos(y,Ee.MAIN);R&&R.end>I.end&&(I=R,this.mainFragLoading={frag:R,targetBufferTime:null})}if(b.start>I.end)return}this.loadFragment(b,o,y)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Pi(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ne.STOPPED&&(this.setInterval(ia),this.state=ne.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(C.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:s,id:n,groupId:o,track:a}=t;if(!r){this.warn(`Audio tracks reset while loading track ${n} "${a.name}" of "${o}"`);return}const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired){this.cachedTrackLoadedData=t,this.state!==ne.STOPPED&&(this.state=ne.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${n} "${a.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const d=r[n];let u=0;if(s.live||(i=d.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(d.details){var h;u=this.alignPlaylists(s,d.details,(h=this.levelLastLoaded)==null?void 0:h.details)}s.alignedSliding||(ro(s,l),s.alignedSliding||Er(s,l),u=s.fragmentStart)}d.details=s,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(C.AUDIO_TRACK_UPDATED,{details:s,id:n,groupId:t.groupId}),this.state===ne.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ne.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{config:n,trackId:o,levels:a}=this;if(!a){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const l=a[o];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const d=l.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const u=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Ao(this.hls,Ee.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[i.cc],p=(t=i.initSegment)==null?void 0:t.data;if(f!==void 0){const y=r?r.index:-1,b=y!==-1,I=new Ps(i.level,i.sn,i.stats.chunkCount,s.byteLength,y,b);h.push(s,p,u,"",i,r,d.totalduration,!1,I,f)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${o}`);const{cache:_}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new so,complete:!1};_.push(new Uint8Array(s)),this.state!==ne.STOPPED&&(this.state=ne.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ee.MAIN&&at(t.frag)&&(this.mainFragLoading=t,this.state===ne.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==Ee.AUDIO){!this.audioOnly&&i.type===Ee.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(at(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(C.AUDIO_TRACK_SWITCHED,Ge({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.AUDIO,t);break;case J.AUDIO_TRACK_LOAD_ERROR:case J.AUDIO_TRACK_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Be.AUDIO_TRACK&&(this.state=ne.IDLE);break;case J.BUFFER_ADD_CODEC_ERROR:case J.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case J.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==He.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==He.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ne.ENDED&&(this.state=ne.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,Ee.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:n}=e,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:a,part:l,level:d}=o,{details:u}=d,{audio:h,text:f,id3:p,initSegment:_}=s;if(this.fragContextChanged(a)||!u){this.fragmentTracker.removeFragment(a);return}if(this.state=ne.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),_!=null&&_.tracks){const y=a.initSegment||a;this._bufferInitSegment(d,_.tracks,y,n),r.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:i,tracks:_.tracks})}if(h){const{startPTS:y,endPTS:b,startDTS:I,endDTS:T}=h;l&&(l.elementaryStreams[He.AUDIO]={startPTS:y,endPTS:b,startDTS:I,endDTS:T}),a.setElementaryStreamInfo(He.AUDIO,y,b,I,T),this.bufferFragmentData(h,a,l,n)}if(p!=null&&(t=p.samples)!=null&&t.length){const y=Ke({id:i,frag:a,details:u},p);r.trigger(C.FRAG_PARSING_METADATA,y)}if(f){const y=Ke({id:i,frag:a,details:u},f);r.trigger(C.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,i,r){if(this.state!==ne.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Ee.AUDIO;const n=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${n}/${s.codec}]`),n&&n.split(",").length===1&&(s.levelCodec=n),this.hls.trigger(C.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const a={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:o};this.hls.trigger(C.BUFFER_APPENDING,a)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===rt.NOT_LOADED||r===rt.PARTIAL){var s;if(!at(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ne.WAITING_INIT_PTS;const n=this.mainDetails;n&&n.fragmentStart!==t.details.fragmentStart&&Er(t.details,n)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:n,channels:o}=this.bufferedTrack;si({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:n,channels:o},e,ri)||(gr(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(C.AUDIO_TRACK_SWITCHED,Ge({},e))}}class Hs extends qt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let n=0;n<r.length;n++){const o=r[n];let a;try{a=new self.URL(o.URI,t.url).href}catch(l){this.warn(`Could not construct new URL for Rendition Report: ${l}`),a=o.URI||""}if(a===e){s=n;break}else a===e.substring(0,a.length)&&(s=n)}if(s!==-1){const n=r[s],o=parseInt(n["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let a=parseInt(n["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&d>t.partTarget&&(a+=1)}const l=i&&vn(i);return new En(o,a>=0?a:void 0,l)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:s}=t,n=self.performance.now(),o=s.loading.first?Math.max(0,n-s.loading.first):0;r.advancedDateTime=Date.now()-o;const a=this.hls.config.timelineOffset;if(a!==r.appliedTimelineOffset){const d=Math.max(a||0,0);r.appliedTimelineOffset=d,r.fragments.forEach(u=>{u.start=u.playlistOffset+d})}if(r.live||i!=null&&i.live){const d="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){Gc(i,r);const I=r.playlistParsingError;if(I){this.warn(I);const T=this.hls;if(!T.config.ignorePlaylistParsingErrors){var l;const{networkDetails:R}=t;T.trigger(C.ERROR,{type:Se.NETWORK_ERROR,details:J.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:I,reason:I.message,level:t.level||void 0,parent:(l=r.fragments[0])==null?void 0:l.type,networkDetails:R,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const u=this.hls.mainForwardBufferInfo,h=u?u.end-u.len:0,f=(r.edge-h)*1e3,p=Za(r,f);if(r.requestScheduled+p<n?r.requestScheduled=n:r.requestScheduled+=p,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let _,y,b;if(r.canBlockReload&&r.endSN&&r.advanced){const I=this.hls.config.lowLatencyMode,T=r.lastPartSn,R=r.endSN,M=r.lastPartIndex,N=M!==-1,P=T===R;N?P?(y=R+1,b=I?0:M):(y=T,b=I?M+1:r.maxPartIndex):y=R+1;const L=r.age,A=L+r.ageHeader;let x=Math.min(A-r.partTarget,r.targetduration*1.5);if(x>0){if(A>r.targetduration*3)this.log(`Playlist last advanced ${L.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,b=void 0;else if(i!=null&&i.tuneInGoal&&A-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${x} with playlist age: ${r.age}`),x=0;else{const k=Math.floor(x/r.targetduration);if(y+=k,b!==void 0){const U=Math.round(x%r.targetduration/r.partTarget);b+=U}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${x} skip sn ${k} to part ${b}`)}r.tuneInGoal=x}if(_=this.getDeliveryDirectives(r,t.deliveryDirectives,y,b),I||!P){r.requestScheduled=n,this.loadingPlaylist(d,_);return}}else(r.canBlockReload||r.canSkipUntil)&&(_=this.getDeliveryDirectives(r,t.deliveryDirectives,y,b));_&&y!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(p-o*2,p/2)),this.scheduleLoading(d,_,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),n=r.requestScheduled;if(s>=n){this.loadingPlaylist(e,t);return}const o=n-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,i,r){let s=vn(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=rr.No),new En(i,r,s)}checkRetry(e){const t=e.details,i=_r(e),r=e.errorAction,{action:s,retryCount:n=0,retryConfig:o}=r||{},a=!!r&&!!o&&(s===dt.RetryRequest||!r.resolved&&s===dt.SendAlternateToPenaltyBox);if(a){var l;if(n>=o.maxNumRetry)return!1;if(i&&(l=e.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const d=Cs(o,n);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,r.resolved=!0}return a}}function Lo(c,e){if(c.length!==e.length)return!1;for(let t=0;t<c.length;t++)if(!Ui(c[t].attrs,e[t].attrs))return!1;return!0}function Ui(c,e,t){const i=c["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>c[r]!==e[r])}function vs(c,e){return e.label.toLowerCase()===c.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(c.lang||"").toLowerCase())}class Xd extends Hs{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(C.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${n==null?void 0:n.groupId}`);return}const o=n.details;n.details=t.details,this.log(`Audio track ${i} "${n.name}" lang:${n.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!i||i.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.audioPreference;if(!s&&a){const h=Mt(a,o,ri);if(h>-1)s=o[h];else{const f=Mt(a,this.tracks);s=this.tracks[f]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const d={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(C.AUDIO_TRACKS_UPDATED,d);const u=this.trackId;if(l!==-1&&u===-1)this.setAudioTrack(l);else if(o.length&&u===-1){var n;const h=new Error(`No audio track selected for current audio group-ID(s): ${(n=this.groupIds)==null?void 0:n.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===Be.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&si(e,r,ri))return r;const s=Mt(e,this.tracksInGroup,ri);if(s>-1){const n=this.tracksInGroup[s];return this.setAudioTrack(s),n}else if(r){let n=t.loadLevel;n===-1&&(n=t.firstAutoLevel);const o=ac(e,t.levels,i,n,ri);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const n=Mt(e,i);if(n>-1)return i[n]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(C.AUDIO_TRACK_SWITCHING,Ge({},r)),s))return;const n=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(n)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||si(e,r,ri)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:n,audioCodec:o,channels:a}=e;for(let l=0;l<t.length;l++){const d=t[l];if(si({name:i,lang:r,assocLang:s,characteristics:n,audioCodec:o,channels:a},d,ri))return l}for(let l=0;l<t.length;l++){const d=t[l];if(Ui(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const d=t[l];if(Ui(e.attrs,d.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&gr(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),n=e.details,o=n==null?void 0:n.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&n.live?" age "+o.toFixed(1)+(n.type&&" "+n.type||""):""} ${s}`),this.hls.trigger(C.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class Qd{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;const n=(i=this.tracks[e])==null?void 0:i.buffer;n!=null&&n.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const ra=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ro="HlsJsTrackRemovedError";class Zd extends Error{constructor(e){super(e),this.name=Ro}}class Jd extends qt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(C.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Tl(Jt(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.BUFFER_RESET,this.onBufferReset,this),e.on(C.BUFFER_APPENDING,this.onBufferAppending,this),e.on(C.BUFFER_CODECS,this.onBufferCodecs,this),e.on(C.BUFFER_EOS,this.onBufferEos,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.FRAG_PARSED,this.onFragParsed,this),e.on(C.FRAG_CHANGED,this.onFragChanged,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.BUFFER_RESET,this.onBufferReset,this),e.off(C.BUFFER_APPENDING,this.onBufferAppending,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.BUFFER_EOS,this.onBufferEos,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.FRAG_PARSED,this.onFragParsed,this),e.off(C.FRAG_CHANGED,this.onFragChanged,this),e.off(C.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const n=this.isQueued();(s||n)&&this.warn(`Transfering MediaSource with${n?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Ke(i,r.tracks):this.sourceBuffers.forEach(s=>{const[n]=s;n&&(i[n]=Ke({},this.tracks[n]),this.removeBuffer(n)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,r=Jt(this.appendSource);if(this.transferData=this.overrides=void 0,i&&r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const n=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(n),s)this._objectUrl=i.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(n);if(this.appendSource)try{i.removeAttribute("src");const a=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||a&&n instanceof a,sa(i),eu(i,o),i.load()}catch{i.src=o}else i.src=o}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,n=s?s.length:0,o=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(r&&s&&n){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${We(i,(a,l)=>a==="initSegment"?void 0:l)};
transfer tracks: ${We(r,(a,l)=>a==="initSegment"?void 0:l)}}`),!La(r,i)){t.mediaSource=null,t.tracks=void 0;const a=e.currentTime,l=this.details,d=Math.max(a,(l==null?void 0:l.fragments[0].start)||0);if(d-a>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${a} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${d} currentTime: ${a}`),this.onMediaDetaching(C.MEDIA_DETACHING,{}),this.onMediaAttaching(C.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,s.forEach(a=>{const l=a,d=r[l];if(d){const u=d.buffer;if(u){const h=this.fragmentTracker,f=d.id;if(h.hasFragments(f)||h.hasParts(f)){const y=Me.getBuffered(u);h.detectEvictedFragments(l,y,f,null,!0)}const p=es(l),_=[l,u];this.sourceBuffers[p]=_,u.updating&&this.operationQueue&&this.operationQueue.prependBlocker(l),this.trackSourceBuffer(l,d)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:n}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const a=s.sourceBuffers;for(let l=a.length;l--;)o&&a[l].abort(),s.removeSourceBuffer(a[l]);o&&s.endOfStream()}catch(a){this.warn(`onMediaDetaching: ${a.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(r.removeAttribute("src"),this.appendSource&&sa(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(C.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[es(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Qd(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),n=!s&&this.sourceBufferCount&&this.media&&r.some(o=>!i[o]);if(s||n){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(o=>{var a,l,d;const u=t[o],{id:h,codec:f,levelCodec:p,container:_,metadata:y,supplemental:b}=u;let I=i[o];const T=(a=this.transferData)==null||(l=a.tracks)==null?void 0:l[o],R=T!=null&&T.buffer?T:I,M=(R==null?void 0:R.pendingCodec)||(R==null?void 0:R.codec),N=R==null?void 0:R.levelCodec;I||(I=i[o]={buffer:void 0,listeners:[],codec:f,supplemental:b,container:_,levelCodec:p,metadata:y,id:h});const P=ir(M,N),L=P==null?void 0:P.replace(ra,"$1");let A=ir(f,p);const x=(d=A)==null?void 0:d.replace(ra,"$1");A&&P&&L!==x&&(o.slice(0,5)==="audio"&&(A=pr(A,this.appendSource)),this.log(`switching codec ${M} to ${A}`),A!==(I.pendingCodec||I.codec)&&(I.pendingCodec=A),I.container=_,this.appendChangeType(o,_,A))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{const n=this.tracks[e];if(n){const o=n.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),o.changeType(r),n.codec=i,n.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:n=>{this.warn(`Failed to change ${e} SourceBuffer type`,n)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,Ee.MAIN))==null?void 0:t.gap)===!0)return;const n={label:"block-audio",execute:()=>{var o;const a=this.tracks.video;(this.lastVideoAppendEnd>r||a!=null&&a.buffer&&Me.isBuffered(a.buffer,r)||((o=this.fragmentTracker.getAppendedFrag(r,Ee.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:n,frag:e},this.append(n,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:s,parent:n,frag:o,part:a,chunkMeta:l}=t,d=l.buffering[s],u=o.sn,h=self.performance.now();d.start=h;const f=o.stats.buffering,p=a?a.stats.buffering:null;f.start===0&&(f.start=h),p&&p.start===0&&(p.start=h);const _=i.audio;let y=!1;s==="audio"&&(_==null?void 0:_.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||l.id===1||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const b=this.tracks.video,I=b==null?void 0:b.buffer;if(I&&u!=="initSegment"){const M=a||o,N=this.blockedAudioAppend;if(s==="audio"&&n!=="main"&&!this.blockedAudioAppend){const L=M.start+M.duration*.05,A=I.buffered,x=this.currentOp("video");!A.length&&!x?this.blockAudio(M):!x&&!Me.isBuffered(I,L)&&this.lastVideoAppendEnd<L&&this.blockAudio(M)}else if(s==="video"){const P=M.end;if(N){const L=N.frag.start;(P>L||P<this.lastVideoAppendEnd||Me.isBuffered(I,L))&&this.unblockAudio()}this.lastVideoAppendEnd=P}}const T=(a||o).start,R={label:`append-${s}`,execute:()=>{if(d.executeStart=self.performance.now(),y){const M=this.tracks[s];if(M){const N=M.buffer;if(N){const P=T-N.timestampOffset;Math.abs(P)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${T} (delta: ${P}) sn: ${u})`),N.timestampOffset=T)}}}this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const M=self.performance.now();d.executeEnd=d.end=M,f.first===0&&(f.first=M),p&&p.first===0&&(p.first=M);const N={};this.sourceBuffers.forEach(([P,L])=>{P&&(N[P]=Me.getBuffered(L))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(C.BUFFER_APPENDED,{type:s,frag:o,part:a,chunkMeta:l,parent:o.type,timeRanges:N})},onError:M=>{var N;const P={type:Se.MEDIA_ERROR,parent:o.type,details:J.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:a,chunkMeta:l,error:M,err:M,fatal:!1},L=(N=this.media)==null?void 0:N.error;if(M.code===DOMException.QUOTA_EXCEEDED_ERR)P.details=J.BUFFER_FULL_ERROR;else if(M.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!L)P.errorAction=Mi(!0);else if(M.name===Ro&&this.sourceBufferCount===0)P.errorAction=Mi(!0);else{const A=++this.appendErrors[s];this.warn(`Failed ${A}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${L||"no media error"})`),(A>=this.hls.config.appendErrorMaxRetry||L)&&(P.fatal=!0)}this.hls.trigger(C.ERROR,P)}};this.append(R,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(C.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([n])=>{n&&this.append(this.getFlushOp(n,r,s),n)})}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],n=r?r.elementaryStreams:i.elementaryStreams;n[He.AUDIOVIDEO]?s.push("audiovideo"):(n[He.AUDIO]&&s.push("audio"),n[He.VIDEO]&&s.push("video"));const o=()=>{const a=self.performance.now();i.stats.buffering.end=a,r&&(r.stats.buffering.end=a);const l=r?r.stats:i.stats;this.hls.trigger(C.FRAG_BUFFERED,{frag:i,part:r,stats:l,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,s).catch(a=>{this.warn(`Fragment buffered callback ${a}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([n])=>{if(n){const o=this.tracks[n];(!t.type||t.type===n)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${n} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([n])=>{var o;return n&&!((o=this.tracks[n])!=null&&o.ended)})&&(r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:n}=this;if(!n||n.readyState!=="open"){n&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${n.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),n.endOfStream(),this.hls.trigger(C.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(C.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===J.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;ge(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,s=i.currentTime,n=t.levelTargetDuration,o=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ge(o)&&o>=0){const a=Math.max(o,n),l=Math.floor(s/n)*n-a;this.flushBackBuffer(s,n,l)}if(ge(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const a=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),l=Math.max(a,n),d=Math.floor(s/n)*n+l;this.flushFrontBuffer(s,n,d)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=Me.getBuffered(s);if(o.length>0&&i>o.start(0)){var n;this.hls.trigger(C.BACK_BUFFER_REACHED,{bufferEnd:i});const a=this.tracks[r];if((n=this.details)!=null&&n.live)this.hls.trigger(C.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(a!=null&&a.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const n=Me.getBuffered(s),o=n.length;if(o<2)return;const a=n.start(o-1),l=n.end(o-1);if(i>a||e>=a&&e<=l)return;this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const l=Math.max(0,t.fragmentStart),d=Math.max(l,r);return{duration:1/0,start:l,end:d}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return ge(s)?{duration:s}:null;const n=this.media.duration,o=ge(i.duration)?i.duration:0;return r>o&&r>n||!ge(n)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(ge(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${We(i)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(C.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const n=s,o=e[n];if(this.isPending(o)){const a=this.getTrackCodec(o,n),l=`${o.container};codecs=${a}`;o.codec=a,this.log(`creating sourceBuffer(${l})${this.currentOp(n)?" Queued":""} ${We(o)}`);try{const d=i.addSourceBuffer(l),u=es(n),h=[n,d];t[u]=h,o.buffer=d}catch(d){var r;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(n),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[n],this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:n,mimeType:l,parent:o.id});return}this.trackSourceBuffer(n,o)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&us(i,"video")&&(r=zl(r,i));const s=ir(r,e.levelCodec);return s?t.slice(0,5)==="audio"?pr(s,this.appendSource):s:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,n)=>{const o=n.removedRanges;o!=null&&o.length&&this.hls.trigger(C.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}removeExecutor(e,t,i){const{media:r,mediaSource:s}=this,n=this.tracks[e],o=n==null?void 0:n.buffer;if(!r||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const a=ge(r.duration)?r.duration:1/0,l=ge(s.duration)?s.duration:1/0,d=Math.max(0,t),u=Math.min(i,a,l);u>d&&(!n.ending||n.ended)?(n.ended=!1,this.log(`Removing [${d},${u}] from the ${e} SourceBuffer`),o.remove(d,u)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i==null?void 0:i.buffer;if(!r)throw new Zd(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(n=>this.appendBlocker(n));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(n=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const n=i.bind(this,e);r.listeners.push({event:t,listener:n}),s.addEventListener(t,n)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function sa(c){const e=c.querySelectorAll("source");[].slice.call(e).forEach(t=>{c.removeChild(t)})}function eu(c,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,c.appendChild(t)}function es(c){return c==="audio"?1:0}class Ks{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.BUFFER_CODECS,this.onBufferCodecs,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(C.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ge(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,Ks.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(o,a)=>a?o.width!==a.width||o.height!==a.height:!0;let s=e.length-1;const n=Math.max(t,i);for(let o=0;o<e.length;o+=1){const a=e[o];if((a.width>=n||a.height>=n)&&r(a,e[o+1])){s=o;break}}return s}}const tu={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},mt=tu,iu={HLS:"h"},ru=iu,su="CMCD-Object",nu="CMCD-Request",au="CMCD-Session",ou="CMCD-Status",Ii={OBJECT:su,REQUEST:nu,SESSION:au,STATUS:ou},lu={[Ii.OBJECT]:["br","d","ot","tb"],[Ii.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ii.SESSION]:["cid","pr","sf","sid","st","v"],[Ii.STATUS]:["bs","rtp"]};class Si{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof Si?i:new Si(i))),this.value=e,this.params=t}}const cu="Dict";function du(c){return Array.isArray(c)?JSON.stringify(c):c instanceof Map?"Map{}":c instanceof Set?"Set{}":typeof c=="object"?JSON.stringify(c):String(c)}function uu(c,e,t,i){return new Error(`failed to ${c} "${du(e)}" as ${t}`,{cause:i})}function Ft(c,e,t){return uu("serialize",c,e,t)}class Io{constructor(e){this.description=e}}const na="Bare Item",hu="Boolean";function fu(c){if(typeof c!="boolean")throw Ft(c,hu);return c?"?1":"?0"}const pu="Byte Sequence";function mu(c){if(ArrayBuffer.isView(c)===!1)throw Ft(c,pu);return`:${dd(c)}:`}const gu="Integer";function _u(c){return c<-999999999999999||999999999999999<c}function wo(c){if(_u(c))throw Ft(c,gu);return c.toString()}function yu(c){return`@${wo(c.getTime()/1e3)}`}const vu="Decimal";function Eu(c){const e=ho(c,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ft(c,vu);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Su="String",bu=/[\x00-\x1f\x7f]+/;function Tu(c){if(bu.test(c))throw Ft(c,Su);return`"${c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function xu(c){return c.description||c.toString().slice(7,-1)}const Au="Token";function aa(c){const e=xu(c);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Ft(e,Au);return e}function Es(c){switch(typeof c){case"number":if(!ge(c))throw Ft(c,na);return Number.isInteger(c)?wo(c):Eu(c);case"string":return Tu(c);case"symbol":return aa(c);case"boolean":return fu(c);case"object":if(c instanceof Date)return yu(c);if(c instanceof Uint8Array)return mu(c);if(c instanceof Io)return aa(c);default:throw Ft(c,na)}}const Lu="Key";function Ss(c){if(/^[a-z*][a-z0-9\-_.*]*$/.test(c)===!1)throw Ft(c,Lu);return c}function zs(c){return c==null?"":Object.entries(c).map(([e,t])=>t===!0?`;${Ss(e)}`:`;${Ss(e)}=${Es(t)}`).join("")}function Do(c){return c instanceof Si?`${Es(c.value)}${zs(c.params)}`:Es(c)}function Ru(c){return`(${c.value.map(Do).join(" ")})${zs(c.params)}`}function Iu(c,e={whitespace:!0}){if(typeof c!="object")throw Ft(c,cu);const t=c instanceof Map?c.entries():Object.entries(c),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Si||(s=new Si(s));let n=Ss(r);return s.value===!0?n+=zs(s.params):(n+="=",Array.isArray(s.value)?n+=Ru(s):n+=Do(s)),n}).join(`,${i}`)}function wu(c,e){return Iu(c,e)}function Du(c){return c==="ot"||c==="sf"||c==="st"}function Cu(c){return typeof c=="number"?ge(c):c!=null&&c!==""&&c!==!1}const ar=c=>Math.round(c),ku=(c,e)=>(e!=null&&e.baseUrl&&(c=ud(c,e.baseUrl)),encodeURIComponent(c)),Qi=c=>ar(c/100)*100,Pu={br:ar,d:ar,bl:Qi,dl:Qi,mtp:Qi,nor:ku,rtp:Qi,tb:ar};function Mu(c,e){const t={};if(c==null||typeof c!="object")return t;const i=Object.keys(c).sort(),r=Ke({},Pu,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return i.forEach(n=>{if(s!=null&&s(n))return;let o=c[n];const a=r[n];a&&(o=a(o,e)),!(n==="v"&&o===1)&&(n=="pr"&&o===1||Cu(o)&&(Du(n)&&typeof o=="string"&&(o=new Io(o)),t[n]=o))}),t}function Co(c,e={}){return c?wu(Mu(c,e),Ke({whitespace:!1},e)):""}function Ou(c,e={}){const t={};if(!c)return t;const i=Object.entries(c),r=Object.entries(lu).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=i.reduce((n,o)=>{var a,l;const[d,u]=o,h=((a=r.find(f=>f[1].includes(d)))===null||a===void 0?void 0:a[0])||Ii.REQUEST;return(l=n[h])!==null&&l!==void 0||(n[h]={}),n[h][d]=u,n},{});return Object.entries(s).reduce((n,[o,a])=>(n[o]=Co(a,e),n),t)}function Bu(c,e,t){return Ke(c,Ou(e,t))}const Fu="CMCD";function Nu(c,e={}){if(!c)return"";const t=Co(c,e);return`${Fu}=${encodeURIComponent(t)}`}const oa=/CMCD=[^&#]+/;function Uu(c,e,t){const i=Nu(e,t);if(!i)return c;if(oa.test(c))return c.replace(oa,i);const r=c.includes("?")?"&":"?";return`${c}${r}${i}`}class $u{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:mt.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:n}=r,o=this.hls.levels[s.level],a=this.getObjectType(s),l={d:(n||s).duration*1e3,ot:a};(a===mt.VIDEO||a===mt.AUDIO||a==mt.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a));const d=n?this.getNextPart(n):this.getNextFrag(s);d!=null&&d.url&&d.url!==s.url&&(l.nor=d.url),this.apply(r,l)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHED,this.onMediaDetached,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHED,this.onMediaDetached,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:ru.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const i=t.ot===mt.INIT||t.ot===mt.VIDEO||t.ot===mt.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((n,o)=>(r.includes(o)&&(n[o]=t[o]),n),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Bu(e.headers,t,s)):e.url=Uu(e.url,t,s)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t,i;const{index:r,fragment:s}=e,n=(t=this.hls.levels[s.level])==null||(i=t.details)==null?void 0:i.partList;if(n){const{sn:o}=s;for(let a=n.length-1;a>=0;a--){const l=n[a];if(l.index===r&&l.fragment.sn===o)return n[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return mt.TIMED_TEXT;if(e.sn==="initSegment")return mt.INIT;if(t==="audio")return mt.AUDIO;if(t==="main")return this.hls.audioTracks.length?mt.VIDEO:mt.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===mt.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,n=s>-1?s+1:r.levels.length;i=r.levels.slice(0,n)}for(const s of i)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===mt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Me.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,n,o){t(s),this.loader.load(s,n,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,n,o){t(s),this.loader.load(s,n,o)}}}}const Gu=3e5;class Vu extends qt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===dt.SendAlternateToPenaltyBox&&i.flags===Rt.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,n=this.pathwayId;if(t.context){const{groupId:o,pathwayId:a,type:l}=t.context;o&&r?n=this.getPathwayForGroupId(o,l,n):a&&(n=a)}n in this.penalizedPathways||(this.penalizedPathways[n]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==n),i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${n} levels: ${r&&r.length} priorities: ${We(s)} penalized: ${We(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>Gu&&delete i[s]});for(let s=0;s<e.length;s++){const n=e[s];if(n in i)continue;if(n===this.pathwayId)return;const o=this.hls.nextLoadLevel,a=this.hls.levels[o];if(t=this.getLevelsForPathway(n),t.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,to(t),this.hls.trigger(C.LEVELS_UPDATED,{levels:t});const l=this.hls.levels[o];a&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===Be.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===Be.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(s=>{const{ID:n,"BASE-ID":o,"URI-REPLACEMENT":a}=s;if(t.some(d=>d.pathwayId===n))return;const l=this.getLevelsForPathway(o).map(d=>{const u=new Xe(d.attrs);u["PATHWAY-ID"]=n;const h=u.AUDIO&&`${u.AUDIO}_clone_${n}`,f=u.SUBTITLES&&`${u.SUBTITLES}_clone_${n}`;h&&(i[u.AUDIO]=h,u.AUDIO=h),f&&(r[u.SUBTITLES]=f,u.SUBTITLES=f);const p=ko(d.uri,u["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),_=new Pi({attrs:u,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:p,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let y=1;y<d.audioGroups.length;y++)_.addGroupId("audio",`${d.audioGroups[y]}_clone_${n}`);if(d.subtitleGroups)for(let y=1;y<d.subtitleGroups.length;y++)_.addGroupId("text",`${d.subtitleGroups[y]}_clone_${n}`);return _});t.push(...l),la(this.audioTracks,i,a,n),la(this.subtitleTracks,r,a,n)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+d)}const s={responseType:"json",url:r.href},n=t.steeringManifestLoadPolicy.default,o=n.errorRetry||n.timeoutRetry||{},a={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(d,u,h,f)=>{this.log(`Loaded steering manifest: "${r}"`);const p=d.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":_,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":b}=p;if(_)try{this.uri=new self.URL(_,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${_}`);return}this.scheduleRefresh(this.uri||h.url),y&&this.clonePathways(y);const I={steeringManifest:p,url:r.toString()};this.hls.trigger(C.STEERING_MANIFEST_LOADED,I),b&&this.updatePathwayPriority(b)},onError:(d,u,h,f)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${u.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${u.url} no longer available`);return}let p=this.timeToLoad*1e3;if(d.code===429){const _=this.loader;if(typeof(_==null?void 0:_.getResponseHeader)=="function"){const y=_.getResponseHeader("Retry-After");y&&(p=parseFloat(y)*1e3)}this.log(`Steering manifest ${u.url} rate limited`);return}this.scheduleRefresh(this.uri||u.url,p)},onTimeout:(d,u,h)=>{this.log(`Timeout loading steering manifest (${u.url})`),this.scheduleRefresh(this.uri||u.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,a,l)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function la(c,e,t,i){c&&Object.keys(e).forEach(r=>{const s=c.filter(n=>n.groupId===r).map(n=>{const o=Ke({},n);return o.details=void 0,o.attrs=new Xe(o.attrs),o.url=o.attrs.URI=ko(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=i,o});c.push(...s)})}function ko(c,e,t,i){const{HOST:r,PARAMS:s,[t]:n}=i;let o;e&&(o=n==null?void 0:n[e],o&&(c=o));const a=new self.URL(c);return r&&!o&&(a.host=r),s&&Object.keys(s).sort().forEach(l=>{l&&a.searchParams.set(l,s[l])}),a.href}class mi extends qt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=mi.CDMCleanupPromise?[mi.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:i,initData:r}=t,s=`"${t.type}" event: init data type: "${i}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let n=Object.keys(this.keySystemAccessPromises);n.length||(n=qi(this.config));const o=n.map(zr).filter(a=>!!a);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(n=>{const o=Hr(n);let a,l;if(i==="sinf"){if(o!==Ve.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${o}`);return}const p=it(new Uint8Array(r));try{const _=Os(JSON.parse(p).sinf),y=Pa(_);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(y.subarray(8,24)),l=Ve.FAIRPLAY}catch(_){this.warn(`${s} Failed to parse sinf: ${_}`);return}}else{if(o!==Ve.WIDEVINE&&o!==Ve.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${o}`);return}const p=Vl(r),_=p.filter(b=>!!b.systemId&&Kr(b.systemId)===o);_.length>1&&this.warn(`${s} Using first of ${_.length} pssh found for selected key-system ${o}`);const y=_[0];if(!y){p.length===0||p.some(b=>!b.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${p.map(b=>Kr(b.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(l=Kr(y.systemId),y.version===0&&y.data)if(l===Ve.WIDEVINE){const b=y.data.length-22;a=new Uint8Array(y.data.subarray(b,b+16))}else l===Ve.PLAYREADY&&(a=Ya(y.data))}if(!l||!a)return;const d=kt.hexDump(a),{keyIdToKeySessionPromise:u,mediaKeySessions:h}=this;let f=u[d];for(let p=0;p<h.length;p++){const _=h[p],y=_.decryptdata;if(!y.keyId)continue;const b=kt.hexDump(y.keyId);if(d===b||y.uri.replace(/-/g,"").indexOf(d)!==-1){if(f=u[b],y.pssh)break;delete u[b],y.pssh=new Uint8Array(r),y.keyId=a,f=u[d]=f.then(()=>this.generateRequestWithPreferredKeySession(_,i,r,"encrypted-event-key-match")),f.catch(I=>this.handleError(I));break}}if(!f){if(l!==o){this.log(`Ignoring "${t.type}" event with ${l} init data for selected key-system ${o}`);return}f=u[d]=this.getKeySystemSelectionPromise([l]).then(({keySystem:p,mediaKeys:_})=>{var y;this.throwIfDestroyed();const b=new Oi("ISO-23001-7",d,(y=zr(p))!=null?y:"");return b.pssh=new Uint8Array(r),b.keyId=a,this.attemptSetMediaKeys(p,_).then(()=>{this.throwIfDestroyed();const I=this.createMediaKeySessionContext({decryptdata:b,keySystem:p,mediaKeys:_});return this.generateRequestWithPreferredKeySession(I,i,r,"encrypted-event-no-match")})}),f.catch(p=>this.handleError(p))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(C.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(C.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===Ve.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(n,o,a)=>!!n&&a.indexOf(n)===o,r=t.map(n=>n.audioCodec).filter(i),s=t.map(n=>n.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((n,o)=>{const a=l=>{const d=l.shift();this.getMediaKeysPromise(d,r,s).then(u=>n({keySystem:d,mediaKeys:u})).catch(u=>{l.length?a(l):u instanceof bt?o(u):o(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_ACCESS,error:u,fatal:!0},u.message))})};a(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return qa===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=Pc(e,t,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let n=s==null?void 0:s.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${We(r)}`),n=this.requestMediaKeySystemAccess(e,r);const o=this.keySystemAccessPromises[e]={keySystemAccess:n};return n.catch(a=>{this.log(`Failed to obtain access to key-system "${e}": ${a}`)}),n.then(a=>{this.log(`Access for key-system "${a.keySystem}" obtained`);const l=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=a.createMediaKeys().then(d=>(this.log(`Media-keys created for "${e}"`),l.then(u=>u?this.setMediaKeysServerCertificate(d,e,u):d))),o.mediaKeys.catch(d=>{this.error(`Failed to create media-keys for "${e}"}: ${d}`)}),o.mediaKeys})}return n.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${kt.hexDump(e.keyId||[])}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return kt.hexDump(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${kt.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const r=qi(this.config),s=e.map(Hr).filter(n=>!!n&&r.indexOf(n)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:n})=>{const o=zr(n);o?t(o):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(o,a).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=s.then(o=>{const a="cenc",l=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(o,a,l,"playlist-key")})).catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof bt?this.hls.trigger(C.ERROR,e.data):this.hls.trigger(C.ERROR,{type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=Hr(e.keyFormat),s=r?[r]:qi(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=qi(this.config)),e.length===0)throw new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${We({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var s,n;const o=(s=this.config.drmSystems)==null||(n=s[e.keySystem])==null?void 0:n.generateRequest;if(o)try{const p=o.call(this.hls,t,i,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,i=p.initData?p.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(p){var a;if(this.warn(p.message),(a=this.hls)!=null&&a.config.debug)throw p}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);const d=new Fs,u=e._onmessage=p=>{const _=e.mediaKeysSession;if(!_){d.emit("error",new Error("invalid state"));return}const{messageType:y,message:b}=p;this.log(`"${y}" message event for session "${_.sessionId}" message size: ${b.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,b).catch(I=>{d.eventNames().length?d.emit("error",I):this.handleError(I)}):y==="license-release"?e.keySystem===Ve.FAIRPLAY&&(this.updateKeySession(e,ps("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},h=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const y=e.keyStatus;d.emit("keyStatus",y),y==="expired"&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",u),e.mediaKeysSession.addEventListener("keystatuseschange",h);const f=new Promise((p,_)=>{d.on("error",_),d.on("keyStatus",y=>{y.startsWith("usable")?p():y==="output-restricted"?_(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):y==="internal-error"?_(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${y}"`)):y==="expired"?_(new Error("key expired while generating request")):this.warn(`unhandled key status change "${y}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${l}`)}).catch(p=>{throw new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>f).catch(p=>{throw d.removeAllListeners(),this.removeSession(e),p}).then(()=>(d.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const r=i;i=t,t=r}this.log(`key status change "${t}" for keyStatuses keyId: ${kt.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${kt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((n,o)=>{const a={responseType:"arraybuffer",url:s},l=t.certLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,f,p,_)=>{n(h.data)},onError:(h,f,p,_)=>{o(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:Ge({url:a.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,p)=>{o(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,f,p)=>{o(new Error("aborted"))}};r.load(a,d,u)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(n=>{s(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:n,fatal:!0},n.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let d;for(let u=0,h=s.length;u<h;u++){var n,o;d=s[u];const f=(n=d.querySelector("name"))==null?void 0:n.textContent,p=(o=d.querySelector("value"))==null?void 0:o.textContent;f&&p&&e.setRequestHeader(f,p)}}const a=r.querySelector("Challenge"),l=a==null?void 0:a.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return ps(atob(l))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)}).catch(n=>{if(!i.decryptdata)throw n;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)}).then(n=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:n||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const n=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${n}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let a=o.response;this.log(`License received ${a instanceof ArrayBuffer?a.byteLength:a}`);const l=this.config.licenseResponseCallback;if(l)try{a=l.call(this.hls,o,n,e)}catch(d){this.error(d)}r(a)}else{const a=i.errorRetry,l=a?a.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)s(new bt({type:Se.KEY_SYSTEM_ERROR,details:J.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:n,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${n}). Status: ${o.status} (${o.statusText})`));else{const d=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,n,e,t).then(({xhr:a,licenseChallenge:l})=>{e.keySystem==Ve.PLAYREADY&&(l=this.unpackPlayReadyKeyMessage(a,l)),a.send(l)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const i=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Oi.clearKeyUriToKeyIdMap();const r=i.length;mi.CDMCleanupPromise=Promise.all(i.map(s=>this.removeSession(s)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(s=>{var n;this.log(`Could not clear media keys: ${s}`),(n=this.hls)==null||n.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(s=>{var n;this.log(`Could not close sessions and clear media keys: ${s}`),(n=this.hls)==null||n.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:s}=this.config;return(Oc(s)?new Promise((o,a)=>{self.setTimeout(()=>a(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(o)}):Promise.resolve()).catch(o=>{var a;this.log(`Could not remove session: ${o}`),(a=this.hls)==null||a.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${o}`)})}).then(()=>t.close()).catch(o=>{var a;this.log(`Could not close session: ${o}`),(a=this.hls)==null||a.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${o}`)})})}}}mi.CDMCleanupPromise=void 0;class bt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class ju{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(C.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(C.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,n=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,a=1e3*n/s,l=this.hls;if(l.trigger(C.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:i}),a>0&&n>l.config.fpsDroppedMonitoringThreshold*o){let d=l.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=d)&&(d=d-1,l.trigger(C.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Po(c,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=c,e.dispatchEvent(t)}function Mo(c,e){const t=c.mode;if(t==="disabled"&&(c.mode="hidden"),c.cues&&!c.cues.getCueById(e.id))try{if(c.addCue(e),!c.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Ne.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,c.addCue(r)}catch(r){Ne.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(c.mode=t)}function fi(c,e){const t=c.mode;if(t==="disabled"&&(c.mode="hidden"),c.cues)for(let i=c.cues.length;i--;)e&&c.cues[i].removeEventListener("enter",e),c.removeCue(c.cues[i]);t==="disabled"&&(c.mode=t)}function bs(c,e,t,i){const r=c.mode;if(r==="disabled"&&(c.mode="hidden"),c.cues&&c.cues.length>0){const s=Ku(c.cues,e,t);for(let n=0;n<s.length;n++)(!i||i(s[n]))&&c.removeCue(s[n])}r==="disabled"&&(c.mode=r)}function Hu(c,e){if(e<=c[0].startTime)return 0;const t=c.length-1;if(e>c[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<c[s].startTime)r=s-1;else if(e>c[s].startTime&&i<t)i=s+1;else return s;return c[i].startTime-e<e-c[r].startTime?i:r}function Ku(c,e,t){const i=[],r=Hu(c,e);if(r>-1)for(let s=r,n=c.length;s<n;s++){const o=c[s];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}function or(c){const e=[];for(let t=0;t<c.length;t++){const i=c[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(c[t])}return e}class zu extends Hs{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=or(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;or(i.textTracks).forEach(n=>{fi(n)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,n=this.tracksInGroup[i];if(!n||n.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${n==null?void 0:n.groupId}`);return}const o=n.details;n.details=t.details,this.log(`Subtitle track ${i} "${n.name}" lang:${n.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(n=>(r==null?void 0:r.indexOf(n))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const n=this.tracks.filter(d=>!i||i.indexOf(d.groupId)!==-1);if(n.length)this.selectDefaultTrack&&!n.some(d=>d.default)&&(this.selectDefaultTrack=!1),n.forEach((d,u)=>{d.id=u});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=n;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const d=Mt(o,n);if(d>-1)s=n[d];else{const u=Mt(o,this.tracks);s=this.tracks[u]}}let a=this.findTrackId(s);a===-1&&s&&(a=this.findTrackId(null));const l={subtitleTracks:n};this.log(`Updating subtitle tracks, ${n.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(C.SUBTITLE_TRACKS_UPDATED,l),a!==-1&&this.trackId===-1&&this.setSubtitleTrack(a)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||si(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(Ui(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Ui(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(vs(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Be.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&si(e,i))return i;const r=Mt(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=Mt(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),n=e.details,o=n==null?void 0:n.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&n.live?" age "+o.toFixed(1)+(n.type&&" "+n.type||""):""} ${s}`),this.hls.trigger(C.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=or(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(s=>vs(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ge(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:n,groupId:o="",name:a,type:l,url:d}=r;this.hls.trigger(C.SUBTITLE_TRACK_SWITCH,{id:n,groupId:o,name:a,type:l,url:d});const u=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(u)}}function Ci(c){let e=5381,t=c.length;for(;t;)e=e*33^c.charCodeAt(--t);return(e>>>0).toString()}const gi=.025;let br=function(c){return c[c.Point=0]="Point",c[c.Range=1]="Range",c}({});function qu(c,e,t){return`${c.identifier}-${t+1}-${Ci(e)}`}class Yu{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return ts(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=ts(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ge(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return ts(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<gi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?br.Range:br.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Wu(this)}}function ts(c,e){return c-e.start<e.duration/2&&!(Math.abs(c-(e.start+e.duration))<gi)?e.start:e.start+e.duration}function Oo(c,e,t){const i=new self.URL(c,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Wu(c){return`["${c.identifier}" ${c.cue.pre?"<pre>":c.cue.post?"<post>":""}${c.timelineStart.toFixed(2)}-${c.resumeTime.toFixed(2)}]`}function Ts(c){const e=c.timelineStart,t=c.duration||0;return`["${c.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Xu{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const l=this.interstitial.playoutLimit,d=this.currentTime;this.startOffset+d>=l&&this.hls.trigger(C.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;let n=r.uri;try{n=Oo(n,s.sessionId).href}catch{}s.loadSource(n);const o=()=>{this.hasDetails=!0};s.once(C.LEVEL_LOADED,o),s.once(C.AUDIO_TRACK_LOADED,o),s.once(C.SUBTITLE_TRACK_LOADED,o),s.on(C.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&l.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,r=Me.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Me.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${Ts(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const ca=.033;class Qu extends qt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const n=i[s];if(!n.error){const o=n.timelineStart;if(t===o||t>o&&t<o+(n.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const r=i.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,s=this.events,n=this.parseDateRanges(r,{url:i.url},t),o=Object.keys(r),a=s?s.filter(l=>!o.includes(l.identifier)):[];n.length&&n.sort((l,d)=>{const u=l.cue.pre,h=l.cue.post,f=d.cue.pre,p=d.cue.post;if(u&&!f)return-1;if(f&&!u||h&&!p)return 1;if(p&&!h)return-1;if(!u&&!f&&!h&&!p){const _=l.startTime,y=d.startTime;if(_!==y)return _-y}return l.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=n,a.forEach(l=>{this.removeEvent(l)}),this.updateSchedule(e,a)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,s=this.parseSchedule(i,e);(t.length||(r==null?void 0:r.length)!==s.length||s.some((o,a)=>Math.abs(o.playout.start-r[a].playout.start)>.005||Math.abs(o.playout.end-r[a].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,i){const r=[],s=Object.keys(e);for(let n=0;n<s.length;n++){const o=s[n],a=e[o];if(a.isInterstitial){let l=this.eventMap[o];l?l.setDateRange(a):(l=new Yu(a,t),this.eventMap[o]=l,i===!1&&(l.appendInPlace=i)),r.push(l)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,s=r.live?1/0:r.edge;let n=0;if(e=e.filter(a=>!a.error&&!(a.cue.once&&a.hasPlayed)),e.length){this.resolveOffsets(e,t);let a=0,l=0;if(e.forEach((d,u)=>{const h=d.cue.pre,f=d.cue.post,p=e[u-1]||null,_=d.appendInPlace,y=f?s:d.startOffset,b=d.duration,I=d.timelineOccupancy===br.Range?b:0,T=d.resumptionOffset,R=(p==null?void 0:p.startTime)===y,M=y+d.cumulativeDuration;let N=_?M+b:y+T;if(h||!f&&y<=0){const L=l;l+=I,d.timelineStart=M;const A=n;n+=b,i.push({event:d,start:M,end:N,playout:{start:A,end:n},integrated:{start:L,end:l}})}else if(y<=s){if(!R){const x=y-a;if(x>ca){const k=a,U=l;l+=x;const K=n;n+=x;const $={previousEvent:e[u-1]||null,nextEvent:d,start:k,end:k+x,playout:{start:K,end:n},integrated:{start:U,end:l}};i.push($)}else x>0&&p&&(p.cumulativeDuration+=x,i[i.length-1].end=y)}f&&(N=M),d.timelineStart=M;const L=l;l+=I;const A=n;n+=b,i.push({event:d,start:M,end:N,playout:{start:A,end:n},integrated:{start:L,end:l}})}else return;const P=d.resumeTime;f||P>s?a=s:a=P}),a<s){var o;const d=a,u=l,h=s-a;l+=h;const f=n;n+=h,i.push({previousEvent:((o=i[i.length-1])==null?void 0:o.event)||null,nextEvent:null,start:a,end:d+h,playout:{start:f,end:n},integrated:{start:u,end:l}})}this.setDurations(s,n,l)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let s=0,n=-1;e.forEach((o,a)=>{const l=o.cue.pre,d=o.cue.post,u=l?0:d?r:o.startTime;this.updateAssetDurations(o),n===u?o.cumulativeDuration=s:(s=0,n=u),!d&&o.snapOptions.in&&(o.resumeAnchor=ni(null,i.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&a+1<e.length&&e[a+1].startTime-e[a].resumeTime<ca&&(e[a+1].appendInPlace=!1,e[a+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=ge(o.resumeOffset)?o.resumeOffset:o.duration;s+=f})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>gi?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):t?!Object.keys(t).some(n=>{const o=t[n].details,a=o.edge;if(i>=a)return this.log(`"${e.identifier}" resumption ${i} past ${n} playlist end ${a}`),!1;const l=ni(null,o.fragments,i);if(!l)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${n} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const d=n==="audio"?.175:0;return Math.abs(l.start-i)<gi+d||Math.abs(l.end-i)<gi+d?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${n} fragment bounds (${l.start}-${l.end} sn: ${l.sn} cc: ${l.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,s=!1;e.assetList.forEach((n,o)=>{const a=t+i;n.startOffset=i,n.timelineStart=a,r||(r=n.duration===null),s||(s=!!n.error);const l=n.error?0:n.duration||0;i+=l}),r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Xt(c){return`[${c.event?'"'+c.event.identifier+'"':"primary"}: ${c.start.toFixed(2)}-${c.end.toFixed(2)}]`}class Zu{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=Oo(i,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,J.ASSET_LIST_LOAD_ERROR,h,i);this.hls.trigger(C.ERROR,f);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,n=s.loader,o=new n(s),a={responseType:"json",url:r.href},l=s.interstitialAssetListLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,f,p,_)=>{const y=h.data,b=y==null?void 0:y.ASSETS;if(!Array.isArray(b)){const I=this.assignAssetListError(e,J.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,f,_);this.hls.trigger(C.ERROR,I);return}e.assetListResponse=y,this.hls.trigger(C.ASSET_LIST_LOADED,{event:e,assetListResponse:y,networkDetails:_})},onError:(h,f,p,_)=>{const y=this.assignAssetListError(e,J.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,_,p);this.hls.trigger(C.ERROR,y)},onTimeout:(h,f,p)=>{const _=this.assignAssetListError(e,J.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,p);this.hls.trigger(C.ERROR,_)}};return o.load(a,d,u),this.hls.trigger(C.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,i,r,s,n){return e.error=i,{type:Se.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:n,stats:s}}}function zt(c,e,t){Bt(c,e,t),c.addEventListener(e,t)}function Bt(c,e,t){c.removeEventListener(e,t)}function da(c){c==null||c.play().catch(()=>{})}class Ju extends qt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const n=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const o=this.playingItem;if(!o){this.checkBuffer();return}if(n&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(),this.checkBuffer(),n&&i<o.start||i>=o.end){var a;const h=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(o)&&(a=this.media)!=null&&a.paused&&(this.shouldPlay=!1),!n){const f=this.findItemIndex(o);if(h>f){const p=this.schedule.findJumpRestrictedIndex(f+1,h);if(p>f){this.setSchedulePosition(p);return}}}this.setSchedulePosition(h);return}const l=this.playingAsset;if(!l){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,h))}return}const d=l.timelineStart,u=l.duration||0;(n&&i<d||i>=d+u)&&this.setScheduleToAssetAtTime(i,l)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const n=s.timelineStart+(s.duration||0);i>=n&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule,n=this.playingItem,o=s.events||[],a=s.items||[],l=s.durations,d=i.map(f=>f.identifier),u=!!(o.length||d.length);if(u&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${a.map(f=>Xt(f))}`),d.length&&this.log(`Removed events ${d}`),this.playerQueue.forEach(f=>{if(f.interstitial.appendInPlace){const p=f.assetItem.timelineStart,_=f.timelineOffset-p;if(_)try{f.timelineOffset=p}catch(y){Math.abs(_)>gi&&this.warn(`${y} ("${f.assetId}" ${f.timelineOffset}->${p})`)}}}),n){const f=this.updateItem(n,this.timelinePos);this.itemsMatch(n,f)&&(this.playingItem=f,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h){const f=this.updateItem(h,this.bufferedPos);this.itemsMatch(h,f)?this.bufferingItem=f:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))}if(i.forEach(f=>{f.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),u||r){if(this.hls.trigger(C.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:a.slice(0),durations:l,removedIds:d}),this.isInterstitial(n)&&d.includes(n.event.identifier)){this.warn(`Interstitial "${n.event.identifier}" removed while playing`),this.primaryFallback(n.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Zu(e),this.schedule=new Qu(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(C.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(C.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(C.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(C.MEDIA_ENDED,this.onMediaEnded,this),e.on(C.ERROR,this.onError,this),e.on(C.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(C.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(C.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(C.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(C.BUFFER_CODECS,this.onBufferCodecs,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(C.MEDIA_ENDED,this.onMediaEnded,this),e.off(C.ERROR,this.onError,this),e.off(C.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Bt(e,"play",this.onPlay),Bt(e,"pause",this.onPause),Bt(e,"seeking",this.onSeeking),Bt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;zt(i,"seeking",this.onSeeking),zt(i,"timeupdate",this.onTimeupdate),zt(i,"play",this.onPlay),zt(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=u=>u&&e.getAssetPlayer(u.identifier),r=(u,h,f,p,_)=>{if(u){let y=u[h].start;const b=u.event;if(b){if(h==="playout"||b.timelineOccupancy!==br.Point){const I=i(f);(I==null?void 0:I.interstitial)===b&&(y+=I.assetItem.startOffset+I[_])}}else{const I=p==="bufferedPos"?n():e[p];y+=I-u.start}return y}return 0},s=(u,h)=>{if(u!==0&&h!=="primary"&&e.schedule.length){var f;const p=e.schedule.findItemIndexAtTime(u),_=(f=e.schedule.items)==null?void 0:f[p];if(_){const y=_[h].start-_.start;return u+y}}return u},n=()=>{const u=e.bufferedPos;return u===Number.MAX_VALUE?o("primary"):Math.max(u,0)},o=u=>{var h;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:e.schedule.durations[u]},a=(u,h)=>{var f,p;const _=e.effectivePlayingItem;if(_!=null&&(f=_.event)!=null&&f.restrictions.skip)return;e.log(`seek to ${u} "${h}"`);const y=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(u,h),I=(p=e.schedule.items)==null?void 0:p[b],T=e.getBufferingPlayer(),R=T==null?void 0:T.interstitial,M=R==null?void 0:R.appendInPlace,N=y&&e.itemsMatch(y,I);if(y&&(M||N)){const L=i(e.playingAsset),A=(L==null?void 0:L.media)||e.primaryMedia;if(A){const x=h==="primary"?A.currentTime:r(y,h,e.playingAsset,"timelinePos","currentTime"),k=u-x,U=(M?x:A.currentTime)+k;if(U>=0&&(!L||M||U<=L.duration)){A.currentTime=U;return}}}if(I){let L=u;if(h!=="primary"){const x=I[h].start,k=u-x;L=I.start+k}const A=!e.isInterstitial(I);if((!e.isInterstitial(y)||y.event.appendInPlace)&&(A||I.event.appendInPlace)){const x=e.media||(M?T==null?void 0:T.media:null);x&&(x.currentTime=L)}else if(y){const x=e.findItemIndex(y);if(b>x){const U=e.schedule.findJumpRestrictedIndex(x+1,b);if(U>x){e.setSchedulePosition(U);return}}let k=0;if(A)e.timelinePos=L,e.checkBuffer();else{var P;const U=I==null||(P=I.event)==null?void 0:P.assetList;if(U){const K=u-(I[h]||I).start;for(let $=U.length;$--;){const j=U[$];if(j.duration&&K>=j.startOffset&&K<j.startOffset+j.duration){k=$;break}}}}e.setSchedulePosition(b,k)}}},l=()=>{const u=e.effectivePlayingItem;if(e.isInterstitial(u))return u;const h=t();return e.isInterstitial(h)?h:null},d={get currentTime(){const u=l(),h=e.effectivePlayingItem;return h&&h===u?r(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(u){const h=l(),f=e.effectivePlayingItem;f&&f===h&&a(u+f.playout.start,"playout")},get duration(){const u=l();return u?u.playout.end-u.playout.start:0},get assetPlayers(){var u;const h=(u=l())==null?void 0:u.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var u;const h=(u=l())==null?void 0:u.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var u,h;return((u=e.schedule)==null||(h=u.events)==null?void 0:h.slice(0))||[]},get schedule(){var u,h;return((u=e.schedule)==null||(h=u.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return l()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const u=t();return e.findItemIndex(u)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const u=e.effectivePlayingItem;return e.findItemIndex(u)},primary:{get bufferedEnd(){return n()},get currentTime(){const u=e.timelinePos;return u>0?u:0},set currentTime(u){a(u,"primary")},get duration(){return o("primary")},get seekableStart(){var u;return((u=e.primaryDetails)==null?void 0:u.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(u){a(u,"integrated")},get duration(){return o("integrated")},get seekableStart(){var u;return s(((u=e.primaryDetails)==null?void 0:u.fragmentStart)||0,"integrated")}},skip:()=>{const u=e.effectivePlayingItem,h=u==null?void 0:u.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(u);if(h.appendInPlace){const p=u.playout.start+u.event.duration;a(p+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const n=(i=s)==null?void 0:i.currentTime;if(!(n===void 0||!ge(n)))return n}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${We(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null;const n=this.hls,o=e!==n,a=o&&e.interstitial.appendInPlace,l=(i=this.detachedData)==null?void 0:i.mediaSource;let d;if(n.media)a&&(s=n.transferMedia(),this.detachedData=s),d="Primary";else if(l){const f=this.getBufferingPlayer();f?(s=f.transferMedia(),d=`${f}`):d="detached MediaSource"}else d="detached media";if(!s){if(l)s=this.detachedData,this.log(`using detachedData: MediaSource ${We(s)}`);else if(!this.detachedData||n.media===t){const f=this.playerQueue;f.length>1&&f.forEach(p=>{if(o&&p.interstitial.appendInPlace!==a){const _=p.interstitial;this.clearInterstitial(p.interstitial,null),_.appendInPlace=!1,_.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${_}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const u=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",h=u&&s?s:t;if(this.log(`${u?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${d}`),h===s){const f=o&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!o||f,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const n=e.findEventIndex(t[0].identifier);this.setSchedulePosition(n)}else if(s>=0||!this.primaryLive){const n=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(n);this.setSchedulePosition(o)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,i){const r=i+1;if(!e.isAssetPastPlayoutLimit(r)&&!e.assetList[r].error)this.setSchedulePosition(t,r);else{const s=this.schedule.items;if(s){const n=t+1,o=s.length;if(n>=o){this.setSchedulePosition(-1);return}const a=e.resumeTime;this.timelinePos<a&&(this.timelinePos=a,this.checkBuffer()),this.setSchedulePosition(n)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,r=t.parentIdentifier,s=i.getEvent(r);if(s){const n=i.findEventIndex(r),o=i.findAssetIndex(s,e);this.setSchedulePosition(n,o)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?i[e]:null,s=this.playingItem,n=this.playingLastItem;if(this.isInterstitial(s)){var o;const l=s.event,d=this.playingAsset,u=d==null?void 0:d.identifier,h=u?this.getAssetPlayer(u):null;if(h&&u&&(!this.eventItemsMatch(s,r)||t!==void 0&&u!==((o=l.assetList)==null?void 0:o[t].identifier))){var a;const f=l.findAssetIndex(d);this.log(`INTERSTITIAL_ASSET_ENDED ${f+1}/${l.assetList.length} ${Ts(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(C.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:f,event:l,schedule:i.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(u,r),h.media&&!((a=this.detachedData)!=null&&a.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(s,r)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${l} ${Xt(s)}`),l.hasPlayed=!0,this.hls.trigger(C.INTERSTITIAL_ENDED,{event:l,schedule:i.slice(0),scheduleIndex:e}),l.cue.once)){this.updateSchedule();const f=this.schedule.items;if(r&&f){const p=this.schedule.findItemIndex(r);this.advanceSchedule(p,f,t,s,n)}return}}this.advanceSchedule(e,i,t,s,n)}advanceSchedule(e,t,i,r,s){const n=e>=0?t[e]:null,o=this.primaryMedia,a=this.playerQueue;if(a.length&&a.forEach(l=>{const d=l.interstitial,u=this.schedule.findEventIndex(d.identifier);(u<e||u>e+1)&&this.clearInterstitial(d,n)}),this.isInterstitial(n)){this.timelinePos=Math.min(Math.max(this.timelinePos,n.start),n.end);const l=n.event;i===void 0&&(i=this.schedule.findAssetIndex(l,this.timelinePos));const d=this.waitingItem;this.assetsBuffered(n,o)||this.setBufferingItem(n);let u=this.preloadAssets(l,i);if(this.eventItemsMatch(n,d||r)||(this.waitingItem=n,this.log(`INTERSTITIAL_STARTED ${Xt(n)} ${l.appendInPlace?"append in place":""}`),this.hls.trigger(C.INTERSTITIAL_STARTED,{event:l,schedule:t.slice(0),scheduleIndex:e})),!l.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${l}`);return}if(l.assetListLoader&&(l.assetListLoader.destroy(),l.assetListLoader=void 0),!o){this.log(`Waiting for attachMedia to start Interstitial ${l}`);return}this.waitingItem=this.endedItem=null,this.playingItem=n;const h=l.assetList[i];if(!h){const f=t[e+1],p=this.media;f&&p&&!this.isInterstitial(f)&&p.currentTime<f.start&&(p.currentTime=this.timelinePos=f.start),this.advanceAfterAssetEnded(l,e,i||0);return}if(u||(u=this.getAssetPlayer(h.identifier)),u===null||u.destroyed){const f=l.assetList.length;this.warn(`asset ${i+1}/${f} player destroyed ${l}`),u=this.createAssetPlayer(l,h,i)}if(!this.eventItemsMatch(n,this.bufferingItem)&&l.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(u,i,t,e,o),this.shouldPlay&&da(u.media)}else n!==null?(this.resumePrimary(n,e,r),this.shouldPlay&&da(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Xt(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let n=this.timelinePos;(n<e.start||n>=e.end)&&(n=this.getPrimaryResumption(e,t),this.timelinePos=n),this.attachPrimary(n,e)}if(!i)return;const s=this.schedule.items;s&&(this.log(`resumed ${Xt(e)}`),this.hls.trigger(C.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Me.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(C.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(C.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],r=Ge(Ge({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{audio:i});return}const s=Ge(Ge({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Ge(Ge({},this.altSelection),{},{subtitles:i});return}const s=Ge(Ge({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){const i=bn(t);this.playerQueue.forEach(r=>r.hls.setAudioOption(t)||r.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=bn(t);this.playerQueue.forEach(r=>r.hls.setSubtitleOption(t)||t.id!==-1&&r.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var i;const n=this.schedule.findEventIndex(s.identifier),o=(i=this.schedule.items)==null?void 0:i[n];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=Me.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const n=this.playingItem,o=this.findItemIndex(n);let a=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,d;const u=this.findItemIndex(s),h=Math.min(u+1,t.length-1),f=t[h];if((a===-1&&s&&e>=s.end||(l=f.event)!=null&&l.appendInPlace&&e+.01>=f.start)&&(a=h),h-o>1&&(s==null||(d=s.event)==null?void 0:d.appendInPlace)===!1)return;if(this.bufferedPos=e,a>u&&a>o)this.bufferedToItem(f);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&f.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else i&&n&&!this.itemsMatch(n,s)&&(a===o?this.bufferedToItem(n):a===o+1&&this.bufferedToItem(t[a]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:r,events:s}=i;if(!r||!s)return t;const n=this.isInterstitial(e),o=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const a=o?o.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${Xt(e)}`+(t?` (${a.toFixed(2)} remaining)`:"")),n?e.event.assetList.forEach(l=>{const d=this.getAssetPlayer(l.identifier);d&&d.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(l=>l.pauseBuffering()))}this.hls.trigger(C.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){const n=this.preloadAssets(i,t);if(n!=null&&n.interstitial.appendInPlace){const o=i.assetList[t],a=this.primaryMedia;o&&a&&this.bufferAssetPlayer(n,a)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,n=e.cue.once;if(s){const a=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(a+.25)}let l,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){const h=d-a;h>0&&(l=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${l?` live-start: ${d} start-offset: ${l}`:""}`),i)return this.createAsset(e,0,0,a,e.duration,i);const u=this.assetListLoader.loadAssetList(e,l);u&&(e.assetListLoader=u)}else if(!n&&r){for(let a=t;a<r;a++){const l=e.assetList[a],d=this.getAssetPlayerQueueIndex(l.identifier);(d===-1||this.playerQueue[d].destroyed)&&!l.error&&this.createAssetPlayer(e,l,a)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(C.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,n){const o={parentIdentifier:e.identifier,identifier:qu(e,n,t),duration:s,startOffset:i,timelineStart:r,uri:n};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,i){this.log(`create HLSAssetPlayer for ${Ts(t)}`);const r=this.hls,s=r.userConfig;let n=s.videoPreference;const o=r.loadLevelObj||r.levels[r.currentLevel];(n||o)&&(n=Ke({},n),o.videoCodec&&(n.videoCodec=o.videoCodec),o.videoRange&&(n.allowedVideoRanges=[o.videoRange]));const a=r.audioTracks[r.audioTrack],l=r.subtitleTracks[r.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const R=t.duration;R&&T<R&&(d=T)}}const u=t.identifier,h=Ge(Ge({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:n,audioPreference:a||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=Ke({},f,{contentId:Ci(t.uri)})),this.getAssetPlayer(u)&&this.warn(`Duplicate date range identifier ${e} and asset ${u}`);const p=new Xu(this.HlsPlayerClass,h,e,t);this.playerQueue.push(p),e.assetList[i]=t;const _=T=>{if(T.live){const N=new Error(`Interstitials MUST be VOD assets ${e}`),P={fatal:!0,type:Se.OTHER_ERROR,details:J.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),i,N.message);return}const R=T.edge-T.fragmentStart,M=t.duration;(M===null||R>M)&&(this.log(`Interstitial asset "${u}" duration change ${M} > ${R}`),t.duration=R,this.updateSchedule())};p.on(C.LEVEL_UPDATED,(T,{details:R})=>_(R)),p.on(C.LEVEL_PTS_UPDATED,(T,{details:R})=>_(R));const y=(T,R)=>{const M=this.getAssetPlayer(u);if(M&&R.tracks){M.off(C.BUFFER_CODECS,y),M.tracks=R.tracks;const N=this.primaryMedia;this.bufferingAsset===M.assetItem&&N&&!M.media&&this.bufferAssetPlayer(M,N)}};p.on(C.BUFFER_CODECS,y);const b=()=>{var T;const R=this.getAssetPlayer(u);if(this.log(`buffered to end of asset ${R}`),!R)return;const M=this.schedule.findEventIndex(e.identifier),N=e.findAssetIndex(t),P=N+1,L=(T=this.schedule.items)==null?void 0:T[M];if(this.isInterstitial(L))if(N!==-1&&!e.isAssetPastPlayoutLimit(P)&&!e.assetList[P].error)this.bufferedToItem(L,P);else{var A;const x=(A=this.schedule.items)==null?void 0:A[M+1];x&&this.bufferedToItem(x)}};p.on(C.BUFFERED_TO_END,b);const I=T=>()=>{if(!this.getAssetPlayer(u))return;this.shouldPlay=!0;const M=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,M,T)};return p.once(C.MEDIA_ENDED,I(i)),p.once(C.PLAYOUT_LIMIT_REACHED,I(1/0)),p.on(C.ERROR,(T,R)=>{const M=this.getAssetPlayer(u);if(R.details===J.BUFFER_STALLED_ERROR){if(M!=null&&M.media){const N=M.currentTime,P=M.duration-N;N&&e.appendInPlace&&P/M.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${u} ${e} at ${M.media.currentTime}`),b()):(this.warn(`Stalled at ${N} of ${N+P} in asset ${u} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${R.error} ${e}`)}),p.on(C.DESTROYING,()=>{if(!this.getAssetPlayer(u))return;const R=new Error(`Asset player destroyed unexpectedly ${u}`),M={fatal:!0,type:Se.OTHER_ERROR,details:J.INTERSTITIAL_ASSET_ITEM_ERROR,error:R};this.handleAssetItemError(M,e,this.schedule.findEventIndex(e.identifier),i,R.message)}),this.hls.trigger(C.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:p}),p}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&Xt(t)}`);const r=this.playerQueue[i];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){const{interstitial:n,assetItem:o,assetId:a}=e,l=n.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!d||d.identifier!==a)&&(d&&(this.clearAssetPlayer(d.identifier,i[r]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${e}`),this.hls.trigger(C.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:n,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;const{interstitial:s,assetItem:n,assetId:o}=e,a=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[a];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=n;const d=this.getBufferingPlayer();if(d===e)return;const u=s.appendInPlace;if(u&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const h=(d==null?void 0:d.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&n!==this.playingAsset){if(!e.tracks)return;if(h&&!La(h,e.tracks)){const f=new Error(`Asset "${o}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),p={fatal:!0,type:Se.OTHER_ERROR,details:J.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},_=s.findAssetIndex(n);this.handleAssetItemError(p,s,a,_,f.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,r,s){if(e.details===J.BUFFER_STALLED_ERROR)return;const n=t.assetList[r]||null;let o=null;if(n){const u=this.getAssetPlayerQueueIndex(n.identifier);o=this.playerQueue[u]||null}const a=this.schedule.items,l=Ke({},e,{fatal:!1,errorAction:Mi(!0),asset:n,assetListIndex:r,event:t,schedule:a,scheduleIndex:i,player:o});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(C.INTERSTITIAL_ASSET_ERROR,l),!e.fatal)return;const d=new Error(s);n&&(this.playingAsset!==n&&this.clearAssetPlayer(n.identifier,null),n.error=d),t.assetList.some(u=>!u.error)?t.appendInPlace&&(t.error=d):t.error=d,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?Xt(i):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const s=this.updateItem(i,r);if(this.itemsMatch(i,s))this.clearInterstitial(e,null);else{const n=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(n)}}else this.checkStart()}onAssetListLoaded(e,t){var i;const r=t.event,s=r.identifier,n=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const o=r.timelineStart,a=r.duration;let l=0;n.forEach((p,_)=>{const y=parseFloat(p.DURATION);this.createAsset(r,_,l,o+l,y,p.URI),l+=y}),r.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${a}) ${r}`);const d=this.waitingItem,u=(d==null?void 0:d.event.identifier)===s;this.updateSchedule();const h=(i=this.bufferingItem)==null?void 0:i.event;if(u){var f;const p=this.schedule.findEventIndex(s),_=(f=this.schedule.items)==null?void 0:f[p];if(_){if(!this.playingItem&&this.timelinePos>_.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(_)}this.setSchedulePosition(p)}else if((h==null?void 0:h.identifier)===s&&h.appendInPlace){const p=r.assetList[0],_=this.getAssetPlayer(p.identifier),y=this.primaryMedia;p&&_&&y&&this.bufferAssetPlayer(_,y)}}onError(e,t){switch(t.details){case J.ASSET_LIST_PARSING_ERROR:case J.ASSET_LIST_LOAD_ERROR:case J.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case J.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const ua=500;class eh extends Bs{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",Ee.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(C.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(C.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ne.IDLE,this.setInterval(ua),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(at(i)&&(this.fragPrevious=i),this.state=ne.IDLE,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let n;const o=i.start;for(let l=0;l<s.length;l++)if(o>=s[l].start&&o<=s[l].end){n=s[l];break}const a=i.start+i.duration;n?n.end=a:(n={start:o,end:a},s.push(n)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(n=>{for(let o=0;o<n.length;){if(n[o].end<=s){n.shift();continue}else if(n[o].start<s)n[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,s,Ee.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===Ee.SUBTITLE&&(t.details===J.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ne.STOPPED&&(this.state=ne.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Lo(this.levels,t)){this.levels=t.map(i=>new Pi(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new Pi(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ee.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==ne.STOPPED&&this.setInterval(ua)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:s}=this,{details:n,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const a=s[o];if(o>=s.length||!a)return;this.log(`Subtitle track ${o} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(n.live||(i=a.details)!=null&&i.live){const u=this.mainDetails;if(n.deltaUpdateFailed||!u)return;const h=u.fragments[0];if(!a.details)n.hasProgramDateTime&&u.hasProgramDateTime?(Er(n,u),l=n.fragmentStart):h&&(l=h.start,gs(n,l));else{var d;l=this.alignPlaylists(n,a.details,(d=this.levelLastLoaded)==null?void 0:d.details),l===0&&h&&(l=h.start,gs(n,l))}}a.details=n,this.levelLastLoaded=a,o===r&&(this.hls.trigger(C.SUBTITLE_TRACK_UPDATED,{details:n,id:o,groupId:t.groupId}),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===ne.IDLE&&(ni(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&pi(r.method)){const n=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Ms(r.method)).catch(o=>{throw s.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const a=performance.now();s.trigger(C.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:n,tdecrypt:a}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=ne.IDLE})}}doTick(){if(!this.media){this.state=ne.IDLE;return}if(this.state===ne.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),n=Me.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:o,len:a}=n,l=i.details,d=this.hls.maxBufferLength+l.levelTargetDuration;if(a>d)return;const u=l.fragments,h=u.length,f=l.edge;let p=null;const _=this.fragPrevious;if(o<f){const I=r.maxFragLookUpTolerance,T=o>f-I?0:I;p=ni(_,u,Math.max(u[0].start,o),T),!p&&_&&_.start<u[0].start&&(p=u[0])}else p=u[h-1];if(p=this.filterReplacedPrimary(p,i.details),!p)return;const y=p.sn-l.startSN,b=u[y-1];if(b&&b.cc===p.cc&&this.fragmentTracker.getState(b)===rt.NOT_LOADED&&(p=b),this.fragmentTracker.getState(p)===rt.NOT_LOADED){const I=this.mapToInitFragWhenRequired(p);I&&this.loadFragment(I,i,o)}}}loadFragment(e,t,i){at(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new th(this.tracksBuffered[this.currentTrackId]||[])}}class th{constructor(e){this.buffered=void 0;const t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const ih={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Bo=c=>String.fromCharCode(ih[c]||c),Lt=15,jt=100,rh={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},sh={17:2,18:4,21:6,22:8,23:10,19:13,20:15},nh={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ah={25:2,26:4,29:6,30:8,31:10,27:13,28:15},oh=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class lh{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Ne.log(`${this.time} [${e}] ${i}`)}}}const ii=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class Fo{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ch{constructor(){this.uchar=" ",this.penState=new Fo}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class dh{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Fo,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<jt;t++)this.chars.push(new ch);this.logger=e}equals(e){for(let t=0;t<jt;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<jt;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<jt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>jt&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=jt)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Bo(e);if(this.pos>=jt){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<jt;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<jt;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class is{constructor(e){this.rows=[],this.currRow=Lt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Lt;t++)this.rows.push(new dh(e));this.logger=e}reset(){for(let e=0;e<Lt;e++)this.rows[e].clear();this.currRow=Lt-1}equals(e){let t=!0;for(let i=0;i<Lt;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Lt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Lt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+We(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Lt;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const o=n.rows[s].cueStartTime,a=this.logger.time;if(o!==null&&a!==null&&o<a)for(let l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(n.rows[s+l])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,n=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[n].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+We(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<Lt;s++){const n=this.rows[s].getTextString();n&&(r=s+1,e?t.push("Row "+r+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class ha{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new is(i),this.nonDisplayedMemory=new is(i),this.lastOutputScreen=new is(i),this.currRollUpRow=this.displayedMemory.rows[Lt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Lt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+We(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class fa{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=hh(),this.logger=void 0;const r=this.logger=new lh;this.channels=[null,new ha(e,t,r),new ha(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,s=t[i+1]&127;let n=!1,o=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+ii([t[i],t[i+1]])+"] -> ("+ii([r,s])+")");const a=this.cmdHistory;if(r>=16&&r<=31){if(uh(r,s,a)){Zi(null,null,a),this.logger.log(3,()=>"Repeated command ("+ii([r,s])+") is dropped");continue}Zi(r,s,this.cmdHistory),n=this.parseCmd(r,s),n||(n=this.parseMidrow(r,s)),n||(n=this.parsePAC(r,s)),n||(n=this.parseBackgroundAttributes(r,s))}else Zi(null,null,a);if(!n&&(o=this.parseChars(r,s),o)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ii([r,s])+" orig: "+ii([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,n=this.channels[s];return e===20||e===21||e===28||e===29?t===32?n.ccRCL():t===33?n.ccBS():t===34?n.ccAOF():t===35?n.ccAON():t===36?n.ccDER():t===37?n.ccRU(2):t===38?n.ccRU(3):t===39?n.ccRU(4):t===40?n.ccFON():t===41?n.ccRDC():t===42?n.ccTR():t===43?n.ccRTD():t===44?n.ccEDM():t===45?n.ccCR():t===46?n.ccENM():t===47&&n.ccEOC():n.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ii([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const n=e<=23?1:2;t>=64&&t<=95?i=n===1?rh[e]:nh[e]:i=n===1?sh[e]:ah[e];const o=this.channels[n];return o?(o.setPAC(this.interpretPAC(i,t)),this.currentChannel=n,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let n;s===17?n=t+80:s===18?n=t+112:n=t+144,this.logger.log(2,()=>"Special char '"+Bo(n)+"' in channel "+i),r=[n]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+ii(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s;const n={};e===16||e===24?(s=Math.floor((t-32)/2),n.background=oh[s],t%2===1&&(n.background=n.background+"_semi")):t===45?n.background="transparent":(n.foreground="black",t===47&&(n.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(n),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Zi(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Zi(c,e,t){t.a=c,t.b=e}function uh(c,e,t){return t.a===c&&t.b===e}function hh(){return{a:null,b:null}}var qs=function(){if(vr!=null&&vr.VTTCue)return self.VTTCue;const c=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,a){if(typeof a!="string"||!Array.isArray(o))return!1;const l=a.toLowerCase();return~o.indexOf(l)?l:!1}function i(o){return t(c,o)}function r(o){return t(e,o)}function s(o,...a){let l=1;for(;l<arguments.length;l++){const d=arguments[l];for(const u in d)o[u]=d[u]}return o}function n(o,a,l){const d=this,u={enumerable:!0};d.hasBeenReset=!1;let h="",f=!1,p=o,_=a,y=l,b=null,I="",T=!0,R="auto",M="start",N=50,P="middle",L=50,A="middle";Object.defineProperty(d,"id",s({},u,{get:function(){return h},set:function(x){h=""+x}})),Object.defineProperty(d,"pauseOnExit",s({},u,{get:function(){return f},set:function(x){f=!!x}})),Object.defineProperty(d,"startTime",s({},u,{get:function(){return p},set:function(x){if(typeof x!="number")throw new TypeError("Start time must be set to a number.");p=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},u,{get:function(){return _},set:function(x){if(typeof x!="number")throw new TypeError("End time must be set to a number.");_=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},u,{get:function(){return y},set:function(x){y=""+x,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},u,{get:function(){return b},set:function(x){b=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},u,{get:function(){return I},set:function(x){const k=i(x);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=k,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},u,{get:function(){return T},set:function(x){T=!!x,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},u,{get:function(){return R},set:function(x){if(typeof x!="number"&&x!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");R=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},u,{get:function(){return M},set:function(x){const k=r(x);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");M=k,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},u,{get:function(){return N},set:function(x){if(x<0||x>100)throw new Error("Position must be between 0 and 100.");N=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},u,{get:function(){return P},set:function(x){const k=r(x);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");P=k,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},u,{get:function(){return L},set:function(x){if(x<0||x>100)throw new Error("Size must be between 0 and 100.");L=x,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},u,{get:function(){return A},set:function(x){const k=r(x);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");A=k,this.hasBeenReset=!0}})),d.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class fh{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function No(c){function e(i,r,s,n){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(n||0)}const t=c.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class ph{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function Uo(c,e,t,i){const r=i?c.split(i):[c];for(const s in r){if(typeof r[s]!="string")continue;const n=r[s].split(t);if(n.length!==2)continue;const o=n[0],a=n[1];e(o,a)}}const xs=new qs(0,0,""),Ji=xs.align==="middle"?"middle":"center";function mh(c,e,t){const i=c;function r(){const o=No(c);if(o===null)throw new Error("Malformed timestamp: "+i);return c=c.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,a){const l=new ph;Uo(o,function(h,f){let p;switch(h){case"region":for(let _=t.length-1;_>=0;_--)if(t[_].id===f){l.set(h,t[_].region);break}break;case"vertical":l.alt(h,f,["rl","lr"]);break;case"line":p=f.split(","),l.integer(h,p[0]),l.percent(h,p[0])&&l.set("snapToLines",!1),l.alt(h,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",Ji,"end"]);break;case"position":p=f.split(","),l.percent(h,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",Ji,"end","line-left","line-right","auto"]);break;case"size":l.percent(h,f);break;case"align":l.alt(h,f,["start",Ji,"end","left","right"]);break}},/:/,/\s/),a.region=l.get("region",null),a.vertical=l.get("vertical","");let d=l.get("line","auto");d==="auto"&&xs.line===-1&&(d=-1),a.line=d,a.lineAlign=l.get("lineAlign","start"),a.snapToLines=l.get("snapToLines",!0),a.size=l.get("size",100),a.align=l.get("align",Ji);let u=l.get("position","auto");u==="auto"&&xs.position===50&&(u=a.align==="start"||a.align==="left"?0:a.align==="end"||a.align==="right"?100:50),a.position=u}function n(){c=c.replace(/^\s+/,"")}if(n(),e.startTime=r(),n(),c.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);c=c.slice(3),n(),e.endTime=r(),n(),s(c,e)}function $o(c){return c.replace(/<br(?: \/)?>/gi,`
`)}class gh{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new fh,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,n=0;for(s=$o(s);n<s.length&&s[n]!=="\r"&&s[n]!==`
`;)++n;const o=s.slice(0,n);return s[n]==="\r"&&++n,s[n]===`
`&&++n,t.buffer=s.slice(n),o}function r(s){Uo(s,function(n,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();const o=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(n?n=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new qs(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{mh(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const _h=/\r\n|\n\r|\n|\r/g,rs=function(e,t,i=0){return e.slice(i,i+t.length)===t},yh=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ge(t)||!ge(i)||!ge(r)||!ge(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t};function Ys(c,e,t){return Ci(c.toString())+Ci(e.toString())+Ci(t)}const vh=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(n=s)!=null&&n.new;){var n;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function Eh(c,e,t,i,r,s,n){const o=new gh,a=vt(new Uint8Array(c)).trim().replace(_h,`
`).split(`
`),l=[],d=e?Nd(e.baseTime,e.timescale):0;let u="00:00.000",h=0,f=0,p,_=!0;o.oncue=function(y){const b=t[i];let I=t.ccOffset;const T=(h-d)/9e4;if(b!=null&&b.new&&(f!==void 0?I=t.ccOffset=b.start:vh(t,i,T)),T){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}I=T-t.presentationOffset}const R=y.endTime-y.startTime,M=Tt((y.startTime+I-f)*9e4,r*9e4)/9e4;y.startTime=Math.max(M,0),y.endTime=Math.max(M+R,0);const N=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(N)),y.id||(y.id=Ys(y.startTime,y.endTime,N)),y.endTime>0&&l.push(y)},o.onparsingerror=function(y){p=y},o.onflush=function(){if(p){n(p);return}s(l)},a.forEach(y=>{if(_)if(rs(y,"X-TIMESTAMP-MAP=")){_=!1,y.slice(16).split(",").forEach(b=>{rs(b,"LOCAL:")?u=b.slice(6):rs(b,"MPEGTS:")&&(h=parseInt(b.slice(7)))});try{f=yh(u)/1e3}catch(b){p=b}return}else y===""&&(_=!1);o.parse(y+`
`)}),o.flush()}const ss="stpp.ttml.im1t",Go=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Vo=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Sh={left:"start",center:"center",right:"end",start:"start",end:"end"};function pa(c,e,t,i){const r=De(new Uint8Array(c),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(o=>vt(o)),n=Fd(e.baseTime,1,e.timescale);try{s.forEach(o=>t(bh(o,n)))}catch(o){i(o)}}function bh(c,e){const r=new DOMParser().parseFromString(c,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(s).reduce((u,h)=>(u[h]=r.getAttribute(`ttp:${h}`)||s[h],u),{}),o=r.getAttribute("xml:space")!=="preserve",a=ma(ns(r,"styling","style")),l=ma(ns(r,"layout","region")),d=ns(r,"body","[begin]");return[].map.call(d,u=>{const h=jo(u,o);if(!h||!u.hasAttribute("begin"))return null;const f=os(u.getAttribute("begin"),n),p=os(u.getAttribute("dur"),n);let _=os(u.getAttribute("end"),n);if(f===null)throw ga(u);if(_===null){if(p===null)throw ga(u);_=f+p}const y=new qs(f-e,_-e,h);y.id=Ys(y.startTime,y.endTime,y.text);const b=l[u.getAttribute("region")],I=a[u.getAttribute("style")],T=Th(b,I,a),{textAlign:R}=T;if(R){const M=Sh[R];M&&(y.lineAlign=M),y.align=R}return Ke(y,T),y}).filter(u=>u!==null)}function ns(c,e,t){const i=c.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function ma(c){return c.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function jo(c,e){return[].slice.call(c.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?jo(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Th(c,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=c!=null&&c.hasAttribute("style")?c.getAttribute("style"):null;return n&&t.hasOwnProperty(n)&&(r=t[n]),s.reduce((o,a)=>{const l=as(e,i,a)||as(c,i,a)||as(r,i,a);return l&&(o[a]=l),o},{})}function as(c,e,t){return c&&c.hasAttributeNS(e,t)?c.getAttributeNS(e,t):null}function ga(c){return new Error(`Could not parse ttml timestamp ${c}`)}function os(c,e){if(!c)return null;let t=No(c);return t===null&&(Go.test(c)?t=xh(c,e):Vo.test(c)&&(t=Ah(c,e))),t}function xh(c,e){const t=Go.exec(c),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Ah(c,e){const t=Vo.exec(c),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class er{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Lh{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ya(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(C.FRAG_LOADING,this.onFragLoading,this),e.on(C.FRAG_LOADED,this.onFragLoaded,this),e.on(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(C.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(C.FRAG_LOADING,this.onFragLoading,this),e.off(C.FRAG_LOADED,this.onFragLoaded,this),e.off(C.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(C.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(C.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(C.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new er(this,"textTrack1"),t=new er(this,"textTrack2"),i=new er(this,"textTrack3"),r=new er(this,"textTrack4");this.cea608Parser1=new fa(1,e,t),this.cea608Parser2=new fa(3,i,r)}addCues(e,t,i,r,s){let n=!1;for(let o=s.length;o--;){const a=s[o],l=Rh(a[0],a[1],t,i);if(l>=0&&(a[0]=Math.min(a[0],t),a[1]=Math.max(a[1],i),n=!0,l/(i-t)>.5))return}if(n||s.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,r)}else{const o=this.Cues.newCue(null,t,i,r);this.hls.trigger(C.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){const{unparsedVttFrags:n}=this;i===Ee.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s}),n.length&&(this.unparsedVttFrags=[],n.forEach(o=>{this.onFragLoaded(C.FRAG_LOADED,o)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(_a(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:n}=t[e],o=this.getExistingTrack(s,n);if(o)i[e]=o,fi(i[e]),Po(i[e],r);else{const a=this.createTextTrack("captions",s,n);a&&(a[e]=!0,i[e]=a)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{fi(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ya(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)fi(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===ss);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Lo(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const n=this.media,o=n?or(n.textTracks):null;if(this.tracks.forEach((a,l)=>{let d;if(o){let u=null;for(let h=0;h<o.length;h++)if(o[h]&&_a(o[h],a)){u=o[h],o[h]=null;break}u&&(d=u)}if(d)fi(d);else{const u=Ho(a);d=this.createTextTrack(u,a.name,a.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),o!=null&&o.length){const a=o.filter(l=>l!==null).map(l=>l.label);a.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${a.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const n=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(C.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,n=this.captionsProperties[s];n&&(n.label=i.name,i.lang&&(n.languageCode=i.lang),n.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ee.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:n,lastSn:o}=this,{cc:a,sn:l}=t.frag,d=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&n&&(l!==o+1||l===o&&d!==this.lastPartIndex+1||a!==this.lastCc)&&(s.reset(),n.reset()),this.lastCc=a,this.lastSn=l,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===Ee.SUBTITLE)if(r.byteLength){const s=i.decryptdata,n="stats"in t;if(s==null||!s.encrypted||n){const o=this.tracks[i.level],a=this.vttCCs;a[i.cc]||(a[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===ss?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;pa(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:n}=this,o=s.length-1;if(!s[i.cc]&&o===-1){n.push(e);return}const a=this.hls,l=(t=i.initSegment)!=null&&t.data?xt(i.initSegment.data,new Uint8Array(r)).buffer:r;Eh(l,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,d=>{this._appendCues(d,i.level),a.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},d=>{const u=d.message==="Missing initPTS for VTT MPEGTS";u?n.push(e):this._fallbackToIMSC1(i,r),a.logger.log(`Failed to parse VTT cue: ${d}`),!(u&&o>i.cc)&&a.trigger(C.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||pa(t,this.initPTS[e.cc],()=>{i.textCodec=ss,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>Mo(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger(C.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===Ee.SUBTITLE&&this.onFragLoaded(C.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===Ee.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){const n=r[s].bytes;if(n){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(n);this.cea608Parser1.addData(r[s].pts,o[0]),this.cea608Parser2.addData(r[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:n}=this;if(!(!n||n.currentTime<i)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(a=>bs(o[a],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(a=>bs(o[a],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const n=e[r++],o=127&e[r++],a=127&e[r++];if(o===0&&a===0)continue;if((4&n)!==0){const d=3&n;(d===0||d===1)&&(t[d].push(o),t[d].push(a))}}return t}}function Ho(c){return c.characteristics&&/transcribes-spoken-dialog/gi.test(c.characteristics)&&/describes-music-and-sound/gi.test(c.characteristics)?"captions":"subtitles"}function _a(c,e){return!!c&&c.kind===Ho(e)&&vs(e,c)}function Rh(c,e,t,i){return Math.min(e,i)-Math.max(c,t)}function ya(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Ih=/\s/,wh={newCue(c,e,t,i){const r=[];let s,n,o,a,l;const d=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(s=i.rows[h],o=!0,a=0,l="",!s.isEmpty()){var u;for(let _=0;_<s.chars.length;_++)Ih.test(s.chars[_].uchar)&&o?a++:(l+=s.chars[_].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),a>=16?a--:a++;const f=$o(l.trim()),p=Ys(e,t,f);c!=null&&(u=c.cues)!=null&&u.getCueById(p)||(n=new d(e,t,f),n.id=p,n.line=h+1,n.align="left",n.position=10+Math.min(80,Math.floor(a*8/32)*10),r.push(n))}return c&&r.length&&(r.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),r.forEach(h=>Mo(c,h))),r}};function Dh(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Ch=/(\d+)-(\d+)\/(\d+)/;class va{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Oh,this.controller=new self.AbortController,this.stats=new Is}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=kh(e,this.controller.signal),n=e.responseType==="arraybuffer",o=n?"byteLength":"length",{maxTimeToFirstByteMs:a,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=a&&ge(a)?a:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Ni(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(u=>{var h;this.response=this.loader=u;const f=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},l-(f-r.loading.start)),!u.ok){const{status:_,statusText:y}=u;throw new Bh(y||"fetch, bad network response",_,u)}r.loading.first=f,r.total=Mh(u.headers)||r.total;const p=(h=this.callbacks)==null?void 0:h.onProgress;return p&&ge(t.highWaterMark)?this.loadProgressively(u,r,e,t.highWaterMark,p):n?u.arrayBuffer():e.responseType==="json"?u.json():u.text()}).then(u=>{var h,f;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const _=u[o];_&&(r.loaded=r.total=_);const y={url:p.url,data:u,code:p.status},b=(h=this.callbacks)==null?void 0:h.onProgress;b&&!ge(t.highWaterMark)&&b(r,e,u,p),(f=this.callbacks)==null||f.onSuccess(y,r,e,p)}).catch(u=>{var h;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const f=u&&u.code||0,p=u?u.message:null;(h=this.callbacks)==null||h.onError({code:f,text:p},e,u?u.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const n=new so,o=e.body.getReader(),a=()=>o.read().then(l=>{if(l.done)return n.dataLength&&s(t,i,n.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const d=l.value,u=d.length;return t.loaded+=u,u<r||n.dataLength?(n.push(d),n.dataLength>=r&&s(t,i,n.flush().buffer,e)):s(t,i,d.buffer,e),a()}).catch(()=>Promise.reject());return a()}}function kh(c,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},c.headers))};return c.rangeEnd&&t.headers.set("Range","bytes="+c.rangeStart+"-"+String(c.rangeEnd-1)),t}function Ph(c){const e=Ch.exec(c);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Mh(c){const e=c.get("Content-Range");if(e){const i=Ph(e);if(ge(i))return i}const t=c.get("Content-Length");if(t)return parseInt(t)}function Oh(c,e){return new self.Request(c.url,e)}class Bh extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const Fh=/^age:\s*[\d.]+\s*$/im;class Ko{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Is,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(n=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(n=>{var o;(o=this.callbacks)==null||o.onError({code:i.status,text:n.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:n}=i.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&ge(s)?s:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const l=t.status,d=t.responseType==="text"?t.responseText:null;if(l>=200&&l<300){const p=d??t.response;if(p!=null){var n,o;i.loading.end=Math.max(self.performance.now(),i.loading.first);const _=t.responseType==="arraybuffer"?p.byteLength:p.length;i.loaded=i.total=_,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const y=(n=this.callbacks)==null?void 0:n.onProgress;y&&y(i,e,p,t);const b={url:t.responseURL,data:p,code:l};(o=this.callbacks)==null||o.onSuccess(b,i,e,t);return}}const u=s.loadPolicy.errorRetry,h=i.retry,f={url:e.url,data:void 0,code:l};if(yr(u,h,!1,f))this.retry(u);else{var a;Ne.error(`${l} while loading ${e.url}`),(a=this.callbacks)==null||a.onError({code:l,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(yr(e,t,!0))this.retry(e);else{var i;Ne.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Cs(e,i.retry),i.retry++,Ne.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Fh.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Nh={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Uh=Ge(Ge({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Ko,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:oc,bufferController:Jd,capLevelController:Ks,errorController:fc,fpsController:ju,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:qa,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:Nh},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},$h()),{},{subtitleStreamController:eh,subtitleTrackController:zu,timelineController:Lh,audioStreamController:Wd,audioTrackController:Xd,emeController:mi,cmcdController:$u,contentSteeringController:Vu,interstitialsController:Ju});function $h(){return{cueHandler:wh,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Gh(c,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=As(c),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(n=>{const o=`${n==="level"?"playlist":n}LoadPolicy`,a=e[o]===void 0,l=[];s.forEach(d=>{const u=`${n}Loading${d}`,h=e[u];if(h!==void 0&&a){l.push(u);const f=i[o].default;switch(e[o]={default:f},d){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),l.length&&t.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${We(e[o])}`)}),Ge(Ge({},i),e)}function As(c){return c&&typeof c=="object"?Array.isArray(c)?c.map(As):Object.keys(c).reduce((e,t)=>(e[t]=As(c[t]),e),{}):c}function Vh(c,e){const t=c.loader;t!==va&&t!==Ko?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),c.progressive=!1):Dh()&&(c.loader=va,c.progressive=!0,c.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const lr=2,jh=.1,Hh=.05,Kh=100;class zh extends Ha{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Kh),this.mediaSource=t.mediaSource;const i=this.media=t.media;zt(i,"playing",this.onMediaPlaying),zt(i,"waiting",this.onMediaWaiting),zt(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Bt(i,"playing",this.onMediaPlaying),Bt(i,"waiting",this.onMediaWaiting),Bt(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const s=(i=this.hls)==null?void 0:i.config;if(!s)return;const{media:n,stalled:o}=this;if(!n)return;const{seeking:a}=n,l=this.seeking&&!a,d=!this.seeking&&a,u=n.paused&&!a||n.ended||n.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&n.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!1}));return}if(!Me.getBuffered(n).length){this.nudgeRetry=0;return}const h=Me.bufferInfo(n,e,0),f=h.nextStart||0,p=this.fragmentTracker;if(a&&p&&this.hls){const N=Ea(this.hls.inFlightFragments,e),P=h.len>lr,L=!f||N||f-e>lr&&!p.getPartialFragment(e);if(P||L)return;this.moved=!1}const _=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(h.len>0)&&!f)return;const P=Math.max(f,h.start||0)-e,A=!!(_!=null&&_.live)?_.targetduration*2:lr,x=p.getPartialFragment(e);if(P>0&&(P<=A||x)){n.paused||this._trySkipBufferHole(x);return}}const y=s.detectStallWithCurrentTimeMs,b=self.performance.now(),I=this.waiting;if(o===null){I>0&&b-I<y?this.stalled=I:this.stalled=b;return}const T=b-o;if(!a&&(T>=y||I)&&this.hls){var R;if(((R=this.mediaSource)==null?void 0:R.readyState)==="ended"&&!(_!=null&&_.live)&&Math.abs(e-((_==null?void 0:_.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(C.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const M=Me.bufferInfo(n,e,s.maxBufferHole);this._tryFixBufferStall(M,T)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(C.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const s=Me.bufferedInfo(Me.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const n=Me.timeRangesToArray(r),o=Me.bufferedInfo(n,t,0).bufferedIndex;if(o>-1&&o<n.length-1){const a=Me.bufferedInfo(n,e,0).bufferedIndex,l=n[o].end,d=n[o+1].start;if((a===-1||a>o)&&d-l<1&&e-l<2){const u=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${l} -> ${d} buffered index: ${a}`);this.warn(u.message),this.media.currentTime+=1e-6;const h=this.fragmentTracker.getPartialFragment(e)||void 0,f=Me.bufferInfo(this.media,e,0);this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:u,reason:u.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t){var i,r;const{fragmentTracker:s,media:n}=this,o=(i=this.hls)==null?void 0:i.config;if(!n||!s||!o)return;const a=n.currentTime,l=(r=this.hls)==null?void 0:r.latestLevelDetails,d=s.getPartialFragment(a);if((d||l!=null&&l.live&&a<l.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;const u=e.buffered;(u&&u.length>1&&e.len>o.maxBufferHole||e.nextStart&&e.nextStart-a<o.maxBufferHole)&&(t>o.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;const n=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${We(e)})`);this.warn(n.message),t.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;const n=r.currentTime,o=Me.bufferInfo(r,n,0),a=n<o.start?o.start:o.nextStart;if(a&&this.hls){const d=o.len<=s.maxBufferHole,u=o.len>0&&o.len<1&&r.readyState<3,h=a-n;if(h>0&&(d||u)){if(h>s.maxBufferHole){let p=!1;if(n===0){const _=i.getAppendedFrag(0,Ee.MAIN);_&&a<_.end&&(p=!0)}if(!p){const _=e||i.getAppendedFrag(n,Ee.MAIN);if(_){var l;if(!((l=this.hls.loadLevelObj)!=null&&l.details)||Ea(this.hls.inFlightFragments,a))return 0;let b=!1,I=_.end;for(;I<a;){const T=i.getPartialFragment(I);if(T)I+=T.duration;else{b=!0;break}}if(b)return 0}}}const f=Math.max(a+Hh,n+jh);if(this.warn(`skipping hole, adjusting currentTime from ${n} to ${f}`),this.moved=!0,r.currentTime=f,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${f}`);this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:e||void 0,buffer:o.len,bufferInfo:o})}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!i||!s)return 0;const n=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const o=n+(r+1)*s.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${n} to ${o}`);this.warn(a.message),i.currentTime=o,t.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${n} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ea(c,e){const t=Sa(c.main);if(t&&t.start<=e)return t;const i=Sa(c.audio);return i&&i.start<=e?i:null}function Sa(c){if(!c)return null;switch(c.state){case ne.IDLE:case ne.STOPPED:case ne.ENDED:case ne.ERROR:return null}return c.frag}const qh=.25;function Ls(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ba(c,e,t,i,r){let s=new c(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new c(e,t,We(r?Ge({type:r},i):i))}return s}const tr=(()=>{const c=Ls();try{c&&new c(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Yh(c){return Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Wh{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(C.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(C.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(C.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&fi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return Po(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=Ls();if(n)for(let o=0;o<s.length;o++){const a=s[o].type;if(a===yt.emsg&&!i||!r)continue;const l=fo(s[o].data);if(l){const d=s[o].pts;let u=d+s[o].duration;u>tr&&(u=tr),u-d<=0&&(u=d+qh);for(let f=0;f<l.length;f++){const p=l[f];if(!po(p)){this.updateId3CueEnds(d,a);const _=ba(n,d,u,p,a);_&&this.id3Track.addCue(_)}}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const n=r[s];n.type===t&&n.startTime<e&&n.endTime===tr&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:a}}=n;if(s&&(o||a)){let l;r==="audio"?l=d=>d.type===yt.audioId3&&a:r==="video"?l=d=>d.type===yt.emsg&&o:l=d=>d.type===yt.audioId3&&a||d.type===yt.emsg&&o,bs(s,t,i,l)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:r}=e,s=Object.keys(r);let n=this.dateRangeCuesAppended;if(i&&t){var o;if((o=i.cues)!=null&&o.length){const d=Object.keys(n).filter(u=>!s.includes(u));for(let u=d.length;u--;){const h=d[u],f=n[h].cues;delete n[h],Object.keys(f).forEach(p=>{try{const _=f[p];_.removeEventListener("enter",this.onEventCueEnter),i.removeCue(_)}catch{}})}}else n=this.dateRangeCuesAppended={}}const a=e.fragments[e.fragments.length-1];if(s.length===0||!ge(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Ls();for(let d=0;d<s.length;d++){const u=s[d],h=r[u],f=h.startTime,p=n[u],_=(p==null?void 0:p.cues)||{};let y=(p==null?void 0:p.durationKnown)||!1,b=tr;const{duration:I,endDate:T}=h;if(T&&I!==null)b=f+I,y=!0;else if(h.endOnNext&&!y){const M=s.reduce((N,P)=>{if(P!==h.id){const L=r[P];if(L.class===h.class&&L.startDate>h.startDate&&(!N||h.startDate<N.startDate))return L}return N},null);M&&(b=M.startTime,y=!0)}const R=Object.keys(h.attr);for(let M=0;M<R.length;M++){const N=R[M];if(!Lc(N))continue;const P=_[N];if(P)y&&!p.durationKnown?P.endTime=b:Math.abs(P.startTime-f)>.01&&(P.startTime=f,P.endTime=b);else if(l){let L=h.attr[N];Rc(N)&&(L=Yh(L));const x=ba(l,f,b,{key:N,data:L},yt.dateRange);x&&(x.id=u,this.id3Track.addCue(x),_[N]=x,this.hls.config.interstitialsController&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&x.addEventListener("enter",this.onEventCueEnter))}}n[u]={cues:_,dateRange:h,durationKnown:y}}}}class Xh{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:n}=this.config;if(!s||n===1||!i.live)return;const o=this.targetLatency;if(o===null)return;const a=r-o,l=Math.min(this.maxLatency,o+i.targetduration);if(a<l&&a>.05&&this.forwardBufferLength>1){const u=Math.min(2,Math.max(1,n)),h=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,f=Math.min(u,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:n,lowLatencyMode:o}=this.config,a=this.hls.userConfig;let l=o&&i||t;(this._targetLatencyUpdated||a.liveSyncDuration||a.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:n*r);const d=r;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,s=e-t-this.edgeStalled,n=r-i.totalduration,o=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(C.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(C.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(C.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===J.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class Qh extends Hs{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this),e.on(C.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this),e.off(C.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],s={},n={};let o=!1,a=!1,l=!1;t.levels.forEach(d=>{var u;const h=d.attrs;let{audioCodec:f,videoCodec:p}=d;f&&(d.audioCodec=f=pr(f,i)||void 0),((u=p)==null?void 0:u.indexOf("avc1"))===0&&(p=d.videoCodec=ql(p));const{width:_,height:y,unknownCodecs:b}=d;let I=b?b.length:0;if(b)for(let k=I;k--;){const U=b[k];this.isAudioSupported(U)?(d.audioCodec=f=f?`${f},${U}`:U,I--,vi.audio[f.substring(0,4)]=2):this.isVideoSupported(U)&&(d.videoCodec=p=p?`${p},${U}`:U,I--,vi.video[p.substring(0,4)]=2)}if(o||(o=!!(_&&y)),a||(a=!!p),l||(l=!!f),I||f&&!this.isAudioSupported(f)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:T,"FRAME-RATE":R,"HDCP-LEVEL":M,"PATHWAY-ID":N,RESOLUTION:P,"VIDEO-RANGE":L}=h,x=`${`${N||"."}-`}${d.bitrate}-${P}-${R}-${T}-${L}-${M}`;if(s[x])if(s[x].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const k=n[x]+=1;d.attrs["PATHWAY-ID"]=new Array(k+1).join(".");const U=this.createLevel(d);s[x]=U,r.push(U)}else s[x].addGroupId("audio",h.AUDIO),s[x].addGroupId("text",h.SUBTITLES);else{const k=this.createLevel(d);s[x]=k,n[x]=1,r.push(k)}}),this.filterAndSortMediaOptions(r,t,o,a,l)}createLevel(e){const t=new Pi(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=$a(r,[])}return t}isAudioSupported(e){return us(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return us(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){let n=[],o=[],a=e;if((i||r)&&s&&(a=a.filter(({videoCodec:y,videoRange:b,width:I,height:T})=>(!!y||!!(I&&T))&&Zl(b))),a.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",b=y;t.levels.length&&(b=`one or more CODECS in variant not supported: ${We(t.levels.map(T=>T.attrs.CODECS).filter((T,R,M)=>M.indexOf(T)===R))}`,this.warn(b),y+=` (${b})`);const I=new Error(y);this.hls.trigger(C.ERROR,{type:Se.MEDIA_ERROR,details:J.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:I,reason:b})}});return}t.audioTracks&&(n=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),Ta(n)),t.subtitles&&(o=t.subtitles,Ta(o));const l=a.slice(0);a.sort((y,b)=>{if(y.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&y.height!==b.height)return y.height-b.height;if(y.frameRate!==b.frameRate)return y.frameRate-b.frameRate;if(y.videoRange!==b.videoRange)return mr.indexOf(y.videoRange)-mr.indexOf(b.videoRange);if(y.videoCodec!==b.videoCodec){const I=gn(y.videoCodec),T=gn(b.videoCodec);if(I!==T)return T-I}if(y.uri===b.uri&&y.codecSet!==b.codecSet){const I=fr(y.codecSet),T=fr(b.codecSet);if(I!==T)return T-I}return y.averageBitrate!==b.averageBitrate?y.averageBitrate-b.averageBitrate:0});let d=l[0];if(this.steering&&(a=this.steering.filterParsedLevels(a),a.length!==l.length)){for(let y=0;y<l.length;y++)if(l[y].pathwayId===a[0].pathwayId){d=l[y];break}}this._levels=a;for(let y=0;y<a.length;y++)if(a[y]===d){var u;this._firstLevel=y;const b=d.bitrate,I=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${a.length} level(s) found, first bitrate: ${b}`),((u=this.hls.userConfig)==null?void 0:u.abrEwmaDefaultEstimate)===void 0){const T=Math.min(b,this.hls.config.abrEwmaDefaultEstimateMax);T>I&&I===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const h=s&&!r,f=this.hls.config,p=!!(f.audioStreamController&&f.audioTrackController),_={levels:a,audioTracks:n,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:p&&!h&&n.some(y=>!!y.url)};this.hls.trigger(C.MANIFEST_PARSED,_)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const d=new Error("invalid level idx"),u=e<0;if(this.hls.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.LEVEL_SWITCH_ERROR,level:e,fatal:u,error:d,reason:d.message}),u)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,n=t[e],o=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,i===e&&r&&s===o)return;this.log(`Switching to level ${e} (${n.height?n.height+"p ":""}${n.videoRange?n.videoRange+" ":""}${n.codecSet?n.codecSet+" ":""}@${n.bitrate})${o?" with Pathway "+o:""} from level ${i}${s?" with Pathway "+s:""}`);const a={level:e,attrs:n.attrs,details:n.details,bitrate:n.bitrate,averageBitrate:n.averageBitrate,maxBitrate:n.maxBitrate,realBitrate:n.realBitrate,width:n.width,height:n.height,codecSet:n.codecSet,audioCodec:n.audioCodec,videoCodec:n.videoCodec,audioGroups:n.audioGroups,subtitleGroups:n.subtitleGroups,loaded:n.loaded,loadError:n.loadError,fragmentError:n.fragmentError,name:n.name,id:n.id,uri:n.uri,url:n.url,urlId:0,audioGroupIds:n.audioGroupIds,textGroupIds:n.textGroupIds};this.hls.trigger(C.LEVEL_SWITCHING,a);const l=n.details;if(!l||l.live){const d=this.switchParams(n.uri,r==null?void 0:r.details,l);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Be.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ee.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,n=t.levelInfo;if(!n){var o;this.warn(`Invalid level index ${r}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(n===this.currentLevel||t.withoutMultiVariant){n.fragmentError===0&&(n.loadError=0);let a=n.details;a===t.details&&a.advanced&&(a=void 0),this.playlistLoaded(r,t,a)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],n=e.details,o=n==null?void 0:n.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&n.live?" age "+o.toFixed(1)+(n.type&&" "+n.type||""):""} ${i}`),this.hls.trigger(C.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((s,n)=>n!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));to(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(C.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(C.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Ta(c){const e={};c.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function zo(){return self.SourceBuffer||self.WebKitSourceBuffer}function qo(){if(!Jt())return!1;const e=zo();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Zh(){if(!qo())return!1;const c=Jt();return typeof(c==null?void 0:c.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>c.isTypeSupported(ki(e,"video")))||["mp4a.40.2","fLaC"].some(e=>c.isTypeSupported(ki(e,"audio"))))}function Jh(){var c;const e=zo();return typeof(e==null||(c=e.prototype)==null?void 0:c.changeType)=="function"}const ef=100;class tf extends Bs{constructor(e,t,i){super(e,t,i,"stream-controller",Ee.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!ge(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const n=this.getFwdBufferInfoAtPos(r,s,Ee.MAIN,0);if(n===null||n.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${n?n.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(C.MANIFEST_PARSED,this.onManifestParsed,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(C.BUFFER_CREATED,this.onBufferCreated,this),e.on(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(C.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(C.MANIFEST_PARSED,this.onManifestParsed,this),e.off(C.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(C.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(C.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(C.BUFFER_CREATED,this.onBufferCreated,this),e.off(C.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(C.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(ef),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ne.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ne.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ne.WAITING_LEVEL:{const{levels:t,level:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=ne.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ne.IDLE;break}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,level:s}=this,n=r==null?void 0:r[s];this.resetStartWhenNotLoaded(n||null),this.state=ne.IDLE}}break}this.state===ne.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;const n=i[s],o=this.getMainFwdBufferInfo();if(o===null)return;const a=this.getLevelDetails();if(a&&this._streamEnded(o,a)){const _={};this.altAudio===2&&(_.type="video"),this.hls.trigger(C.BUFFER_EOS,_),this.state=ne.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const l=n.details;if(!l||this.state===ne.WAITING_LEVEL||this.waitForLive(n)){this.level=s,this.state=ne.WAITING_LEVEL,this.startFragRequested=!1;return}const d=o.len,u=this.getMaxBufferLength(n.maxBitrate);if(d>=u)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&f&&at(f)&&this.fragmentTracker.getState(f)!==rt.OK){var p;const y=((p=this.backtrackFragment)!=null?p:f).sn-l.startSN,b=l.fragments[y-1];b&&f.cc===b.cc&&(f=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const y=this.audioOnly&&!this.altAudio?He.AUDIO:He.VIDEO,b=(y===He.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,y,Ee.MAIN)}f=this.getNextFragmentLoopLoading(f,l,o,Ee.MAIN,u)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,n,h))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===rt.NOT_LOADED||r===rt.PARTIAL?at(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ee.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,a=e[o],l=this.fragLastKbps;l&&this.fragCurrent?i=this.fragCurrent.duration*a.maxBitrate/(1e3*l)+1:i=0}else i=0;const n=this.getBufferedFrag(t.currentTime+i);if(n){const o=this.followingBufferedFrag(n);if(o){this.abortCurrentFrag();const a=o.maxStartPTS?o.maxStartPTS:o.start,l=o.duration,d=Math.max(n.end,a+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ne.KEY_LOADING:case ne.FRAG_LOADING:case ne.FRAG_LOADING_WAITING_RETRY:case ne.PARSING:case ne.PARSED:this.state=ne.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;zt(i,"playing",this.onMediaPlaying),zt(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Bt(i,"playing",this.onMediaPlaying),Bt(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;t.levels.forEach(s=>{const n=s.audioCodec;n&&(i=i||n.indexOf("mp4a.40.2")!==-1,r=r||n.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&r&&!Jh(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ne.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=ne.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:s}=this,n=t.level,o=t.details,a=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${n}`);return}this.log(`Level ${n} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=t.levelInfo,d=this.fragCurrent;d&&(this.state===ne.FRAG_LOADING||this.state===ne.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let u=0;if(o.live||(i=l.details)!=null&&i.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,l.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(l.details=o,this.levelLastLoaded=l,s||this.setStartPosition(o,u),this.hls.trigger(C.LEVEL_UPDATED,{details:o,level:n}),this.state===ne.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=ne.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),n=e.fragmentStart,o=e.edge,a=s>=n-t.maxFragLookUpTolerance&&s<=o;if(r!==null&&i.duration>r&&(s<r||!a)){const l=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!a&&i.readyState<4||s<o-l)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{levels:n}=this;if(!n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=n[i.level];if(!o){this.warn(`Level ${i.level} not found on progress`);return}const a=o.details;if(!a){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const l=o.videoCodec,d=a.PTSKnown||!a.live,u=(t=i.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Ao(this.hls,Ee.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,_=p!==-1,y=new Ps(i.level,i.sn,i.stats.chunkCount,s.byteLength,p,_),b=this.initPTS[i.cc];f.push(s,u,h,l,i,r,a.totalduration,d,y,b)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio===2;if(gr(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(C.BUFFER_FLUSHED,()=>{var n;(n=this.hls)==null||n.trigger(C.AUDIO_TRACK_SWITCHED,t)}),i.trigger(C.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(C.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=gr(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,n=!1;for(const o in i){const a=i[o];if(a.id==="main"){if(s=o,r=a,o==="video"){const l=i[o];l&&(this.videoBuffer=l.buffer)}}else n=!0}n&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,s=i.type===Ee.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ne.PARSED&&(this.state=ne.IDLE);return}const o=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),at(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const n=this.media;n&&(!this._hasEnoughToStart&&Me.getBuffered(n).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case J.FRAG_GAP:case J.FRAG_PARSING_ERROR:case J.FRAG_DECRYPT_ERROR:case J.FRAG_LOAD_ERROR:case J.FRAG_LOAD_TIMEOUT:case J.KEY_LOAD_ERROR:case J.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.MAIN,t);break;case J.LEVEL_LOAD_ERROR:case J.LEVEL_LOAD_TIMEOUT:case J.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Be.LEVEL&&(this.state=ne.IDLE);break;case J.BUFFER_ADD_CODEC_ERROR:case J.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case J.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case J.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ne.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==He.AUDIO||!this.altAudio){const i=(t===He.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,Ee.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),n=Me.getBuffered(e),o=n.length?n.start(0):0,a=o-i,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);a>0&&(a<l||this.loadingParts&&a<2*((s==null?void 0:s.partTarget)||0))&&(this.log(`adjusting start position by ${a} to match buffer start`),i+=a,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${o}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=ne.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const n=s.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),r.trigger(C.FRAG_LOADED,i),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:n}=e,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:a,part:l,level:d}=o,{video:u,text:h,id3:f,initSegment:p}=s,{details:_}=d,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=ne.PARSING,p){if(p!=null&&p.tracks){const T=a.initSegment||a;this._bufferInitSegment(d,p.tracks,T,n),r.trigger(C.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:p.tracks})}const b=p.initPTS,I=p.timescale;ge(b)&&(this.initPTS[a.cc]={baseTime:b,timescale:I},r.trigger(C.INIT_PTS_FOUND,{frag:a,id:i,initPTS:b,timescale:I}))}if(u&&_){y&&u.type==="audiovideo"&&this.logMuxedErr(a);const b=_.fragments[a.sn-1-_.startSN],I=a.sn===_.startSN,T=!b||a.cc>b.cc;if(s.independent!==!1){const{startPTS:R,endPTS:M,startDTS:N,endDTS:P}=u;if(l)l.elementaryStreams[u.type]={startPTS:R,endPTS:M,startDTS:N,endDTS:P};else if(u.firstKeyFrame&&u.independent&&n.id===1&&!T&&(this.couldBacktrack=!0),u.dropped&&u.independent){const L=this.getMainFwdBufferInfo(),A=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,x=u.firstKeyFramePTS?u.firstKeyFramePTS:R;if(!I&&A<x-this.config.maxBufferHole&&!T){this.backtrack(a);return}else T&&(a.gap=!0);a.setElementaryStreamInfo(u.type,a.start,M,a.start,P,!0)}else I&&R-(_.appliedTimelineOffset||0)>lr&&(a.gap=!0);a.setElementaryStreamInfo(u.type,R,M,N,P),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,l,n,I||T)}else if(I||T)a.gap=!0;else{this.backtrack(a);return}}if(y){const{startPTS:b,endPTS:I,startDTS:T,endDTS:R}=y;l&&(l.elementaryStreams[He.AUDIO]={startPTS:b,endPTS:I,startDTS:T,endDTS:R}),a.setElementaryStreamInfo(He.AUDIO,b,I,T,R),this.bufferFragmentData(y,a,l,n)}if(_&&f!=null&&(t=f.samples)!=null&&t.length){const b={id:i,frag:a,details:_,samples:f.samples};r.trigger(C.FRAG_PARSING_METADATA,b)}if(_&&h){const b={id:i,frag:a,details:_,samples:h.samples};r.trigger(C.FRAG_PARSING_USERDATA,b)}}logMuxedErr(e){this.warn(`${at(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==ne.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:s,video:n,audiovideo:o}=t;if(s){let l=ir(s.codec,e.audioCodec);l==="mp4a"&&(l="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const u=s.metadata;u&&"channelCount"in u&&(u.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id=Ee.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(n){n.levelCodec=e.videoCodec,n.id=Ee.MAIN;const l=n.codec;if((l==null?void 0:l.length)===4)switch(l){case"hvc1":case"hev1":n.codec="hvc1.1.6.L120.90";break;case"av01":n.codec="av01.0.04M.08";break;case"avc1":n.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${l}]${n.codec!==l?" parsed-corrected="+n.codec:""}${n.supplemental?" supplemental="+n.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const a=Object.keys(t);if(a.length){if(this.hls.trigger(C.BUFFER_CODECS,t),!this.hls)return;a.forEach(l=>{const u=t[l].initSegment;u!=null&&u.byteLength&&this.hls.trigger(C.BUFFER_APPENDING,{type:l,data:u,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ee.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ne.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Me.isBuffered(e,i)?t=this.getAppendedFrag(i):Me.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(C.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(C.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ge(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ge(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?ni(null,i.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const n=s+(t-r.start)*1e3;return new Date(n)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class rf{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=J.KEY_LOAD_ERROR,i,r,s){return new Ht({type:Se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:r}=e;for(let s=0;s<t.length;s++){const n=t[s];if(r<=n.cc&&(i==="initSegment"||n.sn==="initSegment"||i<n.sn)){this.emeController.selectKeySystemFormat(n).then(o=>{n.setKeyFormat(o)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const l=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,J.KEY_LOAD_ERROR,l))}const n=s.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,J.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let o=this.keyUriToKeyInfo[n];if((i=o)!=null&&i.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((r=o)!=null&&r.keyLoadPromise){var a;switch((a=o.mediaKeySessionContext)==null?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(l=>(s.key=l.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[n]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,J.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,i))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((n,o)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=i.keyLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(h,f,p,_)=>{const{frag:y,keyInfo:b,url:I}=p;if(!y.decryptdata||b!==this.keyUriToKeyInfo[I])return o(this.createKeyLoadError(y,J.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),_));b.decryptdata.key=y.decryptdata.key=new Uint8Array(h.data),y.keyLoader=null,b.loader=null,n({frag:y,keyInfo:b})},onError:(h,f,p,_)=>{this.resetLoader(f),o(this.createKeyLoadError(t,J.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),p,Ge({url:a.url,data:void 0},h)))},onTimeout:(h,f,p)=>{this.resetLoader(f),o(this.createKeyLoadError(t,J.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(h,f,p)=>{this.resetLoader(f),o(this.createKeyLoadError(t,J.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(a,d,u)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}function xa(c){const{type:e}=c;switch(e){case Be.AUDIO_TRACK:return Ee.AUDIO;case Be.SUBTITLE_TRACK:return Ee.SUBTITLE;default:return Ee.MAIN}}function ls(c,e){let t=c.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class sf{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(C.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.LEVEL_LOADING,this.onLevelLoading,this),e.on(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(C.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(C.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.LEVEL_LOADING,this.onLevelLoading,this),e.off(C.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(C.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(C.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,n=new s(t);return this.loaders[e.type]=n,n}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Be.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:s,url:n,deliveryDirectives:o,levelInfo:a}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:Be.LEVEL,url:n,deliveryDirectives:o,levelOrTrack:a})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:n,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:Be.AUDIO_TRACK,url:s,deliveryDirectives:n,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:n,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:Be.SUBTITLE_TRACK,url:s,deliveryDirectives:n,levelOrTrack:o})}onLevelsUpdated(e,t){const i=this.loaders[Be.LEVEL];if(i){const r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[Be.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const l=this.hls.logger,d=r.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?l.log(`[playlist-loader]: ignore ${e.url} ongoing request`):l.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}l.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===Be.MANIFEST?s=i.manifestLoadPolicy.default:s=Ke({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),ge((t=e.deliveryDirectives)==null?void 0:t.part)){let l;if(e.type===Be.LEVEL&&e.level!==null?l=this.hls.levels[e.level].details:e.type===Be.AUDIO_TRACK&&e.id!==null?l=this.hls.audioTracks[e.id].details:e.type===Be.SUBTITLE_TRACK&&e.id!==null&&(l=this.hls.subtitleTracks[e.id].details),l){const d=l.partTarget,u=l.targetduration;if(d&&u){const h=Math.max(d*3,u*.8)*1e3;s=Ke({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const n=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},a={onSuccess:(l,d,u,h)=>{const f=this.getInternalLoader(u);this.resetInternalLoader(u.type);const p=l.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,u,new Error("no EXTM3U delimiter"),h||null,d);return}d.parsing.start=performance.now(),Ot.isMediaPlaylist(p)||u.type!==Be.MANIFEST?this.handleTrackOrLevelPlaylist(l,d,u,h||null,f):this.handleMasterPlaylist(l,d,u,h)},onError:(l,d,u,h)=>{this.handleNetworkError(d,u,!1,l,h)},onTimeout:(l,d,u)=>{this.handleNetworkError(d,u,!0,void 0,l)}};r.load(e,o,a)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const s=this.hls,n=e.data,o=ls(e,i),a=Ot.parseMasterPlaylist(n,o);if(a.playlistParsingError){this.handleManifestParsingError(e,i,a.playlistParsingError,r,t);return}const{contentSteering:l,levels:d,sessionData:u,sessionKeys:h,startTimeOffset:f,variableList:p}=a;this.variableList=p;const{AUDIO:_=[],SUBTITLES:y,"CLOSED-CAPTIONS":b}=Ot.parseMasterPlaylistMedia(n,o,a);_.length&&!_.some(T=>!T.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Xe({}),bitrate:0,url:""})),s.trigger(C.MANIFEST_LOADED,{levels:d,audioTracks:_,subtitles:y,captions:b,contentSteering:l,url:o,stats:t,networkDetails:r,sessionData:u,sessionKeys:h,startTimeOffset:f,variableList:p})}handleTrackOrLevelPlaylist(e,t,i,r,s){const n=this.hls,{id:o,level:a,type:l}=i,d=ls(e,i),u=ge(a)?a:ge(o)?o:0,h=xa(i),f=Ot.parseLevelPlaylist(e.data,d,u,h,0,this.variableList);if(l===Be.MANIFEST){const p={attrs:new Xe({}),bitrate:0,details:f,name:"",url:d};f.requestScheduled=t.loading.start+Za(f,0),n.trigger(C.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(C.ERROR,{type:Se.NETWORK_ERROR,details:J.MANIFEST_PARSING_ERROR,fatal:t.type===Be.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let n=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Be.LEVEL?n+=`: ${e.level} id: ${e.id}`:(e.type===Be.AUDIO_TRACK||e.type===Be.SUBTITLE_TRACK)&&(n+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(n);this.hls.logger.warn(`[playlist-loader]: ${n}`);let a=J.UNKNOWN,l=!1;const d=this.getInternalLoader(e);switch(e.type){case Be.MANIFEST:a=i?J.MANIFEST_LOAD_TIMEOUT:J.MANIFEST_LOAD_ERROR,l=!0;break;case Be.LEVEL:a=i?J.LEVEL_LOAD_TIMEOUT:J.LEVEL_LOAD_ERROR,l=!1;break;case Be.AUDIO_TRACK:a=i?J.AUDIO_TRACK_LOAD_TIMEOUT:J.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Be.SUBTITLE_TRACK:a=i?J.SUBTITLE_TRACK_LOAD_TIMEOUT:J.SUBTITLE_LOAD_ERROR,l=!1;break}d&&this.resetInternalLoader(e.type);const u={type:Se.NETWORK_ERROR,details:a,fatal:l,url:e.url,loader:d,context:e,error:o,networkDetails:t,stats:s};if(r){const h=(t==null?void 0:t.url)||e.url;u.response=Ge({url:h,data:void 0},r)}this.hls.trigger(C.ERROR,u)}handlePlaylistLoaded(e,t,i,r,s,n){const o=this.hls,{type:a,level:l,id:d,groupId:u,deliveryDirectives:h}=r,f=ls(t,r),p=xa(r),_=typeof r.level=="number"&&p===Ee.MAIN?l:void 0;if(!e.fragments.length){const b=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(C.ERROR,{type:Se.NETWORK_ERROR,details:J.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:b,reason:b.message,response:t,context:r,level:_,parent:p,networkDetails:s,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(y),!o.config.ignorePlaylistParsingErrors){o.trigger(C.ERROR,{type:Se.NETWORK_ERROR,details:J.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:t,context:r,level:_,parent:p,networkDetails:s,stats:i});return}e.playlistParsingError=null}switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),a){case Be.MANIFEST:case Be.LEVEL:o.trigger(C.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||o.levels[0],level:_||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:a===Be.MANIFEST});break;case Be.AUDIO_TRACK:o.trigger(C.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:d||0,groupId:u||"",stats:i,networkDetails:s,deliveryDirectives:h});break;case Be.SUBTITLE_TRACK:o.trigger(C.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:d||0,groupId:u||"",stats:i,networkDetails:s,deliveryDirectives:h});break}}}class It{static get version(){return Bi}static isMSESupported(){return qo()}static isSupported(){return Zh()}static getMediaSource(){return Jt()}static get Events(){return C}static get MetadataSchema(){return yt}static get ErrorTypes(){return Se}static get ErrorDetails(){return J}static get DefaultConfig(){return It.defaultConfig?It.defaultConfig:Uh}static set DefaultConfig(e){It.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Fs,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=bl(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=Gh(It.DefaultConfig,e,t);this.userConfig=e,i.progressive&&Vh(i,t);const{abrController:r,bufferController:s,capLevelController:n,errorController:o,fpsController:a}=i,l=new o(this),d=this.abrController=new r(this),u=new pc(this),h=i.interstitialsController,f=h?this.interstitialsController=new h(this,It):null,p=this.bufferController=new s(this,u),_=this.capLevelController=new n(this),y=new a(this),b=new sf(this),I=i.contentSteeringController,T=I?new I(this):null,R=this.levelController=new Qh(this,T),M=new Wh(this),N=new rf(this.config),P=this.streamController=new tf(this,u,N),L=this.gapController=new zh(this,u);_.setStreamController(P),y.setStreamController(P);const A=[b,R,P];f&&A.splice(1,0,f),T&&A.splice(1,0,T),this.networkControllers=A;const x=[d,p,L,_,y,M,u];this.audioTrackController=this.createController(i.audioTrackController,A);const k=i.audioStreamController;k&&A.push(this.audioStreamController=new k(this,u,N)),this.subtitleTrackController=this.createController(i.subtitleTrackController,A);const U=i.subtitleStreamController;U&&A.push(this.subtititleStreamController=new U(this,u,N)),this.createController(i.timelineController,x),N.emeController=this.emeController=this.createController(i.emeController,x),this.cmcdController=this.createController(i.cmcdController,x),this.latencyController=this.createController(Xh,x),this.coreComponents=x,A.push(l);const K=l.onErrorOut;typeof K=="function"&&this.on(C.ERROR,K,l),this.on(C.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===C.ERROR;this.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(C.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(C.ERROR,{type:Se.OTHER_ERROR,details:J.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(C.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(C.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(C.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=Rs.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(C.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Ee.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Ee.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ee.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=hd()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ql(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let s=r;s--;){const n=e[s].attrs["HDCP-LEVEL"];if(n&&n<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=Va(t);return Ga(e,i,navigator.mediaCapabilities)}}It.defaultConfig=void 0;var Yo={exports:{}};(function(c,e){(function(t,i){c.exports=i()})(window,function(){return function(t){var i={};function r(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=i,r.d=function(s,n,o){r.o(s,n)||Object.defineProperty(s,n,{enumerable:!0,get:o})},r.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,n){if(1&n&&(s=r(s)),8&n||4&n&&typeof s=="object"&&s&&s.__esModule)return s;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:s}),2&n&&typeof s!="string")for(var a in s)r.d(o,a,(function(l){return s[l]}).bind(null,a));return o},r.n=function(s){var n=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(n,"a",n),n},r.o=function(s,n){return Object.prototype.hasOwnProperty.call(s,n)},r.p="",r(r.s=20)}([function(t,i,r){var s=r(9),n=r.n(s),o=function(){function a(){}return a.e=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var u="[".concat(l,"] > ").concat(d);a.ENABLE_CALLBACK&&a.emitter.emit("log","error",u),a.ENABLE_ERROR&&(console.error?console.error(u):console.warn?console.warn(u):console.log(u))},a.i=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var u="[".concat(l,"] > ").concat(d);a.ENABLE_CALLBACK&&a.emitter.emit("log","info",u),a.ENABLE_INFO&&(console.info?console.info(u):console.log(u))},a.w=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var u="[".concat(l,"] > ").concat(d);a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",u),a.ENABLE_WARN&&(console.warn?console.warn(u):console.log(u))},a.d=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var u="[".concat(l,"] > ").concat(d);a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",u),a.ENABLE_DEBUG&&(console.debug?console.debug(u):console.log(u))},a.v=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var u="[".concat(l,"] > ").concat(d);a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",u),a.ENABLE_VERBOSE&&console.log(u)},a}();o.GLOBAL_TAG="mpegts.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new n.a,i.a=o},function(t,i,r){var s;(function(n){n.IO_ERROR="io_error",n.DEMUX_ERROR="demux_error",n.INIT_SEGMENT="init_segment",n.MEDIA_SEGMENT="media_segment",n.LOADING_COMPLETE="loading_complete",n.RECOVERED_EARLY_EOF="recovered_early_eof",n.MEDIA_INFO="media_info",n.METADATA_ARRIVED="metadata_arrived",n.SCRIPTDATA_ARRIVED="scriptdata_arrived",n.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",n.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",n.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",n.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",n.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",n.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",n.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",n.STATISTICS_INFO="statistics_info",n.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(s||(s={})),i.a=s},function(t,i,r){r.d(i,"c",function(){return n}),r.d(i,"b",function(){return o}),r.d(i,"a",function(){return a});var s=r(3),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function l(d){this._type=d||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return l.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},l.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(d){this._onContentLengthKnown=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(d){this._onURLRedirect=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(d){this._onDataArrival=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onError",{get:function(){return this._onError},set:function(d){this._onError=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onComplete",{get:function(){return this._onComplete},set:function(d){this._onComplete=d},enumerable:!1,configurable:!0}),l.prototype.open=function(d,u){throw new s.c("Unimplemented abstract function!")},l.prototype.abort=function(){throw new s.c("Unimplemented abstract function!")},l}()},function(t,i,r){r.d(i,"d",function(){return o}),r.d(i,"a",function(){return a}),r.d(i,"b",function(){return l}),r.d(i,"c",function(){return d});var s,n=(s=function(u,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,p){f.__proto__=p}||function(f,p){for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(f[_]=p[_])})(u,h)},function(u,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function f(){this.constructor=u}s(u,h),u.prototype=h===null?Object.create(h):(f.prototype=h.prototype,new f)}),o=function(){function u(h){this._message=h}return Object.defineProperty(u.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),u.prototype.toString=function(){return this.name+": "+this.message},u}(),a=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),h}(o),l=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),h}(o),d=function(u){function h(f){return u.call(this,f)||this}return n(h,u),Object.defineProperty(h.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),h}(o)},function(t,i,r){var s;(function(n){n.ERROR="error",n.LOADING_COMPLETE="loading_complete",n.RECOVERED_EARLY_EOF="recovered_early_eof",n.MEDIA_INFO="media_info",n.METADATA_ARRIVED="metadata_arrived",n.SCRIPTDATA_ARRIVED="scriptdata_arrived",n.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",n.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",n.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",n.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",n.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",n.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",n.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",n.STATISTICS_INFO="statistics_info",n.DESTROYING="destroying"})(s||(s={})),i.a=s},function(t,i,r){var s={};(function(){var n=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(n)||/(opr)[\/]([\w.]+)/.exec(n)||/(chrome)[ \/]([\w.]+)/.exec(n)||/(iemobile)[\/]([\w.]+)/.exec(n)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(n)||[],a=/(ipad)/.exec(n)||/(ipod)/.exec(n)||/(windows phone)/.exec(n)||/(iphone)/.exec(n)||/(kindle)/.exec(n)||/(android)/.exec(n)||/(windows)/.exec(n)||/(mac)/.exec(n)||/(linux)/.exec(n)||/(cros)/.exec(n)||[],l={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:a[0]||""},d={};if(l.browser){d[l.browser]=!0;var u=l.majorVersion.split(".");d.version={major:parseInt(l.majorVersion,10),string:l.version},u.length>1&&(d.version.minor=parseInt(u[1],10)),u.length>2&&(d.version.build=parseInt(u[2],10))}l.platform&&(d[l.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),(d.rv||d.iemobile)&&(d.rv&&delete d.rv,l.browser="msie",d.msie=!0),d.edge&&(delete d.edge,l.browser="msedge",d.msedge=!0),d.opr&&(l.browser="opera",d.opera=!0),d.safari&&d.android&&(l.browser="android",d.android=!0);for(var h in d.name=l.browser,d.platform=l.platform,s)s.hasOwnProperty(h)&&delete s[h];Object.assign(s,d)})(),i.a=s},function(t,i,r){i.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,i,r){var s;(function(n){n.ERROR="error",n.SOURCE_OPEN="source_open",n.UPDATE_END="update_end",n.BUFFER_FULL="buffer_full",n.START_STREAMING="start_streaming",n.END_STREAMING="end_streaming"})(s||(s={})),i.a=s},function(t,i,r){var s=r(9),n=r.n(s),o=r(0),a=function(){function l(){}return Object.defineProperty(l,"forceGlobalTag",{get:function(){return o.a.FORCE_GLOBAL_TAG},set:function(d){o.a.FORCE_GLOBAL_TAG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"globalTag",{get:function(){return o.a.GLOBAL_TAG},set:function(d){o.a.GLOBAL_TAG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableAll",{get:function(){return o.a.ENABLE_VERBOSE&&o.a.ENABLE_DEBUG&&o.a.ENABLE_INFO&&o.a.ENABLE_WARN&&o.a.ENABLE_ERROR},set:function(d){o.a.ENABLE_VERBOSE=d,o.a.ENABLE_DEBUG=d,o.a.ENABLE_INFO=d,o.a.ENABLE_WARN=d,o.a.ENABLE_ERROR=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableDebug",{get:function(){return o.a.ENABLE_DEBUG},set:function(d){o.a.ENABLE_DEBUG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableVerbose",{get:function(){return o.a.ENABLE_VERBOSE},set:function(d){o.a.ENABLE_VERBOSE=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableInfo",{get:function(){return o.a.ENABLE_INFO},set:function(d){o.a.ENABLE_INFO=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableWarn",{get:function(){return o.a.ENABLE_WARN},set:function(d){o.a.ENABLE_WARN=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableError",{get:function(){return o.a.ENABLE_ERROR},set:function(d){o.a.ENABLE_ERROR=d,l._notifyChange()},enumerable:!1,configurable:!0}),l.getConfig=function(){return{globalTag:o.a.GLOBAL_TAG,forceGlobalTag:o.a.FORCE_GLOBAL_TAG,enableVerbose:o.a.ENABLE_VERBOSE,enableDebug:o.a.ENABLE_DEBUG,enableInfo:o.a.ENABLE_INFO,enableWarn:o.a.ENABLE_WARN,enableError:o.a.ENABLE_ERROR,enableCallback:o.a.ENABLE_CALLBACK}},l.applyConfig=function(d){o.a.GLOBAL_TAG=d.globalTag,o.a.FORCE_GLOBAL_TAG=d.forceGlobalTag,o.a.ENABLE_VERBOSE=d.enableVerbose,o.a.ENABLE_DEBUG=d.enableDebug,o.a.ENABLE_INFO=d.enableInfo,o.a.ENABLE_WARN=d.enableWarn,o.a.ENABLE_ERROR=d.enableError,o.a.ENABLE_CALLBACK=d.enableCallback},l._notifyChange=function(){var d=l.emitter;if(d.listenerCount("change")>0){var u=l.getConfig();d.emit("change",u)}},l.registerListener=function(d){l.emitter.addListener("change",d)},l.removeListener=function(d){l.emitter.removeListener("change",d)},l.addLogListener=function(d){o.a.emitter.addListener("log",d),o.a.emitter.listenerCount("log")>0&&(o.a.ENABLE_CALLBACK=!0,l._notifyChange())},l.removeLogListener=function(d){o.a.emitter.removeListener("log",d),o.a.emitter.listenerCount("log")===0&&(o.a.ENABLE_CALLBACK=!1,l._notifyChange())},l}();a.emitter=new n.a,i.a=a},function(t,i,r){var s,n=typeof Reflect=="object"?Reflect:null,o=n&&typeof n.apply=="function"?n.apply:function(R,M,N){return Function.prototype.apply.call(R,M,N)};s=n&&typeof n.ownKeys=="function"?n.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var a=Number.isNaN||function(R){return R!=R};function l(){l.init.call(this)}t.exports=l,t.exports.once=function(R,M){return new Promise(function(N,P){function L(x){R.removeListener(M,A),P(x)}function A(){typeof R.removeListener=="function"&&R.removeListener("error",L),N([].slice.call(arguments))}T(R,M,A,{once:!0}),M!=="error"&&function(x,k,U){typeof x.on=="function"&&T(x,"error",k,U)}(R,L,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var d=10;function u(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function h(R){return R._maxListeners===void 0?l.defaultMaxListeners:R._maxListeners}function f(R,M,N,P){var L,A,x,k;if(u(N),(A=R._events)===void 0?(A=R._events=Object.create(null),R._eventsCount=0):(A.newListener!==void 0&&(R.emit("newListener",M,N.listener?N.listener:N),A=R._events),x=A[M]),x===void 0)x=A[M]=N,++R._eventsCount;else if(typeof x=="function"?x=A[M]=P?[N,x]:[x,N]:P?x.unshift(N):x.push(N),(L=h(R))>0&&x.length>L&&!x.warned){x.warned=!0;var U=new Error("Possible EventEmitter memory leak detected. "+x.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");U.name="MaxListenersExceededWarning",U.emitter=R,U.type=M,U.count=x.length,k=U,console&&console.warn&&console.warn(k)}return R}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(R,M,N){var P={fired:!1,wrapFn:void 0,target:R,type:M,listener:N},L=p.bind(P);return L.listener=N,P.wrapFn=L,L}function y(R,M,N){var P=R._events;if(P===void 0)return[];var L=P[M];return L===void 0?[]:typeof L=="function"?N?[L.listener||L]:[L]:N?function(A){for(var x=new Array(A.length),k=0;k<x.length;++k)x[k]=A[k].listener||A[k];return x}(L):I(L,L.length)}function b(R){var M=this._events;if(M!==void 0){var N=M[R];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}function I(R,M){for(var N=new Array(M),P=0;P<M;++P)N[P]=R[P];return N}function T(R,M,N,P){if(typeof R.on=="function")P.once?R.once(M,N):R.on(M,N);else{if(typeof R.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(M,function L(A){P.once&&R.removeEventListener(M,L),N(A)})}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");d=R}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},l.prototype.getMaxListeners=function(){return h(this)},l.prototype.emit=function(R){for(var M=[],N=1;N<arguments.length;N++)M.push(arguments[N]);var P=R==="error",L=this._events;if(L!==void 0)P=P&&L.error===void 0;else if(!P)return!1;if(P){var A;if(M.length>0&&(A=M[0]),A instanceof Error)throw A;var x=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw x.context=A,x}var k=L[R];if(k===void 0)return!1;if(typeof k=="function")o(k,this,M);else{var U=k.length,K=I(k,U);for(N=0;N<U;++N)o(K[N],this,M)}return!0},l.prototype.addListener=function(R,M){return f(this,R,M,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(R,M){return f(this,R,M,!0)},l.prototype.once=function(R,M){return u(M),this.on(R,_(this,R,M)),this},l.prototype.prependOnceListener=function(R,M){return u(M),this.prependListener(R,_(this,R,M)),this},l.prototype.removeListener=function(R,M){var N,P,L,A,x;if(u(M),(P=this._events)===void 0)return this;if((N=P[R])===void 0)return this;if(N===M||N.listener===M)--this._eventsCount==0?this._events=Object.create(null):(delete P[R],P.removeListener&&this.emit("removeListener",R,N.listener||M));else if(typeof N!="function"){for(L=-1,A=N.length-1;A>=0;A--)if(N[A]===M||N[A].listener===M){x=N[A].listener,L=A;break}if(L<0)return this;L===0?N.shift():function(k,U){for(;U+1<k.length;U++)k[U]=k[U+1];k.pop()}(N,L),N.length===1&&(P[R]=N[0]),P.removeListener!==void 0&&this.emit("removeListener",R,x||M)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(R){var M,N,P;if((N=this._events)===void 0)return this;if(N.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):N[R]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete N[R]),this;if(arguments.length===0){var L,A=Object.keys(N);for(P=0;P<A.length;++P)(L=A[P])!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(M=N[R])=="function")this.removeListener(R,M);else if(M!==void 0)for(P=M.length-1;P>=0;P--)this.removeListener(R,M[P]);return this},l.prototype.listeners=function(R){return y(this,R,!0)},l.prototype.rawListeners=function(R){return y(this,R,!1)},l.listenerCount=function(R,M){return typeof R.listenerCount=="function"?R.listenerCount(M):b.call(R,M)},l.prototype.listenerCount=b,l.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,i,r){r.d(i,"b",function(){return o}),r.d(i,"a",function(){return a});var s=r(2),n=r(6),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},a={NETWORK_EXCEPTION:s.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:s.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:s.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:s.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:n.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:n.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:n.a.CODEC_UNSUPPORTED}},function(t,i,r){r.d(i,"d",function(){return s}),r.d(i,"b",function(){return n}),r.d(i,"a",function(){return o}),r.d(i,"c",function(){return a});var s=function(l,d,u,h,f){this.dts=l,this.pts=d,this.duration=u,this.originalDts=h,this.isSyncPoint=f,this.fileposition=null},n=function(){function l(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return l.prototype.appendSyncPoint=function(d){d.isSyncPoint=!0,this.syncPoints.push(d)},l}(),o=function(){function l(){this._list=[]}return l.prototype.clear=function(){this._list=[]},l.prototype.appendArray=function(d){var u=this._list;d.length!==0&&(u.length>0&&d[0].originalDts<u[u.length-1].originalDts&&this.clear(),Array.prototype.push.apply(u,d))},l.prototype.getLastSyncPointBeforeDts=function(d){if(this._list.length==0)return null;var u=this._list,h=0,f=u.length-1,p=0,_=0,y=f;for(d<u[0].dts&&(h=0,_=y+1);_<=y;){if((p=_+Math.floor((y-_)/2))===f||d>=u[p].dts&&d<u[p+1].dts){h=p;break}u[p].dts<d?_=p+1:y=p-1}return this._list[h]},l}(),a=function(){function l(d){this._type=d,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),l.prototype.isEmpty=function(){return this._list.length===0},l.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},l.prototype._searchNearestSegmentBefore=function(d){var u=this._list;if(u.length===0)return-2;var h=u.length-1,f=0,p=0,_=h,y=0;if(d<u[0].originalBeginDts)return y=-1;for(;p<=_;){if((f=p+Math.floor((_-p)/2))===h||d>u[f].lastSample.originalDts&&d<u[f+1].originalBeginDts){y=f;break}u[f].originalBeginDts<d?p=f+1:_=f-1}return y},l.prototype._searchNearestSegmentAfter=function(d){return this._searchNearestSegmentBefore(d)+1},l.prototype.append=function(d){var u=this._list,h=d,f=this._lastAppendLocation,p=0;f!==-1&&f<u.length&&h.originalBeginDts>=u[f].lastSample.originalDts&&(f===u.length-1||f<u.length-1&&h.originalBeginDts<u[f+1].originalBeginDts)?p=f+1:u.length>0&&(p=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=p,this._list.splice(p,0,h)},l.prototype.getLastSegmentBefore=function(d){var u=this._searchNearestSegmentBefore(d);return u>=0?this._list[u]:null},l.prototype.getLastSampleBefore=function(d){var u=this.getLastSegmentBefore(d);return u!=null?u.lastSample:null},l.prototype.getLastSyncPointBefore=function(d){for(var u=this._searchNearestSegmentBefore(d),h=this._list[u].syncPoints;h.length===0&&u>0;)u--,h=this._list[u].syncPoints;return h.length>0?h[h.length-1]:null},l}()},function(t,i,r){var s=function(){function n(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&o&&a},n.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},n.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,l=this._search(a.times,o);return{index:l,milliseconds:a.times[l],fileposition:a.filepositions[l]}},n.prototype._search=function(o,a){var l=0,d=o.length-1,u=0,h=0,f=d;for(a<o[0]&&(l=0,h=f+1);h<=f;){if((u=h+Math.floor((f-h)/2))===d||a>=o[u]&&a<o[u+1]){l=u;break}o[u]<a?h=u+1:f=u-1}return l},n}();i.a=s},function(t,i,r){var s=r(9),n=r.n(s),o=r(0),a=r(5),l=r(12);function d(E,v,g){var m=E;if(v+g<m.length){for(;g--;)if((192&m[++v])!=128)return!1;return!0}return!1}var u,h=function(E){for(var v=[],g=E,m=0,S=E.length;m<S;)if(g[m]<128)v.push(String.fromCharCode(g[m])),++m;else{if(!(g[m]<192)){if(g[m]<224){if(d(g,m,1)&&(D=(31&g[m])<<6|63&g[m+1])>=128){v.push(String.fromCharCode(65535&D)),m+=2;continue}}else if(g[m]<240){if(d(g,m,2)&&(D=(15&g[m])<<12|(63&g[m+1])<<6|63&g[m+2])>=2048&&(63488&D)!=55296){v.push(String.fromCharCode(65535&D)),m+=3;continue}}else if(g[m]<248){var D;if(d(g,m,3)&&(D=(7&g[m])<<18|(63&g[m+1])<<12|(63&g[m+2])<<6|63&g[m+3])>65536&&D<1114112){D-=65536,v.push(String.fromCharCode(D>>>10|55296)),v.push(String.fromCharCode(1023&D|56320)),m+=4;continue}}}v.push("�"),++m}return v.join("")},f=r(3),p=(u=new ArrayBuffer(2),new DataView(u).setInt16(0,256,!0),new Int16Array(u)[0]===256),_=function(){function E(){}return E.parseScriptData=function(v,g,m){var S={};try{var D=E.parseValue(v,g,m),w=E.parseValue(v,g+D.size,m-D.size);S[D.data]=w.data}catch(B){o.a.e("AMF",B.toString())}return S},E.parseObject=function(v,g,m){if(m<3)throw new f.a("Data not enough when parse ScriptDataObject");var S=E.parseString(v,g,m),D=E.parseValue(v,g+S.size,m-S.size),w=D.objectEnd;return{data:{name:S.data,value:D.data},size:S.size+D.size,objectEnd:w}},E.parseVariable=function(v,g,m){return E.parseObject(v,g,m)},E.parseString=function(v,g,m){if(m<2)throw new f.a("Data not enough when parse String");var S=new DataView(v,g,m).getUint16(0,!p);return{data:S>0?h(new Uint8Array(v,g+2,S)):"",size:2+S}},E.parseLongString=function(v,g,m){if(m<4)throw new f.a("Data not enough when parse LongString");var S=new DataView(v,g,m).getUint32(0,!p);return{data:S>0?h(new Uint8Array(v,g+4,S)):"",size:4+S}},E.parseDate=function(v,g,m){if(m<10)throw new f.a("Data size invalid when parse Date");var S=new DataView(v,g,m),D=S.getFloat64(0,!p),w=S.getInt16(8,!p);return{data:new Date(D+=60*w*1e3),size:10}},E.parseValue=function(v,g,m){if(m<1)throw new f.a("Data not enough when parse Value");var S,D=new DataView(v,g,m),w=1,B=D.getUint8(0),V=!1;try{switch(B){case 0:S=D.getFloat64(1,!p),w+=8;break;case 1:S=!!D.getUint8(1),w+=1;break;case 2:var G=E.parseString(v,g+1,m-1);S=G.data,w+=G.size;break;case 3:S={};var z=0;for((16777215&D.getUint32(m-4,!p))==9&&(z=3);w<m-4;){var Y=E.parseObject(v,g+w,m-w-z);if(Y.objectEnd)break;S[Y.data.name]=Y.data.value,w+=Y.size}w<=m-3&&(16777215&D.getUint32(w-1,!p))===9&&(w+=3);break;case 8:for(S={},w+=4,z=0,(16777215&D.getUint32(m-4,!p))==9&&(z=3);w<m-8;){var q=E.parseVariable(v,g+w,m-w-z);if(q.objectEnd)break;S[q.data.name]=q.data.value,w+=q.size}w<=m-3&&(16777215&D.getUint32(w-1,!p))===9&&(w+=3);break;case 9:S=void 0,w=1,V=!0;break;case 10:S=[];var X=D.getUint32(1,!p);w+=4;for(var te=0;te<X;te++){var ce=E.parseValue(v,g+w,m-w);S.push(ce.data),w+=ce.size}break;case 11:var se=E.parseDate(v,g+1,m-1);S=se.data,w+=se.size;break;case 12:var pe=E.parseString(v,g+1,m-1);S=pe.data,w+=pe.size;break;default:w=m,o.a.w("AMF","Unsupported AMF value type "+B)}}catch(ue){o.a.e("AMF",ue.toString())}return{data:S,size:w,objectEnd:V}},E}(),y=function(){function E(v){this.TAG="ExpGolomb",this._buffer=v,this._buffer_index=0,this._total_bytes=v.byteLength,this._total_bits=8*v.byteLength,this._current_word=0,this._current_word_bits_left=0}return E.prototype.destroy=function(){this._buffer=null},E.prototype._fillCurrentWord=function(){var v=this._total_bytes-this._buffer_index;if(v<=0)throw new f.a("ExpGolomb: _fillCurrentWord() but no bytes available");var g=Math.min(4,v),m=new Uint8Array(4);m.set(this._buffer.subarray(this._buffer_index,this._buffer_index+g)),this._current_word=new DataView(m.buffer).getUint32(0,!1),this._buffer_index+=g,this._current_word_bits_left=8*g},E.prototype.readBits=function(v){if(v>32)throw new f.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(v<=this._current_word_bits_left){var g=this._current_word>>>32-v;return this._current_word<<=v,this._current_word_bits_left-=v,g}var m=this._current_word_bits_left?this._current_word:0;m>>>=32-this._current_word_bits_left;var S=v-this._current_word_bits_left;this._fillCurrentWord();var D=Math.min(S,this._current_word_bits_left),w=this._current_word>>>32-D;return this._current_word<<=D,this._current_word_bits_left-=D,m=m<<D|w},E.prototype.readBool=function(){return this.readBits(1)===1},E.prototype.readByte=function(){return this.readBits(8)},E.prototype._skipLeadingZero=function(){var v;for(v=0;v<this._current_word_bits_left;v++)if(this._current_word&2147483648>>>v)return this._current_word<<=v,this._current_word_bits_left-=v,v;return this._fillCurrentWord(),v+this._skipLeadingZero()},E.prototype.readUEG=function(){var v=this._skipLeadingZero();return this.readBits(v+1)-1},E.prototype.readSEG=function(){var v=this.readUEG();return 1&v?v+1>>>1:-1*(v>>>1)},E}(),b=function(){function E(){}return E._ebsp2rbsp=function(v){for(var g=v,m=g.byteLength,S=new Uint8Array(m),D=0,w=0;w<m;w++)w>=2&&g[w]===3&&g[w-1]===0&&g[w-2]===0||(S[D]=g[w],D++);return new Uint8Array(S.buffer,0,D)},E.parseSPS=function(v){for(var g=v.subarray(1,4),m="avc1.",S=0;S<3;S++){var D=g[S].toString(16);D.length<2&&(D="0"+D),m+=D}var w=E._ebsp2rbsp(v),B=new y(w);B.readByte();var V=B.readByte();B.readByte();var G=B.readByte();B.readUEG();var z=E.getProfileString(V),Y=E.getLevelString(G),q=1,X=420,te=8,ce=8;if((V===100||V===110||V===122||V===244||V===44||V===83||V===86||V===118||V===128||V===138||V===144)&&((q=B.readUEG())===3&&B.readBits(1),q<=3&&(X=[0,420,422,444][q]),te=B.readUEG()+8,ce=B.readUEG()+8,B.readBits(1),B.readBool()))for(var se=q!==3?8:12,pe=0;pe<se;pe++)B.readBool()&&(pe<6?E._skipScalingList(B,16):E._skipScalingList(B,64));B.readUEG();var ue=B.readUEG();if(ue===0)B.readUEG();else if(ue===1){B.readBits(1),B.readSEG(),B.readSEG();var de=B.readUEG();for(pe=0;pe<de;pe++)B.readSEG()}var Ae=B.readUEG();B.readBits(1);var ke=B.readUEG(),he=B.readUEG(),Te=B.readBits(1);Te===0&&B.readBits(1),B.readBits(1);var Pe=0,Le=0,Ie=0,Ue=0;B.readBool()&&(Pe=B.readUEG(),Le=B.readUEG(),Ie=B.readUEG(),Ue=B.readUEG());var je=1,we=1,Oe=0,qe=!0,et=0,At=0;if(B.readBool()){if(B.readBool()){var lt=B.readByte();lt>0&&lt<16?(je=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][lt-1],we=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][lt-1]):lt===255&&(je=B.readByte()<<8|B.readByte(),we=B.readByte()<<8|B.readByte())}if(B.readBool()&&B.readBool(),B.readBool()&&(B.readBits(4),B.readBool()&&B.readBits(24)),B.readBool()&&(B.readUEG(),B.readUEG()),B.readBool()){var _t=B.readBits(32),ht=B.readBits(32);qe=B.readBool(),Oe=(et=ht)/(At=2*_t)}}var ct=1;je===1&&we===1||(ct=je/we);var ft=0,$e=0;q===0?(ft=1,$e=2-Te):(ft=q===3?1:2,$e=(q===1?2:1)*(2-Te));var $t=16*(ke+1),Gt=16*(he+1)*(2-Te);$t-=(Pe+Le)*ft,Gt-=(Ie+Ue)*$e;var $i=Math.ceil($t*ct);return B.destroy(),B=null,{codec_mimetype:m,profile_idc:V,level_idc:G,profile_string:z,level_string:Y,chroma_format_idc:q,bit_depth:te,bit_depth_luma:te,bit_depth_chroma:ce,ref_frames:Ae,chroma_format:X,chroma_format_string:E.getChromaFormatString(X),frame_rate:{fixed:qe,fps:Oe,fps_den:At,fps_num:et},sar_ratio:{width:je,height:we},codec_size:{width:$t,height:Gt},present_size:{width:$i,height:Gt}}},E._skipScalingList=function(v,g){for(var m=8,S=8,D=0;D<g;D++)S!==0&&(S=(m+v.readSEG()+256)%256),m=S===0?m:S},E.getProfileString=function(v){switch(v){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},E.getLevelString=function(v){return(v/10).toFixed(1)},E.getChromaFormatString=function(v){switch(v){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},E}(),I=r(6),T=function(){function E(){}return E._ebsp2rbsp=function(v){for(var g=v,m=g.byteLength,S=new Uint8Array(m),D=0,w=0;w<m;w++)w>=2&&g[w]===3&&g[w-1]===0&&g[w-2]===0||(S[D]=g[w],D++);return new Uint8Array(S.buffer,0,D)},E.parseVPS=function(v){var g=E._ebsp2rbsp(v),m=new y(g);return m.readByte(),m.readByte(),m.readBits(4),m.readBits(2),m.readBits(6),{num_temporal_layers:m.readBits(3)+1,temporal_id_nested:m.readBool()}},E.parseSPS=function(v){var g=E._ebsp2rbsp(v),m=new y(g);m.readByte(),m.readByte();for(var S=0,D=0,w=0,B=0,V=(m.readBits(4),m.readBits(3)),G=(m.readBool(),m.readBits(2)),z=m.readBool(),Y=m.readBits(5),q=m.readByte(),X=m.readByte(),te=m.readByte(),ce=m.readByte(),se=m.readByte(),pe=m.readByte(),ue=m.readByte(),de=m.readByte(),Ae=m.readByte(),ke=m.readByte(),he=m.readByte(),Te=[],Pe=[],Le=0;Le<V;Le++)Te.push(m.readBool()),Pe.push(m.readBool());if(V>0)for(Le=V;Le<8;Le++)m.readBits(2);for(Le=0;Le<V;Le++)Te[Le]&&(m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte()),Pe[Le]&&m.readByte();m.readUEG();var Ie=m.readUEG();Ie==3&&m.readBits(1);var Ue=m.readUEG(),je=m.readUEG();m.readBool()&&(S+=m.readUEG(),D+=m.readUEG(),w+=m.readUEG(),B+=m.readUEG());var we=m.readUEG(),Oe=m.readUEG(),qe=m.readUEG();for(Le=m.readBool()?0:V;Le<=V;Le++)m.readUEG(),m.readUEG(),m.readUEG();if(m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readBool()&&m.readBool())for(var et=0;et<4;et++)for(var At=0;At<(et===3?2:6);At++)if(m.readBool()){var lt=Math.min(64,1<<4+(et<<1));for(et>1&&m.readSEG(),Le=0;Le<lt;Le++)m.readSEG()}else m.readUEG();m.readBool(),m.readBool(),m.readBool()&&(m.readByte(),m.readUEG(),m.readUEG(),m.readBool());var _t=m.readUEG(),ht=0;for(Le=0;Le<_t;Le++){var ct=!1;if(Le!==0&&(ct=m.readBool()),ct){Le===_t&&m.readUEG(),m.readBool(),m.readUEG();for(var ft=0,$e=0;$e<=ht;$e++){var $t=m.readBool(),Gt=!1;$t||(Gt=m.readBool()),($t||Gt)&&ft++}ht=ft}else{var $i=m.readUEG(),en=m.readUEG();for(ht=$i+en,$e=0;$e<$i;$e++)m.readUEG(),m.readBool();for($e=0;$e<en;$e++)m.readUEG(),m.readBool()}}if(m.readBool()){var il=m.readUEG();for(Le=0;Le<il;Le++){for($e=0;$e<qe+4;$e++)m.readBits(1);m.readBits(1)}}var tn=0,Ti=1,xi=1,rn=!1,Mr=1,Or=1;if(m.readBool(),m.readBool(),m.readBool()){if(m.readBool()){var Ai=m.readByte();Ai>0&&Ai<=16?(Ti=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Ai-1],xi=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Ai-1]):Ai===255&&(Ti=m.readBits(16),xi=m.readBits(16))}if(m.readBool()&&m.readBool(),m.readBool()&&(m.readBits(3),m.readBool(),m.readBool()&&(m.readByte(),m.readByte(),m.readByte())),m.readBool()&&(m.readUEG(),m.readUEG()),m.readBool(),m.readBool(),m.readBool(),m.readBool()&&(m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG()),m.readBool()&&(Mr=m.readBits(32),Or=m.readBits(32),m.readBool()&&m.readUEG(),m.readBool())){var Br=!1,Fr=!1,Gi=!1;for(Br=m.readBool(),Fr=m.readBool(),(Br||Fr)&&((Gi=m.readBool())&&(m.readByte(),m.readBits(5),m.readBool(),m.readBits(5)),m.readBits(4),m.readBits(4),Gi&&m.readBits(4),m.readBits(5),m.readBits(5),m.readBits(5)),Le=0;Le<=V;Le++){var sn=m.readBool();rn=sn;var nn=!0,Nr=1;sn||(nn=m.readBool());var an=!1;if(nn?m.readUEG():an=m.readBool(),an||(Nr=m.readUEG()+1),Br){for($e=0;$e<Nr;$e++)m.readUEG(),m.readUEG(),Gi&&(m.readUEG(),m.readUEG());m.readBool()}if(Fr){for($e=0;$e<Nr;$e++)m.readUEG(),m.readUEG(),Gi&&(m.readUEG(),m.readUEG());m.readBool()}}}m.readBool()&&(m.readBool(),m.readBool(),m.readBool(),tn=m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG())}m.readBool();var rl="hvc1.".concat(Y,".1.L").concat(he,".B0"),on=Ue-(S+D)*(Ie===1||Ie===2?2:1),ln=je-(w+B)*(Ie===1?2:1),cn=1;return Ti!==1&&xi!==1&&(cn=Ti/xi),m.destroy(),m=null,{codec_mimetype:rl,profile_string:E.getProfileString(Y),level_string:E.getLevelString(he),profile_idc:Y,bit_depth:we+8,ref_frames:1,chroma_format:Ie,chroma_format_string:E.getChromaFormatString(Ie),general_level_idc:he,general_profile_space:G,general_tier_flag:z,general_profile_idc:Y,general_profile_compatibility_flags_1:q,general_profile_compatibility_flags_2:X,general_profile_compatibility_flags_3:te,general_profile_compatibility_flags_4:ce,general_constraint_indicator_flags_1:se,general_constraint_indicator_flags_2:pe,general_constraint_indicator_flags_3:ue,general_constraint_indicator_flags_4:de,general_constraint_indicator_flags_5:Ae,general_constraint_indicator_flags_6:ke,min_spatial_segmentation_idc:tn,constant_frame_rate:0,chroma_format_idc:Ie,bit_depth_luma_minus8:we,bit_depth_chroma_minus8:Oe,frame_rate:{fixed:rn,fps:Or/Mr,fps_den:Mr,fps_num:Or},sar_ratio:{width:Ti,height:xi},codec_size:{width:on,height:ln},present_size:{width:on*cn,height:ln}}},E.parsePPS=function(v){var g=E._ebsp2rbsp(v),m=new y(g);m.readByte(),m.readByte(),m.readUEG(),m.readUEG(),m.readBool(),m.readBool(),m.readBits(3),m.readBool(),m.readBool(),m.readUEG(),m.readUEG(),m.readSEG(),m.readBool(),m.readBool(),m.readBool()&&m.readUEG(),m.readSEG(),m.readSEG(),m.readBool(),m.readBool(),m.readBool(),m.readBool();var S=m.readBool(),D=m.readBool(),w=1;return D&&S?w=0:D?w=3:S&&(w=2),{parallelismType:w}},E.getChromaFormatString=function(v){switch(v){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},E.getProfileString=function(v){switch(v){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},E.getLevelString=function(v){return(v/30).toFixed(1)},E}();function R(E){return E.byteOffset%2==0&&E.byteLength%2==0}function M(E){return E.byteOffset%4==0&&E.byteLength%4==0}function N(E,v){for(var g=0;g<E.length;g++)if(E[g]!==v[g])return!1;return!0}var P=function(E,v){return E.byteLength===v.byteLength&&(M(E)&&M(v)?function(g,m){return N(new Uint32Array(g.buffer,g.byteOffset,g.byteLength/4),new Uint32Array(m.buffer,m.byteOffset,m.byteLength/4))}(E,v):R(E)&&R(v)?function(g,m){return N(new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2),new Uint16Array(m.buffer,m.byteOffset,m.byteLength/2))}(E,v):function(g,m){return N(g,m)}(E,v))},L=function(){return(L=Object.assign||function(E){for(var v,g=1,m=arguments.length;g<m;g++)for(var S in v=arguments[g])Object.prototype.hasOwnProperty.call(v,S)&&(E[S]=v[S]);return E}).apply(this,arguments)},A=function(){function E(){}return E.parseOBUs=function(v,g){for(var m=0;m<v.byteLength;){var S=m,D=(v[m],(120&v[m])>>3),w=(4&v[m])!=0,B=(2&v[m])!=0;v[m],m+=1,w&&(m+=1);var V=Number.POSITIVE_INFINITY;if(B){V=0;for(var G=0;;G++){var z=v[m++];if(V|=(127&z)<<7*G,(128&z)==0)break}}console.log(D),D===1?g=L(L({},E.parseSeuqneceHeader(v.subarray(m,m+V))),{sequence_header_data:v.subarray(S,m+V)}):(D==3&&g||D==6&&g)&&(g=E.parseOBUFrameHeader(v.subarray(m,m+V),0,0,g)),m+=V}return g},E.parseSeuqneceHeader=function(v){var g=new y(v),m=g.readBits(3),S=(g.readBool(),g.readBool()),D=!0,w=0,B=1,V=void 0,G=[];if(S)G.push({operating_point_idc:0,level:g.readBits(5),tier:0});else{if(g.readBool()){var z=g.readBits(32),Y=g.readBits(32),q=g.readBool();if(q){for(var X=0;g.readBits(1)===0;)X+=1;X>=32||(1<<X)-1+g.readBits(X)}(w=Y)/(B=z),D=q,g.readBool()&&(g.readBits(5),g.readBits(32),V=g.readBits(5),g.readBits(5))}for(var te=g.readBool(),ce=g.readBits(5),se=0;se<=ce;se++){var pe=g.readBits(12),ue=g.readBits(5),de=ue>7?g.readBits(1):0;G.push({operating_point_idc:pe,level:ue,tier:de}),te&&g.readBool()&&g.readBits(4)}}var Ae=G[0],ke=Ae.level,he=Ae.tier,Te=g.readBits(4),Pe=g.readBits(4),Le=g.readBits(Te+1)+1,Ie=g.readBits(Pe+1)+1,Ue=!1;S||(Ue=g.readBool()),Ue&&(g.readBits(4),g.readBits(4)),g.readBool(),g.readBool(),g.readBool();var je=!1,we=2,Oe=2,qe=0;S||(g.readBool(),g.readBool(),g.readBool(),g.readBool(),(je=g.readBool())&&(g.readBool(),g.readBool()),(we=g.readBool()?2:g.readBits(1))?Oe=g.readBool()?2:g.readBits(1):Oe=2,je?qe=g.readBits(3)+1:qe=0);var et=g.readBool(),At=(g.readBool(),g.readBool(),g.readBool()),lt=8;m===2&&At?lt=g.readBool()?12:10:lt=At?10:8;var _t=!1;m!==1&&(_t=g.readBool()),g.readBool()&&(g.readBits(8),g.readBits(8),g.readBits(8));var ht=1,ct=1;return _t?(g.readBits(1),ht=1,ct=1):(g.readBits(1),m==0?(ht=1,ct=1):m==1?(ht=0,ct=0):lt==12?g.readBits(1)&&g.readBits(1):(ht=1,ct=0),ht&&ct&&g.readBits(2),g.readBits(1)),g.readBool(),g.destroy(),g=null,{codec_mimetype:"av01.".concat(m,".").concat(E.getLevelString(ke,he),".").concat(lt.toString(10).padStart(2,"0")),level:ke,tier:he,level_string:E.getLevelString(ke,he),profile_idc:m,profile_string:"".concat(m),bit_depth:lt,ref_frames:1,chroma_format:E.getChromaFormat(_t,ht,ct),chroma_format_string:E.getChromaFormatString(_t,ht,ct),sequence_header:{frame_id_numbers_present_flag:Ue,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:S,decoder_model_info_present_flag:!1,operating_points:G,buffer_removal_time_length_minus_1:V,equal_picture_interval:D,seq_force_screen_content_tools:we,seq_force_integer_mv:Oe,enable_order_hint:je,order_hint_bits:qe,enable_superres:et,frame_width_bit:Te+1,frame_height_bit:Pe+1,max_frame_width:Le,max_frame_height:Ie},keyframe:void 0,frame_rate:{fixed:D,fps:w/B,fps_den:B,fps_num:w}}},E.parseOBUFrameHeader=function(v,g,m,S){var D=S.sequence_header,w=new y(v),B=(D.max_frame_width,D.max_frame_height,0);D.frame_id_numbers_present_flag&&(B=D.additional_frame_id_length_minus_1+D.delta_frame_id_length_minus_2+3);var V=0,G=!0,z=!0,Y=!1;if(!D.reduced_still_picture_header){if(w.readBool())return S;G=(V=w.readBits(2))===2||V===0,(z=w.readBool())&&D.decoder_model_info_present_flag&&D.equal_picture_interval,z&&w.readBool(),Y=!!(V===3||V===0&&z)||w.readBool()}S.keyframe=G,w.readBool();var q=D.seq_force_screen_content_tools;D.seq_force_screen_content_tools===2&&(q=w.readBits(1)),q&&(D.seq_force_integer_mv,D.seq_force_integer_mv==2&&w.readBits(1)),D.frame_id_numbers_present_flag&&w.readBits(B);var X=!1;if(X=V==3||!D.reduced_still_picture_header&&w.readBool(),w.readBits(D.order_hint_bits),G||Y||w.readBits(3),D.decoder_model_info_present_flag&&w.readBool()){for(var te=0;te<=D.operating_points_cnt_minus_1;te++)if(D.operating_points[te].decoder_model_present_for_this_op[te]){var ce=D.operating_points[te].operating_point_idc;(ce===0||ce>>g&1&&ce>>m+8&1)&&w.readBits(D.buffer_removal_time_length_minus_1+1)}}var se=255;if(V===3||V==0&&z||(se=w.readBits(8)),(G||se!==255)&&Y&&D.enable_order_hint)for(var pe=0;pe<8;pe++)w.readBits(D.order_hint_bits);if(G){var ue=E.frameSizeAndRenderSize(w,X,D);S.codec_size={width:ue.FrameWidth,height:ue.FrameHeight},S.present_size={width:ue.RenderWidth,height:ue.RenderHeight},S.sar_ratio={width:ue.RenderWidth/ue.FrameWidth,height:ue.RenderHeight/ue.FrameHeight}}return w.destroy(),w=null,S},E.frameSizeAndRenderSize=function(v,g,m){var S=m.max_frame_width,D=m.max_frame_height;g&&(S=v.readBits(m.frame_width_bit)+1,D=v.readBits(m.frame_height_bit)+1);var w=!1;m.enable_superres&&(w=v.readBool());var B=8;w&&(B=v.readBits(3)+9);var V=S;S=Math.floor((8*V+B/2)/B);var G=V,z=D;if(v.readBool()){var Y=v.readBits(16)+1,q=v.readBits(16)+1;G=v.readBits(Y)+1,z=v.readBits(q)+1}return{UpscaledWidth:V,FrameWidth:S,FrameHeight:D,RenderWidth:G,RenderHeight:z}},E.getLevelString=function(v,g){return"".concat(v.toString(10).padStart(2,"0")).concat(g===0?"M":"H")},E.getChromaFormat=function(v,g,m){return v?0:g===0&&m===0?3:g===1&&m===0?2:g===1&&m===1?1:Number.NaN},E.getChromaFormatString=function(v,g,m){return v?"4:0:0":g===0&&m===0?"4:4:4":g===1&&m===0?"4:2:2":g===1&&m===1?"4:2:0":"Unknown"},E}(),x,k=function(){function E(v,g){this.TAG="FLVDemuxer",this._config=g,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=v.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=v.hasAudioTrack,this._hasVideo=v.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new l.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var m=new ArrayBuffer(2);return new DataView(m).setInt16(0,256,!0),new Int16Array(m)[0]===256}()}return E.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},E.probe=function(v){var g=new Uint8Array(v);if(g.byteLength<9)return{needMoreData:!0};var m={match:!1};if(g[0]!==70||g[1]!==76||g[2]!==86||g[3]!==1)return m;var S,D,w=(4&g[4])>>>2!=0,B=(1&g[4])!=0,V=(S=g)[D=5]<<24|S[D+1]<<16|S[D+2]<<8|S[D+3];return V<9?m:{match:!0,consumed:V,dataOffset:V,hasAudioTrack:w,hasVideoTrack:B}},E.prototype.bindDataSource=function(v){return v.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(E.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(v){this._onTrackMetadata=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(v){this._onMediaInfo=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(v){this._onMetaDataArrived=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(v){this._onScriptDataArrived=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onError",{get:function(){return this._onError},set:function(v){this._onError=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(v){this._onDataAvailable=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(v){this._timestampBase=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"overridedDuration",{get:function(){return this._duration},set:function(v){this._durationOverrided=!0,this._duration=v,this._mediaInfo.duration=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"overridedHasAudio",{set:function(v){this._hasAudioFlagOverrided=!0,this._hasAudio=v,this._mediaInfo.hasAudio=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"overridedHasVideo",{set:function(v){this._hasVideoFlagOverrided=!0,this._hasVideo=v,this._mediaInfo.hasVideo=v},enumerable:!1,configurable:!0}),E.prototype.resetMediaInfo=function(){this._mediaInfo=new l.a},E.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},E.prototype.parseChunks=function(v,g){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new f.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var m=0,S=this._littleEndian;if(g===0){if(!(v.byteLength>13))return 0;m=E.probe(v).dataOffset}for(this._firstParse&&(this._firstParse=!1,g+m!==this._dataOffset&&o.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(D=new DataView(v,m)).getUint32(0,!S)!==0&&o.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),m+=4);m<v.byteLength;){this._dispatch=!0;var D=new DataView(v,m);if(m+11+4>v.byteLength)break;var w=D.getUint8(0),B=16777215&D.getUint32(0,!S);if(m+11+B+4>v.byteLength)break;if(w===8||w===9||w===18){var V=D.getUint8(4),G=D.getUint8(5),z=D.getUint8(6)|G<<8|V<<16|D.getUint8(7)<<24;16777215&D.getUint32(7,!S)&&o.a.w(this.TAG,"Meet tag which has StreamID != 0!");var Y=m+11;switch(w){case 8:this._parseAudioData(v,Y,B,z);break;case 9:this._parseVideoData(v,Y,B,z,g+m);break;case 18:this._parseScriptData(v,Y,B)}var q=D.getUint32(11+B,!S);q!==11+B&&o.a.w(this.TAG,"Invalid PrevTagSize ".concat(q)),m+=11+B+4}else o.a.w(this.TAG,"Unsupported tag type ".concat(w,", skipped")),m+=11+B+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),m},E.prototype._parseScriptData=function(v,g,m){var S=_.parseScriptData(v,g,m);if(S.hasOwnProperty("onMetaData")){if(S.onMetaData==null||typeof S.onMetaData!="object")return void o.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&o.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=S;var D=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},D)),typeof D.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=D.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof D.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=D.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof D.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=D.audiodatarate),typeof D.videodatarate=="number"&&(this._mediaInfo.videoDataRate=D.videodatarate),typeof D.width=="number"&&(this._mediaInfo.width=D.width),typeof D.height=="number"&&(this._mediaInfo.height=D.height),typeof D.duration=="number"){if(!this._durationOverrided){var w=Math.floor(D.duration*this._timescale);this._duration=w,this._mediaInfo.duration=w}}else this._mediaInfo.duration=0;if(typeof D.framerate=="number"){var B=Math.floor(1e3*D.framerate);if(B>0){var V=B/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=V,this._referenceFrameRate.fps_num=B,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=V}}if(typeof D.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var G=D.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(G),D.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=D,o.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(S).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},S))},E.prototype._parseKeyframesIndex=function(v){for(var g=[],m=[],S=1;S<v.times.length;S++){var D=this._timestampBase+Math.floor(1e3*v.times[S]);g.push(D),m.push(v.filepositions[S])}return{times:g,filepositions:m}},E.prototype._parseAudioData=function(v,g,m,S){if(m<=1)o.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var D=new DataView(v,g,m).getUint8(0),w=D>>>4;if(w!==9)if(w===2||w===10){var B=0,V=(12&D)>>>2;if(V>=0&&V<=4){B=this._flvSoundRateTable[V];var G=1&D,z=this._audioMetadata,Y=this._audioTrack;if(z||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(z=this._audioMetadata={}).type="audio",z.id=Y.id,z.timescale=this._timescale,z.duration=this._duration,z.audioSampleRate=B,z.channelCount=G===0?1:2),w===10){var q=this._parseAACAudioData(v,g+1,m-1);if(q==null)return;if(q.packetType===0){if(z.config){if(P(q.data.config,z.config))return;o.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var X=q.data;z.audioSampleRate=X.samplingRate,z.channelCount=X.channelCount,z.codec=X.codec,z.originalCodec=X.originalCodec,z.config=X.config,z.refSampleDuration=1024/z.audioSampleRate*z.timescale,o.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",z),(se=this._mediaInfo).audioCodec=z.originalCodec,se.audioSampleRate=z.audioSampleRate,se.audioChannelCount=z.channelCount,se.hasVideo?se.videoCodec!=null&&(se.mimeType='video/x-flv; codecs="'+se.videoCodec+","+se.audioCodec+'"'):se.mimeType='video/x-flv; codecs="'+se.audioCodec+'"',se.isComplete()&&this._onMediaInfo(se)}else if(q.packetType===1){var te=this._timestampBase+S,ce={unit:q.data,length:q.data.byteLength,dts:te,pts:te};Y.samples.push(ce),Y.length+=q.data.length}else o.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(q.packetType))}else if(w===2){if(!z.codec){var se;if((X=this._parseMP3AudioData(v,g+1,m-1,!0))==null)return;z.audioSampleRate=X.samplingRate,z.channelCount=X.channelCount,z.codec=X.codec,z.originalCodec=X.originalCodec,z.refSampleDuration=1152/z.audioSampleRate*z.timescale,o.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",z),(se=this._mediaInfo).audioCodec=z.codec,se.audioSampleRate=z.audioSampleRate,se.audioChannelCount=z.channelCount,se.audioDataRate=X.bitRate,se.hasVideo?se.videoCodec!=null&&(se.mimeType='video/x-flv; codecs="'+se.videoCodec+","+se.audioCodec+'"'):se.mimeType='video/x-flv; codecs="'+se.audioCodec+'"',se.isComplete()&&this._onMediaInfo(se)}var pe=this._parseMP3AudioData(v,g+1,m-1,!1);if(pe==null)return;te=this._timestampBase+S;var ue={unit:pe,length:pe.byteLength,dts:te,pts:te};Y.samples.push(ue),Y.length+=pe.length}}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+V)}else this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+w);else{if(m<=5)return void o.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var de=15&D,Ae=String.fromCharCode.apply(String,new Uint8Array(v,g,m).slice(1,5));switch(Ae){case"Opus":this._parseOpusAudioPacket(v,g+5,m-5,S,de);break;case"fLaC":this._parseFlacAudioPacket(v,g+5,m-5,S,de);break;default:this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+Ae)}}}},E.prototype._parseAACAudioData=function(v,g,m){if(!(m<=1)){var S={},D=new Uint8Array(v,g,m);return S.packetType=D[0],D[0]===0?S.data=this._parseAACAudioSpecificConfig(v,g+1,m-1):S.data=D.subarray(1),S}o.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},E.prototype._parseAACAudioSpecificConfig=function(v,g,m){var S,D,w=new Uint8Array(v,g,m),B=null,V=0,G=null;if(V=S=w[0]>>>3,(D=(7&w[0])<<1|w[1]>>>7)<0||D>=this._mpegSamplingRates.length)this._onError(I.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var z=this._mpegSamplingRates[D],Y=(120&w[1])>>>3;if(!(Y<0||Y>=8)){V===5&&(G=(7&w[1])<<1|w[2]>>>7,(124&w[2])>>>2);var q=self.navigator.userAgent.toLowerCase();return q.indexOf("firefox")!==-1?D>=6?(V=5,B=new Array(4),G=D-3):(V=2,B=new Array(2),G=D):q.indexOf("android")!==-1?(V=2,B=new Array(2),G=D):(V=5,G=D,B=new Array(4),D>=6?G=D-3:Y===1&&(V=2,B=new Array(2),G=D)),B[0]=V<<3,B[0]|=(15&D)>>>1,B[1]=(15&D)<<7,B[1]|=(15&Y)<<3,V===5&&(B[1]|=(15&G)>>>1,B[2]=(1&G)<<7,B[2]|=8,B[3]=0),{config:B,samplingRate:z,channelCount:Y,codec:"mp4a.40."+V,originalCodec:"mp4a.40."+S}}this._onError(I.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},E.prototype._parseMP3AudioData=function(v,g,m,S){if(!(m<4)){this._littleEndian;var D=new Uint8Array(v,g,m),w=null;if(S){if(D[0]!==255)return;var B=D[1]>>>3&3,V=(6&D[1])>>1,G=(240&D[2])>>>4,z=(12&D[2])>>>2,Y=(D[3]>>>6&3)!==3?2:1,q=0,X=0;switch(B){case 0:q=this._mpegAudioV25SampleRateTable[z];break;case 2:q=this._mpegAudioV20SampleRateTable[z];break;case 3:q=this._mpegAudioV10SampleRateTable[z]}switch(V){case 1:G<this._mpegAudioL3BitRateTable.length&&(X=this._mpegAudioL3BitRateTable[G]);break;case 2:G<this._mpegAudioL2BitRateTable.length&&(X=this._mpegAudioL2BitRateTable[G]);break;case 3:G<this._mpegAudioL1BitRateTable.length&&(X=this._mpegAudioL1BitRateTable[G])}w={bitRate:X,samplingRate:q,channelCount:Y,codec:"mp3",originalCodec:"mp3"}}else w=D;return w}o.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},E.prototype._parseOpusAudioPacket=function(v,g,m,S,D){if(D===0)this._parseOpusSequenceHeader(v,g,m);else if(D===1)this._parseOpusAudioData(v,g,m,S);else if(D!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(D))},E.prototype._parseOpusSequenceHeader=function(v,g,m){if(m<=16)o.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var S=this._audioMetadata,D=this._audioTrack;S||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(S=this._audioMetadata={}).type="audio",S.id=D.id,S.timescale=this._timescale,S.duration=this._duration);var w=new DataView(v,g,m);w.setUint8(8,0);var B=w.getUint8(9);w.setUint16(10,w.getUint16(10,!0),!1);var V=w.getUint32(12,!0);w.setUint32(12,w.getUint32(12,!0),!1);var G={config:new Uint8Array(v,g+8,m-8),channelCount:B,samplingFrequence:V,codec:"opus",originalCodec:"opus"};if(S.config){if(P(G.config,S.config))return;o.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}S.audioSampleRate=G.samplingFrequence,S.channelCount=G.channelCount,S.codec=G.codec,S.originalCodec=G.originalCodec,S.config=G.config,S.refSampleDuration=20,o.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",S);var z=this._mediaInfo;z.audioCodec=S.originalCodec,z.audioSampleRate=S.audioSampleRate,z.audioChannelCount=S.channelCount,z.hasVideo?z.videoCodec!=null&&(z.mimeType='video/x-flv; codecs="'+z.videoCodec+","+z.audioCodec+'"'):z.mimeType='video/x-flv; codecs="'+z.audioCodec+'"',z.isComplete()&&this._onMediaInfo(z)}},E.prototype._parseOpusAudioData=function(v,g,m,S){var D=this._audioTrack,w=new Uint8Array(v,g,m),B=this._timestampBase+S,V={unit:w,length:w.byteLength,dts:B,pts:B};D.samples.push(V),D.length+=w.length},E.prototype._parseFlacAudioPacket=function(v,g,m,S,D){if(D===0)this._parseFlacSequenceHeader(v,g,m);else if(D===1)this._parseFlacAudioData(v,g,m,S);else if(D!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(D))},E.prototype._parseFlacSequenceHeader=function(v,g,m){var S=this._audioMetadata,D=this._audioTrack;S||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(S=this._audioMetadata={}).type="audio",S.id=D.id,S.timescale=this._timescale,S.duration=this._duration);var w=new Uint8Array(v,g+4,m-4),B=new y(w),V=B.readBits(16),G=B.readBits(16),z=G===V?G:null;B.readBits(24),B.readBits(24);var Y=B.readBits(20),q=B.readBits(3)+1,X=B.readBits(5)+1;B.destroy();var te=new Uint8Array(w.byteLength+4);te.set(w,4),te[0]=128,te[1]=w.byteLength>>>16&255,te[2]=w.byteLength>>>8&255,te[3]=w.byteLength>>>0&255;var ce={config:te,channelCount:q,samplingFrequence:Y,sampleSize:X,codec:"flac",originalCodec:"flac"};if(S.config){if(P(ce.config,S.config))return;o.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}S.audioSampleRate=ce.samplingFrequence,S.channelCount=ce.channelCount,S.sampleSize=ce.sampleSize,S.codec=ce.codec,S.originalCodec=ce.originalCodec,S.config=ce.config,S.refSampleDuration=z!=null?1e3*z/ce.samplingFrequence:null,o.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",S);var se=this._mediaInfo;se.audioCodec=S.originalCodec,se.audioSampleRate=S.audioSampleRate,se.audioChannelCount=S.channelCount,se.hasVideo?se.videoCodec!=null&&(se.mimeType='video/x-flv; codecs="'+se.videoCodec+","+se.audioCodec+'"'):se.mimeType='video/x-flv; codecs="'+se.audioCodec+'"',se.isComplete()&&this._onMediaInfo(se)},E.prototype._parseFlacAudioData=function(v,g,m,S){var D=this._audioTrack,w=new Uint8Array(v,g,m),B=this._timestampBase+S,V={unit:w,length:w.byteLength,dts:B,pts:B};D.samples.push(V),D.length+=w.length},E.prototype._parseVideoData=function(v,g,m,S,D){if(m<=1)o.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var w=new Uint8Array(v,g,m)[0],B=(112&w)>>>4;if(128&w){var V=15&w,G=String.fromCharCode.apply(String,new Uint8Array(v,g,m).slice(1,5));if(G==="hvc1")this._parseEnhancedHEVCVideoPacket(v,g+5,m-5,S,D,B,V);else{if(G!=="av01")return void this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(G));this._parseEnhancedAV1VideoPacket(v,g+5,m-5,S,D,B,V)}}else{var z=15&w;if(z===7)this._parseAVCVideoPacket(v,g+1,m-1,S,D,B);else{if(z!==12)return void this._onError(I.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(z));this._parseHEVCVideoPacket(v,g+1,m-1,S,D,B)}}}},E.prototype._parseAVCVideoPacket=function(v,g,m,S,D,w){if(m<4)o.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var B=this._littleEndian,V=new DataView(v,g,m),G=V.getUint8(0),z=(16777215&V.getUint32(0,!B))<<8>>8;if(G===0)this._parseAVCDecoderConfigurationRecord(v,g+4,m-4);else if(G===1)this._parseAVCVideoData(v,g+4,m-4,S,D,w,z);else if(G!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(G))}},E.prototype._parseHEVCVideoPacket=function(v,g,m,S,D,w){if(m<4)o.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var B=this._littleEndian,V=new DataView(v,g,m),G=V.getUint8(0),z=(16777215&V.getUint32(0,!B))<<8>>8;if(G===0)this._parseHEVCDecoderConfigurationRecord(v,g+4,m-4);else if(G===1)this._parseHEVCVideoData(v,g+4,m-4,S,D,w,z);else if(G!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(G))}},E.prototype._parseEnhancedHEVCVideoPacket=function(v,g,m,S,D,w,B){var V=this._littleEndian,G=new DataView(v,g,m);if(B===0)this._parseHEVCDecoderConfigurationRecord(v,g,m);else if(B===1){var z=(4294967040&G.getUint32(0,!V))>>8;this._parseHEVCVideoData(v,g+3,m-3,S,D,w,z)}else if(B===3)this._parseHEVCVideoData(v,g,m,S,D,w,0);else if(B!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(B))},E.prototype._parseEnhancedAV1VideoPacket=function(v,g,m,S,D,w,B){if(this._littleEndian,B===0)this._parseAV1CodecConfigurationRecord(v,g,m);else if(B===1)this._parseAV1VideoData(v,g,m,S,D,w,0);else{if(B===5)return void this._onError(I.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(B));if(B!==2)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(B))}},E.prototype._parseAVCDecoderConfigurationRecord=function(v,g,m){if(m<7)o.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,D=this._videoTrack,w=this._littleEndian,B=new DataView(v,g,m);if(S){if(S.avcc!==void 0){var V=new Uint8Array(v,g,m);if(P(V,S.avcc))return;o.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=D.id,S.timescale=this._timescale,S.duration=this._duration;var G=B.getUint8(0),z=B.getUint8(1);if(B.getUint8(2),B.getUint8(3),G===1&&z!==0)if(this._naluLengthSize=1+(3&B.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var Y=31&B.getUint8(5);if(Y!==0){Y>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(Y));for(var q=6,X=0;X<Y;X++){var te=B.getUint16(q,!w);if(q+=2,te!==0){var ce=new Uint8Array(v,g+q,te);q+=te;var se=b.parseSPS(ce);if(X===0){S.codecWidth=se.codec_size.width,S.codecHeight=se.codec_size.height,S.presentWidth=se.present_size.width,S.presentHeight=se.present_size.height,S.profile=se.profile_string,S.level=se.level_string,S.bitDepth=se.bit_depth,S.chromaFormat=se.chroma_format,S.sarRatio=se.sar_ratio,S.frameRate=se.frame_rate,se.frame_rate.fixed!==!1&&se.frame_rate.fps_num!==0&&se.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var pe=S.frameRate.fps_den,ue=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(pe/ue);for(var de=ce.subarray(1,4),Ae="avc1.",ke=0;ke<3;ke++){var he=de[ke].toString(16);he.length<2&&(he="0"+he),Ae+=he}S.codec=Ae;var Te=this._mediaInfo;Te.width=S.codecWidth,Te.height=S.codecHeight,Te.fps=S.frameRate.fps,Te.profile=S.profile,Te.level=S.level,Te.refFrames=se.ref_frames,Te.chromaFormat=se.chroma_format_string,Te.sarNum=S.sarRatio.width,Te.sarDen=S.sarRatio.height,Te.videoCodec=Ae,Te.hasAudio?Te.audioCodec!=null&&(Te.mimeType='video/x-flv; codecs="'+Te.videoCodec+","+Te.audioCodec+'"'):Te.mimeType='video/x-flv; codecs="'+Te.videoCodec+'"',Te.isComplete()&&this._onMediaInfo(Te)}}}var Pe=B.getUint8(q);if(Pe!==0){for(Pe>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(Pe)),q++,X=0;X<Pe;X++)te=B.getUint16(q,!w),q+=2,te!==0&&(q+=te);S.avcc=new Uint8Array(m),S.avcc.set(new Uint8Array(v,g,m),0),o.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(I.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},E.prototype._parseHEVCDecoderConfigurationRecord=function(v,g,m){if(m<22)o.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,D=this._videoTrack,w=this._littleEndian,B=new DataView(v,g,m);if(S){if(S.hvcc!==void 0){var V=new Uint8Array(v,g,m);if(P(V,S.hvcc))return;o.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=D.id,S.timescale=this._timescale,S.duration=this._duration;var G=B.getUint8(0),z=31&B.getUint8(1);if(G!==0&&G!==1||z===0)this._onError(I.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&B.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var Y=B.getUint8(22),q=0,X=23;q<Y;q++){var te=63&B.getUint8(X+0),ce=B.getUint16(X+1,!w);X+=3;for(var se=0;se<ce;se++){var pe=B.getUint16(X+0,!w);if(se===0)if(te===33){X+=2;var ue=new Uint8Array(v,g+X,pe),de=T.parseSPS(ue);S.codecWidth=de.codec_size.width,S.codecHeight=de.codec_size.height,S.presentWidth=de.present_size.width,S.presentHeight=de.present_size.height,S.profile=de.profile_string,S.level=de.level_string,S.bitDepth=de.bit_depth,S.chromaFormat=de.chroma_format,S.sarRatio=de.sar_ratio,S.frameRate=de.frame_rate,de.frame_rate.fixed!==!1&&de.frame_rate.fps_num!==0&&de.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var Ae=S.frameRate.fps_den,ke=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(Ae/ke),S.codec=de.codec_mimetype;var he=this._mediaInfo;he.width=S.codecWidth,he.height=S.codecHeight,he.fps=S.frameRate.fps,he.profile=S.profile,he.level=S.level,he.refFrames=de.ref_frames,he.chromaFormat=de.chroma_format_string,he.sarNum=S.sarRatio.width,he.sarDen=S.sarRatio.height,he.videoCodec=de.codec_mimetype,he.hasAudio?he.audioCodec!=null&&(he.mimeType='video/x-flv; codecs="'+he.videoCodec+","+he.audioCodec+'"'):he.mimeType='video/x-flv; codecs="'+he.videoCodec+'"',he.isComplete()&&this._onMediaInfo(he),X+=pe}else X+=2+pe;else X+=2+pe}}S.hvcc=new Uint8Array(m),S.hvcc.set(new Uint8Array(v,g,m),0),o.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(I.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},E.prototype._parseAV1CodecConfigurationRecord=function(v,g,m){if(m<4)o.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var S=this._videoMetadata,D=this._videoTrack,w=(this._littleEndian,new DataView(v,g,m));S?S.av1c!==void 0&&o.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=D.id,S.timescale=this._timescale,S.duration=this._duration);var B=127&w.getUint8(0);if(w.getUint8(1),w.getUint8(1),w.getUint8(2),B===1){var V=A.parseOBUs(new Uint8Array(v,g+4,m-4));if(V!=null){S.profile=V.profile_string,S.level=V.level_string,S.bitDepth=V.bit_depth,S.chromaFormat=V.chroma_format,S.frameRate=V.frame_rate,V.frame_rate.fixed!==!1&&V.frame_rate.fps_num!==0&&V.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var G=S.frameRate.fps_den,z=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(G/z),S.codec=V.codec_mimetype,S.extra=V;var Y=this._mediaInfo;Y.fps=S.frameRate.fps,Y.profile=S.profile,Y.level=S.level,Y.refFrames=V.ref_frames,Y.chromaFormat=V.chroma_format_string,Y.videoCodec=V.codec_mimetype,Y.hasAudio?Y.audioCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+'"',Y.isComplete()&&this._onMediaInfo(Y),S.av1c=new Uint8Array(m),S.av1c.set(new Uint8Array(v,g,m),0),o.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},E.prototype._parseAVCVideoData=function(v,g,m,S,D,w,B){for(var V=this._littleEndian,G=new DataView(v,g,m),z=[],Y=0,q=0,X=this._naluLengthSize,te=this._timestampBase+S,ce=w===1;q<m;){if(q+4>=m){o.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(te,", offset = ").concat(q,", dataSize = ").concat(m));break}var se=G.getUint32(q,!V);if(X===3&&(se>>>=8),se>m-X)return void o.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(te,", NaluSize > DataSize!"));var pe=31&G.getUint8(q+X);pe===5&&(ce=!0);var ue=new Uint8Array(v,g+q,X+se),de={type:pe,data:ue};z.push(de),Y+=ue.byteLength,q+=X+se}if(z.length){var Ae=this._videoTrack,ke={units:z,length:Y,isKeyframe:ce,dts:te,cts:B,pts:te+B};ce&&(ke.fileposition=D),Ae.samples.push(ke),Ae.length+=Y}},E.prototype._parseHEVCVideoData=function(v,g,m,S,D,w,B){for(var V=this._littleEndian,G=new DataView(v,g,m),z=[],Y=0,q=0,X=this._naluLengthSize,te=this._timestampBase+S,ce=w===1;q<m;){if(q+4>=m){o.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(te,", offset = ").concat(q,", dataSize = ").concat(m));break}var se=G.getUint32(q,!V);if(X===3&&(se>>>=8),se>m-X)return void o.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(te,", NaluSize > DataSize!"));var pe=G.getUint8(q+X)>>1&63;pe!==19&&pe!==20&&pe!==21||(ce=!0);var ue=new Uint8Array(v,g+q,X+se),de={type:pe,data:ue};z.push(de),Y+=ue.byteLength,q+=X+se}if(z.length){var Ae=this._videoTrack,ke={units:z,length:Y,isKeyframe:ce,dts:te,cts:B,pts:te+B};ce&&(ke.fileposition=D),Ae.samples.push(ke),Ae.length+=Y}},E.prototype._parseAV1VideoData=function(v,g,m,S,D,w,B){this._littleEndian;var V,G=[],z=this._timestampBase+S,Y=w===1;if(Y){var q=this._videoMetadata,X=A.parseOBUs(new Uint8Array(v,g,m),q.extra);if(X==null)return void this._onError(I.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(X),q.codecWidth=X.codec_size.width,q.codecHeight=X.codec_size.height,q.presentWidth=X.present_size.width,q.presentHeight=X.present_size.height,q.sarRatio=X.sar_ratio;var te=this._mediaInfo;te.width=q.codecWidth,te.height=q.codecHeight,te.sarNum=q.sarRatio.width,te.sarDen=q.sarRatio.height,o.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",q)}if(V=m,G.push({unitType:0,data:new Uint8Array(v,g+0,m)}),G.length){var ce=this._videoTrack,se={units:G,length:V,isKeyframe:Y,dts:z,cts:B,pts:z+B};Y&&(se.fileposition=D),ce.samples.push(se),ce.length+=V}},E}(),U=function(){function E(){}return E.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},E}(),K=function(){this.program_pmt_pid={}};(function(E){E[E.kMPEG1Audio=3]="kMPEG1Audio",E[E.kMPEG2Audio=4]="kMPEG2Audio",E[E.kPESPrivateData=6]="kPESPrivateData",E[E.kADTSAAC=15]="kADTSAAC",E[E.kLOASAAC=17]="kLOASAAC",E[E.kAC3=129]="kAC3",E[E.kEAC3=135]="kEAC3",E[E.kMetadata=21]="kMetadata",E[E.kSCTE35=134]="kSCTE35",E[E.kH264=27]="kH264",E[E.kH265=36]="kH265"})(x||(x={}));var $,j=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},Q=function(){},ie=function(){},ee=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(E){E[E.kUnspecified=0]="kUnspecified",E[E.kSliceNonIDR=1]="kSliceNonIDR",E[E.kSliceDPA=2]="kSliceDPA",E[E.kSliceDPB=3]="kSliceDPB",E[E.kSliceDPC=4]="kSliceDPC",E[E.kSliceIDR=5]="kSliceIDR",E[E.kSliceSEI=6]="kSliceSEI",E[E.kSliceSPS=7]="kSliceSPS",E[E.kSlicePPS=8]="kSlicePPS",E[E.kSliceAUD=9]="kSliceAUD",E[E.kEndOfSequence=10]="kEndOfSequence",E[E.kEndOfStream=11]="kEndOfStream",E[E.kFiller=12]="kFiller",E[E.kSPSExt=13]="kSPSExt",E[E.kReserved0=14]="kReserved0"})($||($={}));var F,O,H=function(){},W=function(E){var v=E.data.byteLength;this.type=E.type,this.data=new Uint8Array(4+v),new DataView(this.data.buffer).setUint32(0,v),this.data.set(E.data,4)},ae=function(){function E(v){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=v,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return E.prototype.findNextStartCodeOffset=function(v){for(var g=v,m=this.data_;;){if(g+3>=m.byteLength)return this.eof_flag_=!0,m.byteLength;var S=m[g+0]<<24|m[g+1]<<16|m[g+2]<<8|m[g+3],D=m[g+0]<<16|m[g+1]<<8|m[g+2];if(S===1||D===1)return g;g++}},E.prototype.readNextNaluPayload=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_startcode_offset_,S=31&v[m+=(v[m]<<24|v[m+1]<<16|v[m+2]<<8|v[m+3])===1?4:3],D=(128&v[m])>>>7,w=this.findNextStartCodeOffset(m);if(this.current_startcode_offset_=w,!(S>=$.kReserved0)&&D===0){var B=v.subarray(m,w);(g=new H).type=S,g.data=B}}return g},E}(),le=function(){function E(v,g,m){var S=8+v.byteLength+1+2+g.byteLength,D=!1;v[3]!==66&&v[3]!==77&&v[3]!==88&&(D=!0,S+=4);var w=this.data=new Uint8Array(S);w[0]=1,w[1]=v[1],w[2]=v[2],w[3]=v[3],w[4]=255,w[5]=225;var B=v.byteLength;w[6]=B>>>8,w[7]=255&B;var V=8;w.set(v,8),w[V+=B]=1;var G=g.byteLength;w[V+1]=G>>>8,w[V+2]=255&G,w.set(g,V+3),V+=3+G,D&&(w[V]=252|m.chroma_format_idc,w[V+1]=248|m.bit_depth_luma-8,w[V+2]=248|m.bit_depth_chroma-8,w[V+3]=0,V+=4)}return E.prototype.getData=function(){return this.data},E}();(function(E){E[E.kNull=0]="kNull",E[E.kAACMain=1]="kAACMain",E[E.kAAC_LC=2]="kAAC_LC",E[E.kAAC_SSR=3]="kAAC_SSR",E[E.kAAC_LTP=4]="kAAC_LTP",E[E.kAAC_SBR=5]="kAAC_SBR",E[E.kAAC_Scalable=6]="kAAC_Scalable",E[E.kLayer1=32]="kLayer1",E[E.kLayer2=33]="kLayer2",E[E.kLayer3=34]="kLayer3"})(F||(F={})),function(E){E[E.k96000Hz=0]="k96000Hz",E[E.k88200Hz=1]="k88200Hz",E[E.k64000Hz=2]="k64000Hz",E[E.k48000Hz=3]="k48000Hz",E[E.k44100Hz=4]="k44100Hz",E[E.k32000Hz=5]="k32000Hz",E[E.k24000Hz=6]="k24000Hz",E[E.k22050Hz=7]="k22050Hz",E[E.k16000Hz=8]="k16000Hz",E[E.k12000Hz=9]="k12000Hz",E[E.k11025Hz=10]="k11025Hz",E[E.k8000Hz=11]="k8000Hz",E[E.k7350Hz=12]="k7350Hz"}(O||(O={}));var ye,me,re=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],oe=(ye=function(E,v){return(ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,m){g.__proto__=m}||function(g,m){for(var S in m)Object.prototype.hasOwnProperty.call(m,S)&&(g[S]=m[S])})(E,v)},function(E,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");function g(){this.constructor=E}ye(E,v),E.prototype=v===null?Object.create(v):(g.prototype=v.prototype,new g)}),fe=function(){},be=function(E){function v(){return E!==null&&E.apply(this,arguments)||this}return oe(v,E),v}(fe),xe=function(){function E(v){this.TAG="AACADTSParser",this.data_=v,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return E.prototype.findNextSyncwordOffset=function(v){for(var g=v,m=this.data_;;){if(g+7>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[g+0]<<8|m[g+1])>>>4===4095)return g;g++}},E.prototype.readNextAACFrame=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_syncword_offset_,S=(8&v[m+1])>>>3,D=(6&v[m+1])>>>1,w=1&v[m+1],B=(192&v[m+2])>>>6,V=(60&v[m+2])>>>2,G=(1&v[m+2])<<2|(192&v[m+3])>>>6,z=(3&v[m+3])<<11|v[m+4]<<3|(224&v[m+5])>>>5;if(v[m+6],m+z>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var Y=w===1?7:9,q=z-Y;m+=Y;var X=this.findNextSyncwordOffset(m+q);if(this.current_syncword_offset_=X,(S===0||S===1)&&D===0){var te=v.subarray(m,m+q);(g=new fe).audio_object_type=B+1,g.sampling_freq_index=V,g.sampling_frequency=re[V],g.channel_config=G,g.data=te}}return g},E.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},E.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},E}(),Ce=function(){function E(v){this.TAG="AACLOASParser",this.data_=v,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return E.prototype.findNextSyncwordOffset=function(v){for(var g=v,m=this.data_;;){if(g+1>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[g+0]<<3|m[g+1]>>>5)===695)return g;g++}},E.prototype.getLATMValue=function(v){for(var g=v.readBits(2),m=0,S=0;S<=g;S++)m<<=8,m|=v.readByte();return m},E.prototype.readNextAACFrame=function(v){for(var g=this.data_,m=null;m==null&&!this.eof_flag_;){var S=this.current_syncword_offset_,D=(31&g[S+1])<<8|g[S+2];if(S+3+D>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var w=new y(g.subarray(S+3,S+3+D)),B=null;if(w.readBool()){if(v==null){o.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(S+3+D),w.destroy();continue}B=v}else{var V=w.readBool();if(V&&w.readBool()){o.a.e(this.TAG,"audioMuxVersionA is Not Supported"),w.destroy();break}if(V&&this.getLATMValue(w),!w.readBool()){o.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),w.destroy();break}if(w.readBits(6)!==0){o.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),w.destroy();break}if(w.readBits(4)!==0){o.a.e(this.TAG,"more than 2 numProgram Not Supported"),w.destroy();break}if(w.readBits(3)!==0){o.a.e(this.TAG,"more than 2 numLayer Not Supported"),w.destroy();break}var G=V?this.getLATMValue(w):0,z=w.readBits(5);G-=5;var Y=w.readBits(4);G-=4;var q=w.readBits(4);G-=4,w.readBits(3),(G-=3)>0&&w.readBits(G);var X=w.readBits(3);if(X!==0){o.a.e(this.TAG,"frameLengthType = ".concat(X,". Only frameLengthType = 0 Supported")),w.destroy();break}w.readByte();var te=w.readBool();if(te)if(V)this.getLATMValue(w);else{for(var ce=0;;){ce<<=8;var se=w.readBool();if(ce+=w.readByte(),!se)break}console.log(ce)}w.readBool()&&w.readByte(),(B=new be).audio_object_type=z,B.sampling_freq_index=Y,B.sampling_frequency=re[B.sampling_freq_index],B.channel_config=q,B.other_data_present=te}for(var pe=0;;){var ue=w.readByte();if(pe+=ue,ue!==255)break}for(var de=new Uint8Array(pe),Ae=0;Ae<pe;Ae++)de[Ae]=w.readByte();(m=new be).audio_object_type=B.audio_object_type,m.sampling_freq_index=B.sampling_freq_index,m.sampling_frequency=re[B.sampling_freq_index],m.channel_config=B.channel_config,m.other_data_present=B.other_data_present,m.data=de,this.current_syncword_offset_=this.findNextSyncwordOffset(S+3+D)}return m},E.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},E.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},E}(),ze=function(E){var v=null,g=E.audio_object_type,m=E.audio_object_type,S=E.sampling_freq_index,D=E.channel_config,w=0,B=navigator.userAgent.toLowerCase();B.indexOf("firefox")!==-1?S>=6?(m=5,v=new Array(4),w=S-3):(m=2,v=new Array(2),w=S):B.indexOf("android")!==-1?(m=2,v=new Array(2),w=S):(m=5,w=S,v=new Array(4),S>=6?w=S-3:D===1&&(m=2,v=new Array(2),w=S)),v[0]=m<<3,v[0]|=(15&S)>>>1,v[1]=(15&S)<<7,v[1]|=(15&D)<<3,m===5&&(v[1]|=(15&w)>>>1,v[2]=(1&w)<<7,v[2]|=8,v[3]=0),this.config=v,this.sampling_rate=re[S],this.channel_count=D,this.codec_mimetype="mp4a.40."+m,this.original_codec_mimetype="mp4a.40."+g},Ye=function(){},ot=function(){};(function(E){E[E.kSpliceNull=0]="kSpliceNull",E[E.kSpliceSchedule=4]="kSpliceSchedule",E[E.kSpliceInsert=5]="kSpliceInsert",E[E.kTimeSignal=6]="kTimeSignal",E[E.kBandwidthReservation=7]="kBandwidthReservation",E[E.kPrivateCommand=255]="kPrivateCommand"})(me||(me={}));var ve,_e=function(E){var v=E.readBool();return v?(E.readBits(6),{time_specified_flag:v,pts_time:4*E.readBits(31)+E.readBits(2)}):(E.readBits(7),{time_specified_flag:v})},Je=function(E){var v=E.readBool();return E.readBits(6),{auto_return:v,duration:4*E.readBits(31)+E.readBits(2)}},Qe=function(E,v){var g=v.readBits(8);return E?{component_tag:g}:{component_tag:g,splice_time:_e(v)}},Ze=function(E){return{component_tag:E.readBits(8),utc_splice_time:E.readBits(32)}},ut=function(E){var v=E.readBits(32),g=E.readBool();E.readBits(7);var m={splice_event_id:v,splice_event_cancel_indicator:g};if(g)return m;if(m.out_of_network_indicator=E.readBool(),m.program_splice_flag=E.readBool(),m.duration_flag=E.readBool(),E.readBits(5),m.program_splice_flag)m.utc_splice_time=E.readBits(32);else{m.component_count=E.readBits(8),m.components=[];for(var S=0;S<m.component_count;S++)m.components.push(Ze(E))}return m.duration_flag&&(m.break_duration=Je(E)),m.unique_program_id=E.readBits(16),m.avail_num=E.readBits(8),m.avails_expected=E.readBits(8),m},st=function(E,v,g,m){return{descriptor_tag:E,descriptor_length:v,identifier:g,provider_avail_id:m.readBits(32)}},pt=function(E,v,g,m){var S=m.readBits(8),D=m.readBits(3);m.readBits(5);for(var w="",B=0;B<D;B++)w+=String.fromCharCode(m.readBits(8));return{descriptor_tag:E,descriptor_length:v,identifier:g,preroll:S,dtmf_count:D,DTMF_char:w}},Et=function(E){var v=E.readBits(8);return E.readBits(7),{component_tag:v,pts_offset:4*E.readBits(31)+E.readBits(2)}},Yt=function(E,v,g,m){var S=m.readBits(32),D=m.readBool();m.readBits(7);var w={descriptor_tag:E,descriptor_length:v,identifier:g,segmentation_event_id:S,segmentation_event_cancel_indicator:D};if(D)return w;if(w.program_segmentation_flag=m.readBool(),w.segmentation_duration_flag=m.readBool(),w.delivery_not_restricted_flag=m.readBool(),w.delivery_not_restricted_flag?m.readBits(5):(w.web_delivery_allowed_flag=m.readBool(),w.no_regional_blackout_flag=m.readBool(),w.archive_allowed_flag=m.readBool(),w.device_restrictions=m.readBits(2)),!w.program_segmentation_flag){w.component_count=m.readBits(8),w.components=[];for(var B=0;B<w.component_count;B++)w.components.push(Et(m))}w.segmentation_duration_flag&&(w.segmentation_duration=m.readBits(40)),w.segmentation_upid_type=m.readBits(8),w.segmentation_upid_length=m.readBits(8);var V=new Uint8Array(w.segmentation_upid_length);for(B=0;B<w.segmentation_upid_length;B++)V[B]=m.readBits(8);return w.segmentation_upid=V.buffer,w.segmentation_type_id=m.readBits(8),w.segment_num=m.readBits(8),w.segments_expected=m.readBits(8),w.segmentation_type_id!==52&&w.segmentation_type_id!==54&&w.segmentation_type_id!==56&&w.segmentation_type_id!==58||(w.sub_segment_num=m.readBits(8),w.sub_segments_expected=m.readBits(8)),w},St=function(E,v,g,m){return{descriptor_tag:E,descriptor_length:v,identifier:g,TAI_seconds:m.readBits(48),TAI_ns:m.readBits(32),UTC_offset:m.readBits(16)}},wt=function(E){return{component_tag:E.readBits(8),ISO_code:String.fromCharCode(E.readBits(8),E.readBits(8),E.readBits(8)),Bit_Stream_Mode:E.readBits(3),Num_Channels:E.readBits(4),Full_Srvc_Audio:E.readBool()}},bi=function(E,v,g,m){for(var S=m.readBits(4),D=[],w=0;w<S;w++)D.push(wt(m));return{descriptor_tag:E,descriptor_length:v,identifier:g,audio_count:S,components:D}},ai=function(E){var v=new y(E),g=v.readBits(8),m=v.readBool(),S=v.readBool();v.readBits(2);var D=v.readBits(12),w=v.readBits(8),B=v.readBool(),V=v.readBits(6),G=4*v.readBits(31)+v.readBits(2),z=v.readBits(8),Y=v.readBits(12),q=v.readBits(12),X=v.readBits(8),te=null;X===me.kSpliceNull?te={}:X===me.kSpliceSchedule?te=function(Ie){for(var Ue=Ie.readBits(8),je=[],we=0;we<Ue;we++)je.push(ut(Ie));return{splice_count:Ue,events:je}}(v):X===me.kSpliceInsert?te=function(Ie){var Ue=Ie.readBits(32),je=Ie.readBool();Ie.readBits(7);var we={splice_event_id:Ue,splice_event_cancel_indicator:je};if(je)return we;if(we.out_of_network_indicator=Ie.readBool(),we.program_splice_flag=Ie.readBool(),we.duration_flag=Ie.readBool(),we.splice_immediate_flag=Ie.readBool(),Ie.readBits(4),we.program_splice_flag&&!we.splice_immediate_flag&&(we.splice_time=_e(Ie)),!we.program_splice_flag){we.component_count=Ie.readBits(8),we.components=[];for(var Oe=0;Oe<we.component_count;Oe++)we.components.push(Qe(we.splice_immediate_flag,Ie))}return we.duration_flag&&(we.break_duration=Je(Ie)),we.unique_program_id=Ie.readBits(16),we.avail_num=Ie.readBits(8),we.avails_expected=Ie.readBits(8),we}(v):X===me.kTimeSignal?te=function(Ie){return{splice_time:_e(Ie)}}(v):X===me.kBandwidthReservation?te={}:X===me.kPrivateCommand?te=function(Ie,Ue){for(var je=String.fromCharCode(Ue.readBits(8),Ue.readBits(8),Ue.readBits(8),Ue.readBits(8)),we=new Uint8Array(Ie-4),Oe=0;Oe<Ie-4;Oe++)we[Oe]=Ue.readBits(8);return{identifier:je,private_data:we.buffer}}(q,v):v.readBits(8*q);for(var ce=[],se=v.readBits(16),pe=0;pe<se;){var ue=v.readBits(8),de=v.readBits(8),Ae=String.fromCharCode(v.readBits(8),v.readBits(8),v.readBits(8),v.readBits(8));ue===0?ce.push(st(ue,de,Ae,v)):ue===1?ce.push(pt(ue,de,Ae,v)):ue===2?ce.push(Yt(ue,de,Ae,v)):ue===3?ce.push(St(ue,de,Ae,v)):ue===4?ce.push(bi(ue,de,Ae,v)):v.readBits(8*(de-4)),pe+=2+de}var ke={table_id:g,section_syntax_indicator:m,private_indicator:S,section_length:D,protocol_version:w,encrypted_packet:B,encryption_algorithm:V,pts_adjustment:G,cw_index:z,tier:Y,splice_command_length:q,splice_command_type:X,splice_command:te,descriptor_loop_length:se,splice_descriptors:ce,E_CRC32:B?v.readBits(32):void 0,CRC32:v.readBits(32)};if(X===me.kSpliceInsert){var he=te;if(he.splice_event_cancel_indicator)return{splice_command_type:X,detail:ke,data:E};if(he.program_splice_flag&&!he.splice_immediate_flag){var Te=he.duration_flag?he.break_duration.auto_return:void 0,Pe=he.duration_flag?he.break_duration.duration/90:void 0;return he.splice_time.time_specified_flag?{splice_command_type:X,pts:(G+he.splice_time.pts_time)%Math.pow(2,33),auto_return:Te,duraiton:Pe,detail:ke,data:E}:{splice_command_type:X,auto_return:Te,duraiton:Pe,detail:ke,data:E}}return{splice_command_type:X,auto_return:Te=he.duration_flag?he.break_duration.auto_return:void 0,duraiton:Pe=he.duration_flag?he.break_duration.duration/90:void 0,detail:ke,data:E}}if(X===me.kTimeSignal){var Le=te;return Le.splice_time.time_specified_flag?{splice_command_type:X,pts:(G+Le.splice_time.pts_time)%Math.pow(2,33),detail:ke,data:E}:{splice_command_type:X,detail:ke,data:E}}return{splice_command_type:X,detail:ke,data:E}};(function(E){E[E.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",E[E.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",E[E.kSliceCRA_NUT=21]="kSliceCRA_NUT",E[E.kSliceVPS=32]="kSliceVPS",E[E.kSliceSPS=33]="kSliceSPS",E[E.kSlicePPS=34]="kSlicePPS",E[E.kSliceAUD=35]="kSliceAUD"})(ve||(ve={}));var oi=function(){},Nt=function(E){var v=E.data.byteLength;this.type=E.type,this.data=new Uint8Array(4+v),new DataView(this.data.buffer).setUint32(0,v),this.data.set(E.data,4)},Lr=function(){function E(v){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=v,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return E.prototype.findNextStartCodeOffset=function(v){for(var g=v,m=this.data_;;){if(g+3>=m.byteLength)return this.eof_flag_=!0,m.byteLength;var S=m[g+0]<<24|m[g+1]<<16|m[g+2]<<8|m[g+3],D=m[g+0]<<16|m[g+1]<<8|m[g+2];if(S===1||D===1)return g;g++}},E.prototype.readNextNaluPayload=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_startcode_offset_,S=v[m+=(v[m]<<24|v[m+1]<<16|v[m+2]<<8|v[m+3])===1?4:3]>>1&63,D=(128&v[m])>>>7,w=this.findNextStartCodeOffset(m);if(this.current_startcode_offset_=w,D===0){var B=v.subarray(m,w);(g=new oi).type=S,g.data=B}}return g},E}(),Rr=function(){function E(v,g,m,S){var D=23+(5+v.byteLength)+(5+g.byteLength)+(5+m.byteLength),w=this.data=new Uint8Array(D);w[0]=1,w[1]=(3&S.general_profile_space)<<6|(S.general_tier_flag?1:0)<<5|31&S.general_profile_idc,w[2]=S.general_profile_compatibility_flags_1,w[3]=S.general_profile_compatibility_flags_2,w[4]=S.general_profile_compatibility_flags_3,w[5]=S.general_profile_compatibility_flags_4,w[6]=S.general_constraint_indicator_flags_1,w[7]=S.general_constraint_indicator_flags_2,w[8]=S.general_constraint_indicator_flags_3,w[9]=S.general_constraint_indicator_flags_4,w[10]=S.general_constraint_indicator_flags_5,w[11]=S.general_constraint_indicator_flags_6,w[12]=S.general_level_idc,w[13]=240|(3840&S.min_spatial_segmentation_idc)>>8,w[14]=255&S.min_spatial_segmentation_idc,w[15]=252|3&S.parallelismType,w[16]=252|3&S.chroma_format_idc,w[17]=248|7&S.bit_depth_luma_minus8,w[18]=248|7&S.bit_depth_chroma_minus8,w[19]=0,w[20]=0,w[21]=(3&S.constant_frame_rate)<<6|(7&S.num_temporal_layers)<<3|(S.temporal_id_nested?1:0)<<2|3,w[22]=3,w[23]=128|ve.kSliceVPS,w[24]=0,w[25]=1,w[26]=(65280&v.byteLength)>>8,w[27]=(255&v.byteLength)>>0,w.set(v,28),w[23+(5+v.byteLength)+0]=128|ve.kSliceSPS,w[23+(5+v.byteLength)+1]=0,w[23+(5+v.byteLength)+2]=1,w[23+(5+v.byteLength)+3]=(65280&g.byteLength)>>8,w[23+(5+v.byteLength)+4]=(255&g.byteLength)>>0,w.set(g,23+(5+v.byteLength)+5),w[23+(5+v.byteLength+5+g.byteLength)+0]=128|ve.kSlicePPS,w[23+(5+v.byteLength+5+g.byteLength)+1]=0,w[23+(5+v.byteLength+5+g.byteLength)+2]=1,w[23+(5+v.byteLength+5+g.byteLength)+3]=(65280&m.byteLength)>>8,w[23+(5+v.byteLength+5+g.byteLength)+4]=(255&m.byteLength)>>0,w.set(m,23+(5+v.byteLength+5+g.byteLength)+5)}return E.prototype.getData=function(){return this.data},E}(),Ir=function(){},wr=function(){},Dr=function(){},Cr=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],kr=function(){function E(v){this.TAG="AC3Parser",this.data_=v,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return E.prototype.findNextSyncwordOffset=function(v){for(var g=v,m=this.data_;;){if(g+7>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[g+0]<<8|m[g+1]<<0)===2935)return g;g++}},E.prototype.readNextAC3Frame=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_syncword_offset_,S=v[m+4]>>6,D=[48e3,44200,33e3][S],w=63&v[m+4],B=2*Cr[S][w];if(isNaN(B)||m+B>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var V=this.findNextSyncwordOffset(m+B);this.current_syncword_offset_=V;var G=v[m+5]>>3,z=7&v[m+5],Y=v[m+6]>>5,q=0;1&Y&&Y!==1&&(q+=2),4&Y&&(q+=2),Y===2&&(q+=2);var X=(v[m+6]<<8|v[m+7]<<0)>>12-q&1,te=[2,1,2,3,3,4,4,5][Y]+X;(g=new Dr).sampling_frequency=D,g.channel_count=te,g.channel_mode=Y,g.bit_stream_identification=G,g.low_frequency_effects_channel_on=X,g.bit_stream_mode=z,g.frame_size_code=w,g.data=v.subarray(m,m+B)}return g},E.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},E.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},E}(),Pr=function(E){var v;v=[E.sampling_rate_code<<6|E.bit_stream_identification<<1|E.bit_stream_mode>>2,(3&E.bit_stream_mode)<<6|E.channel_mode<<3|E.low_frequency_effects_channel_on<<2|E.frame_size_code>>4,E.frame_size_code<<4&224],this.config=v,this.sampling_rate=E.sampling_frequency,this.bit_stream_identification=E.bit_stream_identification,this.bit_stream_mode=E.bit_stream_mode,this.low_frequency_effects_channel_on=E.low_frequency_effects_channel_on,this.channel_count=E.channel_count,this.channel_mode=E.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Fe=function(){},Wo=function(){function E(v){this.TAG="EAC3Parser",this.data_=v,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return E.prototype.findNextSyncwordOffset=function(v){for(var g=v,m=this.data_;;){if(g+7>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[g+0]<<8|m[g+1]<<0)===2935)return g;g++}},E.prototype.readNextEAC3Frame=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_syncword_offset_,S=new y(v.subarray(m+2)),D=(S.readBits(2),S.readBits(3),S.readBits(11)+1<<1),w=S.readBits(2),B=null,V=null;w===3?(B=[24e3,22060,16e3][w=S.readBits(2)],V=3):(B=[48e3,44100,32e3][w],V=S.readBits(2));var G=S.readBits(3),z=S.readBits(1),Y=S.readBits(5);if(m+D>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var q=this.findNextSyncwordOffset(m+D);this.current_syncword_offset_=q;var X=[2,1,2,3,3,4,4,5][G]+z;S.destroy(),(g=new Fe).sampling_frequency=B,g.channel_count=X,g.channel_mode=G,g.bit_stream_identification=Y,g.low_frequency_effects_channel_on=z,g.frame_size=D,g.num_blks=[1,2,3,6][V],g.data=v.subarray(m,m+D)}return g},E.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},E.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},E}(),Xo=function(E){var v,g=Math.floor(E.frame_size*E.sampling_frequency/(16*E.num_blks));v=[255&g,248&g,E.sampling_rate_code<<6|E.bit_stream_identification<<1|0,0|E.channel_mode<<1|E.low_frequency_effects_channel_on<<0,0],this.config=v,this.sampling_rate=E.sampling_frequency,this.bit_stream_identification=E.bit_stream_identification,this.num_blks=E.num_blks,this.low_frequency_effects_channel_on=E.low_frequency_effects_channel_on,this.channel_count=E.channel_count,this.channel_mode=E.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},Qo=function(){},Zo=function(){function E(v){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=v,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return E._ebsp2rbsp=function(v){for(var g=v,m=g.byteLength,S=new Uint8Array(m),D=0,w=0;w<m;w++)w>=2&&g[w]===3&&g[w-1]===0&&g[w-2]===0||(S[D]=g[w],D++);return new Uint8Array(S.buffer,0,D)},E.prototype.findNextStartCodeOffset=function(v){for(var g=v,m=this.data_;;){if(g+2>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[g+0]<<16|m[g+1]<<8|m[g+2])===1)return g;g++}},E.prototype.readNextOBUPayload=function(){for(var v=this.data_,g=null;g==null&&!this.eof_flag_;){var m=this.current_startcode_offset_+3,S=this.findNextStartCodeOffset(m);this.current_startcode_offset_=S,g=E._ebsp2rbsp(v.subarray(m,S))}return g},E}(),Jo=function(){var E=function(v,g){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,S){m.__proto__=S}||function(m,S){for(var D in S)Object.prototype.hasOwnProperty.call(S,D)&&(m[D]=S[D])})(v,g)};return function(v,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function m(){this.constructor=v}E(v,g),v.prototype=g===null?Object.create(g):(m.prototype=g.prototype,new m)}}(),ti=function(){return(ti=Object.assign||function(E){for(var v,g=1,m=arguments.length;g<m;g++)for(var S in v=arguments[g])Object.prototype.hasOwnProperty.call(v,S)&&(E[S]=v[S]);return E}).apply(this,arguments)},Ws=function(E){function v(g,m){var S=E.call(this)||this;return S.TAG="TSDemuxer",S.first_parse_=!0,S.media_info_=new l.a,S.timescale_=90,S.duration_=0,S.current_pmt_pid_=-1,S.program_pmt_map_={},S.pes_slice_queues_={},S.section_slice_queues_={},S.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},S.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},S.last_pcr_base_=NaN,S.timestamp_offset_=0,S.audio_last_sample_pts_=void 0,S.aac_last_incomplete_data_=null,S.has_video_=!1,S.has_audio_=!1,S.video_init_segment_dispatched_=!1,S.audio_init_segment_dispatched_=!1,S.video_metadata_changed_=!1,S.audio_metadata_changed_=!1,S.loas_previous_frame=null,S.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},S.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},S.ts_packet_size_=g.ts_packet_size,S.sync_offset_=g.sync_offset,S.config_=m,S}return Jo(v,E),v.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,E.prototype.destroy.call(this)},v.probe=function(g){var m=new Uint8Array(g),S=-1,D=188;if(m.byteLength<=3*D)return{needMoreData:!0};for(;S===-1;){for(var w=Math.min(1e3,m.byteLength-3*D),B=0;B<w;){if(m[B]===71&&m[B+D]===71&&m[B+2*D]===71){S=B;break}B++}if(S===-1)if(D===188)D=192;else{if(D!==192)break;D=204}}return S===-1?{match:!1}:(D===192&&S>=4?(o.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),S-=4):D===204&&o.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:D,sync_offset:S})},v.prototype.bindDataSource=function(g){return g.onDataArrival=this.parseChunks.bind(this),this},v.prototype.resetMediaInfo=function(){this.media_info_=new l.a},v.prototype.parseChunks=function(g,m){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new f.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var S=0;for(this.first_parse_&&(this.first_parse_=!1,S=this.sync_offset_);S+this.ts_packet_size_<=g.byteLength;){var D=m+S;this.ts_packet_size_===192&&(S+=4);var w=new Uint8Array(g,S,188),B=w[0];if(B!==71){o.a.e(this.TAG,"sync_byte = ".concat(B,", not 0x47"));break}var V=(64&w[1])>>>6,G=(w[1],(31&w[1])<<8|w[2]),z=(48&w[3])>>>4,Y=15&w[3],q=!(!this.pmt_||this.pmt_.pcr_pid!==G),X={},te=4;if(z==2||z==3){var ce=w[4];if(ce>0&&(q||z==3)&&(X.discontinuity_indicator=(128&w[5])>>>7,X.random_access_indicator=(64&w[5])>>>6,X.elementary_stream_priority_indicator=(32&w[5])>>>5,(16&w[5])>>>4)){var se=300*this.getPcrBase(w)+((1&w[10])<<8|w[11]);this.last_pcr_=se}if(z==2||5+ce===188){S+=188,this.ts_packet_size_===204&&(S+=16);continue}te=5+ce}if(z==1||z==3){if(G===0||G===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[G]===x.kSCTE35){var pe=188-te;this.handleSectionSlice(g,S+te,pe,{pid:G,file_position:D,payload_unit_start_indicator:V,continuity_conunter:Y,random_access_indicator:X.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[G]!=null){pe=188-te;var ue=this.pmt_.pid_stream_type[G];G!==this.pmt_.common_pids.h264&&G!==this.pmt_.common_pids.h265&&G!==this.pmt_.common_pids.av1&&G!==this.pmt_.common_pids.adts_aac&&G!==this.pmt_.common_pids.loas_aac&&G!==this.pmt_.common_pids.ac3&&G!==this.pmt_.common_pids.eac3&&G!==this.pmt_.common_pids.opus&&G!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[G]!==!0&&this.pmt_.timed_id3_pids[G]!==!0&&this.pmt_.synchronous_klv_pids[G]!==!0&&this.pmt_.asynchronous_klv_pids[G]!==!0||this.handlePESSlice(g,S+te,pe,{pid:G,stream_type:ue,file_position:D,payload_unit_start_indicator:V,continuity_conunter:Y,random_access_indicator:X.random_access_indicator})}}S+=188,this.ts_packet_size_===204&&(S+=16)}return this.dispatchAudioVideoMediaSegment(),S},v.prototype.handleSectionSlice=function(g,m,S,D){var w=new Uint8Array(g,m,S),B=this.section_slice_queues_[D.pid];if(D.payload_unit_start_indicator){var V=w[0];if(B!=null&&B.total_length!==0){var G=new Uint8Array(g,m+1,Math.min(S,V));B.slices.push(G),B.total_length+=G.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,D):this.clearSlices(B,D)}for(var z=1+V;z<w.byteLength&&w[z+0]!==255;){var Y=(15&w[z+1])<<8|w[z+2];this.section_slice_queues_[D.pid]=new ee,(B=this.section_slice_queues_[D.pid]).expected_length=Y+3,B.file_position=D.file_position,B.random_access_indicator=D.random_access_indicator,G=new Uint8Array(g,m+z,Math.min(S-z,B.expected_length-B.total_length)),B.slices.push(G),B.total_length+=G.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,D):B.total_length>=B.expected_length&&this.clearSlices(B,D),z+=G.byteLength}}else B!=null&&B.total_length!==0&&(G=new Uint8Array(g,m,Math.min(S,B.expected_length-B.total_length)),B.slices.push(G),B.total_length+=G.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,D):B.total_length>=B.expected_length&&this.clearSlices(B,D))},v.prototype.handlePESSlice=function(g,m,S,D){var w=new Uint8Array(g,m,S),B=w[0]<<16|w[1]<<8|w[2],V=(w[3],w[4]<<8|w[5]);if(D.payload_unit_start_indicator){if(B!==1)return void o.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(B));var G=this.pes_slice_queues_[D.pid];G&&(G.expected_length===0||G.expected_length===G.total_length?this.emitPESSlices(G,D):this.clearSlices(G,D)),this.pes_slice_queues_[D.pid]=new ee,this.pes_slice_queues_[D.pid].file_position=D.file_position,this.pes_slice_queues_[D.pid].random_access_indicator=D.random_access_indicator}if(this.pes_slice_queues_[D.pid]!=null){var z=this.pes_slice_queues_[D.pid];z.slices.push(w),D.payload_unit_start_indicator&&(z.expected_length=V===0?0:V+6),z.total_length+=w.byteLength,z.expected_length>0&&z.expected_length===z.total_length?this.emitPESSlices(z,D):z.expected_length>0&&z.expected_length<z.total_length&&this.clearSlices(z,D)}},v.prototype.emitSectionSlices=function(g,m){for(var S=new Uint8Array(g.total_length),D=0,w=0;D<g.slices.length;D++){var B=g.slices[D];S.set(B,w),w+=B.byteLength}g.slices=[],g.expected_length=-1,g.total_length=0;var V=new ie;V.pid=m.pid,V.data=S,V.file_position=g.file_position,V.random_access_indicator=g.random_access_indicator,this.parseSection(V)},v.prototype.emitPESSlices=function(g,m){for(var S=new Uint8Array(g.total_length),D=0,w=0;D<g.slices.length;D++){var B=g.slices[D];S.set(B,w),w+=B.byteLength}g.slices=[],g.expected_length=-1,g.total_length=0;var V=new Q;V.pid=m.pid,V.data=S,V.stream_type=m.stream_type,V.file_position=g.file_position,V.random_access_indicator=g.random_access_indicator,this.parsePES(V)},v.prototype.clearSlices=function(g,m){g.slices=[],g.expected_length=-1,g.total_length=0},v.prototype.parseSection=function(g){var m=g.data,S=g.pid;S===0?this.parsePAT(m):S===this.current_pmt_pid_?this.parsePMT(m):this.pmt_!=null&&this.pmt_.scte_35_pids[S]&&this.parseSCTE35(m)},v.prototype.parsePES=function(g){var m=g.data,S=m[0]<<16|m[1]<<8|m[2],D=m[3],w=m[4]<<8|m[5];if(S===1)if(D!==188&&D!==190&&D!==191&&D!==240&&D!==241&&D!==255&&D!==242&&D!==248){m[6];var B=(192&m[7])>>>6,V=m[8],G=void 0,z=void 0;B!==2&&B!==3||(G=this.getTimestamp(m,9),z=B===3?this.getTimestamp(m,14):G);var Y=9+V,q=void 0;if(w!==0){if(w<3+V)return void o.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");q=w-3-V}else q=m.byteLength-Y;var X=m.subarray(Y,Y+q);switch(g.stream_type){case x.kMPEG1Audio:case x.kMPEG2Audio:this.parseMP3Payload(X,G);break;case x.kPESPrivateData:this.pmt_.common_pids.av1===g.pid?this.parseAV1Payload(X,G,z,g.file_position,g.random_access_indicator):this.pmt_.common_pids.opus===g.pid?this.parseOpusPayload(X,G):this.pmt_.common_pids.ac3===g.pid?this.parseAC3Payload(X,G):this.pmt_.common_pids.eac3===g.pid?this.parseEAC3Payload(X,G):this.pmt_.asynchronous_klv_pids[g.pid]?this.parseAsynchronousKLVMetadataPayload(X,g.pid,D):this.pmt_.smpte2038_pids[g.pid]?this.parseSMPTE2038MetadataPayload(X,G,z,g.pid,D):this.parsePESPrivateDataPayload(X,G,z,g.pid,D);break;case x.kADTSAAC:this.parseADTSAACPayload(X,G);break;case x.kLOASAAC:this.parseLOASAACPayload(X,G);break;case x.kAC3:this.parseAC3Payload(X,G);break;case x.kEAC3:this.parseEAC3Payload(X,G);break;case x.kMetadata:this.pmt_.timed_id3_pids[g.pid]?this.parseTimedID3MetadataPayload(X,G,z,g.pid,D):this.pmt_.synchronous_klv_pids[g.pid]&&this.parseSynchronousKLVMetadataPayload(X,G,z,g.pid,D);break;case x.kH264:this.parseH264Payload(X,G,z,g.file_position,g.random_access_indicator);break;case x.kH265:this.parseH265Payload(X,G,z,g.file_position,g.random_access_indicator)}}else(D===188||D===191||D===240||D===241||D===255||D===242||D===248)&&g.stream_type===x.kPESPrivateData&&(Y=6,q=void 0,q=w!==0?w:m.byteLength-Y,X=m.subarray(Y,Y+q),this.parsePESPrivateDataPayload(X,void 0,void 0,g.pid,D));else o.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(S))},v.prototype.parsePAT=function(g){var m=g[0];if(m===0){var S=(15&g[1])<<8|g[2],D=(g[3],g[4],(62&g[5])>>>1),w=1&g[5],B=g[6],V=(g[7],null);if(w===1&&B===0)(V=new K).version_number=D;else if((V=this.pat_)==null)return;for(var G=S-5-4,z=-1,Y=-1,q=8;q<8+G;q+=4){var X=g[q]<<8|g[q+1],te=(31&g[q+2])<<8|g[q+3];X===0?V.network_pid=te:(V.program_pmt_pid[X]=te,z===-1&&(z=X),Y===-1&&(Y=te))}w===1&&B===0&&(this.pat_==null&&o.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(V))),this.pat_=V,this.current_program_=z,this.current_pmt_pid_=Y)}else o.a.e(this.TAG,"parsePAT: table_id ".concat(m," is not corresponded to PAT!"))},v.prototype.parsePMT=function(g){var m=g[0];if(m===2){var S=(15&g[1])<<8|g[2],D=g[3]<<8|g[4],w=(62&g[5])>>>1,B=1&g[5],V=g[6],G=(g[7],null);if(B===1&&V===0)(G=new j).program_number=D,G.version_number=w,this.program_pmt_map_[D]=G;else if((G=this.program_pmt_map_[D])==null)return;G.pcr_pid=(31&g[8])<<8|g[9];for(var z=(15&g[10])<<8|g[11],Y=12+z,q=S-9-z-4,X=Y;X<Y+q;){var te=g[X],ce=(31&g[X+1])<<8|g[X+2],se=(15&g[X+3])<<8|g[X+4];G.pid_stream_type[ce]=te;var pe=G.common_pids.h264||G.common_pids.h265,ue=G.common_pids.adts_aac||G.common_pids.loas_aac||G.common_pids.ac3||G.common_pids.eac3||G.common_pids.opus||G.common_pids.mp3;if(te!==x.kH264||pe)if(te!==x.kH265||pe)if(te!==x.kADTSAAC||ue)if(te!==x.kLOASAAC||ue)if(te!==x.kAC3||ue)if(te!==x.kEAC3||ue)if(te!==x.kMPEG1Audio&&te!==x.kMPEG2Audio||ue)if(te===x.kPESPrivateData){if(G.pes_private_data_pids[ce]=!0,se>0){for(var de=X+5;de<X+5+se;){var Ae=g[de+0],ke=g[de+1];if(Ae===5){var he=String.fromCharCode.apply(String,Array.from(g.subarray(de+2,de+2+ke)));he==="VANC"?G.smpte2038_pids[ce]=!0:he==="AV01"?G.common_pids.av1=ce:he==="Opus"?G.common_pids.opus=ce:he==="KLVA"&&(G.asynchronous_klv_pids[ce]=!0)}else if(Ae===127){if(ce===G.common_pids.opus){var Te=null;if(g[de+2]===128&&(Te=g[de+3]),Te==null){o.a.e(this.TAG,"Not Supported Opus channel count.");continue}var Pe={codec:"opus",channel_count:15&Te?15&Te:2,channel_config_code:Te,sample_rate:48e3},Le={codec:"opus",meta:Pe};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=Pe,this.dispatchAudioInitSegment(Le)):this.detectAudioMetadataChange(Le)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Le))}}else Ae===128&&ce===G.common_pids.av1&&(this.video_metadata_.av1c=g.subarray(de+2,de+2+ke));de+=2+ke}var Ie=g.subarray(X+5,X+5+se);this.dispatchPESPrivateDataDescriptor(ce,te,Ie)}}else if(te===x.kMetadata){if(se>0)for(de=X+5;de<X+5+se;){Ae=g[de+0];var Ue=g[de+1];if(Ae===38){var je=g[de+2]<<8|g[de+3]<<0,we=null;je===65535&&(we=String.fromCharCode.apply(String,Array.from(g.subarray(de+4,de+4+4))));var Oe=null;if(g[de+4+(je===65535?4:0)]===255){var qe=4+(je===65535?4:0)+1;Oe=String.fromCharCode.apply(String,Array.from(g.subarray(de+qe,de+qe+4)))}we==="ID3 "&&Oe==="ID3 "?G.timed_id3_pids[ce]=!0:Oe==="KLVA"&&(G.synchronous_klv_pids[ce]=!0)}de+=2+Ue}}else te===x.kSCTE35&&(G.scte_35_pids[ce]=!0);else G.common_pids.mp3=ce;else G.common_pids.eac3=ce;else G.common_pids.ac3=ce;else G.common_pids.loas_aac=ce;else G.common_pids.adts_aac=ce;else G.common_pids.h265=ce;else G.common_pids.h264=ce;X+=5+se}D===this.current_program_&&(this.pmt_==null&&o.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(G))),this.pmt_=G,(G.common_pids.h264||G.common_pids.h265||G.common_pids.av1)&&(this.has_video_=!0),(G.common_pids.adts_aac||G.common_pids.loas_aac||G.common_pids.ac3||G.common_pids.opus||G.common_pids.mp3)&&(this.has_audio_=!0))}else o.a.e(this.TAG,"parsePMT: table_id ".concat(m," is not corresponded to PMT!"))},v.prototype.parseSCTE35=function(g){var m=ai(g);if(m.pts!=null){var S=Math.floor(m.pts/this.timescale_);m.pts=S}else m.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(m)},v.prototype.parseAV1Payload=function(g,m,S,D,w){for(var B=new Zo(g),V=null,G=[],z=0,Y=!1,q=null;(V=B.readNextOBUPayload())!=null;){if((q=A.parseOBUs(V,this.video_metadata_.details))&&q.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,q)===!0){var X;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(X=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+q.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),X.set(q.sequence_header_data,this.video_metadata_.av1c.byteLength),q.av1c=X,this.dispatchVideoInitSegment()}}else(X=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+q.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),X.set(q.sequence_header_data,this.video_metadata_.av1c.byteLength),q.av1c=X,this.video_metadata_.details=q,this.dispatchVideoInitSegment();this.video_metadata_.details=q,Y||(Y=q.keyframe),G.push({data:V}),z+=V.byteLength}var te=Math.floor(m/this.timescale_),ce=Math.floor(S/this.timescale_);if(G.length){var se=this.video_track_,pe={units:G,length:z,isKeyframe:Y,dts:ce,pts:te,cts:te-ce,file_position:D};se.samples.push(pe),se.length+=z}},v.prototype.parseH264Payload=function(g,m,S,D,w){for(var B=new ae(g),V=null,G=[],z=0,Y=!1;(V=B.readNextNaluPayload())!=null;){var q=new W(V);if(q.type===$.kSliceSPS){var X=b.parseSPS(V.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(q,X)===!0&&(o.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:q,pps:void 0,av1c:void 0,details:X}):(this.video_metadata_.sps=q,this.video_metadata_.details=X)}else q.type===$.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=q,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(q.type===$.kSliceIDR||q.type===$.kSliceNonIDR&&w===1)&&(Y=!0);this.video_init_segment_dispatched_&&(G.push(q),z+=q.data.byteLength)}var te=Math.floor(m/this.timescale_),ce=Math.floor(S/this.timescale_);if(G.length){var se=this.video_track_,pe={units:G,length:z,isKeyframe:Y,dts:ce,pts:te,cts:te-ce,file_position:D};se.samples.push(pe),se.length+=z}},v.prototype.parseH265Payload=function(g,m,S,D,w){for(var B=new Lr(g),V=null,G=[],z=0,Y=!1;(V=B.readNextNaluPayload())!=null;){var q=new Nt(V);if(q.type===ve.kSliceVPS){if(!this.video_init_segment_dispatched_){var X=T.parseVPS(V.data);this.video_metadata_.vps=q,this.video_metadata_.details=ti(ti({},this.video_metadata_.details),X)}}else q.type===ve.kSliceSPS?(X=T.parseSPS(V.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(q,X)===!0&&(o.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:q,pps:void 0,av1c:void 0,details:X}):(this.video_metadata_.sps=q,this.video_metadata_.details=ti(ti({},this.video_metadata_.details),X))):q.type===ve.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(X=T.parsePPS(V.data),this.video_metadata_.pps=q,this.video_metadata_.details=ti(ti({},this.video_metadata_.details),X),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):q.type!==ve.kSliceIDR_W_RADL&&q.type!==ve.kSliceIDR_N_LP&&q.type!==ve.kSliceCRA_NUT||(Y=!0);this.video_init_segment_dispatched_&&(G.push(q),z+=q.data.byteLength)}var te=Math.floor(m/this.timescale_),ce=Math.floor(S/this.timescale_);if(G.length){var se=this.video_track_,pe={units:G,length:z,isKeyframe:Y,dts:ce,pts:te,cts:te-ce,file_position:D};se.samples.push(pe),se.length+=z}},v.prototype.detectVideoMetadataChange=function(g,m){if(m.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return o.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(m.codec_mimetype)),!0;if(m.codec_size.width!==this.video_metadata_.details.codec_size.width||m.codec_size.height!==this.video_metadata_.details.codec_size.height){var S=this.video_metadata_.details.codec_size,D=m.codec_size;return o.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(S.width,"x").concat(S.height," to ").concat(D.width,"x").concat(D.height)),!0}return m.present_size.width!==this.video_metadata_.details.present_size.width&&(o.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(m.present_size.width)),!0)},v.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},v.prototype.dispatchVideoInitSegment=function(){var g=this.video_metadata_.details,m={type:"video"};m.id=this.video_track_.id,m.timescale=1e3,m.duration=this.duration_,m.codecWidth=g.codec_size.width,m.codecHeight=g.codec_size.height,m.presentWidth=g.present_size.width,m.presentHeight=g.present_size.height,m.profile=g.profile_string,m.level=g.level_string,m.bitDepth=g.bit_depth,m.chromaFormat=g.chroma_format,m.sarRatio=g.sar_ratio,m.frameRate=g.frame_rate;var S=m.frameRate.fps_den,D=m.frameRate.fps_num;if(m.refSampleDuration=S/D*1e3,m.codec=g.codec_mimetype,this.video_metadata_.av1c)m.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(m.codec));else if(this.video_metadata_.vps){var w=this.video_metadata_.vps.data.subarray(4),B=this.video_metadata_.sps.data.subarray(4),V=this.video_metadata_.pps.data.subarray(4),G=new Rr(w,B,V,g);m.hvcc=G.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(m.codec))}else{B=this.video_metadata_.sps.data.subarray(4),V=this.video_metadata_.pps.data.subarray(4);var z=new le(B,V,g);m.avcc=z.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(m.codec))}this.onTrackMetadata("video",m),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var Y=this.media_info_;Y.hasVideo=!0,Y.width=m.codecWidth,Y.height=m.codecHeight,Y.fps=m.frameRate.fps,Y.profile=m.profile,Y.level=m.level,Y.refFrames=g.ref_frames,Y.chromaFormat=g.chroma_format_string,Y.sarNum=m.sarRatio.width,Y.sarDen=m.sarRatio.height,Y.videoCodec=m.codec,Y.hasAudio&&Y.audioCodec?Y.mimeType='video/mp2t; codecs="'.concat(Y.videoCodec,",").concat(Y.audioCodec,'"'):Y.mimeType='video/mp2t; codecs="'.concat(Y.videoCodec,'"'),Y.isComplete()&&this.onMediaInfo(Y)},v.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},v.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},v.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},v.prototype.parseADTSAACPayload=function(g,m){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var S=new Uint8Array(g.byteLength+this.aac_last_incomplete_data_.byteLength);S.set(this.aac_last_incomplete_data_,0),S.set(g,this.aac_last_incomplete_data_.byteLength),g=S}var D,w;if(m!=null&&(w=m/this.timescale_),this.audio_metadata_.codec==="aac"){if(m==null&&this.audio_last_sample_pts_!=null)D=1024/this.audio_metadata_.sampling_frequency*1e3,w=this.audio_last_sample_pts_+D;else if(m==null)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){D=1024/this.audio_metadata_.sampling_frequency*1e3;var B=this.audio_last_sample_pts_+D;Math.abs(B-w)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(B,"ms, PES pts: ").concat(w,"ms")),w=B)}}for(var V,G=new xe(g),z=null,Y=w;(z=G.readNextAACFrame())!=null;){D=1024/z.sampling_frequency*1e3;var q={codec:"aac",data:z};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:z.audio_object_type,sampling_freq_index:z.sampling_freq_index,sampling_frequency:z.sampling_frequency,channel_config:z.channel_config},this.dispatchAudioInitSegment(q)):this.detectAudioMetadataChange(q)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(q)),V=Y;var X=Math.floor(Y),te={unit:z.data,length:z.data.byteLength,pts:X,dts:X};this.audio_track_.samples.push(te),this.audio_track_.length+=z.data.byteLength,Y+=D}G.hasIncompleteData()&&(this.aac_last_incomplete_data_=G.getIncompleteData()),V&&(this.audio_last_sample_pts_=V)}},v.prototype.parseLOASAACPayload=function(g,m){var S;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var D=new Uint8Array(g.byteLength+this.aac_last_incomplete_data_.byteLength);D.set(this.aac_last_incomplete_data_,0),D.set(g,this.aac_last_incomplete_data_.byteLength),g=D}var w,B;if(m!=null&&(B=m/this.timescale_),this.audio_metadata_.codec==="aac"){if(m==null&&this.audio_last_sample_pts_!=null)w=1024/this.audio_metadata_.sampling_frequency*1e3,B=this.audio_last_sample_pts_+w;else if(m==null)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){w=1024/this.audio_metadata_.sampling_frequency*1e3;var V=this.audio_last_sample_pts_+w;Math.abs(V-B)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(V,"ms, PES pts: ").concat(B,"ms")),B=V)}}for(var G,z=new Ce(g),Y=null,q=B;(Y=z.readNextAACFrame((S=this.loas_previous_frame)!==null&&S!==void 0?S:void 0))!=null;){this.loas_previous_frame=Y,w=1024/Y.sampling_frequency*1e3;var X={codec:"aac",data:Y};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:Y.audio_object_type,sampling_freq_index:Y.sampling_freq_index,sampling_frequency:Y.sampling_frequency,channel_config:Y.channel_config},this.dispatchAudioInitSegment(X)):this.detectAudioMetadataChange(X)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(X)),G=q;var te=Math.floor(q),ce={unit:Y.data,length:Y.data.byteLength,pts:te,dts:te};this.audio_track_.samples.push(ce),this.audio_track_.length+=Y.data.byteLength,q+=w}z.hasIncompleteData()&&(this.aac_last_incomplete_data_=z.getIncompleteData()),G&&(this.audio_last_sample_pts_=G)}},v.prototype.parseAC3Payload=function(g,m){if(!this.has_video_||this.video_init_segment_dispatched_){var S,D;if(m!=null&&(D=m/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(m==null&&this.audio_last_sample_pts_!=null)S=1536/this.audio_metadata_.sampling_frequency*1e3,D=this.audio_last_sample_pts_+S;else if(m==null)return void o.a.w(this.TAG,"AC3: Unknown pts")}for(var w,B=new kr(g),V=null,G=D;(V=B.readNextAC3Frame())!=null;){S=1536/V.sampling_frequency*1e3;var z={codec:"ac-3",data:V};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:V.sampling_frequency,bit_stream_identification:V.bit_stream_identification,bit_stream_mode:V.bit_stream_mode,low_frequency_effects_channel_on:V.low_frequency_effects_channel_on,channel_mode:V.channel_mode},this.dispatchAudioInitSegment(z)):this.detectAudioMetadataChange(z)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(z)),w=G;var Y=Math.floor(G),q={unit:V.data,length:V.data.byteLength,pts:Y,dts:Y};this.audio_track_.samples.push(q),this.audio_track_.length+=V.data.byteLength,G+=S}w&&(this.audio_last_sample_pts_=w)}},v.prototype.parseEAC3Payload=function(g,m){if(!this.has_video_||this.video_init_segment_dispatched_){var S,D;if(m!=null&&(D=m/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(m==null&&this.audio_last_sample_pts_!=null)S=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,D=this.audio_last_sample_pts_+S;else if(m==null)return void o.a.w(this.TAG,"EAC3: Unknown pts")}for(var w,B=new Wo(g),V=null,G=D;(V=B.readNextEAC3Frame())!=null;){S=1536/V.sampling_frequency*1e3;var z={codec:"ec-3",data:V};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ec-3",sampling_frequency:V.sampling_frequency,bit_stream_identification:V.bit_stream_identification,low_frequency_effects_channel_on:V.low_frequency_effects_channel_on,num_blks:V.num_blks,channel_mode:V.channel_mode},this.dispatchAudioInitSegment(z)):this.detectAudioMetadataChange(z)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(z)),w=G;var Y=Math.floor(G),q={unit:V.data,length:V.data.byteLength,pts:Y,dts:Y};this.audio_track_.samples.push(q),this.audio_track_.length+=V.data.byteLength,G+=S}w&&(this.audio_last_sample_pts_=w)}},v.prototype.parseOpusPayload=function(g,m){if(!this.has_video_||this.video_init_segment_dispatched_){var S,D;if(m!=null&&(D=m/this.timescale_),this.audio_metadata_.codec==="opus"){if(m==null&&this.audio_last_sample_pts_!=null)S=20,D=this.audio_last_sample_pts_+S;else if(m==null)return void o.a.w(this.TAG,"Opus: Unknown pts")}for(var w,B=D,V=0;V<g.length;){S=20;for(var G=(16&g[V+1])!=0,z=(8&g[V+1])!=0,Y=V+2,q=0;g[Y]===255;)q+=255,Y+=1;q+=g[Y],Y+=1,Y+=G?2:0,Y+=z?2:0,w=B;var X=Math.floor(B),te=g.slice(Y,Y+q),ce={unit:te,length:te.byteLength,pts:X,dts:X};this.audio_track_.samples.push(ce),this.audio_track_.length+=te.byteLength,B+=S,V=Y+q}w&&(this.audio_last_sample_pts_=w)}},v.prototype.parseMP3Payload=function(g,m){if(!this.has_video_||this.video_init_segment_dispatched_){var S=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],D=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],w=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],B=g[1]>>>3&3,V=(6&g[1])>>1,G=(240&g[2])>>>4,z=(12&g[2])>>>2,Y=(g[3]>>>6&3)!==3?2:1,q=0,X=34;switch(B){case 0:q=[11025,12e3,8e3,0][z];break;case 2:q=[22050,24e3,16e3,0][z];break;case 3:q=[44100,48e3,32e3,0][z]}switch(V){case 1:X=34,G<w.length&&w[G];break;case 2:X=33,G<D.length&&D[G];break;case 3:X=32,G<S.length&&S[G]}var te=new wr;te.object_type=X,te.sample_rate=q,te.channel_count=Y,te.data=g;var ce={codec:"mp3",data:te};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:X,sample_rate:q,channel_count:Y},this.dispatchAudioInitSegment(ce)):this.detectAudioMetadataChange(ce)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ce));var se={unit:g,length:g.byteLength,pts:m/this.timescale_,dts:m/this.timescale_};this.audio_track_.samples.push(se),this.audio_track_.length+=g.byteLength}},v.prototype.detectAudioMetadataChange=function(g){if(g.codec!==this.audio_metadata_.codec)return o.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(g.codec)),!0;if(g.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((m=g.data).audio_object_type!==this.audio_metadata_.audio_object_type)return o.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(m.audio_object_type)),!0;if(m.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return o.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(m.sampling_freq_index)),!0;if(m.channel_config!==this.audio_metadata_.channel_config)return o.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(m.channel_config)),!0}else if(g.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var m;if((m=g.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return o.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(m.sampling_frequency)),!0;if(m.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return o.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(m.bit_stream_identification)),!0;if(m.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return o.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(m.bit_stream_mode)),!0;if(m.channel_mode!==this.audio_metadata_.channel_mode)return o.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(m.channel_mode)),!0;if(m.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return o.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(m.low_frequency_effects_channel_on)),!0}else if(g.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((S=g.meta).sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(S.sample_rate)),!0;if(S.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(S.channel_count)),!0}else if(g.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var S;if((S=g.data).object_type!==this.audio_metadata_.object_type)return o.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(S.object_type)),!0;if(S.sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(S.sample_rate)),!0;if(S.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(S.channel_count)),!0}return!1},v.prototype.dispatchAudioInitSegment=function(g){var m={type:"audio"};if(m.id=this.audio_track_.id,m.timescale=1e3,m.duration=this.duration_,this.audio_metadata_.codec==="aac"){var S=g.codec==="aac"?g.data:null,D=new ze(S);m.audioSampleRate=D.sampling_rate,m.channelCount=D.channel_count,m.codec=D.codec_mimetype,m.originalCodec=D.original_codec_mimetype,m.config=D.config,m.refSampleDuration=1024/m.audioSampleRate*m.timescale}else if(this.audio_metadata_.codec==="ac-3"){var w=g.codec==="ac-3"?g.data:null,B=new Pr(w);m.audioSampleRate=B.sampling_rate,m.channelCount=B.channel_count,m.codec=B.codec_mimetype,m.originalCodec=B.original_codec_mimetype,m.config=B.config,m.refSampleDuration=1536/m.audioSampleRate*m.timescale}else if(this.audio_metadata_.codec==="ec-3"){var V=g.codec==="ec-3"?g.data:null,G=new Xo(V);m.audioSampleRate=G.sampling_rate,m.channelCount=G.channel_count,m.codec=G.codec_mimetype,m.originalCodec=G.original_codec_mimetype,m.config=G.config,m.refSampleDuration=256*G.num_blks/m.audioSampleRate*m.timescale}else this.audio_metadata_.codec==="opus"?(m.audioSampleRate=this.audio_metadata_.sample_rate,m.channelCount=this.audio_metadata_.channel_count,m.channelConfigCode=this.audio_metadata_.channel_config_code,m.codec="opus",m.originalCodec="opus",m.config=void 0,m.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(m.audioSampleRate=this.audio_metadata_.sample_rate,m.channelCount=this.audio_metadata_.channel_count,m.codec="mp3",m.originalCodec="mp3",m.config=void 0);this.audio_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(m.codec)),this.onTrackMetadata("audio",m),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var z=this.media_info_;z.hasAudio=!0,z.audioCodec=m.originalCodec,z.audioSampleRate=m.audioSampleRate,z.audioChannelCount=m.channelCount,z.hasVideo&&z.videoCodec?z.mimeType='video/mp2t; codecs="'.concat(z.videoCodec,",").concat(z.audioCodec,'"'):z.mimeType='video/mp2t; codecs="'.concat(z.audioCodec,'"'),z.isComplete()&&this.onMediaInfo(z)},v.prototype.dispatchPESPrivateDataDescriptor=function(g,m,S){var D=new ot;D.pid=g,D.stream_type=m,D.descriptor=S,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(D)},v.prototype.parsePESPrivateDataPayload=function(g,m,S,D,w){var B=new Ye;if(B.pid=D,B.stream_id=w,B.len=g.byteLength,B.data=g,m!=null){var V=Math.floor(m/this.timescale_);B.pts=V}else B.nearest_pts=this.getNearestTimestampMilliseconds();if(S!=null){var G=Math.floor(S/this.timescale_);B.dts=G}this.onPESPrivateData&&this.onPESPrivateData(B)},v.prototype.parseTimedID3MetadataPayload=function(g,m,S,D,w){var B=new Ye;if(B.pid=D,B.stream_id=w,B.len=g.byteLength,B.data=g,m!=null){var V=Math.floor(m/this.timescale_);B.pts=V}if(S!=null){var G=Math.floor(S/this.timescale_);B.dts=G}this.onTimedID3Metadata&&this.onTimedID3Metadata(B)},v.prototype.parseSynchronousKLVMetadataPayload=function(g,m,S,D,w){var B=new Qo;if(B.pid=D,B.stream_id=w,B.len=g.byteLength,B.data=g,m!=null){var V=Math.floor(m/this.timescale_);B.pts=V}if(S!=null){var G=Math.floor(S/this.timescale_);B.dts=G}B.access_units=function(z){for(var Y=[],q=0;q+5<z.byteLength;){var X=z[q+0],te=z[q+1],ce=z[q+2],se=z[q+3]<<8|z[q+4]<<0,pe=z.slice(q+5,q+5+se);Y.push({service_id:X,sequence_number:te,flags:ce,data:pe}),q+=5+se}return Y}(g),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(B)},v.prototype.parseAsynchronousKLVMetadataPayload=function(g,m,S){var D=new Ye;D.pid=m,D.stream_id=S,D.len=g.byteLength,D.data=g,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(D)},v.prototype.parseSMPTE2038MetadataPayload=function(g,m,S,D,w){var B=new Ir;if(B.pid=D,B.stream_id=w,B.len=g.byteLength,B.data=g,m!=null){var V=Math.floor(m/this.timescale_);B.pts=V}if(B.nearest_pts=this.getNearestTimestampMilliseconds(),S!=null){var G=Math.floor(S/this.timescale_);B.dts=G}B.ancillaries=function(z){for(var Y=new y(z),q=0,X=[];q+=6,Y.readBits(6)===0;){var te=Y.readBool();q+=1;var ce=Y.readBits(11);q+=11;var se=Y.readBits(12);q+=12;var pe=255&Y.readBits(10);q+=10;var ue=255&Y.readBits(10);q+=10;var de=255&Y.readBits(10);q+=10;for(var Ae=new Uint8Array(de),ke=0;ke<de;ke++){var he=255&Y.readBits(10);q+=10,Ae[ke]=he}Y.readBits(10),q+=10;var Te="User Defined";pe===65?ue===7&&(Te="SCTE-104"):pe===95?ue===220?Te="ARIB STD-B37 (1SEG)":ue===221?Te="ARIB STD-B37 (ANALOG)":ue===222?Te="ARIB STD-B37 (SD)":ue===223&&(Te="ARIB STD-B37 (HD)"):pe===97&&(ue===1?Te="EIA-708":ue===2&&(Te="EIA-608")),X.push({yc_indicator:te,line_number:ce,horizontal_offset:se,did:pe,sdid:ue,user_data:Ae,description:Te,information:{}}),Y.readBits(8-(q-Math.floor(q/8))%8),q+=(8-(q-Math.floor(q/8)))%8}return Y.destroy(),Y=null,X}(g),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(B)},v.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},v.prototype.getPcrBase=function(g){var m=33554432*g[6]+131072*g[7]+512*g[8]+2*g[9]+(128&g[10])/128+this.timestamp_offset_;return m+4294967296<this.last_pcr_base_&&(m+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=m,m},v.prototype.getTimestamp=function(g,m){var S=536870912*(14&g[m])+4194304*(255&g[m+1])+16384*(254&g[m+2])+128*(255&g[m+3])+(254&g[m+4])/2+this.timestamp_offset_;return S+4294967296<this.last_pcr_base_&&(S+=8589934592),S},v}(U),Xs=function(E,v,g){for(var m,S=0,D=v.length;S<D;S++)!m&&S in v||(m||(m=Array.prototype.slice.call(v,0,S)),m[S]=v[S]);return E.concat(m||Array.prototype.slice.call(v))},Qs=function(){function E(){}return E.init=function(){for(var v in E.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},E.types)E.types.hasOwnProperty(v)&&(E.types[v]=[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]);var g=E.constants={};g.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),g.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),g.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),g.STSC=g.STCO=g.STTS,g.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),g.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),g.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),g.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),g.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),g.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},E.box=function(v){for(var g=8,m=null,S=Array.prototype.slice.call(arguments,1),D=S.length,w=0;w<D;w++)g+=S[w].byteLength;(m=new Uint8Array(g))[0]=g>>>24&255,m[1]=g>>>16&255,m[2]=g>>>8&255,m[3]=255&g,m.set(v,4);var B=8;for(w=0;w<D;w++)m.set(S[w],B),B+=S[w].byteLength;return m},E.generateInitSegment=function(v){var g=E.box(E.types.ftyp,E.constants.FTYP),m=E.moov(v),S=new Uint8Array(g.byteLength+m.byteLength);return S.set(g,0),S.set(m,g.byteLength),S},E.moov=function(v){var g=E.mvhd(v.timescale,v.duration),m=E.trak(v),S=E.mvex(v);return E.box(E.types.moov,g,m,S)},E.mvhd=function(v,g){return E.box(E.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v,g>>>24&255,g>>>16&255,g>>>8&255,255&g,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},E.trak=function(v){return E.box(E.types.trak,E.tkhd(v),E.mdia(v))},E.tkhd=function(v){var g=v.id,m=v.duration,S=v.presentWidth,D=v.presentHeight;return E.box(E.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g,0,0,0,0,m>>>24&255,m>>>16&255,m>>>8&255,255&m,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,S>>>8&255,255&S,0,0,D>>>8&255,255&D,0,0]))},E.mdia=function(v){return E.box(E.types.mdia,E.mdhd(v),E.hdlr(v),E.minf(v))},E.mdhd=function(v){var g=v.timescale,m=v.duration;return E.box(E.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g,m>>>24&255,m>>>16&255,m>>>8&255,255&m,85,196,0,0]))},E.hdlr=function(v){var g=null;return g=v.type==="audio"?E.constants.HDLR_AUDIO:E.constants.HDLR_VIDEO,E.box(E.types.hdlr,g)},E.minf=function(v){var g=null;return g=v.type==="audio"?E.box(E.types.smhd,E.constants.SMHD):E.box(E.types.vmhd,E.constants.VMHD),E.box(E.types.minf,g,E.dinf(),E.stbl(v))},E.dinf=function(){return E.box(E.types.dinf,E.box(E.types.dref,E.constants.DREF))},E.stbl=function(v){return E.box(E.types.stbl,E.stsd(v),E.box(E.types.stts,E.constants.STTS),E.box(E.types.stsc,E.constants.STSC),E.box(E.types.stsz,E.constants.STSZ),E.box(E.types.stco,E.constants.STCO))},E.stsd=function(v){return v.type==="audio"?v.codec==="mp3"?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.mp3(v)):v.codec==="ac-3"?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.ac3(v)):v.codec==="ec-3"?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.ec3(v)):v.codec==="opus"?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.Opus(v)):v.codec=="flac"?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.fLaC(v)):E.box(E.types.stsd,E.constants.STSD_PREFIX,E.mp4a(v)):v.type==="video"&&v.codec.startsWith("hvc1")?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.hvc1(v)):v.type==="video"&&v.codec.startsWith("av01")?E.box(E.types.stsd,E.constants.STSD_PREFIX,E.av01(v)):E.box(E.types.stsd,E.constants.STSD_PREFIX,E.avc1(v))},E.mp3=function(v){var g=v.channelCount,m=v.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types[".mp3"],S)},E.mp4a=function(v){var g=v.channelCount,m=v.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types.mp4a,S,E.esds(v))},E.ac3=function(v){var g=v.channelCount,m=v.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types["ac-3"],S,E.box(E.types.dac3,new Uint8Array(v.config)))},E.ec3=function(v){var g=v.channelCount,m=v.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types["ec-3"],S,E.box(E.types.dec3,new Uint8Array(v.config)))},E.esds=function(v){var g=v.config||[],m=g.length,S=new Uint8Array([0,0,0,0,3,23+m,0,1,0,4,15+m,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([m]).concat(g).concat([6,1,2]));return E.box(E.types.esds,S)},E.Opus=function(v){var g=v.channelCount,m=v.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types.Opus,S,E.dOps(v))},E.dOps=function(v){var g=v.channelCount,m=v.channelConfigCode,S=v.audioSampleRate;if(v.config)return E.box(E.types.dOps,v.config);var D=[];switch(m){case 1:case 2:D=[0];break;case 0:D=[255,1,1,0,1];break;case 128:D=[255,2,0,0,1];break;case 3:D=[1,2,1,0,2,1];break;case 4:D=[1,2,2,0,1,2,3];break;case 5:D=[1,3,2,0,4,1,2,3];break;case 6:D=[1,4,2,0,4,1,2,3,5];break;case 7:D=[1,4,2,0,4,1,2,3,5,6];break;case 8:D=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:D=[1,1,2,0,1];break;case 131:D=[1,1,3,0,1,2];break;case 132:D=[1,1,4,0,1,2,3];break;case 133:D=[1,1,5,0,1,2,3,4];break;case 134:D=[1,1,6,0,1,2,3,4,5];break;case 135:D=[1,1,7,0,1,2,3,4,5,6];break;case 136:D=[1,1,8,0,1,2,3,4,5,6,7]}var w=new Uint8Array(Xs([0,g,0,0,S>>>24&255,S>>>17&255,S>>>8&255,S>>>0&255,0,0],D));return E.box(E.types.dOps,w)},E.fLaC=function(v){var g=v.channelCount,m=Math.min(v.audioSampleRate,65535),S=v.sampleSize,D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g,0,S,0,0,0,0,m>>>8&255,255&m,0,0]);return E.box(E.types.fLaC,D,E.dfLa(v))},E.dfLa=function(v){var g=new Uint8Array(Xs([0,0,0,0],v.config));return E.box(E.types.dfLa,g)},E.avc1=function(v){var g=v.avcc,m=v.codecWidth,S=v.codecHeight,D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>>8&255,255&m,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return E.box(E.types.avc1,D,E.box(E.types.avcC,g))},E.hvc1=function(v){var g=v.hvcc,m=v.codecWidth,S=v.codecHeight,D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>>8&255,255&m,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return E.box(E.types.hvc1,D,E.box(E.types.hvcC,g))},E.av01=function(v){var g=v.av1c,m=v.codecWidth||192,S=v.codecHeight||108,D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>>8&255,255&m,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return E.box(E.types.av01,D,E.box(E.types.av1C,g))},E.mvex=function(v){return E.box(E.types.mvex,E.trex(v))},E.trex=function(v){var g=v.id,m=new Uint8Array([0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return E.box(E.types.trex,m)},E.moof=function(v,g){return E.box(E.types.moof,E.mfhd(v.sequenceNumber),E.traf(v,g))},E.mfhd=function(v){var g=new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v]);return E.box(E.types.mfhd,g)},E.traf=function(v,g){var m=v.id,S=E.box(E.types.tfhd,new Uint8Array([0,0,0,0,m>>>24&255,m>>>16&255,m>>>8&255,255&m])),D=E.box(E.types.tfdt,new Uint8Array([0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,255&g])),w=E.sdtp(v),B=E.trun(v,w.byteLength+16+16+8+16+8+8);return E.box(E.types.traf,S,D,B,w)},E.sdtp=function(v){for(var g=v.samples||[],m=g.length,S=new Uint8Array(4+m),D=0;D<m;D++){var w=g[D].flags;S[D+4]=w.isLeading<<6|w.dependsOn<<4|w.isDependedOn<<2|w.hasRedundancy}return E.box(E.types.sdtp,S)},E.trun=function(v,g){var m=v.samples||[],S=m.length,D=12+16*S,w=new Uint8Array(D);g+=8+D,w.set([0,0,15,1,S>>>24&255,S>>>16&255,S>>>8&255,255&S,g>>>24&255,g>>>16&255,g>>>8&255,255&g],0);for(var B=0;B<S;B++){var V=m[B].duration,G=m[B].size,z=m[B].flags,Y=m[B].cts;w.set([V>>>24&255,V>>>16&255,V>>>8&255,255&V,G>>>24&255,G>>>16&255,G>>>8&255,255&G,z.isLeading<<2|z.dependsOn,z.isDependedOn<<6|z.hasRedundancy<<4|z.isNonSync,0,0,Y>>>24&255,Y>>>16&255,Y>>>8&255,255&Y],12+16*B)}return E.box(E.types.trun,w)},E.mdat=function(v){return E.box(E.types.mdat,v)},E}();Qs.init();var li=Qs,Zs=function(){function E(){}return E.getSilentFrame=function(v,g){if(v==="mp4a.40.2"){if(g===1)return new Uint8Array([0,200,0,128,35,128]);if(g===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(g===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(g===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(g===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(g===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(g===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},E}(),Ut=r(11),Js=function(){function E(v){this.TAG="MP4Remuxer",this._config=v,this._isLive=v.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new Ut.c("audio"),this._videoSegmentInfoList=new Ut.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.a.chrome||!(a.a.version.major<50||a.a.version.major===50&&a.a.version.build<2661)),this._fillSilentAfterSeek=a.a.msedge||a.a.msie,this._mp3UseMpegAudio=!a.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return E.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},E.prototype.bindDataSource=function(v){return v.onDataAvailable=this.remux.bind(this),v.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(E.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(v){this._onInitSegment=v},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(v){this._onMediaSegment=v},enumerable:!1,configurable:!0}),E.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},E.prototype.seek=function(v){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},E.prototype.remux=function(v,g){if(!this._onMediaSegment)throw new f.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(v,g),g&&this._remuxVideo(g),v&&this._remuxAudio(v)},E.prototype._onTrackMetadataReceived=function(v,g){var m=null,S="mp4",D=g.codec;if(v==="audio")this._audioMeta=g,g.codec==="mp3"&&this._mp3UseMpegAudio?(S="mpeg",D="",m=new Uint8Array):m=li.generateInitSegment(g);else{if(v!=="video")return;this._videoMeta=g,m=li.generateInitSegment(g)}if(!this._onInitSegment)throw new f.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(v,{type:v,data:m.buffer,codec:D,container:"".concat(v,"/").concat(S),mediaDuration:g.duration})},E.prototype._calculateDtsBase=function(v,g){this._dtsBaseInited||(v&&v.samples&&v.samples.length&&(this._audioDtsBase=v.samples[0].dts),g&&g.samples&&g.samples.length&&(this._videoDtsBase=g.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},E.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},E.prototype.flushStashedSamples=function(){var v=this._videoStashedLastSample,g=this._audioStashedLastSample,m={type:"video",id:1,sequenceNumber:0,samples:[],length:0};v!=null&&(m.samples.push(v),m.length=v.length);var S={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};g!=null&&(S.samples.push(g),S.length=g.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(m,!0),this._remuxAudio(S,!0)},E.prototype._remuxAudio=function(v,g){if(this._audioMeta!=null){var m,S=v,D=S.samples,w=void 0,B=-1,V=this._audioMeta.refSampleDuration,G=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,z=this._dtsBaseInited&&this._audioNextDts===void 0,Y=!1;if(D&&D.length!==0&&(D.length!==1||g)){var q=0,X=null,te=0;G?(q=0,te=S.length):(q=8,te=8+S.length);var ce=null;if(D.length>1&&(te-=(ce=D.pop()).length),this._audioStashedLastSample!=null){var se=this._audioStashedLastSample;this._audioStashedLastSample=null,D.unshift(se),te+=se.length}ce!=null&&(this._audioStashedLastSample=ce);var pe=D[0].dts-this._dtsBase;if(this._audioNextDts)w=pe-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())w=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(Y=!0);else{var ue=this._audioSegmentInfoList.getLastSampleBefore(pe);if(ue!=null){var de=pe-(ue.originalDts+ue.duration);de<=3&&(de=0),w=pe-(ue.dts+ue.duration+de)}else w=0}if(Y){var Ae=pe-w,ke=this._videoSegmentInfoList.getLastSegmentBefore(pe);if(ke!=null&&ke.beginDts<Ae){if(et=Zs.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var he=ke.beginDts,Te=Ae-ke.beginDts;o.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(he,", duration: ").concat(Te)),D.unshift({unit:et,dts:he,pts:he}),te+=et.byteLength}}else Y=!1}for(var Pe=[],Le=0;Le<D.length;Le++){var Ie=(se=D[Le]).unit,Ue=se.dts-this._dtsBase,je=(he=Ue,!1),we=null,Oe=0;if(!(Ue<-.001)){if(this._audioMeta.codec!=="mp3"&&V!=null){var qe=Ue;if(this._audioNextDts&&(qe=this._audioNextDts),(w=Ue-qe)<=-3*V){o.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(Ue," ms ,curRefDts: ").concat(qe," ms)  due to dtsCorrection: ").concat(w," ms overlap."));continue}if(w>=3*V&&this._fillAudioTimestampGap&&!a.a.safari){je=!0;var et,At=Math.floor(w/V);o.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(Ue," ms, curRefDts: ").concat(qe," ms, ")+"dtsCorrection: ".concat(Math.round(w)," ms, generate: ").concat(At," frames")),he=Math.floor(qe),Oe=Math.floor(qe+V)-he,(et=Zs.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(o.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),et=Ie),we=[];for(var lt=0;lt<At;lt++){qe+=V;var _t=Math.floor(qe),ht=Math.floor(qe+V)-_t,ct={dts:_t,pts:_t,cts:0,unit:et,size:et.byteLength,duration:ht,originalDts:Ue,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};we.push(ct),te+=ct.size}this._audioNextDts=qe+V}else he=Math.floor(qe),Oe=Math.floor(qe+V)-he,this._audioNextDts=qe+V}else he=Ue-w,Le!==D.length-1?Oe=D[Le+1].dts-this._dtsBase-w-he:ce!=null?Oe=ce.dts-this._dtsBase-w-he:Oe=Pe.length>=1?Pe[Pe.length-1].duration:Math.floor(V),this._audioNextDts=he+Oe;B===-1&&(B=he),Pe.push({dts:he,pts:he,cts:0,unit:se.unit,size:se.unit.byteLength,duration:Oe,originalDts:Ue,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),je&&Pe.push.apply(Pe,we)}}if(Pe.length===0)return S.samples=[],void(S.length=0);for(G?X=new Uint8Array(te):((X=new Uint8Array(te))[0]=te>>>24&255,X[1]=te>>>16&255,X[2]=te>>>8&255,X[3]=255&te,X.set(li.types.mdat,4)),Le=0;Le<Pe.length;Le++)Ie=Pe[Le].unit,X.set(Ie,q),q+=Ie.byteLength;var ft=Pe[Pe.length-1];m=ft.dts+ft.duration;var $e=new Ut.b;$e.beginDts=B,$e.endDts=m,$e.beginPts=B,$e.endPts=m,$e.originalBeginDts=Pe[0].originalDts,$e.originalEndDts=ft.originalDts+ft.duration,$e.firstSample=new Ut.d(Pe[0].dts,Pe[0].pts,Pe[0].duration,Pe[0].originalDts,!1),$e.lastSample=new Ut.d(ft.dts,ft.pts,ft.duration,ft.originalDts,!1),this._isLive||this._audioSegmentInfoList.append($e),S.samples=Pe,S.sequenceNumber++;var $t=null;$t=G?new Uint8Array:li.moof(S,B),S.samples=[],S.length=0;var Gt={type:"audio",data:this._mergeBoxes($t,X).buffer,sampleCount:Pe.length,info:$e};G&&z&&(Gt.timestampOffset=B),this._onMediaSegment("audio",Gt)}}},E.prototype._remuxVideo=function(v,g){if(this._videoMeta!=null){var m,S,D=v,w=D.samples,B=void 0,V=-1,G=-1;if(w&&w.length!==0&&(w.length!==1||g)){var z=8,Y=null,q=8+v.length,X=null;if(w.length>1&&(q-=(X=w.pop()).length),this._videoStashedLastSample!=null){var te=this._videoStashedLastSample;this._videoStashedLastSample=null,w.unshift(te),q+=te.length}X!=null&&(this._videoStashedLastSample=X);var ce=w[0].dts-this._dtsBase;if(this._videoNextDts)B=ce-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())B=0;else{var se=this._videoSegmentInfoList.getLastSampleBefore(ce);if(se!=null){var pe=ce-(se.originalDts+se.duration);pe<=3&&(pe=0),B=ce-(se.dts+se.duration+pe)}else B=0}for(var ue=new Ut.b,de=[],Ae=0;Ae<w.length;Ae++){var ke=(te=w[Ae]).dts-this._dtsBase,he=te.isKeyframe,Te=ke-B,Pe=te.cts,Le=Te+Pe;V===-1&&(V=Te,G=Le);var Ie=0;if(Ae!==w.length-1?Ie=w[Ae+1].dts-this._dtsBase-B-Te:X!=null?Ie=X.dts-this._dtsBase-B-Te:Ie=de.length>=1?de[de.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),he){var Ue=new Ut.d(Te,Le,Ie,te.dts,!0);Ue.fileposition=te.fileposition,ue.appendSyncPoint(Ue)}de.push({dts:Te,pts:Le,cts:Pe,units:te.units,size:te.length,isKeyframe:he,duration:Ie,originalDts:ke,flags:{isLeading:0,dependsOn:he?2:1,isDependedOn:he?1:0,hasRedundancy:0,isNonSync:he?0:1}})}for((Y=new Uint8Array(q))[0]=q>>>24&255,Y[1]=q>>>16&255,Y[2]=q>>>8&255,Y[3]=255&q,Y.set(li.types.mdat,4),Ae=0;Ae<de.length;Ae++)for(var je=de[Ae].units;je.length;){var we=je.shift().data;Y.set(we,z),z+=we.byteLength}var Oe=de[de.length-1];if(m=Oe.dts+Oe.duration,S=Oe.pts+Oe.duration,this._videoNextDts=m,ue.beginDts=V,ue.endDts=m,ue.beginPts=G,ue.endPts=S,ue.originalBeginDts=de[0].originalDts,ue.originalEndDts=Oe.originalDts+Oe.duration,ue.firstSample=new Ut.d(de[0].dts,de[0].pts,de[0].duration,de[0].originalDts,de[0].isKeyframe),ue.lastSample=new Ut.d(Oe.dts,Oe.pts,Oe.duration,Oe.originalDts,Oe.isKeyframe),this._isLive||this._videoSegmentInfoList.append(ue),D.samples=de,D.sequenceNumber++,this._forceFirstIDR){var qe=de[0].flags;qe.dependsOn=2,qe.isNonSync=0}var et=li.moof(D,V);D.samples=[],D.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(et,Y).buffer,sampleCount:de.length,info:ue})}}},E.prototype._mergeBoxes=function(v,g){var m=new Uint8Array(v.byteLength+g.byteLength);return m.set(v,0),m.set(g,v.byteLength),m},E}(),el=r(14),tt=r(1),tl=(r(2),function(){function E(v,g){this.TAG="TransmuxingController",this._emitter=new n.a,this._config=g,v.segments||(v.segments=[{duration:v.duration,filesize:v.filesize,url:v.url}]),typeof v.cors!="boolean"&&(v.cors=!0),typeof v.withCredentials!="boolean"&&(v.withCredentials=!1),this._mediaDataSource=v,this._currentSegmentIndex=0;var m=0;this._mediaDataSource.segments.forEach(function(S){S.timestampBase=m,m+=S.duration,S.cors=v.cors,S.withCredentials=v.withCredentials,g.referrerPolicy&&(S.referrerPolicy=g.referrerPolicy)}),isNaN(m)||this._mediaDataSource.duration===m||(this._mediaDataSource.duration=m),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return E.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},E.prototype.on=function(v,g){this._emitter.addListener(v,g)},E.prototype.off=function(v,g){this._emitter.removeListener(v,g)},E.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},E.prototype._loadSegment=function(v,g){this._currentSegmentIndex=v;var m=this._mediaDataSource.segments[v],S=this._ioctl=new el.a(m,this._config,v);S.onError=this._onIOException.bind(this),S.onSeeked=this._onIOSeeked.bind(this),S.onComplete=this._onIOComplete.bind(this),S.onRedirect=this._onIORedirect.bind(this),S.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),g?this._demuxer.bindDataSource(this._ioctl):S.onDataArrival=this._onInitChunkArrival.bind(this),S.open(g)},E.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},E.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},E.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},E.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},E.prototype.seek=function(v){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var g=this._searchSegmentIndexContains(v);if(g===this._currentSegmentIndex){var m=this._mediaInfo.segments[g];if(m==null)this._pendingSeekTime=v;else{var S=m.getNearestKeyframe(v);this._remuxer.seek(S.milliseconds),this._ioctl.seek(S.fileposition),this._pendingResolveSeekPoint=S.milliseconds}}else{var D=this._mediaInfo.segments[g];D==null?(this._pendingSeekTime=v,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(g)):(S=D.getNearestKeyframe(v),this._internalAbort(),this._remuxer.seek(v),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[g].timestampBase,this._loadSegment(g,S.fileposition),this._pendingResolveSeekPoint=S.milliseconds,this._reportSegmentMediaInfo(g))}this._enableStatisticsReporter()}},E.prototype._searchSegmentIndexContains=function(v){for(var g=this._mediaDataSource.segments,m=g.length-1,S=0;S<g.length;S++)if(v<g[S].timestampBase){m=S-1;break}return m},E.prototype._onInitChunkArrival=function(v,g){var m=this,S=0;if(g>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,S=this._demuxer.parseChunks(v,g);else{var D=null;(D=k.probe(v)).match&&(this._setupFLVDemuxerRemuxer(D),S=this._demuxer.parseChunks(v,g)),D.match||D.needMoreData||(D=Ws.probe(v)).match&&(this._setupTSDemuxerRemuxer(D),S=this._demuxer.parseChunks(v,g)),D.match||D.needMoreData||(D=null,o.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){m._internalAbort()}),this._emitter.emit(tt.a.DEMUX_ERROR,I.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return S},E.prototype._setupFLVDemuxerRemuxer=function(v){this._demuxer=new k(v,this._config),this._remuxer||(this._remuxer=new Js(this._config));var g=this._mediaDataSource;g.duration==null||isNaN(g.duration)||(this._demuxer.overridedDuration=g.duration),typeof g.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=g.hasAudio),typeof g.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=g.hasVideo),this._demuxer.timestampBase=g.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},E.prototype._setupTSDemuxerRemuxer=function(v){var g=this._demuxer=new Ws(v,this._config);this._remuxer||(this._remuxer=new Js(this._config)),g.onError=this._onDemuxException.bind(this),g.onMediaInfo=this._onMediaInfo.bind(this),g.onMetaDataArrived=this._onMetaDataArrived.bind(this),g.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),g.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),g.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),g.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),g.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),g.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),g.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},E.prototype._onMediaInfo=function(v){var g=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},v),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,l.a.prototype));var m=Object.assign({},v);Object.setPrototypeOf(m,l.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=m,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var S=g._pendingSeekTime;g._pendingSeekTime=null,g.seek(S)})},E.prototype._onMetaDataArrived=function(v){this._emitter.emit(tt.a.METADATA_ARRIVED,v)},E.prototype._onScriptDataArrived=function(v){this._emitter.emit(tt.a.SCRIPTDATA_ARRIVED,v)},E.prototype._onTimedID3Metadata=function(v){var g=this._remuxer.getTimestampBase();g!=null&&(v.pts!=null&&(v.pts-=g),v.dts!=null&&(v.dts-=g),this._emitter.emit(tt.a.TIMED_ID3_METADATA_ARRIVED,v))},E.prototype._onSynchronousKLVMetadata=function(v){var g=this._remuxer.getTimestampBase();g!=null&&(v.pts!=null&&(v.pts-=g),v.dts!=null&&(v.dts-=g),this._emitter.emit(tt.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,v))},E.prototype._onAsynchronousKLVMetadata=function(v){this._emitter.emit(tt.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,v)},E.prototype._onSMPTE2038Metadata=function(v){var g=this._remuxer.getTimestampBase();g!=null&&(v.pts!=null&&(v.pts-=g),v.dts!=null&&(v.dts-=g),v.nearest_pts!=null&&(v.nearest_pts-=g),this._emitter.emit(tt.a.SMPTE2038_METADATA_ARRIVED,v))},E.prototype._onSCTE35Metadata=function(v){var g=this._remuxer.getTimestampBase();g!=null&&(v.pts!=null&&(v.pts-=g),v.nearest_pts!=null&&(v.nearest_pts-=g),this._emitter.emit(tt.a.SCTE35_METADATA_ARRIVED,v))},E.prototype._onPESPrivateDataDescriptor=function(v){this._emitter.emit(tt.a.PES_PRIVATE_DATA_DESCRIPTOR,v)},E.prototype._onPESPrivateData=function(v){var g=this._remuxer.getTimestampBase();g!=null&&(v.pts!=null&&(v.pts-=g),v.nearest_pts!=null&&(v.nearest_pts-=g),v.dts!=null&&(v.dts-=g),this._emitter.emit(tt.a.PES_PRIVATE_DATA_ARRIVED,v))},E.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},E.prototype._onIOComplete=function(v){var g=v+1;g<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(g)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(tt.a.LOADING_COMPLETE),this._disableStatisticsReporter())},E.prototype._onIORedirect=function(v){var g=this._ioctl.extraData;this._mediaDataSource.segments[g].redirectedURL=v},E.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(tt.a.RECOVERED_EARLY_EOF)},E.prototype._onIOException=function(v,g){o.a.e(this.TAG,"IOException: type = ".concat(v,", code = ").concat(g.code,", msg = ").concat(g.msg)),this._emitter.emit(tt.a.IO_ERROR,v,g),this._disableStatisticsReporter()},E.prototype._onDemuxException=function(v,g){o.a.e(this.TAG,"DemuxException: type = ".concat(v,", info = ").concat(g)),this._emitter.emit(tt.a.DEMUX_ERROR,v,g)},E.prototype._onRemuxerInitSegmentArrival=function(v,g){this._emitter.emit(tt.a.INIT_SEGMENT,v,g)},E.prototype._onRemuxerMediaSegmentArrival=function(v,g){if(this._pendingSeekTime==null&&(this._emitter.emit(tt.a.MEDIA_SEGMENT,v,g),this._pendingResolveSeekPoint!=null&&v==="video")){var m=g.info.syncPoints,S=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&m.length>0&&m[0].originalDts===S&&(S=m[0].pts),this._emitter.emit(tt.a.RECOMMEND_SEEKPOINT,S)}},E.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},E.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},E.prototype._reportSegmentMediaInfo=function(v){var g=this._mediaInfo.segments[v],m=Object.assign({},g);m.duration=this._mediaInfo.duration,m.segmentCount=this._mediaInfo.segmentCount,delete m.segments,delete m.keyframesIndex,this._emitter.emit(tt.a.MEDIA_INFO,m)},E.prototype._reportStatisticsInfo=function(){var v={};v.url=this._ioctl.currentURL,v.hasRedirect=this._ioctl.hasRedirect,v.hasRedirect&&(v.redirectedURL=this._ioctl.currentRedirectedURL),v.speed=this._ioctl.currentSpeed,v.loaderType=this._ioctl.loaderType,v.currentSegmentIndex=this._currentSegmentIndex,v.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(tt.a.STATISTICS_INFO,v)},E}());i.a=tl},function(t,i,r){var s,n=r(0),o=function(){function P(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return P.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},P.prototype.addBytes=function(L){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=L,this._totalBytes+=L):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=L,this._totalBytes+=L):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=L,this._totalBytes+=L,this._lastCheckpoint=this._now())},Object.defineProperty(P.prototype,"currentKBps",{get:function(){this.addBytes(0);var L=(this._now()-this._lastCheckpoint)/1e3;return L==0&&(L=1),this._intervalBytes/L/1024},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"averageKBps",{get:function(){var L=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/L/1024},enumerable:!1,configurable:!0}),P}(),a=r(2),l=r(5),d=r(3),u=(s=function(P,L){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,x){A.__proto__=x}||function(A,x){for(var k in x)Object.prototype.hasOwnProperty.call(x,k)&&(A[k]=x[k])})(P,L)},function(P,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function A(){this.constructor=P}s(P,L),P.prototype=L===null?Object.create(L):(A.prototype=L.prototype,new A)}),h=function(P){function L(A,x){var k=P.call(this,"fetch-stream-loader")||this;return k.TAG="FetchStreamLoader",k._seekHandler=A,k._config=x,k._needStash=!0,k._requestAbort=!1,k._abortController=null,k._contentLength=null,k._receivedLength=0,k}return u(L,P),L.isSupported=function(){try{var A=l.a.msedge&&l.a.version.minor>=15048,x=!l.a.msedge||A;return self.fetch&&self.ReadableStream&&x}catch{return!1}},L.prototype.destroy=function(){this.isWorking()&&this.abort(),P.prototype.destroy.call(this)},L.prototype.open=function(A,x){var k=this;this._dataSource=A,this._range=x;var U=A.url;this._config.reuseRedirectedURL&&A.redirectedURL!=null&&(U=A.redirectedURL);var K=this._seekHandler.getConfig(U,x),$=new self.Headers;if(typeof K.headers=="object"){var j=K.headers;for(var Q in j)j.hasOwnProperty(Q)&&$.append(Q,j[Q])}var ie={method:"GET",headers:$,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var Q in this._config.headers)$.append(Q,this._config.headers[Q]);A.cors===!1&&(ie.mode="same-origin"),A.withCredentials&&(ie.credentials="include"),A.referrerPolicy&&(ie.referrerPolicy=A.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ie.signal=this._abortController.signal),this._status=a.c.kConnecting,self.fetch(K.url,ie).then(function(ee){if(k._requestAbort)return k._status=a.c.kIdle,void ee.body.cancel();if(ee.ok&&ee.status>=200&&ee.status<=299){if(ee.url!==K.url&&k._onURLRedirect){var F=k._seekHandler.removeURLParameters(ee.url);k._onURLRedirect(F)}var O=ee.headers.get("Content-Length");return O!=null&&(k._contentLength=parseInt(O),k._contentLength!==0&&k._onContentLengthKnown&&k._onContentLengthKnown(k._contentLength)),k._pump.call(k,ee.body.getReader())}if(k._status=a.c.kError,!k._onError)throw new d.d("FetchStreamLoader: Http code invalid, "+ee.status+" "+ee.statusText);k._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:ee.status,msg:ee.statusText})}).catch(function(ee){if(!k._abortController||!k._abortController.signal.aborted){if(k._status=a.c.kError,!k._onError)throw ee;k._onError(a.b.EXCEPTION,{code:-1,msg:ee.message})}})},L.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.c.kBuffering||!l.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},L.prototype._pump=function(A){var x=this;return A.read().then(function(k){if(k.done)if(x._contentLength!==null&&x._receivedLength<x._contentLength){x._status=a.c.kError;var U=a.b.EARLY_EOF,K={code:-1,msg:"Fetch stream meet Early-EOF"};if(!x._onError)throw new d.d(K.msg);x._onError(U,K)}else x._status=a.c.kComplete,x._onComplete&&x._onComplete(x._range.from,x._range.from+x._receivedLength-1);else{if(x._abortController&&x._abortController.signal.aborted)return void(x._status=a.c.kComplete);if(x._requestAbort===!0)return x._status=a.c.kComplete,A.cancel();x._status=a.c.kBuffering;var $=k.value.buffer,j=x._range.from+x._receivedLength;x._receivedLength+=$.byteLength,x._onDataArrival&&x._onDataArrival($,j,x._receivedLength),x._pump(A)}}).catch(function(k){if(x._abortController&&x._abortController.signal.aborted)x._status=a.c.kComplete;else if(k.code!==11||!l.a.msedge){x._status=a.c.kError;var U=0,K=null;if(k.code!==19&&k.message!=="network error"||!(x._contentLength===null||x._contentLength!==null&&x._receivedLength<x._contentLength)?(U=a.b.EXCEPTION,K={code:k.code,msg:k.message}):(U=a.b.EARLY_EOF,K={code:k.code,msg:"Fetch stream meet Early-EOF"}),!x._onError)throw new d.d(K.msg);x._onError(U,K)}})},L}(a.a),f=function(){var P=function(L,A){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,k){x.__proto__=k}||function(x,k){for(var U in k)Object.prototype.hasOwnProperty.call(k,U)&&(x[U]=k[U])})(L,A)};return function(L,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function x(){this.constructor=L}P(L,A),L.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)}}(),p=function(P){function L(A,x){var k=P.call(this,"xhr-moz-chunked-loader")||this;return k.TAG="MozChunkedLoader",k._seekHandler=A,k._config=x,k._needStash=!0,k._xhr=null,k._requestAbort=!1,k._contentLength=null,k._receivedLength=0,k}return f(L,P),L.isSupported=function(){try{var A=new XMLHttpRequest;return A.open("GET","https://example.com",!0),A.responseType="moz-chunked-arraybuffer",A.responseType==="moz-chunked-arraybuffer"}catch(x){return n.a.w("MozChunkedLoader",x.message),!1}},L.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),P.prototype.destroy.call(this)},L.prototype.open=function(A,x){this._dataSource=A,this._range=x;var k=A.url;this._config.reuseRedirectedURL&&A.redirectedURL!=null&&(k=A.redirectedURL);var U=this._seekHandler.getConfig(k,x);this._requestURL=U.url;var K=this._xhr=new XMLHttpRequest;if(K.open("GET",U.url,!0),K.responseType="moz-chunked-arraybuffer",K.onreadystatechange=this._onReadyStateChange.bind(this),K.onprogress=this._onProgress.bind(this),K.onloadend=this._onLoadEnd.bind(this),K.onerror=this._onXhrError.bind(this),A.withCredentials&&(K.withCredentials=!0),typeof U.headers=="object"){var $=U.headers;for(var j in $)$.hasOwnProperty(j)&&K.setRequestHeader(j,$[j])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var j in $)$.hasOwnProperty(j)&&K.setRequestHeader(j,$[j])}this._status=a.c.kConnecting,K.send()},L.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.c.kComplete},L.prototype._onReadyStateChange=function(A){var x=A.target;if(x.readyState===2){if(x.responseURL!=null&&x.responseURL!==this._requestURL&&this._onURLRedirect){var k=this._seekHandler.removeURLParameters(x.responseURL);this._onURLRedirect(k)}if(x.status!==0&&(x.status<200||x.status>299)){if(this._status=a.c.kError,!this._onError)throw new d.d("MozChunkedLoader: Http code invalid, "+x.status+" "+x.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:x.status,msg:x.statusText})}else this._status=a.c.kBuffering}},L.prototype._onProgress=function(A){if(this._status!==a.c.kError){this._contentLength===null&&A.total!==null&&A.total!==0&&(this._contentLength=A.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var x=A.target.response,k=this._range.from+this._receivedLength;this._receivedLength+=x.byteLength,this._onDataArrival&&this._onDataArrival(x,k,this._receivedLength)}},L.prototype._onLoadEnd=function(A){this._requestAbort!==!0?this._status!==a.c.kError&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},L.prototype._onXhrError=function(A){this._status=a.c.kError;var x=0,k=null;if(this._contentLength&&A.loaded<this._contentLength?(x=a.b.EARLY_EOF,k={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(x=a.b.EXCEPTION,k={code:-1,msg:A.constructor.name+" "+A.type}),!this._onError)throw new d.d(k.msg);this._onError(x,k)},L}(a.a),_=function(){var P=function(L,A){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,k){x.__proto__=k}||function(x,k){for(var U in k)Object.prototype.hasOwnProperty.call(k,U)&&(x[U]=k[U])})(L,A)};return function(L,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function x(){this.constructor=L}P(L,A),L.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)}}(),y=(function(P){function L(A,x){var k=P.call(this,"xhr-msstream-loader")||this;return k.TAG="MSStreamLoader",k._seekHandler=A,k._config=x,k._needStash=!0,k._xhr=null,k._reader=null,k._totalRange=null,k._currentRange=null,k._currentRequestURL=null,k._currentRedirectedURL=null,k._contentLength=null,k._receivedLength=0,k._bufferLimit=16777216,k._lastTimeBufferSize=0,k._isReconnecting=!1,k}_(L,P),L.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var A=new XMLHttpRequest;return A.open("GET","https://example.com",!0),A.responseType="ms-stream",A.responseType==="ms-stream"}catch(x){return n.a.w("MSStreamLoader",x.message),!1}},L.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),P.prototype.destroy.call(this)},L.prototype.open=function(A,x){this._internalOpen(A,x,!1)},L.prototype._internalOpen=function(A,x,k){this._dataSource=A,k?this._currentRange=x:this._totalRange=x;var U=A.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?U=this._currentRedirectedURL:A.redirectedURL!=null&&(U=A.redirectedURL));var K=this._seekHandler.getConfig(U,x);this._currentRequestURL=K.url;var $=this._reader=new self.MSStreamReader;$.onprogress=this._msrOnProgress.bind(this),$.onload=this._msrOnLoad.bind(this),$.onerror=this._msrOnError.bind(this);var j=this._xhr=new XMLHttpRequest;if(j.open("GET",K.url,!0),j.responseType="ms-stream",j.onreadystatechange=this._xhrOnReadyStateChange.bind(this),j.onerror=this._xhrOnError.bind(this),A.withCredentials&&(j.withCredentials=!0),typeof K.headers=="object"){var Q=K.headers;for(var ie in Q)Q.hasOwnProperty(ie)&&j.setRequestHeader(ie,Q[ie])}if(typeof this._config.headers=="object"){Q=this._config.headers;for(var ie in Q)Q.hasOwnProperty(ie)&&j.setRequestHeader(ie,Q[ie])}this._isReconnecting?this._isReconnecting=!1:this._status=a.c.kConnecting,j.send()},L.prototype.abort=function(){this._internalAbort(),this._status=a.c.kComplete},L.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},L.prototype._xhrOnReadyStateChange=function(A){var x=A.target;if(x.readyState===2)if(x.status>=200&&x.status<=299){if(this._status=a.c.kBuffering,x.responseURL!=null){var k=this._seekHandler.removeURLParameters(x.responseURL);x.responseURL!==this._currentRequestURL&&k!==this._currentRedirectedURL&&(this._currentRedirectedURL=k,this._onURLRedirect&&this._onURLRedirect(k))}var U=x.getResponseHeader("Content-Length");if(U!=null&&this._contentLength==null){var K=parseInt(U);K>0&&(this._contentLength=K,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=a.c.kError,!this._onError)throw new d.d("MSStreamLoader: Http code invalid, "+x.status+" "+x.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:x.status,msg:x.statusText})}else if(x.readyState===3&&x.status>=200&&x.status<=299){this._status=a.c.kBuffering;var $=x.response;this._reader.readAsArrayBuffer($)}},L.prototype._xhrOnError=function(A){this._status=a.c.kError;var x=a.b.EXCEPTION,k={code:-1,msg:A.constructor.name+" "+A.type};if(!this._onError)throw new d.d(k.msg);this._onError(x,k)},L.prototype._msrOnProgress=function(A){var x=A.target.result;if(x!=null){var k=x.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=x.byteLength;var U=this._totalRange.from+this._receivedLength;this._receivedLength+=k.byteLength,this._onDataArrival&&this._onDataArrival(k,U,this._receivedLength),x.byteLength>=this._bufferLimit&&(n.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(U+k.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},L.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var A={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,A,!0)}},L.prototype._msrOnLoad=function(A){this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},L.prototype._msrOnError=function(A){this._status=a.c.kError;var x=0,k=null;if(this._contentLength&&this._receivedLength<this._contentLength?(x=a.b.EARLY_EOF,k={code:-1,msg:"MSStream meet Early-Eof"}):(x=a.b.EARLY_EOF,k={code:-1,msg:A.constructor.name+" "+A.type}),!this._onError)throw new d.d(k.msg);this._onError(x,k)}}(a.a),function(){var P=function(L,A){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,k){x.__proto__=k}||function(x,k){for(var U in k)Object.prototype.hasOwnProperty.call(k,U)&&(x[U]=k[U])})(L,A)};return function(L,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function x(){this.constructor=L}P(L,A),L.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)}}()),b=function(P){function L(A,x){var k=P.call(this,"xhr-range-loader")||this;return k.TAG="RangeLoader",k._seekHandler=A,k._config=x,k._needStash=!1,k._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],k._currentChunkSizeKB=384,k._currentSpeedNormalized=0,k._zeroSpeedChunkCount=0,k._xhr=null,k._speedSampler=new o,k._requestAbort=!1,k._waitForTotalLength=!1,k._totalLengthReceived=!1,k._currentRequestURL=null,k._currentRedirectedURL=null,k._currentRequestRange=null,k._totalLength=null,k._contentLength=null,k._receivedLength=0,k._lastTimeLoaded=0,k}return y(L,P),L.isSupported=function(){try{var A=new XMLHttpRequest;return A.open("GET","https://example.com",!0),A.responseType="arraybuffer",A.responseType==="arraybuffer"}catch(x){return n.a.w("RangeLoader",x.message),!1}},L.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),P.prototype.destroy.call(this)},Object.defineProperty(L.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),L.prototype.open=function(A,x){this._dataSource=A,this._range=x,this._status=a.c.kConnecting;var k=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(k=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||k?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},L.prototype._openSubRange=function(){var A=1024*this._currentChunkSizeKB,x=this._range.from+this._receivedLength,k=x+A;this._contentLength!=null&&k-this._range.from>=this._contentLength&&(k=this._range.from+this._contentLength-1),this._currentRequestRange={from:x,to:k},this._internalOpen(this._dataSource,this._currentRequestRange)},L.prototype._internalOpen=function(A,x){this._lastTimeLoaded=0;var k=A.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?k=this._currentRedirectedURL:A.redirectedURL!=null&&(k=A.redirectedURL));var U=this._seekHandler.getConfig(k,x);this._currentRequestURL=U.url;var K=this._xhr=new XMLHttpRequest;if(K.open("GET",U.url,!0),K.responseType="arraybuffer",K.onreadystatechange=this._onReadyStateChange.bind(this),K.onprogress=this._onProgress.bind(this),K.onload=this._onLoad.bind(this),K.onerror=this._onXhrError.bind(this),A.withCredentials&&(K.withCredentials=!0),typeof U.headers=="object"){var $=U.headers;for(var j in $)$.hasOwnProperty(j)&&K.setRequestHeader(j,$[j])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var j in $)$.hasOwnProperty(j)&&K.setRequestHeader(j,$[j])}K.send()},L.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.c.kComplete},L.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},L.prototype._onReadyStateChange=function(A){var x=A.target;if(x.readyState===2){if(x.responseURL!=null){var k=this._seekHandler.removeURLParameters(x.responseURL);x.responseURL!==this._currentRequestURL&&k!==this._currentRedirectedURL&&(this._currentRedirectedURL=k,this._onURLRedirect&&this._onURLRedirect(k))}if(x.status>=200&&x.status<=299){if(this._waitForTotalLength)return;this._status=a.c.kBuffering}else{if(this._status=a.c.kError,!this._onError)throw new d.d("RangeLoader: Http code invalid, "+x.status+" "+x.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:x.status,msg:x.statusText})}}},L.prototype._onProgress=function(A){if(this._status!==a.c.kError){if(this._contentLength===null){var x=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,x=!0;var k=A.total;this._internalAbort(),k!=null&k!==0&&(this._totalLength=k)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,x)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var U=A.loaded-this._lastTimeLoaded;this._lastTimeLoaded=A.loaded,this._speedSampler.addBytes(U)}},L.prototype._normalizeSpeed=function(A){var x=this._chunkSizeKBList,k=x.length-1,U=0,K=0,$=k;if(A<x[0])return x[0];for(;K<=$;){if((U=K+Math.floor(($-K)/2))===k||A>=x[U]&&A<x[U+1])return x[U];x[U]<A?K=U+1:$=U-1}},L.prototype._onLoad=function(A){if(this._status!==a.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var x=this._speedSampler.lastSecondKBps;if(x===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(x=this._speedSampler.currentKBps)),x!==0){var k=this._normalizeSpeed(x);this._currentSpeedNormalized!==k&&(this._currentSpeedNormalized=k,this._currentChunkSizeKB=k)}var U=A.target.response,K=this._range.from+this._receivedLength;this._receivedLength+=U.byteLength;var $=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():$=!0,this._onDataArrival&&this._onDataArrival(U,K,this._receivedLength),$&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},L.prototype._onXhrError=function(A){this._status=a.c.kError;var x=0,k=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(x=a.b.EARLY_EOF,k={code:-1,msg:"RangeLoader meet Early-Eof"}):(x=a.b.EXCEPTION,k={code:-1,msg:A.constructor.name+" "+A.type}),!this._onError)throw new d.d(k.msg);this._onError(x,k)},L}(a.a),I=function(){var P=function(L,A){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,k){x.__proto__=k}||function(x,k){for(var U in k)Object.prototype.hasOwnProperty.call(k,U)&&(x[U]=k[U])})(L,A)};return function(L,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function x(){this.constructor=L}P(L,A),L.prototype=A===null?Object.create(A):(x.prototype=A.prototype,new x)}}(),T=function(P){function L(){var A=P.call(this,"websocket-loader")||this;return A.TAG="WebSocketLoader",A._needStash=!0,A._ws=null,A._requestAbort=!1,A._receivedLength=0,A}return I(L,P),L.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},L.prototype.destroy=function(){this._ws&&this.abort(),P.prototype.destroy.call(this)},L.prototype.open=function(A){try{var x=this._ws=new self.WebSocket(A.url);x.binaryType="arraybuffer",x.onopen=this._onWebSocketOpen.bind(this),x.onclose=this._onWebSocketClose.bind(this),x.onmessage=this._onWebSocketMessage.bind(this),x.onerror=this._onWebSocketError.bind(this),this._status=a.c.kConnecting}catch(U){this._status=a.c.kError;var k={code:U.code,msg:U.message};if(!this._onError)throw new d.d(k.msg);this._onError(a.b.EXCEPTION,k)}},L.prototype.abort=function(){var A=this._ws;!A||A.readyState!==0&&A.readyState!==1||(this._requestAbort=!0,A.close()),this._ws=null,this._status=a.c.kComplete},L.prototype._onWebSocketOpen=function(A){this._status=a.c.kBuffering},L.prototype._onWebSocketClose=function(A){this._requestAbort!==!0?(this._status=a.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},L.prototype._onWebSocketMessage=function(A){var x=this;if(A.data instanceof ArrayBuffer)this._dispatchArrayBuffer(A.data);else if(A.data instanceof Blob){var k=new FileReader;k.onload=function(){x._dispatchArrayBuffer(k.result)},k.readAsArrayBuffer(A.data)}else{this._status=a.c.kError;var U={code:-1,msg:"Unsupported WebSocket message type: "+A.data.constructor.name};if(!this._onError)throw new d.d(U.msg);this._onError(a.b.EXCEPTION,U)}},L.prototype._dispatchArrayBuffer=function(A){var x=A,k=this._receivedLength;this._receivedLength+=x.byteLength,this._onDataArrival&&this._onDataArrival(x,k,this._receivedLength)},L.prototype._onWebSocketError=function(A){this._status=a.c.kError;var x={code:A.code,msg:A.message};if(!this._onError)throw new d.d(x.msg);this._onError(a.b.EXCEPTION,x)},L}(a.a),R=function(){function P(L){this._zeroStart=L||!1}return P.prototype.getConfig=function(L,A){var x={};if(A.from!==0||A.to!==-1){var k=void 0;k=A.to!==-1?"bytes=".concat(A.from.toString(),"-").concat(A.to.toString()):"bytes=".concat(A.from.toString(),"-"),x.Range=k}else this._zeroStart&&(x.Range="bytes=0-");return{url:L,headers:x}},P.prototype.removeURLParameters=function(L){return L},P}(),M=function(){function P(L,A){this._startName=L,this._endName=A}return P.prototype.getConfig=function(L,A){var x=L;if(A.from!==0||A.to!==-1){var k=!0;x.indexOf("?")===-1&&(x+="?",k=!1),k&&(x+="&"),x+="".concat(this._startName,"=").concat(A.from.toString()),A.to!==-1&&(x+="&".concat(this._endName,"=").concat(A.to.toString()))}return{url:x,headers:{}}},P.prototype.removeURLParameters=function(L){var A=L.split("?")[0],x=void 0,k=L.indexOf("?");k!==-1&&(x=L.substring(k+1));var U="";if(x!=null&&x.length>0)for(var K=x.split("&"),$=0;$<K.length;$++){var j=K[$].split("="),Q=$>0;j[0]!==this._startName&&j[0]!==this._endName&&(Q&&(U+="&"),U+=K[$])}return U.length===0?A:A+"?"+U},P}(),N=function(){function P(L,A,x){this.TAG="IOController",this._config=A,this._extraData=x,this._stashInitialSize=65536,A.stashInitialSize!=null&&A.stashInitialSize>0&&(this._stashInitialSize=A.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,A.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=L,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(L.url),this._refTotalLength=L.filesize?L.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new o,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return P.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},P.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},P.prototype.isPaused=function(){return this._paused},Object.defineProperty(P.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"extraData",{get:function(){return this._extraData},set:function(L){this._extraData=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(L){this._onDataArrival=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(L){this._onSeeked=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onError",{get:function(){return this._onError},set:function(L){this._onError=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onComplete",{get:function(){return this._onComplete},set:function(L){this._onComplete=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(L){this._onRedirect=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(L){this._onRecoveredEarlyEof=L},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"currentSpeed",{get:function(){return this._loaderClass===b?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),P.prototype._selectSeekHandler=function(){var L=this._config;if(L.seekType==="range")this._seekHandler=new R(this._config.rangeLoadZeroStart);else if(L.seekType==="param"){var A=L.seekParamStart||"bstart",x=L.seekParamEnd||"bend";this._seekHandler=new M(A,x)}else{if(L.seekType!=="custom")throw new d.b("Invalid seekType in config: ".concat(L.seekType));if(typeof L.customSeekHandler!="function")throw new d.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new L.customSeekHandler}},P.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=T;else if(h.isSupported())this._loaderClass=h;else if(p.isSupported())this._loaderClass=p;else{if(!b.isSupported())throw new d.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=b}},P.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},P.prototype.open=function(L){this._currentRange={from:0,to:-1},L&&(this._currentRange.from=L),this._speedSampler.reset(),L||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},P.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},P.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},P.prototype.resume=function(){if(this._paused){this._paused=!1;var L=this._resumeFrom;this._resumeFrom=0,this._internalSeek(L,!0)}},P.prototype.seek=function(L){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(L,!0)},P.prototype._internalSeek=function(L,A){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(A),this._loader.destroy(),this._loader=null;var x={from:L,to:-1};this._currentRange={from:x.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,x),this._onSeeked&&this._onSeeked()},P.prototype.updateUrl=function(L){if(!L||typeof L!="string"||L.length===0)throw new d.b("Url must be a non-empty string!");this._dataSource.url=L},P.prototype._expandBuffer=function(L){for(var A=this._stashSize;A+1048576<L;)A*=2;if((A+=1048576)!==this._bufferSize){var x=new ArrayBuffer(A);if(this._stashUsed>0){var k=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(x,0,A).set(k,0)}this._stashBuffer=x,this._bufferSize=A}},P.prototype._normalizeSpeed=function(L){var A=this._speedNormalizeList,x=A.length-1,k=0,U=0,K=x;if(L<A[0])return A[0];for(;U<=K;){if((k=U+Math.floor((K-U)/2))===x||L>=A[k]&&L<A[k+1])return A[k];A[k]<L?U=k+1:K=k-1}},P.prototype._adjustStashSize=function(L){var A=0;(A=this._config.isLive?L/8:L<512?L:L>=512&&L<=1024?Math.floor(1.5*L):2*L)>8192&&(A=8192);var x=1024*A+1048576;this._bufferSize<x&&this._expandBuffer(x),this._stashSize=1024*A},P.prototype._dispatchChunks=function(L,A){return this._currentRange.to=A+L.byteLength-1,this._onDataArrival(L,A)},P.prototype._onURLRedirect=function(L){this._redirectedURL=L,this._onRedirect&&this._onRedirect(L)},P.prototype._onContentLengthKnown=function(L){L&&this._fullRequestFlag&&(this._totalLength=L,this._fullRequestFlag=!1)},P.prototype._onLoaderChunkArrival=function(L,A,x){if(!this._onDataArrival)throw new d.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(L.byteLength);var k=this._speedSampler.lastSecondKBps;if(k!==0){var U=this._normalizeSpeed(k);this._speedNormalized!==U&&(this._speedNormalized=U,this._adjustStashSize(U))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=A),this._stashUsed+L.byteLength<=this._stashSize)(j=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(L),this._stashUsed),this._stashUsed+=L.byteLength;else if(j=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var K=this._stashBuffer.slice(0,this._stashUsed);(Q=this._dispatchChunks(K,this._stashByteStart))<K.byteLength?Q>0&&(ie=new Uint8Array(K,Q),j.set(ie,0),this._stashUsed=ie.byteLength,this._stashByteStart+=Q):(this._stashUsed=0,this._stashByteStart+=Q),this._stashUsed+L.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+L.byteLength),j=new Uint8Array(this._stashBuffer,0,this._bufferSize)),j.set(new Uint8Array(L),this._stashUsed),this._stashUsed+=L.byteLength}else(Q=this._dispatchChunks(L,A))<L.byteLength&&(($=L.byteLength-Q)>this._bufferSize&&(this._expandBuffer($),j=new Uint8Array(this._stashBuffer,0,this._bufferSize)),j.set(new Uint8Array(L,Q),0),this._stashUsed+=$,this._stashByteStart=A+Q);else if(this._stashUsed===0){var $;(Q=this._dispatchChunks(L,A))<L.byteLength&&(($=L.byteLength-Q)>this._bufferSize&&this._expandBuffer($),(j=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(L,Q),0),this._stashUsed+=$,this._stashByteStart=A+Q)}else{var j,Q;if(this._stashUsed+L.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+L.byteLength),(j=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(L),this._stashUsed),this._stashUsed+=L.byteLength,(Q=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&Q>0){var ie=new Uint8Array(this._stashBuffer,Q);j.set(ie,0)}this._stashUsed-=Q,this._stashByteStart+=Q}}},P.prototype._flushStashBuffer=function(L){if(this._stashUsed>0){var A=this._stashBuffer.slice(0,this._stashUsed),x=this._dispatchChunks(A,this._stashByteStart),k=A.byteLength-x;if(x<A.byteLength){if(!L){if(x>0){var U=new Uint8Array(this._stashBuffer,0,this._bufferSize),K=new Uint8Array(A,x);U.set(K,0),this._stashUsed=K.byteLength,this._stashByteStart+=x}return 0}n.a.w(this.TAG,"".concat(k," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,k}return 0},P.prototype._onLoaderComplete=function(L,A){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},P.prototype._onLoaderError=function(L,A){switch(n.a.e(this.TAG,"Loader error, code = ".concat(A.code,", msg = ").concat(A.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,L=a.b.UNRECOVERABLE_EARLY_EOF),L){case a.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var x=this._currentRange.to+1;return void(x<this._totalLength&&(n.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(x,!1)))}L=a.b.UNRECOVERABLE_EARLY_EOF;break;case a.b.UNRECOVERABLE_EARLY_EOF:case a.b.CONNECTING_TIMEOUT:case a.b.HTTP_STATUS_CODE_INVALID:case a.b.EXCEPTION:}if(!this._onError)throw new d.d("IOException: "+A.msg);this._onError(L,A)},P}();i.a=N},function(t,i,r){var s=function(){function n(){}return n.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,a){return o.__proto__=a,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(o),l=1;l<arguments.length;l++){var d=arguments[l];if(d!=null)for(var u in d)d.hasOwnProperty(u)&&(a[u]=d[u])}return a},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(o,a){var l=a>0?0|a:0;return this.substring(l,l+o.length)===o}}),typeof self.Promise!="function"&&r(21).polyfill()},n}();s.install(),i.a=s},function(t,i,r){var s=r(9),n=r.n(s),o=r(0),a=r(5),l=r(7),d=r(3),u=function(){function h(f){this.TAG="MSEController",this._config=f,this._emitter=new n.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return h.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(f,p){this._emitter.addListener(f,p)},h.prototype.off=function(f,p){this._emitter.removeListener(f,p)},h.prototype.initialize=function(f){if(this._mediaSource)throw new d.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&o.a.v(this.TAG,"Using ManagedMediaSource");var p=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;p.addEventListener("sourceopen",this.e.onSourceOpen),p.addEventListener("sourceended",this.e.onSourceEnded),p.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(p.addEventListener("startstreaming",this.e.onStartStreaming),p.addEventListener("endstreaming",this.e.onEndStreaming),p.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=f},h.prototype.shutdown=function(){if(this._mediaSource){var f=this._mediaSource;for(var p in this._sourceBuffers){var _=this._pendingSegments[p];_.splice(0,_.length),this._pendingSegments[p]=null,this._pendingRemoveRanges[p]=null,this._lastInitSegments[p]=null;var y=this._sourceBuffers[p];if(y){if(f.readyState!=="closed"){try{f.removeSourceBuffer(y)}catch(b){o.a.e(this.TAG,b.message)}y.removeEventListener("error",this.e.onSourceBufferError),y.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[p]=null,this._sourceBuffers[p]=null}}if(f.readyState==="open")try{f.endOfStream()}catch(b){o.a.e(this.TAG,b.message)}this._mediaElementProxy=null,f.removeEventListener("sourceopen",this.e.onSourceOpen),f.removeEventListener("sourceended",this.e.onSourceEnded),f.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(f.removeEventListener("startstreaming",this.e.onStartStreaming),f.removeEventListener("endstreaming",this.e.onEndStreaming),f.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},h.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},h.prototype.getObject=function(){if(!this._mediaSource)throw new d.a("MediaSource has not been initialized yet!");return this._mediaSource},h.prototype.getHandle=function(){if(!this._mediaSource)throw new d.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},h.prototype.getObjectURL=function(){if(!this._mediaSource)throw new d.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},h.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},h.prototype.appendInitSegment=function(f,p){if(p===void 0&&(p=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(f),void this._pendingSegments[f.type].push(f);var _=f,y="".concat(_.container);_.codec&&_.codec.length>0&&(_.codec==="opus"&&a.a.safari&&(_.codec="Opus"),y+=";codecs=".concat(_.codec));var b=!1;if(o.a.v(this.TAG,"Received Initialization Segment, mimeType: "+y),this._lastInitSegments[_.type]=_,y!==this._mimeTypes[_.type]){if(this._mimeTypes[_.type])o.a.v(this.TAG,"Notice: ".concat(_.type," mimeType changed, origin: ").concat(this._mimeTypes[_.type],", target: ").concat(y));else{b=!0;try{var I=this._sourceBuffers[_.type]=this._mediaSource.addSourceBuffer(y);I.addEventListener("error",this.e.onSourceBufferError),I.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(T){return o.a.e(this.TAG,T.message),void this._emitter.emit(l.a.ERROR,{code:T.code,msg:T.message})}}this._mimeTypes[_.type]=y}p||this._pendingSegments[_.type].push(_),b||this._sourceBuffers[_.type]&&!this._sourceBuffers[_.type].updating&&this._doAppendSegments(),a.a.safari&&_.container==="audio/mpeg"&&_.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=_.mediaDuration/1e3,this._updateMediaSourceDuration())},h.prototype.appendMediaSegment=function(f){var p=f;this._pendingSegments[p.type].push(p),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var _=this._sourceBuffers[p.type];!_||_.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},h.prototype.flush=function(){for(var f in this._sourceBuffers)if(this._sourceBuffers[f]){var p=this._sourceBuffers[f];if(this._mediaSource.readyState==="open")try{p.abort()}catch(R){o.a.e(this.TAG,R.message)}var _=this._pendingSegments[f];if(_.splice(0,_.length),this._mediaSource.readyState!=="closed"){for(var y=0;y<p.buffered.length;y++){var b=p.buffered.start(y),I=p.buffered.end(y);this._pendingRemoveRanges[f].push({start:b,end:I})}if(p.updating||this._doRemoveRanges(),a.a.safari){var T=this._lastInitSegments[f];T&&(this._pendingSegments[f].push(T),p.updating||this._doAppendSegments())}}}},h.prototype.endOfStream=function(){var f=this._mediaSource,p=this._sourceBuffers;f&&f.readyState==="open"?p.video&&p.video.updating||p.audio&&p.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,f.endOfStream()):f&&f.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},h.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var f=this._mediaElementProxy.getCurrentTime();for(var p in this._sourceBuffers){var _=this._sourceBuffers[p];if(_){var y=_.buffered;if(y.length>=1&&f-y.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},h.prototype._doCleanupSourceBuffer=function(){var f=this._mediaElementProxy.getCurrentTime();for(var p in this._sourceBuffers){var _=this._sourceBuffers[p];if(_){for(var y=_.buffered,b=!1,I=0;I<y.length;I++){var T=y.start(I),R=y.end(I);if(T<=f&&f<R+3){if(f-T>=this._config.autoCleanupMaxBackwardDuration){b=!0;var M=f-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[p].push({start:T,end:M})}}else R<f&&(b=!0,this._pendingRemoveRanges[p].push({start:T,end:R}))}b&&!_.updating&&this._doRemoveRanges()}}},h.prototype._updateMediaSourceDuration=function(){var f=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(f.video&&f.video.updating||f.audio&&f.audio.updating)){var p=this._mediaSource.duration,_=this._pendingMediaDuration;_>0&&(isNaN(p)||_>p)&&(o.a.v(this.TAG,"Update MediaSource duration from ".concat(p," to ").concat(_)),this._mediaSource.duration=_),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},h.prototype._doRemoveRanges=function(){for(var f in this._pendingRemoveRanges)if(this._sourceBuffers[f]&&!this._sourceBuffers[f].updating)for(var p=this._sourceBuffers[f],_=this._pendingRemoveRanges[f];_.length&&!p.updating;){var y=_.shift();p.remove(y.start,y.end)}},h.prototype._doAppendSegments=function(){var f=this._pendingSegments;for(var p in f)if(this._sourceBuffers[p]&&!this._sourceBuffers[p].updating&&this._mediaSource.streaming!==!1&&f[p].length>0){var _=f[p].shift();if(typeof _.timestampOffset=="number"&&isFinite(_.timestampOffset)){var y=this._sourceBuffers[p].timestampOffset,b=_.timestampOffset/1e3;Math.abs(y-b)>.1&&(o.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(y," to ").concat(b)),this._sourceBuffers[p].timestampOffset=b),delete _.timestampOffset}if(!_.data||_.data.byteLength===0)continue;try{this._sourceBuffers[p].appendBuffer(_.data),this._isBufferFull=!1}catch(I){this._pendingSegments[p].unshift(_),I.code===22?(this._isBufferFull||this._emitter.emit(l.a.BUFFER_FULL),this._isBufferFull=!0):(o.a.e(this.TAG,I.message),this._emitter.emit(l.a.ERROR,{code:I.code,msg:I.message}))}}},h.prototype._onSourceOpen=function(){if(o.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var f=this._pendingSourceBufferInit;f.length;){var p=f.shift();this.appendInitSegment(p,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(l.a.SOURCE_OPEN)},h.prototype._onStartStreaming=function(){o.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(l.a.START_STREAMING)},h.prototype._onEndStreaming=function(){o.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(l.a.END_STREAMING)},h.prototype._onQualityChange=function(){o.a.v(this.TAG,"ManagedMediaSource onQualityChange")},h.prototype._onSourceEnded=function(){o.a.v(this.TAG,"MediaSource onSourceEnded")},h.prototype._onSourceClose=function(){o.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},h.prototype._hasPendingSegments=function(){var f=this._pendingSegments;return f.video.length>0||f.audio.length>0},h.prototype._hasPendingRemoveRanges=function(){var f=this._pendingRemoveRanges;return f.video.length>0||f.audio.length>0},h.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(l.a.UPDATE_END)},h.prototype._onSourceBufferError=function(f){o.a.e(this.TAG,"SourceBuffer Error: ".concat(f))},h}();i.a=u},function(t,i,r){var s=r(9),n=r.n(s),o=r(18),a=r.n(o),l=r(0),d=r(8),u=r(13),h=r(1),f=(r(19),r(12)),p=function(){function _(y,b){if(this.TAG="Transmuxer",this._emitter=new n.a,b.enableWorker&&typeof Worker<"u")try{this._worker=a()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[y,b]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},d.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:d.a.getConfig()})}catch{l.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new u.a(y,b)}else this._controller=new u.a(y,b);if(this._controller){var I=this._controller;I.on(h.a.IO_ERROR,this._onIOError.bind(this)),I.on(h.a.DEMUX_ERROR,this._onDemuxError.bind(this)),I.on(h.a.INIT_SEGMENT,this._onInitSegment.bind(this)),I.on(h.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),I.on(h.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),I.on(h.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),I.on(h.a.MEDIA_INFO,this._onMediaInfo.bind(this)),I.on(h.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),I.on(h.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),I.on(h.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),I.on(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),I.on(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),I.on(h.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),I.on(h.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),I.on(h.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),I.on(h.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),I.on(h.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),I.on(h.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return _.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),d.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(y,b){this._emitter.addListener(y,b)},_.prototype.off=function(y,b){this._emitter.removeListener(y,b)},_.prototype.hasWorker=function(){return this._worker!=null},_.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},_.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},_.prototype.seek=function(y){this._worker?this._worker.postMessage({cmd:"seek",param:y}):this._controller.seek(y)},_.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},_.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},_.prototype._onInitSegment=function(y,b){var I=this;Promise.resolve().then(function(){I._emitter.emit(h.a.INIT_SEGMENT,y,b)})},_.prototype._onMediaSegment=function(y,b){var I=this;Promise.resolve().then(function(){I._emitter.emit(h.a.MEDIA_SEGMENT,y,b)})},_.prototype._onLoadingComplete=function(){var y=this;Promise.resolve().then(function(){y._emitter.emit(h.a.LOADING_COMPLETE)})},_.prototype._onRecoveredEarlyEof=function(){var y=this;Promise.resolve().then(function(){y._emitter.emit(h.a.RECOVERED_EARLY_EOF)})},_.prototype._onMediaInfo=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.MEDIA_INFO,y)})},_.prototype._onMetaDataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.METADATA_ARRIVED,y)})},_.prototype._onScriptDataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.SCRIPTDATA_ARRIVED,y)})},_.prototype._onTimedID3MetadataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.TIMED_ID3_METADATA_ARRIVED,y)})},_.prototype._onSynchronousKLVMetadataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,y)})},_.prototype._onAsynchronousKLVMetadataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,y)})},_.prototype._onSMPTE2038MetadataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.SMPTE2038_METADATA_ARRIVED,y)})},_.prototype._onSCTE35MetadataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.SCTE35_METADATA_ARRIVED,y)})},_.prototype._onPESPrivateDataDescriptor=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.PES_PRIVATE_DATA_DESCRIPTOR,y)})},_.prototype._onPESPrivateDataArrived=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.PES_PRIVATE_DATA_ARRIVED,y)})},_.prototype._onStatisticsInfo=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.STATISTICS_INFO,y)})},_.prototype._onIOError=function(y,b){var I=this;Promise.resolve().then(function(){I._emitter.emit(h.a.IO_ERROR,y,b)})},_.prototype._onDemuxError=function(y,b){var I=this;Promise.resolve().then(function(){I._emitter.emit(h.a.DEMUX_ERROR,y,b)})},_.prototype._onRecommendSeekpoint=function(y){var b=this;Promise.resolve().then(function(){b._emitter.emit(h.a.RECOMMEND_SEEKPOINT,y)})},_.prototype._onLoggingConfigChanged=function(y){this._worker&&this._worker.postMessage({cmd:"logging_config",param:y})},_.prototype._onWorkerMessage=function(y){var b=y.data,I=b.data;if(b.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(b.msg){case h.a.INIT_SEGMENT:case h.a.MEDIA_SEGMENT:this._emitter.emit(b.msg,I.type,I.data);break;case h.a.LOADING_COMPLETE:case h.a.RECOVERED_EARLY_EOF:this._emitter.emit(b.msg);break;case h.a.MEDIA_INFO:Object.setPrototypeOf(I,f.a.prototype),this._emitter.emit(b.msg,I);break;case h.a.METADATA_ARRIVED:case h.a.SCRIPTDATA_ARRIVED:case h.a.TIMED_ID3_METADATA_ARRIVED:case h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case h.a.SMPTE2038_METADATA_ARRIVED:case h.a.SCTE35_METADATA_ARRIVED:case h.a.PES_PRIVATE_DATA_DESCRIPTOR:case h.a.PES_PRIVATE_DATA_ARRIVED:case h.a.STATISTICS_INFO:this._emitter.emit(b.msg,I);break;case h.a.IO_ERROR:case h.a.DEMUX_ERROR:this._emitter.emit(b.msg,I.type,I.info);break;case h.a.RECOMMEND_SEEKPOINT:this._emitter.emit(b.msg,I);break;case"logcat_callback":l.a.emitter.emit("log",I.type,I.logcat)}},_}();i.a=p},function(t,i,r){function s(l){var d={};function u(f){if(d[f])return d[f].exports;var p=d[f]={i:f,l:!1,exports:{}};return l[f].call(p.exports,p,p.exports,u),p.l=!0,p.exports}u.m=l,u.c=d,u.i=function(f){return f},u.d=function(f,p,_){u.o(f,p)||Object.defineProperty(f,p,{configurable:!1,enumerable:!0,get:_})},u.r=function(f){Object.defineProperty(f,"__esModule",{value:!0})},u.n=function(f){var p=f&&f.__esModule?function(){return f.default}:function(){return f};return u.d(p,"a",p),p},u.o=function(f,p){return Object.prototype.hasOwnProperty.call(f,p)},u.p="/",u.oe=function(f){throw console.error(f),f};var h=u(u.s=ENTRY_MODULE);return h.default||h}function n(l){return(l+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(l,d,u){var h={};h[u]=[];var f=d.toString(),p=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!p)return h;for(var _,y=p[1],b=new RegExp("(\\\\n|\\W)"+n(y)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");_=b.exec(f);)_[3]!=="dll-reference"&&h[u].push(_[3]);for(b=new RegExp("\\("+n(y)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");_=b.exec(f);)l[_[2]]||(h[u].push(_[1]),l[_[2]]=r(_[1]).m),h[_[2]]=h[_[2]]||[],h[_[2]].push(_[4]);for(var I,T=Object.keys(h),R=0;R<T.length;R++)for(var M=0;M<h[T[R]].length;M++)I=h[T[R]][M],isNaN(1*I)||(h[T[R]][M]=1*h[T[R]][M]);return h}function a(l){return Object.keys(l).reduce(function(d,u){return d||l[u].length>0},!1)}t.exports=function(l,d){d=d||{};var u={main:r.m},h=d.all?{main:Object.keys(u.main)}:function(b,I){for(var T={main:[I]},R={main:[]},M={main:{}};a(T);)for(var N=Object.keys(T),P=0;P<N.length;P++){var L=N[P],A=T[L].pop();if(M[L]=M[L]||{},!M[L][A]&&b[L][A]){M[L][A]=!0,R[L]=R[L]||[],R[L].push(A);for(var x=o(b,b[L][A],L),k=Object.keys(x),U=0;U<k.length;U++)T[k[U]]=T[k[U]]||[],T[k[U]]=T[k[U]].concat(x[k[U]])}}return R}(u,l),f="";Object.keys(h).filter(function(b){return b!=="main"}).forEach(function(b){for(var I=0;h[b][I];)I++;h[b].push(I),u[b][I]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+b+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(I))+")({"+h[b].map(function(T){return JSON.stringify(T)+": "+u[b][T].toString()}).join(",")+`});
`}),f=f+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+h.main.map(function(b){return JSON.stringify(b)+": "+u.main[b].toString()}).join(",")+"}))(self);";var p=new self.Blob([f],{type:"text/javascript"});if(d.bare)return p;var _=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(p),y=new self.Worker(_);return y.objectURL=_,y}},function(t,i,r){r.r(i),r(0);var s=r(8),n=r(15),o=r(13),a=r(1);i.default=function(l){var d=null,u=(function($,j){l.postMessage({msg:"logcat_callback",data:{type:$,logcat:j}})}).bind(this);function h($,j){var Q={msg:a.a.INIT_SEGMENT,data:{type:$,data:j}};l.postMessage(Q,[j.data])}function f($,j){var Q={msg:a.a.MEDIA_SEGMENT,data:{type:$,data:j}};l.postMessage(Q,[j.data])}function p(){var $={msg:a.a.LOADING_COMPLETE};l.postMessage($)}function _(){var $={msg:a.a.RECOVERED_EARLY_EOF};l.postMessage($)}function y($){var j={msg:a.a.MEDIA_INFO,data:$};l.postMessage(j)}function b($){var j={msg:a.a.METADATA_ARRIVED,data:$};l.postMessage(j)}function I($){var j={msg:a.a.SCRIPTDATA_ARRIVED,data:$};l.postMessage(j)}function T($){var j={msg:a.a.TIMED_ID3_METADATA_ARRIVED,data:$};l.postMessage(j)}function R($){var j={msg:a.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:$};l.postMessage(j)}function M($){var j={msg:a.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:$};l.postMessage(j)}function N($){var j={msg:a.a.SMPTE2038_METADATA_ARRIVED,data:$};l.postMessage(j)}function P($){var j={msg:a.a.SCTE35_METADATA_ARRIVED,data:$};l.postMessage(j)}function L($){var j={msg:a.a.PES_PRIVATE_DATA_DESCRIPTOR,data:$};l.postMessage(j)}function A($){var j={msg:a.a.PES_PRIVATE_DATA_ARRIVED,data:$};l.postMessage(j)}function x($){var j={msg:a.a.STATISTICS_INFO,data:$};l.postMessage(j)}function k($,j){l.postMessage({msg:a.a.IO_ERROR,data:{type:$,info:j}})}function U($,j){l.postMessage({msg:a.a.DEMUX_ERROR,data:{type:$,info:j}})}function K($){l.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:$})}n.a.install(),l.addEventListener("message",function($){switch($.data.cmd){case"init":(d=new o.a($.data.param[0],$.data.param[1])).on(a.a.IO_ERROR,k.bind(this)),d.on(a.a.DEMUX_ERROR,U.bind(this)),d.on(a.a.INIT_SEGMENT,h.bind(this)),d.on(a.a.MEDIA_SEGMENT,f.bind(this)),d.on(a.a.LOADING_COMPLETE,p.bind(this)),d.on(a.a.RECOVERED_EARLY_EOF,_.bind(this)),d.on(a.a.MEDIA_INFO,y.bind(this)),d.on(a.a.METADATA_ARRIVED,b.bind(this)),d.on(a.a.SCRIPTDATA_ARRIVED,I.bind(this)),d.on(a.a.TIMED_ID3_METADATA_ARRIVED,T.bind(this)),d.on(a.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,R.bind(this)),d.on(a.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,M.bind(this)),d.on(a.a.SMPTE2038_METADATA_ARRIVED,N.bind(this)),d.on(a.a.SCTE35_METADATA_ARRIVED,P.bind(this)),d.on(a.a.PES_PRIVATE_DATA_DESCRIPTOR,L.bind(this)),d.on(a.a.PES_PRIVATE_DATA_ARRIVED,A.bind(this)),d.on(a.a.STATISTICS_INFO,x.bind(this)),d.on(a.a.RECOMMEND_SEEKPOINT,K.bind(this));break;case"destroy":d&&(d.destroy(),d=null),l.postMessage({msg:"destroyed"});break;case"start":d.start();break;case"stop":d.stop();break;case"seek":d.seek($.data.param);break;case"pause":d.pause();break;case"resume":d.resume();break;case"logging_config":var j=$.data.param;s.a.applyConfig(j),j.enableCallback===!0?s.a.addLogListener(u):s.a.removeLogListener(u)}})}},function(t,i,r){t.exports=r(25).default},function(t,i,r){(function(s,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var o;o=function(){function a(re){return typeof re=="function"}var l=Array.isArray?Array.isArray:function(re){return Object.prototype.toString.call(re)==="[object Array]"},d=0,u=void 0,h=void 0,f=function(re,oe){R[d]=re,R[d+1]=oe,(d+=2)===2&&(h?h(M):x())},p=typeof window<"u"?window:void 0,_=p||{},y=_.MutationObserver||_.WebKitMutationObserver,b=typeof self>"u"&&s!==void 0&&{}.toString.call(s)==="[object process]",I=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function T(){var re=setTimeout;return function(){return re(M,1)}}var R=new Array(1e3);function M(){for(var re=0;re<d;re+=2)(0,R[re])(R[re+1]),R[re]=void 0,R[re+1]=void 0;d=0}var N,P,L,A,x=void 0;function k(re,oe){var fe=this,be=new this.constructor($);be[K]===void 0&&le(be);var xe=fe._state;if(xe){var Ce=arguments[xe-1];f(function(){return W(xe,be,Ce,fe._result)})}else O(fe,be,re,oe);return be}function U(re){if(re&&typeof re=="object"&&re.constructor===this)return re;var oe=new this($);return Q(oe,re),oe}b?x=function(){return s.nextTick(M)}:y?(P=0,L=new y(M),A=document.createTextNode(""),L.observe(A,{characterData:!0}),x=function(){A.data=P=++P%2}):I?((N=new MessageChannel).port1.onmessage=M,x=function(){return N.port2.postMessage(0)}):x=p===void 0?function(){try{var re=Function("return this")().require("vertx");return(u=re.runOnLoop||re.runOnContext)!==void 0?function(){u(M)}:T()}catch{return T()}}():T();var K=Math.random().toString(36).substring(2);function $(){}function j(re,oe,fe){oe.constructor===re.constructor&&fe===k&&oe.constructor.resolve===U?function(be,xe){xe._state===1?ee(be,xe._result):xe._state===2?F(be,xe._result):O(xe,void 0,function(Ce){return Q(be,Ce)},function(Ce){return F(be,Ce)})}(re,oe):fe===void 0?ee(re,oe):a(fe)?function(be,xe,Ce){f(function(ze){var Ye=!1,ot=function(ve,_e,Je,Qe){try{ve.call(_e,Je,Qe)}catch(Ze){return Ze}}(Ce,xe,function(ve){Ye||(Ye=!0,xe!==ve?Q(ze,ve):ee(ze,ve))},function(ve){Ye||(Ye=!0,F(ze,ve))},ze._label);!Ye&&ot&&(Ye=!0,F(ze,ot))},be)}(re,oe,fe):ee(re,oe)}function Q(re,oe){if(re===oe)F(re,new TypeError("You cannot resolve a promise with itself"));else if(xe=typeof(be=oe),be===null||xe!=="object"&&xe!=="function")ee(re,oe);else{var fe=void 0;try{fe=oe.then}catch(Ce){return void F(re,Ce)}j(re,oe,fe)}var be,xe}function ie(re){re._onerror&&re._onerror(re._result),H(re)}function ee(re,oe){re._state===void 0&&(re._result=oe,re._state=1,re._subscribers.length!==0&&f(H,re))}function F(re,oe){re._state===void 0&&(re._state=2,re._result=oe,f(ie,re))}function O(re,oe,fe,be){var xe=re._subscribers,Ce=xe.length;re._onerror=null,xe[Ce]=oe,xe[Ce+1]=fe,xe[Ce+2]=be,Ce===0&&re._state&&f(H,re)}function H(re){var oe=re._subscribers,fe=re._state;if(oe.length!==0){for(var be=void 0,xe=void 0,Ce=re._result,ze=0;ze<oe.length;ze+=3)be=oe[ze],xe=oe[ze+fe],be?W(fe,be,xe,Ce):xe(Ce);re._subscribers.length=0}}function W(re,oe,fe,be){var xe=a(fe),Ce=void 0,ze=void 0,Ye=!0;if(xe){try{Ce=fe(be)}catch(ot){Ye=!1,ze=ot}if(oe===Ce)return void F(oe,new TypeError("A promises callback cannot return that same promise."))}else Ce=be;oe._state!==void 0||(xe&&Ye?Q(oe,Ce):Ye===!1?F(oe,ze):re===1?ee(oe,Ce):re===2&&F(oe,Ce))}var ae=0;function le(re){re[K]=ae++,re._state=void 0,re._result=void 0,re._subscribers=[]}var ye=function(){function re(oe,fe){this._instanceConstructor=oe,this.promise=new oe($),this.promise[K]||le(this.promise),l(fe)?(this.length=fe.length,this._remaining=fe.length,this._result=new Array(this.length),this.length===0?ee(this.promise,this._result):(this.length=this.length||0,this._enumerate(fe),this._remaining===0&&ee(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return re.prototype._enumerate=function(oe){for(var fe=0;this._state===void 0&&fe<oe.length;fe++)this._eachEntry(oe[fe],fe)},re.prototype._eachEntry=function(oe,fe){var be=this._instanceConstructor,xe=be.resolve;if(xe===U){var Ce=void 0,ze=void 0,Ye=!1;try{Ce=oe.then}catch(ve){Ye=!0,ze=ve}if(Ce===k&&oe._state!==void 0)this._settledAt(oe._state,fe,oe._result);else if(typeof Ce!="function")this._remaining--,this._result[fe]=oe;else if(be===me){var ot=new be($);Ye?F(ot,ze):j(ot,oe,Ce),this._willSettleAt(ot,fe)}else this._willSettleAt(new be(function(ve){return ve(oe)}),fe)}else this._willSettleAt(xe(oe),fe)},re.prototype._settledAt=function(oe,fe,be){var xe=this.promise;xe._state===void 0&&(this._remaining--,oe===2?F(xe,be):this._result[fe]=be),this._remaining===0&&ee(xe,this._result)},re.prototype._willSettleAt=function(oe,fe){var be=this;O(oe,void 0,function(xe){return be._settledAt(1,fe,xe)},function(xe){return be._settledAt(2,fe,xe)})},re}(),me=function(){function re(oe){this[K]=ae++,this._result=this._state=void 0,this._subscribers=[],$!==oe&&(typeof oe!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof re?function(fe,be){try{be(function(xe){Q(fe,xe)},function(xe){F(fe,xe)})}catch(xe){F(fe,xe)}}(this,oe):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return re.prototype.catch=function(oe){return this.then(null,oe)},re.prototype.finally=function(oe){var fe=this.constructor;return a(oe)?this.then(function(be){return fe.resolve(oe()).then(function(){return be})},function(be){return fe.resolve(oe()).then(function(){throw be})}):this.then(oe,oe)},re}();return me.prototype.then=k,me.all=function(re){return new ye(this,re).promise},me.race=function(re){var oe=this;return l(re)?new oe(function(fe,be){for(var xe=re.length,Ce=0;Ce<xe;Ce++)oe.resolve(re[Ce]).then(fe,be)}):new oe(function(fe,be){return be(new TypeError("You must pass an array to race."))})},me.resolve=U,me.reject=function(re){var oe=new this($);return F(oe,re),oe},me._setScheduler=function(re){h=re},me._setAsap=function(re){f=re},me._asap=f,me.polyfill=function(){var re=void 0;if(n!==void 0)re=n;else if(typeof self<"u")re=self;else try{re=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var oe=re.Promise;if(oe){var fe=null;try{fe=Object.prototype.toString.call(oe.resolve())}catch{}if(fe==="[object Promise]"&&!oe.cast)return}re.Promise=me},me.Promise=me,me},t.exports=o()}).call(this,r(22),r(23))},function(t,i){var r,s,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(I){if(r===setTimeout)return setTimeout(I,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(I,0);try{return r(I,0)}catch{try{return r.call(null,I,0)}catch{return r.call(this,I,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:o}catch{r=o}try{s=typeof clearTimeout=="function"?clearTimeout:a}catch{s=a}})();var d,u=[],h=!1,f=-1;function p(){h&&d&&(h=!1,d.length?u=d.concat(u):f=-1,u.length&&_())}function _(){if(!h){var I=l(p);h=!0;for(var T=u.length;T;){for(d=u,u=[];++f<T;)d&&d[f].run();f=-1,T=u.length}d=null,h=!1,function(R){if(s===clearTimeout)return clearTimeout(R);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(R);try{s(R)}catch{try{return s.call(null,R)}catch{return s.call(this,R)}}}(I)}}function y(I,T){this.fun=I,this.array=T}function b(){}n.nextTick=function(I){var T=new Array(arguments.length-1);if(arguments.length>1)for(var R=1;R<arguments.length;R++)T[R-1]=arguments[R];u.push(new y(I,T)),u.length!==1||h||l(_)},y.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=b,n.addListener=b,n.once=b,n.off=b,n.removeListener=b,n.removeAllListeners=b,n.emit=b,n.prependListener=b,n.prependOnceListener=b,n.listeners=function(I){return[]},n.binding=function(I){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(I){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,i){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch{typeof window=="object"&&(r=window)}t.exports=r},function(t,i,r){r.r(i);var s=r(0),n=r(8),o=r(3),a=r(7),l=r(16),d=r(17),u=r(1),h=r(4),f=r(10);i.default=function(p){var _="PlayerEngineWorker",y=(function(F,O){p.postMessage({msg:"logcat_callback",type:F,logcat:O})}).bind(void 0),b=null,I=null,T=null,R=null,M=!1,N=!1,P=0,L=0,A=!1;function x(){T&&(T.shutdown(),T.destroy(),T=null)}function k(){if(b==null||I==null)throw new o.a("Worker not initialized");if(R)throw new o.a("Transmuxer has been initialized");N||(!I.deferLoadAfterSourceOpen||M?((R=new d.a(b,I)).on(u.a.INIT_SEGMENT,function(F,O){T.appendInitSegment(O)}),R.on(u.a.MEDIA_SEGMENT,function(F,O){T.appendMediaSegment(O),p.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:O.info.endDts})}),R.on(u.a.LOADING_COMPLETE,function(){T.endOfStream(),p.postMessage({msg:"player_event",event:h.a.LOADING_COMPLETE})}),R.on(u.a.RECOVERED_EARLY_EOF,function(){p.postMessage({msg:"player_event",event:h.a.RECOVERED_EARLY_EOF})}),R.on(u.a.IO_ERROR,function(F,O){p.postMessage({msg:"player_event",event:h.a.ERROR,error_type:f.b.NETWORK_ERROR,error_detail:F,info:O})}),R.on(u.a.DEMUX_ERROR,function(F,O){p.postMessage({msg:"player_event",event:h.a.ERROR,error_type:f.b.MEDIA_ERROR,error_detail:F,info:O})}),R.on(u.a.MEDIA_INFO,function(F){ie(u.a.MEDIA_INFO,F)}),R.on(u.a.STATISTICS_INFO,function(F){ie(u.a.STATISTICS_INFO,F)}),R.on(u.a.RECOMMEND_SEEKPOINT,function(F){(function(O){p.postMessage({msg:"transmuxing_event",event:u.a.RECOMMEND_SEEKPOINT,milliseconds:O})})(F)}),R.on(u.a.METADATA_ARRIVED,function(F){ee(h.a.METADATA_ARRIVED,F)}),R.on(u.a.SCRIPTDATA_ARRIVED,function(F){ee(h.a.SCRIPTDATA_ARRIVED,F)}),R.on(u.a.TIMED_ID3_METADATA_ARRIVED,function(F){ee(h.a.TIMED_ID3_METADATA_ARRIVED,F)}),R.on(u.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(F){ee(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,F)}),R.on(u.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(F){ee(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,F)}),R.on(u.a.SMPTE2038_METADATA_ARRIVED,function(F){ee(h.a.SMPTE2038_METADATA_ARRIVED,F)}),R.on(u.a.SCTE35_METADATA_ARRIVED,function(F){ee(h.a.SCTE35_METADATA_ARRIVED,F)}),R.on(u.a.PES_PRIVATE_DATA_DESCRIPTOR,function(F){ee(h.a.PES_PRIVATE_DATA_DESCRIPTOR,F)}),R.on(u.a.PES_PRIVATE_DATA_ARRIVED,function(F){ee(h.a.PES_PRIVATE_DATA_ARRIVED,F)}),R.open()):N=!0)}function U(){T&&T.flush(),R&&(R.close(),R.destroy(),R=null)}function K(){M=!0,N&&(N=!1,k())}function $(){p.postMessage({msg:"mse_event",event:a.a.UPDATE_END})}function j(){s.a.v(_,"MSE SourceBuffer is full, report to main thread"),p.postMessage({msg:"mse_event",event:a.a.BUFFER_FULL})}function Q(F){p.postMessage({msg:"player_event",event:h.a.ERROR,error_type:f.b.MEDIA_ERROR,error_detail:f.b.MEDIA_MSE_ERROR,info:F})}function ie(F,O){p.postMessage({msg:"transmuxing_event",event:F,info:O})}function ee(F,O){p.postMessage({msg:"player_event",event:F,extraData:O})}p.addEventListener("message",function(F){if(!A){var O=F.data;switch(O.cmd){case"logging_config":var H=O;n.a.applyConfig(H.logging_config),H.logging_config.enableCallback===!0?n.a.addLogListener(y):n.a.removeLogListener(y);break;case"init":b=(H=O).media_data_source,I=H.config;break;case"destroy":(function(){R&&U(),T&&x(),A=!0,p.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){s.a.v(_,"Initializing MediaSource in DedicatedWorker"),(T=new l.a(I)).on(a.a.SOURCE_OPEN,K.bind(this)),T.on(a.a.UPDATE_END,$.bind(this)),T.on(a.a.BUFFER_FULL,j.bind(this)),T.on(a.a.ERROR,Q.bind(this)),T.initialize({getCurrentTime:function(){return P},getReadyState:function(){return L}});var W=T.getHandle();p.postMessage({msg:"mse_init",handle:W},[W])})();break;case"shutdown_mse":x();break;case"load":k();break;case"unload":U();break;case"unbuffered_seek":H=O,T.flush(),R.seek(H.milliseconds);break;case"timeupdate":P=(H=O).current_time;break;case"readystatechange":L=(H=O).ready_state;break;case"pause_transmuxer":R.pause();break;case"resume_transmuxer":R.resume()}}})}},function(t,i,r){r.r(i);var s=r(15),n=r(14),o={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},o)}var l=function(){function F(){}return F.supportMSEH264Playback=function(){var O=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),H=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return O||H},F.supportMSEH265Playback=function(){var O=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),H=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return O||H},F.supportNetworkStreamIO=function(){var O=new n.a({},a()),H=O.loaderType;return O.destroy(),H=="fetch-stream-loader"||H=="xhr-moz-chunked-loader"},F.getNetworkLoaderTypeName=function(){var O=new n.a({},a()),H=O.loaderType;return O.destroy(),H},F.supportNativeMediaPlayback=function(O){F.videoElement==null&&(F.videoElement=window.document.createElement("video"));var H=F.videoElement.canPlayType(O);return H==="probably"||H=="maybe"},F.getFeatureList=function(){var O={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return O.msePlayback=F.supportMSEH264Playback(),O.networkStreamIO=F.supportNetworkStreamIO(),O.networkLoaderName=F.getNetworkLoaderTypeName(),O.mseLivePlayback=O.msePlayback&&O.networkStreamIO,O.mseH265Playback=F.supportMSEH265Playback(),O.nativeMP4H264Playback=F.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),O.nativeMP4H265Playback=F.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),O.nativeWebmVP8Playback=F.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),O.nativeWebmVP9Playback=F.supportNativeMediaPlayback('video/webm; codecs="vp9"'),O},F}(),d=r(2),u=r(0),h=r(9),f=r.n(h),p=r(16),_=r(4),y=r(17),b=r(7),I=r(10),T=r(3),R=r(1),M=r(5),N=r(11),P=function(){function F(O,H,W){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new N.a,this.e=null,this._config=O,this._media_element=H,this._on_unbuffered_seek=W,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var ae=M.a.chrome&&(M.a.version.major<50||M.a.version.major===50&&M.a.version.build<2661);this._always_seek_keyframe=!!(ae||M.a.msedge||M.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return F.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},F.prototype.seek=function(O){var H=this._isPositionBuffered(O),W=!1;if(O<1&&this._media_element.buffered.length>0){var ae=this._media_element.buffered.start(0);(ae<1&&O<ae||M.a.safari)&&(W=!0,O=M.a.safari?.1:ae)}if(W)this.directSeek(O);else if(H)if(this._always_seek_keyframe){var le=this._getNearestKeyframe(Math.floor(1e3*O));le!=null&&(O=le.dts/1e3),this.directSeek(O)}else this.directSeek(O);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*O)),this._config.accurateSeek&&this.directSeek(O)},F.prototype.directSeek=function(O){this._request_set_current_time=!0,this._media_element.currentTime=O},F.prototype.appendSyncPoints=function(O){this._idr_sample_list.appendArray(O)},F.prototype._onMediaSeeking=function(O){if(this._request_set_current_time)this._request_set_current_time=!1;else{var H=this._media_element.currentTime,W=this._media_element.buffered;if(H<1&&W.length>0){var ae=W.start(0);if(ae<1&&H<ae||M.a.safari){var le=M.a.safari?.1:ae;return void this.directSeek(le)}}if(this._isPositionBuffered(H)){if(this._always_seek_keyframe){var ye=this._getNearestKeyframe(Math.floor(1e3*H));ye!=null&&(H=ye.dts/1e3,this.directSeek(H))}}else this._seek_request_record_clocktime=F._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},F.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=F._getClockTime()-100){var O=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered(O)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*O)),this._config.accurateSeek&&this.directSeek(O))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},F.prototype._isPositionBuffered=function(O){for(var H=this._media_element.buffered,W=0;W<H.length;W++){var ae=H.start(W),le=H.end(W);if(O>=ae&&O<le)return!0}return!1},F.prototype._getNearestKeyframe=function(O){return this._idr_sample_list.getLastSyncPointBeforeDts(O)},F._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},F}(),L=function(){function F(O,H,W,ae){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=O,this._media_element=H,this._on_pause_transmuxer=W,this._on_resume_transmuxer=ae,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return F.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},F.prototype.notifyBufferedPositionChanged=function(O){!this._config.isLive&&this._config.lazyLoad&&(O==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded(O))},F.prototype._onMediaTimeUpdate=function(O){this._paused&&this._resumeTransmuxerIfNeeded()},F.prototype._suspendTransmuxerIfNeeded=function(){for(var O=this._media_element.buffered,H=this._media_element.currentTime,W=0,ae=0;ae<O.length;ae++){var le=O.start(ae),ye=O.end(ae);if(le<=H&&H<ye){W=ye;break}}W>0&&this._suspendTransmuxerIfBufferedPositionExceeded(W)},F.prototype._suspendTransmuxerIfBufferedPositionExceeded=function(O){O>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(u.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},F.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},F.prototype._resumeTransmuxerIfNeeded=function(){for(var O=this._media_element.buffered,H=this._media_element.currentTime,W=this._config.lazyLoadRecoverDuration,ae=!1,le=0;le<O.length;le++){var ye=O.start(le),me=O.end(le);if(H>=ye&&H<me){H>=me-W&&(ae=!0);break}}ae&&(u.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},F.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},F}(),A=function(){function F(O,H){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=O,this._on_direct_seek=H,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return F.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},F.prototype._onMediaCanPlay=function(O){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},F.prototype._onMediaStalled=function(O){this._detectAndFixStuckPlayback(!0)},F.prototype._onMediaProgress=function(O){this._detectAndFixStuckPlayback()},F.prototype._detectAndFixStuckPlayback=function(O){var H=this._media_element,W=H.buffered;O||!this._canplay_received||H.readyState<2?W.length>0&&H.currentTime<W.start(0)&&(u.a.w(this.TAG,"Playback seems stuck at ".concat(H.currentTime,", seek to ").concat(W.start(0))),this._on_direct_seek(W.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},F}(),x=function(){function F(O,H,W){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=O,this._media_element=H,this._on_direct_seek=W}return F.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},F.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},F.prototype._chaseLiveLatency=function(){var O=this._media_element.buffered,H=this._media_element.currentTime,W=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&O.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!W)){var ae=O.end(O.length-1);if(ae>this._config.liveBufferLatencyMaxLatency&&ae-H>this._config.liveBufferLatencyMaxLatency){var le=ae-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(le)}}},F}(),k=function(){function F(O,H){this._config=null,this._media_element=null,this.e=null,this._config=O,this._media_element=H,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return F.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},F.prototype._onMediaTimeUpdate=function(O){if(this._config.isLive&&this._config.liveSync){var H=this._getCurrentLatency();if(H>this._config.liveSyncMaxLatency){var W=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=W}else H>this._config.liveSyncTargetLatency||this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(this._media_element.playbackRate=1)}},F.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var O=this._media_element.buffered,H=this._media_element.currentTime;return O.length==0?0:O.end(O.length-1)-H},F}(),U=function(){function F(O,H){this.TAG="PlayerEngineMainThread",this._emitter=new h,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=O,this._config=a(),typeof H=="object"&&Object.assign(this._config,H),O.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return F.prototype.destroy=function(){this._emitter.emit(_.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},F.prototype.on=function(O,H){var W=this;this._emitter.addListener(O,H),O===_.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return W._emitter.emit(_.a.MEDIA_INFO,W.mediaInfo)}):O==_.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return W._emitter.emit(_.a.STATISTICS_INFO,W.statisticsInfo)})},F.prototype.off=function(O,H){this._emitter.removeListener(O,H)},F.prototype.attachMediaElement=function(O){var H=this;this._media_element=O,O.src="",O.removeAttribute("src"),O.srcObject=null,O.load(),O.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new p.a(this._config),this._mse_controller.on(b.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(b.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(b.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(b.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(b.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(b.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return H._media_element.currentTime},getReadyState:function(){return H._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?(O.disableRemotePlayback=!0,O.srcObject=this._mse_controller.getObject()):O.src=this._mse_controller.getObjectURL()},F.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},F.prototype.load=function(){var O=this;if(!this._media_element)throw new T.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new T.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new y.a(this._media_data_source,this._config),this._transmuxer.on(R.a.INIT_SEGMENT,function(H,W){O._mse_controller.appendInitSegment(W)}),this._transmuxer.on(R.a.MEDIA_SEGMENT,function(H,W){O._mse_controller.appendMediaSegment(W),!O._config.isLive&&H==="video"&&W.data&&W.data.byteLength>0&&"info"in W&&O._seeking_handler.appendSyncPoints(W.info.syncPoints),O._loading_controller.notifyBufferedPositionChanged(W.info.endDts/1e3)}),this._transmuxer.on(R.a.LOADING_COMPLETE,function(){O._mse_controller.endOfStream(),O._emitter.emit(_.a.LOADING_COMPLETE)}),this._transmuxer.on(R.a.RECOVERED_EARLY_EOF,function(){O._emitter.emit(_.a.RECOVERED_EARLY_EOF)}),this._transmuxer.on(R.a.IO_ERROR,function(H,W){O._emitter.emit(_.a.ERROR,I.b.NETWORK_ERROR,H,W)}),this._transmuxer.on(R.a.DEMUX_ERROR,function(H,W){O._emitter.emit(_.a.ERROR,I.b.MEDIA_ERROR,H,W)}),this._transmuxer.on(R.a.MEDIA_INFO,function(H){O._media_info=H,O._emitter.emit(_.a.MEDIA_INFO,Object.assign({},H))}),this._transmuxer.on(R.a.STATISTICS_INFO,function(H){O._statistics_info=O._fillStatisticsInfo(H),O._emitter.emit(_.a.STATISTICS_INFO,Object.assign({},H))}),this._transmuxer.on(R.a.RECOMMEND_SEEKPOINT,function(H){O._media_element&&!O._config.accurateSeek&&O._seeking_handler.directSeek(H/1e3)}),this._transmuxer.on(R.a.METADATA_ARRIVED,function(H){O._emitter.emit(_.a.METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.SCRIPTDATA_ARRIVED,function(H){O._emitter.emit(_.a.SCRIPTDATA_ARRIVED,H)}),this._transmuxer.on(R.a.TIMED_ID3_METADATA_ARRIVED,function(H){O._emitter.emit(_.a.TIMED_ID3_METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(H){O._emitter.emit(_.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(H){O._emitter.emit(_.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.SMPTE2038_METADATA_ARRIVED,function(H){O._emitter.emit(_.a.SMPTE2038_METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.SCTE35_METADATA_ARRIVED,function(H){O._emitter.emit(_.a.SCTE35_METADATA_ARRIVED,H)}),this._transmuxer.on(R.a.PES_PRIVATE_DATA_DESCRIPTOR,function(H){O._emitter.emit(_.a.PES_PRIVATE_DATA_DESCRIPTOR,H)}),this._transmuxer.on(R.a.PES_PRIVATE_DATA_ARRIVED,function(H){O._emitter.emit(_.a.PES_PRIVATE_DATA_ARRIVED,H)}),this._seeking_handler=new P(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new L(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new A(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new x(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new k(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},F.prototype.unload=function(){var O,H,W,ae,le,ye,me,re,oe;(O=this._media_element)===null||O===void 0||O.pause(),(H=this._live_latency_synchronizer)===null||H===void 0||H.destroy(),this._live_latency_synchronizer=null,(W=this._live_latency_chaser)===null||W===void 0||W.destroy(),this._live_latency_chaser=null,(ae=this._startup_stall_jumper)===null||ae===void 0||ae.destroy(),this._startup_stall_jumper=null,(le=this._loading_controller)===null||le===void 0||le.destroy(),this._loading_controller=null,(ye=this._seeking_handler)===null||ye===void 0||ye.destroy(),this._seeking_handler=null,(me=this._mse_controller)===null||me===void 0||me.flush(),(re=this._transmuxer)===null||re===void 0||re.close(),(oe=this._transmuxer)===null||oe===void 0||oe.destroy(),this._transmuxer=null},F.prototype.play=function(){return this._media_element.play()},F.prototype.pause=function(){this._media_element.pause()},F.prototype.seek=function(O){this._media_element&&this._seeking_handler?this._seeking_handler.seek(O):this._pending_seek_time=O},Object.defineProperty(F.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),F.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},F.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},F.prototype._onMSEBufferFull=function(){u.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},F.prototype._onMSEError=function(O){this._emitter.emit(_.a.ERROR,I.b.MEDIA_ERROR,I.a.MEDIA_MSE_ERROR,O)},F.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(u.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},F.prototype._onMSEEndStreaming=function(){this._config.isLive||(u.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},F.prototype._onMediaLoadedMetadata=function(O){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},F.prototype._onRequestDirectSeek=function(O){this._seeking_handler.directSeek(O)},F.prototype._onRequiredUnbufferedSeek=function(O){this._mse_controller.flush(),this._transmuxer.seek(O)},F.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},F.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},F.prototype._fillStatisticsInfo=function(O){if(O.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return O;var H=!0,W=0,ae=0;if(this._media_element.getVideoPlaybackQuality){var le=this._media_element.getVideoPlaybackQuality();W=le.totalVideoFrames,ae=le.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(W=this._media_element.webkitDecodedFrameCount,ae=this._media_element.webkitDroppedFrameCount):H=!1;return H&&(O.decodedFrames=W,O.droppedFrames=ae),O},F}(),K=r(18),$=r(8),j=function(){function F(O,H){this.TAG="PlayerEngineDedicatedThread",this._emitter=new h,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=O,this._config=a(),typeof H=="object"&&Object.assign(this._config,H),O.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},$.a.registerListener(this.e.onLoggingConfigChanged),this._worker=K(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:$.a.getConfig()})}return F.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},F.prototype.destroy=function(){this._emitter.emit(_.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),$.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},F.prototype.on=function(O,H){var W=this;this._emitter.addListener(O,H),O===_.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return W._emitter.emit(_.a.MEDIA_INFO,W.mediaInfo)}):O==_.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return W._emitter.emit(_.a.STATISTICS_INFO,W.statisticsInfo)})},F.prototype.off=function(O,H){this._emitter.removeListener(O,H)},F.prototype.attachMediaElement=function(O){this._media_element=O,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},F.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},F.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new P(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new L(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new A(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new x(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new k(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},F.prototype.unload=function(){var O,H,W,ae,le,ye;(O=this._media_element)===null||O===void 0||O.pause(),this._worker.postMessage({cmd:"unload"}),(H=this._live_latency_synchronizer)===null||H===void 0||H.destroy(),this._live_latency_synchronizer=null,(W=this._live_latency_chaser)===null||W===void 0||W.destroy(),this._live_latency_chaser=null,(ae=this._startup_stall_jumper)===null||ae===void 0||ae.destroy(),this._startup_stall_jumper=null,(le=this._loading_controller)===null||le===void 0||le.destroy(),this._loading_controller=null,(ye=this._seeking_handler)===null||ye===void 0||ye.destroy(),this._seeking_handler=null},F.prototype.play=function(){return this._media_element.play()},F.prototype.pause=function(){this._media_element.pause()},F.prototype.seek=function(O){this._media_element&&this._seeking_handler?this._seeking_handler.seek(O):this._pending_seek_time=O},Object.defineProperty(F.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),F.prototype._onLoggingConfigChanged=function(O){var H;(H=this._worker)===null||H===void 0||H.postMessage({cmd:"logging_config",logging_config:O})},F.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},F.prototype._onMSEBufferFull=function(){u.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},F.prototype._onMediaLoadedMetadata=function(O){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},F.prototype._onRequestDirectSeek=function(O){this._seeking_handler.directSeek(O)},F.prototype._onRequiredUnbufferedSeek=function(O){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:O})},F.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},F.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},F.prototype._onMediaTimeUpdate=function(O){this._worker.postMessage({cmd:"timeupdate",current_time:O.target.currentTime})},F.prototype._onMediaReadyStateChange=function(O){this._worker.postMessage({cmd:"readystatechange",ready_state:O.target.readyState})},F.prototype._onWorkerMessage=function(O){var H,W=O.data,ae=W.msg;if(ae=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,(H=this._worker)===null||H===void 0||H.terminate(),void(this._worker=null);switch(ae){case"mse_init":var le=W;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=le.handle;break;case"mse_event":(le=W).event==b.a.UPDATE_END?this._onMSEUpdateEnd():le.event==b.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((le=W).event==R.a.MEDIA_INFO){var ye=W;this._media_info=ye.info,this._emitter.emit(_.a.MEDIA_INFO,Object.assign({},ye.info))}else if(le.event==R.a.STATISTICS_INFO){var me=W;this._statistics_info=this._fillStatisticsInfo(me.info),this._emitter.emit(_.a.STATISTICS_INFO,Object.assign({},me.info))}else if(le.event==R.a.RECOMMEND_SEEKPOINT){var re=W;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(re.milliseconds/1e3)}break;case"player_event":if((le=W).event==_.a.ERROR){var oe=W;this._emitter.emit(_.a.ERROR,oe.error_type,oe.error_detail,oe.info)}else if("extraData"in le){var fe=W;this._emitter.emit(fe.event,fe.extraData)}break;case"logcat_callback":le=W,u.a.emitter.emit("log",le.type,le.logcat);break;case"buffered_position_changed":le=W,this._loading_controller.notifyBufferedPositionChanged(le.buffered_position_milliseconds/1e3)}},F.prototype._fillStatisticsInfo=function(O){if(O.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return O;var H=!0,W=0,ae=0;if(this._media_element.getVideoPlaybackQuality){var le=this._media_element.getVideoPlaybackQuality();W=le.totalVideoFrames,ae=le.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(W=this._media_element.webkitDecodedFrameCount,ae=this._media_element.webkitDroppedFrameCount):H=!1;return H&&(O.decodedFrames=W,O.droppedFrames=ae),O},F}(),Q=function(){function F(O,H){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var W=O.type.toLowerCase();if(W!=="mse"&&W!=="mpegts"&&W!=="m2ts"&&W!=="flv")throw new T.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(H&&H.enableWorkerForMSE&&j.isSupported())try{this._player_engine=new j(O,H)}catch{u.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new U(O,H)}else this._player_engine=new U(O,H)}return F.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},F.prototype.on=function(O,H){this._player_engine.on(O,H)},F.prototype.off=function(O,H){this._player_engine.off(O,H)},F.prototype.attachMediaElement=function(O){this._media_element=O,this._player_engine.attachMediaElement(O)},F.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},F.prototype.load=function(){this._player_engine.load()},F.prototype.unload=function(){this._player_engine.unload()},F.prototype.play=function(){return this._player_engine.play()},F.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(F.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"volume",{get:function(){return this._media_element.volume},set:function(O){this._media_element.volume=O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"muted",{get:function(){return this._media_element.muted},set:function(O){this._media_element.muted=O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function(O){this._player_engine.seek(O)},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),F}(),ie=function(){function F(O,H){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new f.a,this._config=a(),typeof H=="object"&&Object.assign(this._config,H);var W=O.type.toLowerCase();if(W==="mse"||W==="mpegts"||W==="m2ts"||W==="flv")throw new T.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(O.hasOwnProperty("segments"))throw new T.b("NativePlayer(".concat(O.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=O,this._mediaElement=null}return F.prototype.destroy=function(){this._emitter.emit(_.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},F.prototype.on=function(O,H){var W=this;O===_.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){W._emitter.emit(_.a.MEDIA_INFO,W.mediaInfo)}):O===_.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){W._emitter.emit(_.a.STATISTICS_INFO,W.statisticsInfo)}),this._emitter.addListener(O,H)},F.prototype.off=function(O,H){this._emitter.removeListener(O,H)},F.prototype.attachMediaElement=function(O){if(this._mediaElement=O,O.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{O.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},F.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},F.prototype.load=function(){if(!this._mediaElement)throw new T.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},F.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},F.prototype.play=function(){return this._mediaElement.play()},F.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(F.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(O){this._mediaElement.volume=O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(O){this._mediaElement.muted=O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(O){this._mediaElement?this._mediaElement.currentTime=O:this._pendingSeekTime=O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"mediaInfo",{get:function(){var O={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(O.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(O.width=this._mediaElement.videoWidth,O.height=this._mediaElement.videoHeight)),O},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"statisticsInfo",{get:function(){var O={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return O;var H=!0,W=0,ae=0;if(this._mediaElement.getVideoPlaybackQuality){var le=this._mediaElement.getVideoPlaybackQuality();W=le.totalVideoFrames,ae=le.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(W=this._mediaElement.webkitDecodedFrameCount,ae=this._mediaElement.webkitDroppedFrameCount):H=!1;return H&&(O.decodedFrames=W,O.droppedFrames=ae),O},enumerable:!1,configurable:!0}),F.prototype._onvLoadedMetadata=function(O){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(_.a.MEDIA_INFO,this.mediaInfo)},F.prototype._reportStatisticsInfo=function(){this._emitter.emit(_.a.STATISTICS_INFO,this.statisticsInfo)},F}();s.a.install();var ee={createPlayer:function(F,O){var H=F;if(H==null||typeof H!="object")throw new T.b("MediaDataSource must be an javascript object!");if(!H.hasOwnProperty("type"))throw new T.b("MediaDataSource must has type field to indicate video file type!");switch(H.type){case"mse":case"mpegts":case"m2ts":case"flv":return new Q(H,O);default:return new ie(H,O)}},isSupported:function(){return l.supportMSEH264Playback()},getFeatureList:function(){return l.getFeatureList()}};ee.BaseLoader=d.a,ee.LoaderStatus=d.c,ee.LoaderErrors=d.b,ee.Events=_.a,ee.ErrorTypes=I.b,ee.ErrorDetails=I.a,ee.MSEPlayer=Q,ee.NativePlayer=ie,ee.LoggingControl=$.a,Object.defineProperty(ee,"version",{enumerable:!0,get:function(){return"1.8.0"}}),i.default=ee}])})})(Yo);var nf=Yo.exports;const Aa=Tr(nf),af=(c,e)=>(t,i,r)=>{if(It.isSupported()){r.hls&&r.hls.destroy();const s=new It({fLoader:class extends It.DefaultConfig.loader{constructor(n){super(n);var o=this.load.bind(this);this.load=function(a,l,d){c?c(a.url).then(u=>{const h=d.onSuccess;d.onSuccess=(f,p,_,y)=>{f.url=u,h(f,p,_,y)},o({...a,frag:{...a.frag,relurl:u,_url:u},url:u},l,d)}):o(a,l,d)}}},pLoader:class extends It.DefaultConfig.loader{constructor(n){super(n);var o=this.load.bind(this);this.load=function(a,l,d){c?c(a.url,!0).then(u=>{const h=d.onSuccess;d.onSuccess=(f,p,_,y)=>{f.url=u,h(f,p,_,y)},o({...a,url:u},l,d)}):o(a,l,d)}}},xhrSetup:async(n,o)=>{if(o.startsWith(ol)&&e){n.open("GET",await e(o),!0);return}}});s.loadSource(i),s.attachMedia(t),r.hls=s,r.on("destroy",()=>s.destroy())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=i:r.notice.show="Unsupported playback format: m3u8"},of=(c,e,t)=>{if(Aa.isSupported()){t.flv&&t.flv.destroy();const i=Aa.createPlayer({type:"flv",url:e},{lazyLoadMaxDuration:5*60,accurateSeek:!0});i.attachMediaElement(c),i.load(),t.flv=i,t.on("destroy",()=>i.destroy())}else t.notice.show="Unsupported playback format: flv"};function gf({option:c,chapters:e,getInstance:t,m3u8UrlTransform:i,getEntityUrl:r,...s}){const n=dn.useRef(),o=sl(c.title);return dn.useEffect(()=>{const a={...c,plugins:[...c.plugins],container:n.current,customType:{...c.customType,m3u8:af(i,r),flv:of},type:o};e&&a.plugins.push(ul({chapters:e})),o==="m3u8"&&a.plugins.push(fl({quality:{control:!0,setting:!0,getName:d=>d.height?d.height+"P":Li.t("application:fileManager.default"),title:Li.t("application:fileManager.quality"),auto:Li.t("application:fileManager.auto")},audio:{control:!0,setting:!0,getName:d=>d.name,title:Li.t("application:fileManager.audioTrack"),auto:Li.t("application:fileManager.auto")}}));const l=new cl(a);return t&&typeof t=="function"&&t(l),()=>{l&&l.destroy&&l.destroy(!1)}},[]),nl.jsx(al,{ref:n,...s})}export{gf as default};
