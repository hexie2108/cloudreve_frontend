import{n as yt,j as e,w as I,x as _,y as Z,r as f,fI as $e,eF as we,cB as jt,aw as D,ad as E,d1 as me,bO as re,dd as Ct,fJ as bt,cm as Ze,C as B,cn as Me,cQ as fe,cp as qe,cX as nn,a4 as Je,am as G,cY as ct,O as dt,bi as St,bh as Et,aW as ye,at as At,h as V,c0 as J,aR as kt,a$ as sn,cv as q,fK as an,aT as et,aU as T,as as pe,dG as Rt,au as z,cN as rn,bI as on,c$ as ln,fL as cn,fM as Mt,ax as se,d_ as Pe,f1 as De,$ as Pt,en as ce,a2 as dn,cb as Dt,e6 as Re,aG as tt,fN as hn,G as It,E as Ce,F as be,H as $,c4 as un,ci as pn,c6 as gn,cc as ht,N as xn,Q as Ue,R as Ke,fO as fn,fP as mn,bk as wn,c_ as vn,ca as yn,aE as jn,aK as Cn,fQ as bn,X as Sn,Z as En,_ as An,aV as de,a1 as kn,bW as S,T as Ve,cS as Rn,co as Ie,fR as Mn,af as _t,cW as Pn,ac as Dn,s as Te,bd as Se,fS as In,bx as _n,fT as Ln,ej as Nn,ey as ze,fU as On,fV as Tn,J as je,eC as zn,e8 as te,aj as nt,fW as Fn,fX as ut,bP as Bn,fY as Hn,fZ as Wn,f_ as ne,f$ as $n,g0 as Lt,dx as Un,g1 as Kn,g2 as Ye,e1 as ke,g3 as Nt,ak as Ot,aI as st,aJ as it,bc as at,g4 as Vn,fe as Yn,ff as Xn,fg as Qn,fc as Gn,av as Zn,ar as qn,bj as Jn,t as pt,g5 as es,g6 as ts,g7 as Fe,g8 as ns,g9 as Be,ga as ss,gb as is,f7 as as,gc as rs,gd as os,ge as ls}from"./index-BhmhgD6-.js";import{L as Xe,P as ve,a as ie,S as Tt,h as ge,i as cs,b as zt,R as Ft,E as Bt,u as ds}from"./DownloadFileList-B8cU4beD.js";import{F as rt,A as hs,c as O}from"./SettingForm-CxIiT_vO.js";import{M as us,C as ps,S as gs}from"./DarkThemeSwitcher-CxPmHxlM.js";import"./codemirror-TlZy3ty4.js";const xs=yt(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),fs=yt(e.jsx("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutline"),gt=25,ms=20*1e3,mi=()=>{const{t:n}=I(),s=_();Z(p=>p.globalState.policyOptionCache);const[t,d]=f.useState(""),[o,l]=f.useState([]),[u,g]=f.useState(!1),[a,i]=f.useState(!0),r=f.useRef();f.useEffect(()=>{a&&!r.current?r.current=setInterval(()=>{h()},ms):(clearInterval(r.current),r.current=void 0)},[a]),f.useEffect(()=>()=>{clearInterval(r.current),r.current=void 0},[]);const c=f.useCallback((p,m)=>()=>{g(!0),s($e({page_size:gt,category:Xe.general,next_page_token:m})).then(v=>{var w;m&&i(!1),l([...p,...v.tasks]),(w=v.pagination)!=null&&w.next_token?d(v.pagination.next_token):d(void 0)}).catch(()=>{d(void 0)}).finally(()=>{g(!1)})},[s,i,l]),h=()=>{c([],"")()},x=p=>{p.target.checked&&o.length>gt&&c([],"")(),i(p.target.checked)};return e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{secondaryAction:e.jsx(rt,{children:e.jsx(jt,{sx:{mr:0},control:e.jsx(Tt,{size:"small",onChange:x,checked:a}),label:e.jsx(D,{variant:"body2",color:"text.secondary",children:n("setting.autoRefresh")})})}),onRefresh:h,loading:u,title:n("application:navbar.taskQueue")}),o.map(p=>e.jsx(ge,{task:p},p.id)),t!=null&&e.jsx(ge,{onLoad:c(o,t),loading:!0},t),t==null&&o.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(me,{size:.8,top:63,primary:n("setting.listEmpty")})})]})})};function ws(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M10 5.75A.75.75 0 0 0 9.25 5H7l-.25.006A5 5 0 0 0 7 15h2.25l.11-.008a.75.75 0 0 0-.11-1.492H7l-.206-.006A3.5 3.5 0 0 1 7 6.5h2.25l.11-.008A.75.75 0 0 0 10 5.75M21.997 10a5 5 0 0 0-5-5h-2.25l-.11.008a.75.75 0 0 0 .11 1.492h2.25l.206.006a3.5 3.5 0 0 1 3.293 3.588c.518.126 1.01.38 1.428.76a5.03 5.03 0 0 0 .073-.855m-5-.75H7l-.102.006A.75.75 0 0 0 7 10.75h9.999l.101-.006A.75.75 0 0 0 17 9.25m1.1 2.419l-5.901 5.902a2.685 2.685 0 0 0-.707 1.247l-.457 1.83c-.2.797.522 1.518 1.318 1.319l1.83-.458a2.685 2.685 0 0 0 1.248-.706L21.33 14.9a2.285 2.285 0 0 0-3.233-3.232"})})}const vs=({share:n,onShareDeleted:s,onClose:t,...d})=>{const o=V(),{t:l}=I(),u=_(),{enqueueSnackbar:g}=J(),a=f.useCallback(()=>{u(kt(l("fileManager.deleteShareWarning"))).then(()=>{u(sn(n.id)).then(()=>{t&&t({},"backdropClick"),g({message:l("application:share.shareCanceled"),variant:"success",action:q}),s(n.id)})})},[l,n.id,t,u,g]),i=f.useCallback(()=>{u(an(n.id,n.password,n.source_type==Je.file)),t&&t({},"backdropClick")},[u,n,t]),r=f.useCallback(()=>{window.open(n.url,"_blank"),t&&t({},"backdropClick")},[n,t]),c=f.useCallback(()=>{navigator.clipboard.writeText(n.url),g({message:l("modals.linkCopied"),variant:"success",action:q}),t&&t({},"backdropClick")},[n,t,g,l]);return e.jsxs(et,{onClose:t,slotProps:{paper:{sx:{minWidth:150}}},...d,children:[e.jsxs(T,{dense:!0,onClick:r,children:[e.jsx(pe,{children:e.jsx(Rt,{fontSize:"small"})}),e.jsx(z,{children:l("fileManager.open")})]}),e.jsxs(T,{dense:!0,onClick:c,children:[e.jsx(pe,{children:e.jsx(rn,{fontSize:"small"})}),e.jsx(z,{children:l("share.copyLinkToClipboard")})]}),!n.expired&&e.jsxs(T,{dense:!0,onClick:i,children:[e.jsx(pe,{children:e.jsx(ws,{fontSize:"small"})}),e.jsx(z,{children:l(`fileManager.${n!=null&&n.expired?"editAndReactivate":"edit"}`)})]}),e.jsx(on,{}),e.jsxs(T,{hoverColor:o.palette.error.light,dense:!0,onClick:a,children:[e.jsx(pe,{children:e.jsx(ln,{fontSize:"small"})}),e.jsx(z,{children:l("fileManager.delete")})]})]})},_e=({share:n,onShareDeleted:s,onLoad:t,loading:d})=>{var i;const{t:o}=I();Ct();const{ref:l,inView:u}=bt({rootMargin:"200px 0px",triggerOnce:!0,skip:!d||!t}),g=Ze({popupId:"shareAction",variant:"popover"});f.useEffect(()=>{u&&t&&t()},[u]);const a=B.currentLoginOrNull();return e.jsxs(e.Fragment,{children:[n&&e.jsx(vs,{onShareDeleted:s,share:n,...Me(g)}),e.jsx(fe,{item:!0,xs:12,sm:6,md:4,ref:l,children:e.jsx(cs,{disabled:d,expanded:!1,onContextMenu:r=>{var c;r.preventDefault(),((c=n==null?void 0:n.owner)==null?void 0:c.id)===(a==null?void 0:a.user.id)&&g.open(r)},sx:{p:0,minHeight:0,width:"100%",textAlign:"left"},...((i=n==null?void 0:n.owner)==null?void 0:i.id)!=(a==null?void 0:a.user.id)?{onClick:()=>{window.open((n==null?void 0:n.url)??"#","_blank")}}:qe(g),children:e.jsxs(E,{sx:{display:"flex",width:"100%"},children:[e.jsx(E,{sx:{height:48,p:1.5},children:n?e.jsx(nn,{sx:{fontSize:32},name:(n==null?void 0:n.name)??"",fileType:(n==null?void 0:n.source_type)??Je.file}):e.jsx(G,{variant:"circular",width:32,height:32})}),e.jsxs(ct,{sx:{flexGrow:1,p:1,pl:0,pr:2},children:[e.jsxs(E,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ct,{children:e.jsx(dt,{title:(n==null?void 0:n.name)??"",children:e.jsx(D,{variant:"body2",fontWeight:500,noWrap:!0,children:d?e.jsx(G,{variant:"text",width:200}):n==null?void 0:n.name})})}),(n==null?void 0:n.expired)&&e.jsx(St,{size:"small",label:o("application:share.expired"),sx:{ml:1,height:18}})]}),e.jsx(E,{children:e.jsx(dt,{title:(n==null?void 0:n.name)??"",children:e.jsx(Et,{variant:"body2",color:"text.secondary",children:n!=null&&n.created_at?e.jsxs(E,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(ye,{sx:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},variant:"body2",datetime:n==null?void 0:n.created_at}),e.jsxs(E,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(At,{sx:{ml:1,mr:.5},fontSize:"small"}),(n==null?void 0:n.visited)??0]})]}):e.jsx(G,{variant:"text",width:"50%"})})})})]})]})})})]})},ys=50,wi=()=>{const{t:n}=I(),s=_(),[t,d]=f.useState(""),[o,l]=f.useState([]),[u,g]=f.useState(!1),[a,i]=f.useState("desc"),r=f.useCallback((p,m,v)=>()=>{g(!0),s(cn({page_size:ys,order_direction:v??a,next_page_token:m})).then(w=>{var j;l([...p,...w.shares]),(j=w.pagination)!=null&&j.next_token?d(w.pagination.next_token):d(void 0)}).catch(()=>{d(void 0)}).finally(()=>{g(!1)})},[s,a,Mt]),c=p=>{r([],"",p)()},h=f.useCallback(p=>{l(m=>m.filter(v=>v.id!==p))},[l]),x=f.useCallback(p=>{i(p.target.value),c(p.target.value)},[c,i]);return e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{secondaryAction:e.jsx(se,{variant:"outlined",children:e.jsxs(Pe,{variant:"outlined",value:a,onChange:x,children:[e.jsx(T,{value:"desc",children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:n("application:share.createdAtDesc")})}),e.jsx(T,{value:"asc",children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:n("application:share.createdAtAsc")})})]})}),onRefresh:()=>c(),loading:u,title:n("application:navbar.myShare")}),e.jsxs(fe,{container:!0,spacing:1,children:[o.map(p=>e.jsx(_e,{share:p,onShareDeleted:h},p.id)),t!=null&&e.jsx(e.Fragment,{children:[...Array(4)].map((p,m)=>e.jsx(_e,{onShareDeleted:h,onLoad:m==0?r(o,t):void 0,loading:!0},m==0?t:m))})]}),t==null&&o.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(me,{size:.8,top:63,primary:n("setting.listEmpty")})})]})})},He=25,js=20*1e3,vi=()=>{const{t:n}=I(),s=_(),[t,d]=f.useState(""),[o,l]=f.useState([]),[u,g]=f.useState(void 0),[a,i]=f.useState(!1),[r,c]=f.useState(!0),h=f.useRef(),x=f.useRef("");f.useEffect(()=>{r&&!h.current?h.current=setInterval(()=>{v()},js):(clearInterval(h.current),h.current=void 0)},[r]),f.useEffect(()=>()=>{clearInterval(h.current),h.current=void 0},[]);const p=f.useCallback((j,C)=>()=>{i(!0),s($e({page_size:He,category:Xe.downloaded,next_page_token:C})).then(y=>{var b;C&&c(!1),l([...j,...y.tasks]),(b=y.pagination)!=null&&b.next_token?d(y.pagination.next_token):d(void 0)}).catch(()=>{d(void 0)}).finally(()=>{i(!1)})},[s,c,l]),m=f.useCallback(()=>{i(!0),s($e({page_size:He,category:Xe.downloading})).then(j=>{var y,b;g(j.tasks);const C=`${((y=j.tasks[0])==null?void 0:y.id)??""}-${((b=j.tasks[j.tasks.length-1])==null?void 0:b.id)??""}-${j.tasks.length}`;x.current!=""&&x.current!=C&&p([],"")(),x.current=C}).catch(()=>{}).finally(()=>{i(!1)})},[s,c,g]),v=()=>{m()},w=j=>{j.target.checked&&o.length>He&&p([],"")(),c(j.target.checked)};return e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{secondaryAction:e.jsx(rt,{children:e.jsx(jt,{sx:{mr:0},control:e.jsx(Tt,{size:"small",onChange:w,checked:r}),label:e.jsx(D,{variant:"body2",color:"text.secondary",children:n("setting.autoRefresh")})})}),onRefresh:v,loading:a,title:n("application:navbar.remoteDownload")}),e.jsx(D,{variant:"h5",sx:{mb:2},color:"text.secondary",fontWeight:500,children:n("download.active")}),u!=null&&u.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(me,{size:.8,top:63,primary:n("setting.listEmpty")})}),u==null&&e.jsx(ge,{onLoad:m,loading:!0}),u&&u.map(j=>e.jsx(ge,{showProgress:!0,task:j},j.id)),e.jsx(D,{variant:"h5",sx:{mb:2,mt:3},color:"text.secondary",fontWeight:500,children:n("download.finished")}),o.map(j=>e.jsx(ge,{task:j},j.id)),t!=null&&e.jsx(ge,{onLoad:p(o,t),loading:!0},t),t==null&&o.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(me,{size:.8,top:63,primary:n("setting.listEmpty")})})]})})},Le={readonly:0,proxy:1};function Cs(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M6.08 9.02a6.001 6.001 0 0 1 11.84 0A4.5 4.5 0 0 1 17.5 18h-11a4.5 4.5 0 0 1-.42-8.98"})})}const xt=({account:n,onAccountDeleted:s,onLoad:t,loading:d,onClick:o,onEditClicked:l})=>{const{t:u}=I(),g=_(),{ref:a,inView:i}=bt({rootMargin:"200px 0px",triggerOnce:!0,skip:!d||!t}),r=Ze({variant:"popover",popupId:"action"+(n==null?void 0:n.id)});f.useEffect(()=>{i&&t&&t()},[i]);const[c,h]=f.useMemo(()=>{if(!(n!=null&&n.options))return[!1,!1];const w=new De(n.options);return[w.enabled(Le.readonly),w.enabled(Le.proxy)]},[n==null?void 0:n.options]),{onClose:x,...p}=Me(r),m=()=>{n&&(l==null||l(n)),x&&x()},v=()=>{n!=null&&n.id&&(x(),g(hn(n.id)),s(n.id))};return e.jsxs(Pt,{ref:a,hover:!0,sx:{cursor:"pointer"},onClick:o,children:[e.jsx(ce,{component:"th",scope:"row",children:d?e.jsx(G,{variant:"text",width:200,sx:{my:"6px"}}):n==null?void 0:n.name}),e.jsx(ce,{children:d?e.jsx(G,{variant:"text",width:100}):e.jsx(dn,{variant:"outlined",clickable:!0,sx:{px:1},simplifiedFile:{path:(n==null?void 0:n.uri)??Dt,type:Je.folder}})}),e.jsx(ce,{children:d?e.jsx(G,{variant:"text",width:100}):c?e.jsx(Re,{icon:e.jsx(At,{}),size:"small",label:u("setting.readonlyOn")}):e.jsx(Re,{icon:e.jsx(xs,{}),size:"small",label:u("setting.readonlyOff")})}),e.jsx(ce,{children:d?e.jsx(G,{variant:"text",width:100}):h?e.jsx(Re,{icon:e.jsx(Cs,{}),sx:{backgroundColor:w=>w.palette.primary.light},color:"success",size:"small",label:u("application:setting.proxied")}):u("setting.none")}),e.jsx(ce,{children:d||!n?e.jsx(G,{variant:"text",width:100}):e.jsx(ye,{datetime:n.created_at,variant:"inherit"})}),e.jsx(ce,{onClick:w=>w.stopPropagation(),children:n&&e.jsx(tt,{size:"small",...qe(r),children:e.jsx(us,{fontSize:"small"})})}),e.jsxs(et,{onClick:w=>w.stopPropagation(),onClose:x,slotProps:{paper:{sx:{minWidth:150}}},...p,children:[e.jsx(T,{dense:!0,onClick:m,children:e.jsx(z,{children:u("fileManager.edit")})}),e.jsx(T,{dense:!0,onClick:v,children:e.jsx(z,{children:u("fileManager.delete")})})]})]})},ft=({onClose:n,onAccountAdded:s,onAccountUpdated:t,editTarget:d,open:o,...l})=>{const{t:u}=I(),g=_();J();const[a,i]=f.useState(!1),[r,c]=f.useState(""),[h,x]=f.useState(Dt),[p,m]=f.useState(!1),[v,w]=f.useState(!1);V();const j=f.useMemo(()=>{var b,M;return new De((M=(b=B.currentLoginOrNull())==null?void 0:b.user.group)==null?void 0:M.permission).enabled(It.webdav_proxy)},[]);f.useEffect(()=>{if(o&&d){c(d.name),x(d.uri);const y=new De(d.options);m(y.enabled(Le.readonly)),w(y.enabled(Le.proxy))}},[o]);const C=()=>{if(!r||!h)return;i(!0);const y={name:r,uri:h,proxy:v,readonly:p};g(d?fn(d.id,y):mn(y)).then(b=>{n&&n({},"escapeKeyDown"),!d&&s&&s(b),d&&t&&t(b)}).finally(()=>{i(!1)})};return e.jsx(Ce,{title:d?u("setting.editWebDavAccount",{name:d.name}):u("setting.createWebDavAccount"),showActions:!0,loading:a,showCancel:!0,onAccept:C,disabled:!r||!h,dialogProps:{onClose:n,open:o,fullWidth:!0,maxWidth:"xs",disableRestoreFocus:!0,...l},children:e.jsx(be,{sx:{pt:1},children:e.jsxs($,{spacing:2,direction:"column",children:[e.jsx(un,{icon:e.jsx(pn,{}),variant:"outlined",value:r,multiline:!0,onChange:y=>c(y.target.value),label:u("setting.annotation"),fullWidth:!0}),e.jsx(gn,{onChange:x,path:h,variant:"davAccountRoot",label:u("application:setting.rootFolder"),allowedFs:[ht.my,ht.share]}),e.jsx(xn,{accordionDetailProps:{sx:{pt:0,pl:"30px"}},defaultExpanded:p||j&&v,title:u("application:modals.advanceOptions"),children:e.jsxs(rt,{children:[e.jsx(Ue,{control:e.jsx(Ke,{size:"small",onChange:y=>m(y.target.checked),checked:p}),label:u("application:setting.readonlyOn")}),e.jsx(D,{sx:{pl:"27px"},variant:"caption",color:"text.secondary",children:u("application:setting.readonlyTooltip")}),j&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{control:e.jsx(Ke,{size:"small",onChange:y=>w(y.target.checked),checked:v}),label:u("application:setting.proxy")}),e.jsx(D,{sx:{pl:"27px"},variant:"caption",color:"text.secondary",children:u("application:setting.proxyTooltip")})]})]})})]})})})},We=({label:n,value:s})=>e.jsxs(se,{variant:"filled",children:[e.jsx(wn,{children:n}),e.jsx(vn,{sx:{"&.MuiFilledInput-root":{paddingRight:"20px"}},value:s,fullWidth:!0,endAdornment:e.jsx(yn,{position:"end",children:e.jsx(tt,{edge:"end",onClick:()=>jn(s),children:e.jsx(Cn,{})})}),inputProps:{readOnly:!0}})]}),bs=({onClose:n,account:s,...t})=>{var o;const{t:d}=I();return _(),e.jsx(Ce,{title:d("application:setting.connectionInfo"),showActions:!0,onAccept:()=>n&&n({},"escapeKeyDown"),dialogProps:{onClose:n,fullWidth:!0,maxWidth:"xs",disableRestoreFocus:!0,...t},children:e.jsx(be,{sx:{pt:1},children:e.jsxs($,{spacing:2,direction:"column",children:[e.jsx(We,{label:d("application:setting.webdavServer"),value:window.location.origin+"/dav"}),e.jsx(We,{label:d("application:setting.userName"),value:((o=B.currentLoginOrNull())==null?void 0:o.user.email)??""}),e.jsx(We,{label:d("application:login.password"),value:(s==null?void 0:s.password)??""})]})})})},Ss=50,Es=({creatAccountDialog:n,setCreateAccountDialog:s})=>{const{t}=I(),d=_(),[o,l]=f.useState(""),[u,g]=f.useState([]),[a,i]=f.useState(!1),[r,c]=f.useState(),[h,x]=f.useState(),[p,m]=f.useState(!1),v=f.useCallback((y,b)=>()=>{i(!0),d(bn({page_size:Ss,next_page_token:b})).then(M=>{var H;g([...y,...M.accounts]),(H=M.pagination)!=null&&H.next_token?l(M.pagination.next_token):l(void 0)}).catch(()=>{l(void 0)}).finally(()=>{i(!1)})},[d]),w=f.useCallback(y=>{g(b=>b.filter(M=>M.id!==y))},[g]),j=y=>{g([y,...u]),c(y)},C=y=>{m(!0),x(y)};return e.jsxs(E,{children:[e.jsx(ft,{open:n,onClose:()=>s(!1),onAccountAdded:j}),e.jsx(ft,{open:p,editTarget:h,onClose:()=>m(!1),onAccountUpdated:y=>g(u.map(b=>b.id==y.id?y:b))}),e.jsx(bs,{open:r!=null,account:r,onClose:()=>c(void 0)}),e.jsxs(Sn,{sx:{mt:1},children:[e.jsxs(En,{sx:{width:"100%",tableLayout:"fixed"},size:"small",children:[e.jsx(An,{children:e.jsxs(Pt,{children:[e.jsx(de,{width:200,children:t("setting.annotation")}),e.jsx(de,{width:200,children:e.jsx(ps,{children:t("setting.rootFolder")})}),e.jsx(de,{width:150,children:t("fileManager.permissions")}),e.jsx(de,{width:150,children:t("setting.proxy")}),e.jsx(de,{width:200,children:t("fileManager.createdAt")}),e.jsx(de,{width:100,children:t("fileManager.actions")})]})}),e.jsxs(kn,{children:[u.map(y=>e.jsx(xt,{onClick:()=>c(y),account:y,onAccountDeleted:w,onEditClicked:()=>C(y)},y.id)),o!=null&&e.jsx(e.Fragment,{children:[...Array(4)].map((y,b)=>e.jsx(xt,{onLoad:b==0?v(u,o):void 0,loading:!0,onAccountDeleted:w},b))})]})]}),o==null&&u.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(D,{variant:"caption",color:"text.secondary",children:t("application:setting.listEmpty")})})]})]})};var As=Object.defineProperty,Ne=Object.getOwnPropertySymbols,Ht=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable,mt=(n,s,t)=>s in n?As(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t,Qe=(n,s)=>{for(var t in s||(s={}))Ht.call(s,t)&&mt(n,t,s[t]);if(Ne)for(var t of Ne(s))Wt.call(s,t)&&mt(n,t,s[t]);return n},Ge=(n,s)=>{var t={};for(var d in n)Ht.call(n,d)&&s.indexOf(d)<0&&(t[d]=n[d]);if(n!=null&&Ne)for(var d of Ne(n))s.indexOf(d)<0&&Wt.call(n,d)&&(t[d]=n[d]);return t};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var ae;(n=>{const s=class k{constructor(a,i,r,c){if(this.version=a,this.errorCorrectionLevel=i,this.modules=[],this.isFunction=[],a<k.MIN_VERSION||a>k.MAX_VERSION)throw new RangeError("Version value out of range");if(c<-1||c>7)throw new RangeError("Mask value out of range");this.size=a*4+17;let h=[];for(let p=0;p<this.size;p++)h.push(!1);for(let p=0;p<this.size;p++)this.modules.push(h.slice()),this.isFunction.push(h.slice());this.drawFunctionPatterns();const x=this.addEccAndInterleave(r);if(this.drawCodewords(x),c==-1){let p=1e9;for(let m=0;m<8;m++){this.applyMask(m),this.drawFormatBits(m);const v=this.getPenaltyScore();v<p&&(c=m,p=v),this.applyMask(m)}}o(0<=c&&c<=7),this.mask=c,this.applyMask(c),this.drawFormatBits(c),this.isFunction=[]}static encodeText(a,i){const r=n.QrSegment.makeSegments(a);return k.encodeSegments(r,i)}static encodeBinary(a,i){const r=n.QrSegment.makeBytes(a);return k.encodeSegments([r],i)}static encodeSegments(a,i,r=1,c=40,h=-1,x=!0){if(!(k.MIN_VERSION<=r&&r<=c&&c<=k.MAX_VERSION)||h<-1||h>7)throw new RangeError("Invalid value");let p,m;for(p=r;;p++){const C=k.getNumDataCodewords(p,i)*8,y=u.getTotalBits(a,p);if(y<=C){m=y;break}if(p>=c)throw new RangeError("Data too long")}for(const C of[k.Ecc.MEDIUM,k.Ecc.QUARTILE,k.Ecc.HIGH])x&&m<=k.getNumDataCodewords(p,C)*8&&(i=C);let v=[];for(const C of a){t(C.mode.modeBits,4,v),t(C.numChars,C.mode.numCharCountBits(p),v);for(const y of C.getData())v.push(y)}o(v.length==m);const w=k.getNumDataCodewords(p,i)*8;o(v.length<=w),t(0,Math.min(4,w-v.length),v),t(0,(8-v.length%8)%8,v),o(v.length%8==0);for(let C=236;v.length<w;C^=253)t(C,8,v);let j=[];for(;j.length*8<v.length;)j.push(0);return v.forEach((C,y)=>j[y>>>3]|=C<<7-(y&7)),new k(p,i,j,h)}getModule(a,i){return 0<=a&&a<this.size&&0<=i&&i<this.size&&this.modules[i][a]}getModules(){return this.modules}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2==0),this.setFunctionModule(r,6,r%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const a=this.getAlignmentPatternPositions(),i=a.length;for(let r=0;r<i;r++)for(let c=0;c<i;c++)r==0&&c==0||r==0&&c==i-1||r==i-1&&c==0||this.drawAlignmentPattern(a[r],a[c]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(a){const i=this.errorCorrectionLevel.formatBits<<3|a;let r=i;for(let h=0;h<10;h++)r=r<<1^(r>>>9)*1335;const c=(i<<10|r)^21522;o(c>>>15==0);for(let h=0;h<=5;h++)this.setFunctionModule(8,h,d(c,h));this.setFunctionModule(8,7,d(c,6)),this.setFunctionModule(8,8,d(c,7)),this.setFunctionModule(7,8,d(c,8));for(let h=9;h<15;h++)this.setFunctionModule(14-h,8,d(c,h));for(let h=0;h<8;h++)this.setFunctionModule(this.size-1-h,8,d(c,h));for(let h=8;h<15;h++)this.setFunctionModule(8,this.size-15+h,d(c,h));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let a=this.version;for(let r=0;r<12;r++)a=a<<1^(a>>>11)*7973;const i=this.version<<12|a;o(i>>>18==0);for(let r=0;r<18;r++){const c=d(i,r),h=this.size-11+r%3,x=Math.floor(r/3);this.setFunctionModule(h,x,c),this.setFunctionModule(x,h,c)}}drawFinderPattern(a,i){for(let r=-4;r<=4;r++)for(let c=-4;c<=4;c++){const h=Math.max(Math.abs(c),Math.abs(r)),x=a+c,p=i+r;0<=x&&x<this.size&&0<=p&&p<this.size&&this.setFunctionModule(x,p,h!=2&&h!=4)}}drawAlignmentPattern(a,i){for(let r=-2;r<=2;r++)for(let c=-2;c<=2;c++)this.setFunctionModule(a+c,i+r,Math.max(Math.abs(c),Math.abs(r))!=1)}setFunctionModule(a,i,r){this.modules[i][a]=r,this.isFunction[i][a]=!0}addEccAndInterleave(a){const i=this.version,r=this.errorCorrectionLevel;if(a.length!=k.getNumDataCodewords(i,r))throw new RangeError("Invalid argument");const c=k.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][i],h=k.ECC_CODEWORDS_PER_BLOCK[r.ordinal][i],x=Math.floor(k.getNumRawDataModules(i)/8),p=c-x%c,m=Math.floor(x/c);let v=[];const w=k.reedSolomonComputeDivisor(h);for(let C=0,y=0;C<c;C++){let b=a.slice(y,y+m-h+(C<p?0:1));y+=b.length;const M=k.reedSolomonComputeRemainder(b,w);C<p&&b.push(0),v.push(b.concat(M))}let j=[];for(let C=0;C<v[0].length;C++)v.forEach((y,b)=>{(C!=m-h||b>=p)&&j.push(y[C])});return o(j.length==x),j}drawCodewords(a){if(a.length!=Math.floor(k.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let i=0;for(let r=this.size-1;r>=1;r-=2){r==6&&(r=5);for(let c=0;c<this.size;c++)for(let h=0;h<2;h++){const x=r-h,m=(r+1&2)==0?this.size-1-c:c;!this.isFunction[m][x]&&i<a.length*8&&(this.modules[m][x]=d(a[i>>>3],7-(i&7)),i++)}}o(i==a.length*8)}applyMask(a){if(a<0||a>7)throw new RangeError("Mask value out of range");for(let i=0;i<this.size;i++)for(let r=0;r<this.size;r++){let c;switch(a){case 0:c=(r+i)%2==0;break;case 1:c=i%2==0;break;case 2:c=r%3==0;break;case 3:c=(r+i)%3==0;break;case 4:c=(Math.floor(r/3)+Math.floor(i/2))%2==0;break;case 5:c=r*i%2+r*i%3==0;break;case 6:c=(r*i%2+r*i%3)%2==0;break;case 7:c=((r+i)%2+r*i%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[i][r]&&c&&(this.modules[i][r]=!this.modules[i][r])}}getPenaltyScore(){let a=0;for(let h=0;h<this.size;h++){let x=!1,p=0,m=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[h][v]==x?(p++,p==5?a+=k.PENALTY_N1:p>5&&a++):(this.finderPenaltyAddHistory(p,m),x||(a+=this.finderPenaltyCountPatterns(m)*k.PENALTY_N3),x=this.modules[h][v],p=1);a+=this.finderPenaltyTerminateAndCount(x,p,m)*k.PENALTY_N3}for(let h=0;h<this.size;h++){let x=!1,p=0,m=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][h]==x?(p++,p==5?a+=k.PENALTY_N1:p>5&&a++):(this.finderPenaltyAddHistory(p,m),x||(a+=this.finderPenaltyCountPatterns(m)*k.PENALTY_N3),x=this.modules[v][h],p=1);a+=this.finderPenaltyTerminateAndCount(x,p,m)*k.PENALTY_N3}for(let h=0;h<this.size-1;h++)for(let x=0;x<this.size-1;x++){const p=this.modules[h][x];p==this.modules[h][x+1]&&p==this.modules[h+1][x]&&p==this.modules[h+1][x+1]&&(a+=k.PENALTY_N2)}let i=0;for(const h of this.modules)i=h.reduce((x,p)=>x+(p?1:0),i);const r=this.size*this.size,c=Math.ceil(Math.abs(i*20-r*10)/r)-1;return o(0<=c&&c<=9),a+=c*k.PENALTY_N4,o(0<=a&&a<=2568888),a}getAlignmentPatternPositions(){if(this.version==1)return[];{const a=Math.floor(this.version/7)+2,i=this.version==32?26:Math.ceil((this.version*4+4)/(a*2-2))*2;let r=[6];for(let c=this.size-7;r.length<a;c-=i)r.splice(1,0,c);return r}}static getNumRawDataModules(a){if(a<k.MIN_VERSION||a>k.MAX_VERSION)throw new RangeError("Version number out of range");let i=(16*a+128)*a+64;if(a>=2){const r=Math.floor(a/7)+2;i-=(25*r-10)*r-55,a>=7&&(i-=36)}return o(208<=i&&i<=29648),i}static getNumDataCodewords(a,i){return Math.floor(k.getNumRawDataModules(a)/8)-k.ECC_CODEWORDS_PER_BLOCK[i.ordinal][a]*k.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][a]}static reedSolomonComputeDivisor(a){if(a<1||a>255)throw new RangeError("Degree out of range");let i=[];for(let c=0;c<a-1;c++)i.push(0);i.push(1);let r=1;for(let c=0;c<a;c++){for(let h=0;h<i.length;h++)i[h]=k.reedSolomonMultiply(i[h],r),h+1<i.length&&(i[h]^=i[h+1]);r=k.reedSolomonMultiply(r,2)}return i}static reedSolomonComputeRemainder(a,i){let r=i.map(c=>0);for(const c of a){const h=c^r.shift();r.push(0),i.forEach((x,p)=>r[p]^=k.reedSolomonMultiply(x,h))}return r}static reedSolomonMultiply(a,i){if(a>>>8||i>>>8)throw new RangeError("Byte out of range");let r=0;for(let c=7;c>=0;c--)r=r<<1^(r>>>7)*285,r^=(i>>>c&1)*a;return o(r>>>8==0),r}finderPenaltyCountPatterns(a){const i=a[1];o(i<=this.size*3);const r=i>0&&a[2]==i&&a[3]==i*3&&a[4]==i&&a[5]==i;return(r&&a[0]>=i*4&&a[6]>=i?1:0)+(r&&a[6]>=i*4&&a[0]>=i?1:0)}finderPenaltyTerminateAndCount(a,i,r){return a&&(this.finderPenaltyAddHistory(i,r),i=0),i+=this.size,this.finderPenaltyAddHistory(i,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(a,i){i[0]==0&&(a+=this.size),i.pop(),i.unshift(a)}};s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],n.QrCode=s;function t(g,a,i){if(a<0||a>31||g>>>a)throw new RangeError("Value out of range");for(let r=a-1;r>=0;r--)i.push(g>>>r&1)}function d(g,a){return(g>>>a&1)!=0}function o(g){if(!g)throw new Error("Assertion error")}const l=class P{constructor(a,i,r){if(this.mode=a,this.numChars=i,this.bitData=r,i<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}static makeBytes(a){let i=[];for(const r of a)t(r,8,i);return new P(P.Mode.BYTE,a.length,i)}static makeNumeric(a){if(!P.isNumeric(a))throw new RangeError("String contains non-numeric characters");let i=[];for(let r=0;r<a.length;){const c=Math.min(a.length-r,3);t(parseInt(a.substring(r,r+c),10),c*3+1,i),r+=c}return new P(P.Mode.NUMERIC,a.length,i)}static makeAlphanumeric(a){if(!P.isAlphanumeric(a))throw new RangeError("String contains unencodable characters in alphanumeric mode");let i=[],r;for(r=0;r+2<=a.length;r+=2){let c=P.ALPHANUMERIC_CHARSET.indexOf(a.charAt(r))*45;c+=P.ALPHANUMERIC_CHARSET.indexOf(a.charAt(r+1)),t(c,11,i)}return r<a.length&&t(P.ALPHANUMERIC_CHARSET.indexOf(a.charAt(r)),6,i),new P(P.Mode.ALPHANUMERIC,a.length,i)}static makeSegments(a){return a==""?[]:P.isNumeric(a)?[P.makeNumeric(a)]:P.isAlphanumeric(a)?[P.makeAlphanumeric(a)]:[P.makeBytes(P.toUtf8ByteArray(a))]}static makeEci(a){let i=[];if(a<0)throw new RangeError("ECI assignment value out of range");if(a<128)t(a,8,i);else if(a<16384)t(2,2,i),t(a,14,i);else if(a<1e6)t(6,3,i),t(a,21,i);else throw new RangeError("ECI assignment value out of range");return new P(P.Mode.ECI,0,i)}static isNumeric(a){return P.NUMERIC_REGEX.test(a)}static isAlphanumeric(a){return P.ALPHANUMERIC_REGEX.test(a)}getData(){return this.bitData.slice()}static getTotalBits(a,i){let r=0;for(const c of a){const h=c.mode.numCharCountBits(i);if(c.numChars>=1<<h)return 1/0;r+=4+h+c.bitData.length}return r}static toUtf8ByteArray(a){a=encodeURI(a);let i=[];for(let r=0;r<a.length;r++)a.charAt(r)!="%"?i.push(a.charCodeAt(r)):(i.push(parseInt(a.substring(r+1,r+3),16)),r+=2);return i}};l.NUMERIC_REGEX=/^[0-9]*$/,l.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,l.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let u=l;n.QrSegment=l})(ae||(ae={}));(n=>{(s=>{const t=class{constructor(o,l){this.ordinal=o,this.formatBits=l}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),s.Ecc=t})(n.QrCode||(n.QrCode={}))})(ae||(ae={}));(n=>{(s=>{const t=class{constructor(o,l){this.modeBits=o,this.numBitsCharCount=l}numCharCountBits(o){return this.numBitsCharCount[Math.floor((o+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),s.Mode=t})(n.QrSegment||(n.QrSegment={}))})(ae||(ae={}));var xe=ae;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var ks={L:xe.QrCode.Ecc.LOW,M:xe.QrCode.Ecc.MEDIUM,Q:xe.QrCode.Ecc.QUARTILE,H:xe.QrCode.Ecc.HIGH},$t=128,Ut="L",Kt="#FFFFFF",Vt="#000000",Yt=!1,Xt=1,Rs=4,Ms=0,Ps=.1;function Qt(n,s=0){const t=[];return n.forEach(function(d,o){let l=null;d.forEach(function(u,g){if(!u&&l!==null){t.push(`M${l+s} ${o+s}h${g-l}v1H${l+s}z`),l=null;return}if(g===d.length-1){if(!u)return;l===null?t.push(`M${g+s},${o+s} h1v1H${g+s}z`):t.push(`M${l+s},${o+s} h${g+1-l}v1H${l+s}z`);return}u&&l===null&&(l=g)})}),t.join("")}function Gt(n,s){return n.slice().map((t,d)=>d<s.y||d>=s.y+s.h?t:t.map((o,l)=>l<s.x||l>=s.x+s.w?o:!1))}function Ds(n,s,t,d){if(d==null)return null;const o=n.length+t*2,l=Math.floor(s*Ps),u=o/s,g=(d.width||l)*u,a=(d.height||l)*u,i=d.x==null?n.length/2-g/2:d.x*u,r=d.y==null?n.length/2-a/2:d.y*u,c=d.opacity==null?1:d.opacity;let h=null;if(d.excavate){let p=Math.floor(i),m=Math.floor(r),v=Math.ceil(g+i-p),w=Math.ceil(a+r-m);h={x:p,y:m,w:v,h:w}}const x=d.crossOrigin;return{x:i,y:r,h:a,w:g,excavation:h,opacity:c,crossOrigin:x}}function Is(n,s){return s!=null?Math.max(Math.floor(s),0):n?Rs:Ms}function Zt({value:n,level:s,minVersion:t,includeMargin:d,marginSize:o,imageSettings:l,size:u,boostLevel:g}){let a=S.useMemo(()=>{const p=(Array.isArray(n)?n:[n]).reduce((m,v)=>(m.push(...xe.QrSegment.makeSegments(v)),m),[]);return xe.QrCode.encodeSegments(p,ks[s],t,void 0,void 0,g)},[n,s,t,g]);const{cells:i,margin:r,numCells:c,calculatedImageSettings:h}=S.useMemo(()=>{let x=a.getModules();const p=Is(d,o),m=x.length+p*2,v=Ds(x,u,p,l);return{cells:x,margin:p,numCells:m,calculatedImageSettings:v}},[a,u,l,d,o]);return{qrcode:a,margin:r,cells:i,numCells:c,calculatedImageSettings:h}}var _s=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),Ls=S.forwardRef(function(s,t){const d=s,{value:o,size:l=$t,level:u=Ut,bgColor:g=Kt,fgColor:a=Vt,includeMargin:i=Yt,minVersion:r=Xt,boostLevel:c,marginSize:h,imageSettings:x}=d,m=Ge(d,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:v}=m,w=Ge(m,["style"]),j=x==null?void 0:x.src,C=S.useRef(null),y=S.useRef(null),b=S.useCallback(A=>{C.current=A,typeof t=="function"?t(A):t&&(t.current=A)},[t]),[M,H]=S.useState(!1),{margin:N,cells:U,numCells:Y,calculatedImageSettings:R}=Zt({value:o,level:u,minVersion:r,boostLevel:c,includeMargin:i,marginSize:h,imageSettings:x,size:l});S.useEffect(()=>{if(C.current!=null){const A=C.current,L=A.getContext("2d");if(!L)return;let F=U;const ee=y.current,Ee=R!=null&&ee!==null&&ee.complete&&ee.naturalHeight!==0&&ee.naturalWidth!==0;Ee&&R.excavation!=null&&(F=Gt(U,R.excavation));const Ae=window.devicePixelRatio||1;A.height=A.width=l*Ae;const lt=l/Y*Ae;L.scale(lt,lt),L.fillStyle=g,L.fillRect(0,0,Y,Y),L.fillStyle=a,_s?L.fill(new Path2D(Qt(F,N))):U.forEach(function(qt,Jt){qt.forEach(function(en,tn){en&&L.fillRect(tn+N,Jt+N,1,1)})}),R&&(L.globalAlpha=R.opacity),Ee&&L.drawImage(ee,R.x+N,R.y+N,R.w,R.h)}}),S.useEffect(()=>{H(!1)},[j]);const oe=Qe({height:l,width:l},v);let le=null;return j!=null&&(le=S.createElement("img",{src:j,key:j,style:{display:"none"},onLoad:()=>{H(!0)},ref:y,crossOrigin:R==null?void 0:R.crossOrigin})),S.createElement(S.Fragment,null,S.createElement("canvas",Qe({style:oe,height:l,width:l,ref:b,role:"img"},w)),le)});Ls.displayName="QRCodeCanvas";var ot=S.forwardRef(function(s,t){const d=s,{value:o,size:l=$t,level:u=Ut,bgColor:g=Kt,fgColor:a=Vt,includeMargin:i=Yt,minVersion:r=Xt,boostLevel:c,title:h,marginSize:x,imageSettings:p}=d,m=Ge(d,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:v,cells:w,numCells:j,calculatedImageSettings:C}=Zt({value:o,level:u,minVersion:r,boostLevel:c,includeMargin:i,marginSize:x,imageSettings:p,size:l});let y=w,b=null;p!=null&&C!=null&&(C.excavation!=null&&(y=Gt(w,C.excavation)),b=S.createElement("image",{href:p.src,height:C.h,width:C.w,x:C.x+v,y:C.y+v,preserveAspectRatio:"none",opacity:C.opacity,crossOrigin:C.crossOrigin}));const M=Qt(y,v);return S.createElement("svg",Qe({height:l,width:l,viewBox:`0 0 ${j} ${j}`,ref:t,role:"img"},m),!!h&&S.createElement("title",null,h),S.createElement("path",{fill:g,d:`M0,0 h${j}v${j}H0z`,shapeRendering:"crispEdges"}),S.createElement("path",{fill:a,d:M,shapeRendering:"crispEdges"}),b)});ot.displayName="QRCodeSVG";const Ns=()=>{const n=V();return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",x:0,y:0,enableBackground:"new 0 0 444 908",viewBox:"0 0 444 908",children:[e.jsx("path",{fill:n.palette.background.paper,stroke:n.palette.divider,strokeMiterlimit:"10",d:"M378.8.5H65.6C29.6.5.5 29.6.5 65.6V843c0 35.9 29.1 65.1 65.1 65.1h313.2c35.9 0 65.1-29.1 65.1-65.1V65.6c0-36-29.2-65.1-65.1-65.1zm46.5 838.8c0 28-21.8 50.7-48.8 50.7H67.9c-26.9 0-48.8-22.7-48.8-50.7V74.1c0-28 21.8-50.7 48.8-50.7h35.3c4 0 7.2 3.4 7.2 7.5 0 14.9 11.6 27 26 27h171.5c14.4.1 26-12 26-27 0-4.1 3.2-7.5 7.2-7.5h35.4c26.9 0 48.8 22.7 48.8 50.7v765.2z"}),e.jsx("path",{fill:"none",stroke:n.palette.divider,strokeMiterlimit:"10",strokeWidth:"4",d:"M243.3 37.3h-46.4c-2 0-3.6-1.6-3.6-3.6h0c0-2 1.6-3.6 3.6-3.6h46.4c2 0 3.6 1.6 3.6 3.6h0c0 2-1.6 3.6-3.6 3.6z"}),e.jsx("circle",{cx:"270",cy:"33.7",r:"5.5",fill:"none",stroke:n.palette.divider,strokeMiterlimit:"10",strokeWidth:"4"})]})},Os=()=>{const n=Z(u=>u.siteConfig.basic.config.title),{t:s}=I(),[t,d]=f.useState(!1),o=V(),l=f.useMemo(()=>{var u,g;return window.location.origin+"/login?refresh_token="+(((g=(u=B.currentLoginOrNull())==null?void 0:u.token)==null?void 0:g.refresh_token)??"")},[t]);return e.jsxs(fe,{container:!0,sx:{px:2,pt:4,pb:4},children:[e.jsx(fe,{item:!0,container:!0,alignItems:"center",xs:12,md:7,children:e.jsxs(E,{children:[e.jsx(E,{marginBottom:2,children:e.jsx(D,{variant:"h4",sx:{fontWeight:700},color:"text.primary",children:e.jsx(Ve,{i18nKey:"setting.connectByiOS",values:{title:n},components:[e.jsx(D,{color:"primary",component:"span",variant:"inherit",sx:{background:u=>`linear-gradient(180deg, transparent 82%, ${Rn(u.palette.secondary.main,.3)} 0%)`}},0)]})})}),e.jsx(E,{color:"text.secondary",sx:{ol:{paddingInlineStart:"24px"},"li::marker":{fontSize:"1.25rem"},li:{marginBottom:2}},children:e.jsxs("ol",{children:[e.jsxs("li",{children:[e.jsx(D,{variant:"h6",component:"p",children:s("setting.downloadOurApp")}),e.jsx(E,{marginTop:1,children:e.jsx(E,{component:"a",href:"https://apps.apple.com/us/app/cloudreve/id1619480823",target:"_blank",children:e.jsx(E,{component:"img",src:"/static/img/appstore.svg"})})})]}),e.jsxs("li",{children:[e.jsx(D,{variant:"h6",component:"p",children:s("setting.fillInEndpoint")}),e.jsxs(E,{marginTop:1,sx:{position:"relative",display:"inline-block"},children:[e.jsx(ot,{marginSize:4,size:200,onClick:()=>d(!1),style:{transition:"all .3s ease-in",filter:t?"initial":"blur(8px)",backgroundColor:"#fff"},value:l}),!t&&e.jsx(Ie,{onClick:()=>d(!0),sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},color:"inherit",variant:"outlined",children:s("setting.shoeQr")})]})]}),e.jsx("li",{children:e.jsx(D,{variant:"h6",component:"p",children:s("setting.loginApp")})})]})})]})}),e.jsx(fe,{item:!0,xs:12,md:5,children:e.jsx(E,{sx:{maxWidth:450,position:"relative",marginX:"auto",perspective:1500,transformStyle:"preserve-3d",perspectiveOrigin:0},children:e.jsx(E,{sx:{position:"relative",borderRadius:"2.75rem",boxShadow:1,width:"75% !important",marginX:"auto",transform:"rotateY(-35deg) rotateX(15deg) translateZ(0)"},children:e.jsxs(E,{children:[e.jsx(E,{position:"relative",zIndex:2,maxWidth:1,height:"auto",sx:{verticalAlign:"middle"},children:e.jsx(Ns,{})}),e.jsx(E,{position:"absolute",top:"2.4%",left:"4%",width:"92.4%",height:"96%",children:e.jsx(E,{component:"img",src:"https://cloudreve.org/imgs/ios/"+(o.palette.mode==="light"?"main.png":"main_dark.jpg"),alt:"Image Description",effect:"blur",width:1,height:1,sx:{objectFit:"cover",borderRadius:"2.5rem",filter:u=>u.palette.mode==="dark"?"brightness(0.7)":"none"}})})]})})})})]})},Ci=()=>{const{t:n}=I(),s=_(),[t,d]=Mn(),[o,l]=f.useState(!1),u=Z(c=>{var h;return(h=c.siteConfig.app.config)==null?void 0:h.app_promotion}),g=f.useMemo(()=>{var x;const c=B.currentLoginOrNull();let h=!1;return c&&((x=c.user.group)!=null&&x.permission)&&(h=new De(c.user.group.permission).enabled(It.webdav)),h},[]),a=f.useMemo(()=>{const c=[];return g&&c.push({label:n("application:setting.webdavAccounts"),value:"dav"}),u&&c.push({label:n("application:setting.iOSApp"),value:"app"}),c},[g,u]),[i,r]=f.useState(t.get(zt)??(g?"dav":"app"));return f.useEffect(()=>{s(_t("app"))},[]),e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{secondaryAction:e.jsx(Pn,{in:i=="dav",children:e.jsx(Dn,{variant:"contained",startIcon:e.jsx(hs,{}),onClick:()=>l(!0),children:n("setting.createNewAccount")})}),title:n("application:navbar.connect")}),e.jsx(Ft,{value:i,onChange:(c,h)=>r(h),tabs:a}),i=="dav"&&g&&e.jsx(Es,{creatAccountDialog:o,setCreateAccountDialog:l}),i=="app"&&u&&e.jsx(Os,{}),!g&&!u&&e.jsx(me,{primary:n("setting.deviceNothing")})]})})};function Ts(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M20.952 3.048a3.578 3.578 0 0 0-5.06 0L3.94 15a3.106 3.106 0 0 0-.825 1.476L2.02 21.078a.75.75 0 0 0 .904.903l4.601-1.096a3.106 3.106 0 0 0 1.477-.825l1.151-1.151a6.52 6.52 0 0 1-.127-1.995L7.941 19c-.21.21-.474.358-.763.427l-3.416.814l.813-3.416c.069-.29.217-.554.427-.764L15 6.06L17.94 9l-2.026 2.026a6.57 6.57 0 0 1 1.994.127l3.044-3.044a3.578 3.578 0 0 0 0-5.06m-4 1.06a2.078 2.078 0 1 1 2.94 2.94l-.892.89L16.06 5zm-3.675 9.868a2 2 0 0 1-1.441 2.496l-.584.145a5.729 5.729 0 0 0 .006 1.807l.54.13a2 2 0 0 1 1.45 2.51l-.187.631c.44.386.94.7 1.485.922l.493-.519a2 2 0 0 1 2.899 0l.499.526a5.282 5.282 0 0 0 1.482-.913l-.198-.686a2 2 0 0 1 1.442-2.496l.583-.145a5.729 5.729 0 0 0-.006-1.807l-.54-.13a2 2 0 0 1-1.449-2.51l.186-.631a5.278 5.278 0 0 0-1.484-.922l-.493.518a2 2 0 0 1-2.9 0l-.498-.525c-.544.22-1.044.53-1.483.913zM16.5 19c-.8 0-1.45-.671-1.45-1.5c0-.828.65-1.5 1.45-1.5c.8 0 1.45.672 1.45 1.5c0 .829-.65 1.5-1.45 1.5"})})}function zs(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M12 2a4 4 0 0 1 4 4v2h1.75A2.25 2.25 0 0 1 20 10.25v9.5A2.25 2.25 0 0 1 17.75 22H6.25A2.25 2.25 0 0 1 4 19.75v-9.5A2.25 2.25 0 0 1 6.25 8H8V6a4 4 0 0 1 4-4Zm5.75 7.5H6.25a.75.75 0 0 0-.75.75v9.5c0 .414.336.75.75.75h11.5a.75.75 0 0 0 .75-.75v-9.5a.75.75 0 0 0-.75-.75Zm-5.75 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm0-10A2.5 2.5 0 0 0 9.5 6v2h5V6A2.5 2.5 0 0 0 12 3.5Z"})})}function Fs(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M2 7.25A3.25 3.25 0 0 1 5.25 4h13.5A3.25 3.25 0 0 1 22 7.25v4.56a6.518 6.518 0 0 0-1.5-1.078V7.25a1.75 1.75 0 0 0-1.75-1.75H5.25A1.75 1.75 0 0 0 3.5 7.25v9.5c0 .966.784 1.75 1.75 1.75h6.063c.173.534.412 1.037.709 1.5H5.25A3.25 3.25 0 0 1 2 16.75zm10 9.25a5.5 5.5 0 1 0 11 0a5.5 5.5 0 0 0-11 0m8.5-3.5a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h1a2.496 2.496 0 0 0-2-1c-.833 0-1.572.407-2.027 1.036a.5.5 0 0 1-.81-.586A3.496 3.496 0 0 1 17.5 13c.98 0 1.865.403 2.5 1.05v-.55a.5.5 0 0 1 .5-.5M15 18.95v.55a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-1c.456.608 1.183 1 2 1c.766 0 1.452-.344 1.911-.888a.5.5 0 0 1 .764.645A3.493 3.493 0 0 1 17.5 20a3.49 3.49 0 0 1-2.5-1.05"})})}function Bs(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M3.28 2.22a.75.75 0 1 0-1.06 1.06l1.25 1.25A3.247 3.247 0 0 0 2 7.25v9.5A3.25 3.25 0 0 0 5.25 20h6.772a6.471 6.471 0 0 1-.709-1.5H5.25a1.75 1.75 0 0 1-1.75-1.75v-9.5c0-.727.443-1.35 1.074-1.615l8.145 8.145a5.5 5.5 0 0 0 7.502 7.502l.498.498a.75.75 0 0 0 1.061-1.06zm15.44 17.56c-.38.142-.79.219-1.22.219a3.49 3.49 0 0 1-2.5-1.05v.55a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5h1.44l.882.883A.498.498 0 0 1 16.5 18h-1a2.496 2.496 0 0 0 2.406.967zm-3.863-8.106l1.512 1.512A3.494 3.494 0 0 1 17.5 13c.98 0 1.865.403 2.5 1.05v-.55a.5.5 0 0 1 1 0v2a.5.5 0 0 1-.5.5h-1.318l3.143 3.143a5.5 5.5 0 0 0-7.467-7.468m3.392 3.392l-1.05-1.05a2.496 2.496 0 0 1 2.3.982h-.999a.498.498 0 0 0-.25.068M7.182 4l1.5 1.5H18.75c.966 0 1.75.784 1.75 1.75v3.482A6.518 6.518 0 0 1 22 11.81V7.25A3.25 3.25 0 0 0 18.75 4z"})})}const Hs=Te(E)(({theme:n})=>({borderRadius:n.shape.borderRadius,padding:n.spacing(1),border:`1px solid ${n.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`})),Ws=({setting:n,setSetting:s})=>{const{t}=I(),d=V(),o=_(),l=Se(d.breakpoints.down("md")),{themes:u}=Z(A=>A.siteConfig.basic.config),[g,a]=f.useState(In),i=f.useRef(null),[r,c]=f.useState(!1),h=Z(A=>A.globalState.preferredTheme),x=Z(A=>A.siteConfig.basic.config.default_theme),[p,m]=f.useState(n.version_retention_enabled),[v,w]=f.useState(n.version_retention_max),[j,C]=f.useState(n.version_retention_ext),[y,b]=f.useState(!1),M=A=>{m(A.target.checked),b(!0)},H=A=>{w(parseInt(A.target.value)??0),b(!0)},N=(A,L)=>{C(L.map(F=>F.replace(/^\./,""))),b(!0)};f.useEffect(()=>{m(n.version_retention_enabled),w(n.version_retention_max),C(n.version_retention_ext)},[n]);const U=A=>{a(A),B.set(Bn.TimeZone,A),Hn()},Y=f.useMemo(()=>u?JSON.parse(u):{},[u]),R=A=>{o(Wn(A)),o(ne({preferred_theme:A}))},oe=()=>{c(!0),o(ne({version_retention_enabled:p,version_retention_max:v,version_retention_ext:j})).then(()=>{b(!1),s({...n,version_retention_enabled:p,version_retention_max:v,version_retention_ext:j})}).finally(()=>{c(!1)})},le=(A,L)=>{s({...n,disable_view_sync:!L}),c(!0),o(ne({disable_view_sync:!L})).then(()=>{const F=B.currentLoginOrNull();F!=null&&F.user&&B.updateUserIfExist({...F==null?void 0:F.user,disable_view_sync:!L}),$n(),c(!1)}).finally(()=>{c(!1)})};return e.jsxs($,{spacing:3,children:[e.jsx(O,{title:t("setting.language"),lgWidth:3,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(Pe,{value:_n.language,onChange:A=>o(Ln(A.target.value)),children:Nn.map(A=>e.jsx(T,{value:A.code,children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:A.displayName})}))}),e.jsx(ze,{children:t("setting.languageDes")})]})}),e.jsx(O,{title:t("setting.timeZone"),lgWidth:4,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(Pe,{value:g,onChange:A=>U(A.target.value),children:Intl.supportedValuesOf("timeZone").map(A=>e.jsx(T,{value:A,children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:A})}))}),e.jsx(ze,{children:t("setting.timezoneDes")})]})}),e.jsx(O,{title:t("setting.darkMode"),lgWidth:12,children:e.jsx(gs,{})}),e.jsx(O,{title:t("setting.themeColor"),lgWidth:12,children:e.jsx(On,{sx:{gap:1},children:Object.keys(Y).map((A,L)=>e.jsx(Tn,{size:30,color:A,onClick:()=>R(A),selected:h&&h==A||!h&&x==A}))})}),e.jsx(O,{title:t("setting.versionRetention"),children:e.jsxs(Hs,{sx:{py:.5},children:[e.jsxs(E,{sx:{pl:1,display:"flex",flexDirection:l?"column":"row",alignItems:l?"flex-start":"center"},children:[e.jsx(Ue,{control:e.jsx(Ke,{size:"small",checked:p,onChange:M}),label:t("application:setting.enableVersionRetention")}),e.jsx(D,{variant:"caption",color:"text.secondary",children:t("application:setting.enableVersionRetentionDes")})]}),e.jsxs($,{spacing:1,sx:{mb:p||y?.5:0},children:[e.jsx(je,{in:p,unmountOnExit:!0,children:e.jsxs($,{sx:{mt:1},spacing:1,children:[e.jsx(zn,{multiple:!0,options:[],value:j??[],autoSelect:!0,freeSolo:!0,onChange:N,renderTags:(A,L)=>A.map((F,ee)=>{const{key:Ee,...Ae}=L({index:ee});return e.jsx(St,{variant:"outlined",label:F,size:"small",...Ae},Ee)}),renderInput:A=>e.jsx(te,{label:t("setting.versionRetentionEnabledExt"),...A,sx:{"& .MuiInputBase-root":{},"& .MuiInputBase-root.MuiOutlinedInput-root":{paddingTop:d.spacing(.6),paddingBottom:d.spacing(.6)},mt:0},helperText:t("application:setting.versionRetentionEnabledExtDes"),margin:"dense",type:"text",fullWidth:!0})}),e.jsx(E,{children:e.jsx(te,{onChange:H,value:v,required:!0,inputProps:{type:"number",step:1,min:0},helperText:t("setting.versionRetentionMax"),inputRef:i})})]})}),e.jsx(je,{in:y,unmountOnExit:!0,children:e.jsx(nt,{variant:"contained",loading:r,onClick:oe,children:e.jsx("span",{children:t("fileManager.save")})})})]})]})}),e.jsxs(O,{title:t("setting.syncView"),lgWidth:12,children:[e.jsxs(Fn,{color:"primary",value:!n.disable_view_sync,exclusive:!0,disabled:r,onChange:le,size:"small","aria-label":"Platform",children:[e.jsxs(ut,{value:!0,children:[e.jsx(Fs,{fontSize:"small",sx:{mr:1}}),t("setting.syncViewOn")]}),e.jsxs(ut,{value:!1,children:[e.jsx(Bs,{fontSize:"small",sx:{mr:1}}),t("setting.syncViewOff")]})]}),e.jsx(ze,{children:t("setting.syncViewDes")})]})]})},Oe={x:0,y:0,width:0,height:0,unit:"px"},he=(n,s,t)=>Math.min(Math.max(n,s),t),$s=(...n)=>n.filter(s=>s&&typeof s=="string").join(" "),wt=(n,s)=>n===s||n.width===s.width&&n.height===s.height&&n.x===s.x&&n.y===s.y&&n.unit===s.unit;function Us(n,s,t,d){const o=K(n,t,d);return n.width&&(o.height=o.width/s),n.height&&(o.width=o.height*s),o.y+o.height>d&&(o.height=d-o.y,o.width=o.height*s),o.x+o.width>t&&(o.width=t-o.x,o.height=o.width/s),n.unit==="%"?Q(o,t,d):o}function Ks(n,s,t){const d=K(n,s,t);return d.x=(s-d.width)/2,d.y=(t-d.height)/2,n.unit==="%"?Q(d,s,t):d}function Q(n,s,t){return n.unit==="%"?{...Oe,...n,unit:"%"}:{unit:"%",x:n.x?n.x/s*100:0,y:n.y?n.y/t*100:0,width:n.width?n.width/s*100:0,height:n.height?n.height/t*100:0}}function K(n,s,t){return n.unit?n.unit==="px"?{...Oe,...n,unit:"px"}:{unit:"px",x:n.x?n.x*s/100:0,y:n.y?n.y*t/100:0,width:n.width?n.width*s/100:0,height:n.height?n.height*t/100:0}:{...Oe,...n,unit:"px"}}function vt(n,s,t,d,o,l=0,u=0,g=d,a=o){const i={...n};let r=Math.min(l,d),c=Math.min(u,o),h=Math.min(g,d),x=Math.min(a,o);s&&(s>1?(r=u?u*s:r,c=r/s,h=g*s):(c=l?l/s:c,r=c*s,x=a/s)),i.y<0&&(i.height=Math.max(i.height+i.y,c),i.y=0),i.x<0&&(i.width=Math.max(i.width+i.x,r),i.x=0);const p=d-(i.x+i.width);p<0&&(i.x=Math.min(i.x,d-r),i.width+=p);const m=o-(i.y+i.height);if(m<0&&(i.y=Math.min(i.y,o-c),i.height+=m),i.width<r&&((t==="sw"||t=="nw")&&(i.x-=r-i.width),i.width=r),i.height<c&&((t==="nw"||t=="ne")&&(i.y-=c-i.height),i.height=c),i.width>h&&((t==="sw"||t=="nw")&&(i.x-=h-i.width),i.width=h),i.height>x&&((t==="nw"||t=="ne")&&(i.y-=x-i.height),i.height=x),s){const v=i.width/i.height;if(v<s){const w=Math.max(i.width/s,c);(t==="nw"||t=="ne")&&(i.y-=w-i.height),i.height=w}else if(v>s){const w=Math.max(i.height*s,r);(t==="sw"||t=="nw")&&(i.x-=w-i.width),i.width=w}}return i}function Vs(n,s,t,d){const o={...n};return s==="ArrowLeft"?d==="nw"?(o.x-=t,o.y-=t,o.width+=t,o.height+=t):d==="w"?(o.x-=t,o.width+=t):d==="sw"?(o.x-=t,o.width+=t,o.height+=t):d==="ne"?(o.y+=t,o.width-=t,o.height-=t):d==="e"?o.width-=t:d==="se"&&(o.width-=t,o.height-=t):s==="ArrowRight"&&(d==="nw"?(o.x+=t,o.y+=t,o.width-=t,o.height-=t):d==="w"?(o.x+=t,o.width-=t):d==="sw"?(o.x+=t,o.width-=t,o.height-=t):d==="ne"?(o.y-=t,o.width+=t,o.height+=t):d==="e"?o.width+=t:d==="se"&&(o.width+=t,o.height+=t)),s==="ArrowUp"?d==="nw"?(o.x-=t,o.y-=t,o.width+=t,o.height+=t):d==="n"?(o.y-=t,o.height+=t):d==="ne"?(o.y-=t,o.width+=t,o.height+=t):d==="sw"?(o.x+=t,o.width-=t,o.height-=t):d==="s"?o.height-=t:d==="se"&&(o.width-=t,o.height-=t):s==="ArrowDown"&&(d==="nw"?(o.x+=t,o.y+=t,o.width-=t,o.height-=t):d==="n"?(o.y+=t,o.height-=t):d==="ne"?(o.y+=t,o.width-=t,o.height-=t):d==="sw"?(o.x-=t,o.width+=t,o.height+=t):d==="s"?o.height+=t:d==="se"&&(o.width+=t,o.height+=t)),o}const ue={capture:!0,passive:!1};let Ys=0;const X=class W extends f.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=f.createRef(),this.mediaRef=f.createRef(),this.initChangeCalled=!1,this.instanceId=`rc-${Ys++}`,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=s=>{const{crop:t,disabled:d}=this.props,o=this.getBox();if(!t)return;const l=K(t,o.width,o.height);if(d)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const u=s.target.dataset.ord,g=!!u;let a=s.clientX,i=s.clientY,r=l.x,c=l.y;if(u){const h=s.clientX-o.x,x=s.clientY-o.y;let p=0,m=0;u==="ne"||u=="e"?(p=h-(l.x+l.width),m=x-l.y,r=l.x,c=l.y+l.height):u==="se"||u==="s"?(p=h-(l.x+l.width),m=x-(l.y+l.height),r=l.x,c=l.y):u==="sw"||u=="w"?(p=h-l.x,m=x-(l.y+l.height),r=l.x+l.width,c=l.y):(u==="nw"||u=="n")&&(p=h-l.x,m=x-l.y,r=l.x+l.width,c=l.y+l.height),a=r+o.x+p,i=c+o.y+m}this.evData={startClientX:a,startClientY:i,startCropX:r,startCropY:c,clientX:s.clientX,clientY:s.clientY,isResize:g,ord:u},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=s=>{const{crop:t,disabled:d,locked:o,keepSelection:l,onChange:u}=this.props,g=this.getBox();if(d||o||l&&t)return;s.cancelable&&s.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=s.clientX-g.x,i=s.clientY-g.y,r={unit:"px",x:a,y:i,width:0,height:0};this.evData={startClientX:s.clientX,startClientY:s.clientY,startCropX:a,startCropY:i,clientX:s.clientX,clientY:s.clientY,isResize:!0},this.mouseDownOnCrop=!0,u(K(r,g.width,g.height),Q(r,g.width,g.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=s=>{const{crop:t,disabled:d,onChange:o,onDragStart:l}=this.props,u=this.getBox();if(d||!t||!this.mouseDownOnCrop)return;s.cancelable&&s.preventDefault(),this.dragStarted||(this.dragStarted=!0,l&&l(s));const{evData:g}=this;g.clientX=s.clientX,g.clientY=s.clientY;let a;g.isResize?a=this.resizeCrop():a=this.dragCrop(),wt(t,a)||o(K(a,u.width,u.height),Q(a,u.width,u.height))},this.onComponentKeyDown=s=>{const{crop:t,disabled:d,onChange:o,onComplete:l}=this.props;if(d)return;const u=s.key;let g=!1;if(!t)return;const a=this.getBox(),i=this.makePixelCrop(a),r=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?W.nudgeStepLarge:s.shiftKey?W.nudgeStepMedium:W.nudgeStep;if(u==="ArrowLeft"?(i.x-=r,g=!0):u==="ArrowRight"?(i.x+=r,g=!0):u==="ArrowUp"?(i.y-=r,g=!0):u==="ArrowDown"&&(i.y+=r,g=!0),g){s.cancelable&&s.preventDefault(),i.x=he(i.x,0,a.width-i.width),i.y=he(i.y,0,a.height-i.height);const c=K(i,a.width,a.height),h=Q(i,a.width,a.height);o(c,h),l&&l(c,h)}},this.onHandlerKeyDown=(s,t)=>{const{aspect:d=0,crop:o,disabled:l,minWidth:u=0,minHeight:g=0,maxWidth:a,maxHeight:i,onChange:r,onComplete:c}=this.props,h=this.getBox();if(l||!o)return;if(s.key==="ArrowUp"||s.key==="ArrowDown"||s.key==="ArrowLeft"||s.key==="ArrowRight")s.stopPropagation(),s.preventDefault();else return;const x=(navigator.platform.match("Mac")?s.metaKey:s.ctrlKey)?W.nudgeStepLarge:s.shiftKey?W.nudgeStepMedium:W.nudgeStep,p=K(o,h.width,h.height),m=Vs(p,s.key,x,t),v=vt(m,d,t,h.width,h.height,u,g,a,i);if(!wt(o,v)){const w=Q(v,h.width,h.height);r(v,w),c&&c(v,w)}},this.onDocPointerDone=s=>{const{crop:t,disabled:d,onComplete:o,onDragEnd:l}=this.props,u=this.getBox();this.unbindDocMove(),!(d||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,l&&l(s),o&&o(K(t,u.width,u.height),Q(t,u.width,u.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var s;(s=this.componentRef.current)==null||s.scrollTo(0,0)}}get document(){return document}getBox(){const s=this.mediaRef.current;if(!s)return{x:0,y:0,width:0,height:0};const{x:t,y:d,width:o,height:l}=s.getBoundingClientRect();return{x:t,y:d,width:o,height:l}}componentDidUpdate(s){const{crop:t,onComplete:d}=this.props;if(d&&!s.crop&&t){const{width:o,height:l}=this.getBox();o&&l&&d(K(t,o,l),Q(t,o,l))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,ue),this.document.addEventListener("pointerup",this.onDocPointerDone,ue),this.document.addEventListener("pointercancel",this.onDocPointerDone,ue),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,ue),this.document.removeEventListener("pointerup",this.onDocPointerDone,ue),this.document.removeEventListener("pointercancel",this.onDocPointerDone,ue),this.docMoveBound=!1)}getCropStyle(){const{crop:s}=this.props;if(s)return{top:`${s.y}${s.unit}`,left:`${s.x}${s.unit}`,width:`${s.width}${s.unit}`,height:`${s.height}${s.unit}`}}dragCrop(){const{evData:s}=this,t=this.getBox(),d=this.makePixelCrop(t),o=s.clientX-s.startClientX,l=s.clientY-s.startClientY;return d.x=he(s.startCropX+o,0,t.width-d.width),d.y=he(s.startCropY+l,0,t.height-d.height),d}getPointRegion(s,t,d,o){const{evData:l}=this,u=l.clientX-s.x,g=l.clientY-s.y;let a;o&&t?a=t==="nw"||t==="n"||t==="ne":a=g<l.startCropY;let i;return d&&t?i=t==="nw"||t==="w"||t==="sw":i=u<l.startCropX,i?a?"nw":"sw":a?"ne":"se"}resolveMinDimensions(s,t,d=0,o=0){const l=Math.min(d,s.width),u=Math.min(o,s.height);return!t||!l&&!u?[l,u]:t>1?l?[l,l/t]:[u*t,u]:u?[u*t,u]:[l,l/t]}resizeCrop(){const{evData:s}=this,{aspect:t=0,maxWidth:d,maxHeight:o}=this.props,l=this.getBox(),[u,g]=this.resolveMinDimensions(l,t,this.props.minWidth,this.props.minHeight);let a=this.makePixelCrop(l);const i=this.getPointRegion(l,s.ord,u,g),r=s.ord||i;let c=s.clientX-s.startClientX,h=s.clientY-s.startClientY;(u&&r==="nw"||r==="w"||r==="sw")&&(c=Math.min(c,-u)),(g&&r==="nw"||r==="n"||r==="ne")&&(h=Math.min(h,-g));const x={unit:"px",x:0,y:0,width:0,height:0};i==="ne"?(x.x=s.startCropX,x.width=c,t?(x.height=x.width/t,x.y=s.startCropY-x.height):(x.height=Math.abs(h),x.y=s.startCropY-x.height)):i==="se"?(x.x=s.startCropX,x.y=s.startCropY,x.width=c,t?x.height=x.width/t:x.height=h):i==="sw"?(x.x=s.startCropX+c,x.y=s.startCropY,x.width=Math.abs(c),t?x.height=x.width/t:x.height=h):i==="nw"&&(x.x=s.startCropX+c,x.width=Math.abs(c),t?(x.height=x.width/t,x.y=s.startCropY-x.height):(x.height=Math.abs(h),x.y=s.startCropY+h));const p=vt(x,t,i,l.width,l.height,u,g,d,o);return t||W.xyOrds.indexOf(r)>-1?a=p:W.xOrds.indexOf(r)>-1?(a.x=p.x,a.width=p.width):W.yOrds.indexOf(r)>-1&&(a.y=p.y,a.height=p.height),a.x=he(a.x,0,l.width-a.width),a.y=he(a.y,0,l.height-a.height),a}renderCropSelection(){const{ariaLabels:s=W.defaultProps.ariaLabels,disabled:t,locked:d,renderSelectionAddon:o,ruleOfThirds:l,crop:u}=this.props,g=this.getCropStyle();if(u)return S.createElement("div",{style:g,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":s.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!d&&S.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},S.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),S.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),S.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),S.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":s.nwDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"nw"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":s.nDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"n"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":s.neDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"ne"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":s.eDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"e"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":s.seDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"se"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":s.sDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"s"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":s.swDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"sw"),role:"button"}),S.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":s.wDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"w"),role:"button"})),o&&S.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:a=>a.stopPropagation()},o(this.state)),l&&S.createElement(S.Fragment,null,S.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),S.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(s){const t={...Oe,...this.props.crop||{}};return K(t,s.width,s.height)}render(){const{aspect:s,children:t,circularCrop:d,className:o,crop:l,disabled:u,locked:g,style:a,ruleOfThirds:i}=this.props,{cropIsActive:r,newCropIsBeingDrawn:c}=this.state,h=l?this.renderCropSelection():null,x=$s("ReactCrop",o,r&&"ReactCrop--active",u&&"ReactCrop--disabled",g&&"ReactCrop--locked",c&&"ReactCrop--new-crop",l&&s&&"ReactCrop--fixed-aspect",l&&d&&"ReactCrop--circular-crop",l&&i&&"ReactCrop--rule-of-thirds",!this.dragStarted&&l&&!l.width&&!l.height&&"ReactCrop--invisible-crop",d&&"ReactCrop--no-animate");return S.createElement("div",{ref:this.componentRef,className:x,style:a},S.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),l?S.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},S.createElement("defs",null,S.createElement("mask",{id:`hole-${this.instanceId}`},S.createElement("rect",{width:"100%",height:"100%",fill:"white"}),d?S.createElement("ellipse",{cx:`${l.x+l.width/2}${l.unit}`,cy:`${l.y+l.height/2}${l.unit}`,rx:`${l.width/2}${l.unit}`,ry:`${l.height/2}${l.unit}`,fill:"black"}):S.createElement("rect",{x:`${l.x}${l.unit}`,y:`${l.y}${l.unit}`,width:`${l.width}${l.unit}`,height:`${l.height}${l.unit}`,fill:"black"}))),S.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,h)}};X.xOrds=["e","w"],X.yOrds=["n","s"],X.xyOrds=["nw","ne","se","sw"],X.nudgeStep=1,X.nudgeStepMedium=10,X.nudgeStepLarge=100,X.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let Xs=X;function Qs(n,s,t){f.useEffect(()=>{const d=setTimeout(()=>{n.apply(void 0,t)},s);return()=>{clearTimeout(d)}},t)}const Gs=Math.PI/180;async function Zs(n,s,t,d=1,o=0){const l=s.getContext("2d");if(!l)throw new Error("No 2d context");const u=n.naturalWidth/n.width,g=n.naturalHeight/n.height,a=window.devicePixelRatio;s.width=Math.floor(t.width*u*a),s.height=Math.floor(t.height*g*a),l.scale(a,a),l.imageSmoothingQuality="high";const i=t.x*u,r=t.y*g,c=o*Gs,h=n.naturalWidth/2,x=n.naturalHeight/2;l.save(),l.translate(-i,-r),l.translate(h,x),l.rotate(c),l.scale(d,d),l.translate(-h,-x),l.drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,n.naturalWidth,n.naturalHeight),l.restore()}function qs(n,s,t){return Ks(Us({unit:"px",width:n*.9},t,n,s),n,s)}const Js=({open:n,onClose:s,onAvatarUpdated:t,file:d})=>{const{t:o}=I(),{enqueueSnackbar:l}=J(),u=_(),[g,a]=f.useState(null),[i,r]=f.useState(void 0),[c,h]=f.useState(),x=f.useRef(null),p=f.useRef(null);f.useRef("");const[m,v]=f.useState(!1);f.useEffect(()=>{if(n&&(r(void 0),a(null),d)){const y=new FileReader;y.addEventListener("load",()=>a(y.result)),y.readAsDataURL(d)}},[n]);const w=y=>{const{width:b,height:M}=y.currentTarget;r(qs(b,M,1))},j=async()=>{const y=x.current,b=p.current;if(!y||!b||!c)throw new Error("Crop canvas does not exist");const M=y.naturalWidth/y.width,H=y.naturalHeight/y.height,N=new OffscreenCanvas(c.width*M,c.height*H),U=N.getContext("2d");if(!U)throw new Error("No 2d context");return U.drawImage(b,0,0,b.width,b.height,0,0,N.width,N.height),await N.convertToBlob({type:"image/png"})},C=()=>{v(!0),j().then(y=>{u(Lt(y,"image/png")).then(()=>{l({message:o("application:setting.avatarUpdated",{}),variant:"success",action:q}),t(),s()}).finally(()=>{v(!1)})}).catch(y=>{l({message:y.message,variant:"error",action:q}),v(!1)})};return Qs(async()=>{c!=null&&c.width&&(c!=null&&c.height)&&x.current&&p.current&&(console.log(c),Zs(x.current,p.current,c,1,0))},100,[c]),e.jsx(Ce,{title:o("application:setting.cropAvatar",{}),showCancel:!0,showActions:!0,loading:m||!g,disabled:!c,onAccept:C,dialogProps:{open:!!n,onClose:s,fullWidth:!0,maxWidth:"xs"},children:e.jsxs(be,{children:[g&&e.jsx(Xs,{circularCrop:!0,crop:i,onChange:(y,b)=>r(b),minWidth:100,aspect:1,onComplete:y=>h(y),minHeight:100,children:e.jsx("img",{ref:x,onLoad:w,src:g,alt:"Avatar",style:{maxWidth:"100%",maxHeight:"60vh"}})}),!!c&&e.jsx("canvas",{ref:p,style:{display:"none",border:"1px solid black",objectFit:"contain",width:c.width,height:c.height}})]})})},ei=({user:n})=>{const{t:s}=I(),t=_(),{enqueueSnackbar:d}=J(),o=Ze({popupId:"avatarEdit",variant:"popover"}),l=S.createRef(),{onClose:u}=Me(o),[g,a]=f.useState(!1),[i,r]=f.useState(void 0),[c,h]=f.useState(1),x=()=>{var w;u(),(w=l.current)==null||w.click()},p=()=>{var j,C;const w=(C=(j=l.current)==null?void 0:j.files)==null?void 0:C[0];w&&(l.current.value="",r(w),a(!0))},m=()=>{h(w=>w+1)},v=()=>{t(Lt()).then(()=>{d({message:s("application:setting.avatarUpdated",{}),variant:"success",action:q}),m()}),u()};return e.jsxs(O,{title:s("setting.avatar"),lgWidth:6,children:[e.jsx(Un,{square:!0,cacheKey:c.toString(),user:n,sx:{width:200,height:200},overwriteTextSize:!0}),e.jsx(Ie,{sx:{mt:1},variant:"contained",startIcon:e.jsx(Bt,{}),...qe(o),children:s("fileManager.edit")}),e.jsx(Js,{onAvatarUpdated:m,file:i,onClose:()=>a(!1),open:g}),e.jsx("input",{onChange:p,type:"file",accept:"image/*",style:{display:"none"},ref:l}),e.jsxs(et,{slotProps:{paper:{sx:{minWidth:150}}},...Me(o),children:[e.jsxs(T,{onClick:x,dense:!0,children:[e.jsx(pe,{children:e.jsx(Kn,{fontSize:"small"})}),e.jsx(z,{children:s("setting.uploadImage")})]}),e.jsxs(T,{dense:!0,onClick:v,children:[e.jsx(pe,{children:e.jsx(Ye,{fontSize:"small"})}),e.jsx(z,{children:s("setting.useGravatar")})]})]})]})},ti=({setting:n,setSetting:s})=>{var x;const{t}=I(),d=V(),o=_(),l=Se(d.breakpoints.down("md")),u=f.useRef(null),g=B.currentLoginOrNull(),[a,i]=f.useState(g==null?void 0:g.user.nickname),[r,c]=f.useState(!1),h=()=>{var p;u.current&&u.current.checkValidity()?(c(!0),o(ne({nick:a})).then(()=>{g!=null&&g.user&&B.updateUserIfExist({...g==null?void 0:g.user,nickname:a??""})}).finally(()=>{c(!1)})):(p=u.current)==null||p.reportValidity()};return e.jsx($,{spacing:3,children:e.jsxs(ke,{container:!0,spacing:l?3:4,direction:l?"column":"row-reverse",sx:{width:"100%"},children:[e.jsx(ke,{spacing:3,sx:{flexGrow:1,width:"100%"},size:{md:6,xs:12},children:g&&e.jsx(ei,{user:g==null?void 0:g.user})}),e.jsx(ke,{spacing:3,sx:{flexGrow:1,width:"100%"},size:{md:6,xs:12},children:e.jsxs($,{spacing:3,children:[e.jsx(O,{title:t("login.email"),noContainer:!0,lgWidth:12,children:e.jsx(te,{disabled:!0,fullWidth:!0,value:g==null?void 0:g.user.email})}),e.jsxs(O,{title:t("setting.nickname"),noContainer:!0,lgWidth:12,children:[e.jsx(te,{fullWidth:!0,onChange:p=>i(p.target.value),value:a,required:!0,inputProps:{maxLength:255},helperText:t("setting.nickNameDes"),inputRef:u}),e.jsx(je,{in:a!=(g==null?void 0:g.user.nickname),children:e.jsx(nt,{variant:"contained",onClick:h,loading:r,sx:{mt:1},children:e.jsx("span",{children:t("fileManager.save")})})})]}),e.jsxs(ke,{spacing:l?3:4,container:!0,sx:{width:"100%"},children:[e.jsx(O,{title:t("setting.uid"),noContainer:!0,lgWidth:6,children:e.jsx(D,{variant:"body2",color:"textSecondary",children:g==null?void 0:g.user.id})}),e.jsx(O,{title:t("setting.regTime"),noContainer:!0,lgWidth:6,children:e.jsx(D,{variant:"body2",color:"textSecondary",children:e.jsx(ye,{datetime:g==null?void 0:g.user.created_at,variant:"inherit"})})})]}),e.jsx(O,{title:t("setting.group"),noContainer:!0,lgWidth:12,children:e.jsx(D,{variant:"body2",color:"textSecondary",children:(x=g==null?void 0:g.user.group)==null?void 0:x.name})})]})})]})})},ni=Te(Nt)`
  display: flex;
  gap: 8px;
  max-width: 650px;
  margin-inline: auto;
`,si=({open:n,onClose:s,on2FADisabled:t})=>{const{t:d}=I(),{enqueueSnackbar:o}=J(),l=_(),[u,g]=f.useState(!1),[a,i]=f.useState("");return f.useEffect(()=>{n&&(g(!1),i(""))},[n]),f.useEffect(()=>{a.length===6&&(g(!0),l(ne({two_fa_enabled:!1,two_fa_code:a})).then(()=>{o({message:d("setting.settingSaved"),variant:"success"}),t(),s()}).catch(()=>{g(!1),i("")}))},[a]),e.jsx(Ce,{title:d("application:setting.disable2FA"),showCancel:!0,hideOk:!0,showActions:!0,dialogProps:{open:!!n,onClose:s,fullWidth:!0,maxWidth:"xs"},children:e.jsx(be,{children:e.jsx(Ot,{children:e.jsx(st,{children:e.jsx(it,{addEndListener:(r,c)=>r.addEventListener("transitionend",c,!1),classNames:"fade",children:e.jsxs(E,{children:[u&&e.jsx(E,{sx:{pt:3,height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(at,{})}),!u&&e.jsxs($,{spacing:1,children:[e.jsx(D,{variant:"body2",children:d("setting.inputCurrent2FACode")}),e.jsx(se,{variant:"standard",margin:"normal",required:!0,children:e.jsx(ni,{TextFieldsProps:{disabled:u},autoFocus:!0,length:6,value:a,onChange:i})})]})]})},`${u}`)})})})})},ii=Te(Nt)`
  display: flex;
  gap: 8px;
  max-width: 650px;
  margin-inline: auto;
`,ai=({open:n,onClose:s,on2FAEnabled:t})=>{var v;const{t:d}=I(),{enqueueSnackbar:o}=J(),l=_(),u=V(),g=Se(u.breakpoints.down("md")),a=Z(w=>w.siteConfig.basic.config.title),i=B.currentLoginOrNull(),[r,c]=f.useState(!1),[h,x]=f.useState(""),[p,m]=f.useState("");return f.useEffect(()=>{n&&(c(!0),x(""),l(Vn()).then(w=>{m(w)}).finally(()=>{c(!1)}))},[n]),f.useEffect(()=>{h.length===6&&(c(!0),l(ne({two_fa_enabled:!0,two_fa_code:h})).then(()=>{o({message:d("setting.settingSaved"),variant:"success"}),t(),s()}).catch(()=>{c(!1),x("")}))},[h]),e.jsx(Ce,{title:d("application:setting.enable2FA"),showCancel:!0,hideOk:!0,showActions:!0,dialogProps:{open:!!n,onClose:s,fullWidth:!0},children:e.jsx(be,{children:e.jsx(Ot,{children:e.jsx(st,{children:e.jsx(it,{addEndListener:(w,j)=>w.addEventListener("transitionend",j,!1),classNames:"fade",children:e.jsxs(E,{children:[r&&e.jsx(E,{sx:{pt:3,height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(at,{})}),!r&&e.jsxs($,{spacing:1,direction:g?"column":"row",children:[e.jsx(E,{sx:{minWidth:176,textAlign:"center",p:1,backgroundColor:"#fff"},children:e.jsx(ot,{size:g?144:160,value:`otpauth://totp/${a}:${(v=i==null?void 0:i.user)==null?void 0:v.nickname}?secret=${p}`})}),e.jsxs(E,{children:[e.jsx(D,{variant:"body2",sx:{mt:1},children:d("setting.2faDescription")}),e.jsx(D,{variant:"body2",sx:{mt:1},children:d("setting.inputCurrent2FACode")}),e.jsx(se,{variant:"standard",margin:"normal",required:!0,children:e.jsx(ii,{TextFieldsProps:{disabled:r},autoFocus:!0,length:6,value:h,onChange:x})})]})]})]})},`${r}`)})})})})};function ri(n){return e.jsx(re,{...n,children:e.jsx("path",{d:"M3 5.75A.75.75 0 0 1 3.75 5c2.663 0 5.258-.943 7.8-2.85a.75.75 0 0 1 .9 0C14.992 4.057 17.587 5 20.25 5a.75.75 0 0 1 .75.75V11c0 .338-.014.67-.04.996a6.467 6.467 0 0 0-1.465-.684c.003-.103.005-.207.005-.312V6.478c-2.577-.152-5.08-1.09-7.5-2.8c-2.42 1.71-4.923 2.648-7.5 2.8V11c0 4.149 2.332 7.221 7.125 9.285a6.506 6.506 0 0 0 1.005 1.52l-.355.143a.75.75 0 0 1-.55 0C5.958 19.676 3 16 3 11zM23 17.5a5.5 5.5 0 1 0-11 0a5.5 5.5 0 0 0 11 0m-5 .5l.001 2.503a.5.5 0 1 1-1 0V18h-2.505a.5.5 0 0 1 0-1H17v-2.5a.5.5 0 1 1 1 0V17h2.497a.5.5 0 0 1 0 1z"})})}const oi=Te(Yn)(({theme:n})=>({borderRadius:n.shape.borderRadius,border:`1px solid ${n.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,marginTop:n.spacing(1),paddingBottom:n.spacing(.5),paddingTop:n.spacing(.5)})),li=({icon:n,iconColor:s,settingTitle:t,settingDescription:d,settingAction:o,...l})=>{const u=n;return e.jsxs(oi,{...l,children:[e.jsx(Xn,{sx:{},children:e.jsx(Qn,{sx:{backgroundColor:s},children:e.jsx(u,{})})}),e.jsx(Gn,{primary:t,secondaryTypographyProps:{variant:"caption",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},secondary:d}),o&&e.jsx(Zn,{children:o})]})},ci=n=>{var h,x;const{t:s}=I(),{enqueueSnackbar:t}=J(),d=_(),o=V(),l=Se(o.breakpoints.down("md")),[u,g]=f.useState(!1),[a,i]=f.useState(!1),r=async()=>{var p;if(!navigator.credentials||!window.PublicKeyCredential){t({message:s("setting.browserNotSupported"),variant:"warning",action:q});return}g(!0);try{const m=await d(ts()),v=await navigator.credentials.create({publicKey:{rp:m.publicKey.rp,user:{id:Fe(m.publicKey.user.id),name:m.publicKey.user.name,displayName:m.publicKey.user.displayName},challenge:Fe(m.publicKey.challenge),pubKeyCredParams:m.publicKey.pubKeyCredParams,timeout:m.publicKey.timeout,excludeCredentials:(p=m.publicKey.excludeCredentials)==null?void 0:p.map(w=>({id:Fe(w.id),type:w.type})),authenticatorSelection:m.publicKey.authenticatorSelection}});if(v){const w=v,j=await d(ns({response:JSON.stringify({id:v.id,type:v.type,rawId:Be(w.rawId),response:{attestationObject:Be(w.response.attestationObject),clientDataJSON:Be(w.response.clientDataJSON)}}),name:s("setting.passkeyName"),ua:navigator.userAgent}));n.onPasskeyAdded(j)}}catch(m){console.error(m)}finally{g(!1)}},c=p=>{d(kt(s("setting.removedAuthenticatorConfirm"))).then(()=>{i(!0),d(ss(p)).then(()=>{n.onPasskeyDeleted(p)}).finally(()=>{i(!1)})})};return e.jsxs(E,{children:[!((h=n.setting.passkeys)!=null&&h.length)&&e.jsxs(E,{onClick:r,sx:{display:"flex",flexDirection:"column",alignItems:"center",borderRadius:p=>`${p.shape.borderRadius}px`,border:p=>`1px solid ${p.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,textAlign:"center",p:1,py:2},children:[e.jsx(Ye,{sx:{fontSize:40,color:p=>p.palette.text.secondary}}),e.jsx(D,{color:"textSecondary",variant:"caption",children:s("setting.noAuthenticator")})]}),e.jsx(qn,{disablePadding:!0,children:(x=n.setting.passkeys)==null?void 0:x.map(p=>e.jsx(li,{iconColor:o.palette.action.active,icon:Ye,secondaryAction:e.jsx(tt,{onClick:()=>c(p.id),disabled:a,children:e.jsx(Jn,{fontSize:"small"})}),settingTitle:e.jsx(Et,{variant:"inherit",children:p.name}),settingDescription:e.jsxs(E,{children:[e.jsx(Ve,{i18nKey:"setting.accountCreatedAt",ns:"application",components:[e.jsx(ye,{datetime:p.created_at,variant:"inherit"})]}),e.jsx(E,{component:l?"div":"span",sx:{ml:l?0:1,color:m=>p.used_at&&pt().diff(pt(p.used_at),"day")<7?m.palette.success.main:m.palette.text.secondary},children:p.used_at?e.jsx(Ve,{i18nKey:"setting.usedAt",ns:"application",components:[e.jsx(ye,{datetime:p.used_at,variant:"inherit"})]}):s("setting.neverUsed")})]})}))}),e.jsx(es,{sx:{mt:1},variant:"contained",loading:u,onClick:r,startIcon:e.jsx(ri,{}),children:e.jsx("span",{children:s("setting.addNewAuthenticator")})})]})},di=({setting:n,setSetting:s})=>{const{t}=I(),d=V(),o=_();Se(d.breakpoints.down("md"));const{enqueueSnackbar:l}=J(),u=Ct(),g=Z(R=>R.siteConfig.login.config.authn),a=S.createRef(),[i,r]=f.useState(!1),[c,h]=f.useState(!1),[x,p]=f.useState(""),[m,v]=f.useState(""),[w,j]=f.useState(""),[C,y]=f.useState(!1),[b,M]=f.useState(!1),H=()=>{if(a.current){if(!a.current.checkValidity()){a.current.reportValidity();return}if(m!==w){l({variant:"warning",message:t("login.passwordNotMatch"),action:q});return}h(!0),o(ne({current_password:x,new_password:m})).then(()=>{B.signOutCurrent(),u("/session"),r(!1),l({variant:"success",message:t("login.passwordReset"),action:q})}).finally(()=>{h(!1)})}},N=R=>()=>{s({...n,two_fa_enabled:R})},U=R=>{s({...n,passkeys:n.passkeys?[...n.passkeys,R]:[R]})},Y=R=>{var oe;s({...n,passkeys:(oe=n.passkeys)==null?void 0:oe.filter(le=>le.id!==R)})};return e.jsxs($,{spacing:3,children:[e.jsxs(O,{title:t("login.password"),lgWidth:5,children:[e.jsx(je,{in:!i,children:e.jsx(Ie,{sx:{mt:1},onClick:()=>r(!0),variant:"contained",startIcon:e.jsx(Bt,{}),children:t("login.resetPassword")})}),e.jsx(je,{in:i,sx:{mt:2},unmountOnExit:!0,children:e.jsx("form",{ref:a,children:e.jsxs($,{spacing:2,children:[e.jsx(te,{required:!0,label:t("setting.originalPassword"),fullWidth:!0,value:x,onChange:R=>p(R.target.value),inputProps:{type:"password",minLength:4,maxLength:64}}),e.jsx(te,{required:!0,label:t("login.newPassword"),fullWidth:!0,value:m,onChange:R=>v(R.target.value),inputProps:{type:"password",minLength:6,maxLength:128}}),e.jsx(te,{required:!0,label:t("login.repeatPassword"),fullWidth:!0,value:w,onChange:R=>j(R.target.value),inputProps:{type:"password",minLength:6,maxLength:128}}),e.jsx(E,{children:e.jsx(nt,{variant:"contained",onClick:H,loading:c,children:e.jsx("span",{children:t("fileManager.save")})})})]})})})]}),e.jsx(O,{title:e.jsxs(E,{children:[t("setting.2fa"),n.two_fa_enabled&&e.jsx(Re,{sx:{ml:1,height:"initial",fontSize:R=>R.typography.caption.fontSize},color:"success",size:"small",variant:"outlined",label:t("setting.enabled")})]}),lgWidth:5,children:e.jsx(Ie,{sx:{mt:1},onClick:()=>n.two_fa_enabled?M(!0):y(!0),variant:"contained",startIcon:e.jsx(Rt,{}),children:t(`setting.${n.two_fa_enabled?"disable":"enable"}2FA`)})}),g&&e.jsx(O,{title:t("setting.hardwareAuthenticator"),children:e.jsx(ci,{setting:n,onPasskeyAdded:U,onPasskeyDeleted:Y})}),e.jsx(ai,{open:C,onClose:()=>y(!1),on2FAEnabled:N(!0)}),e.jsx(si,{open:b,onClose:()=>M(!1),on2FADisabled:N(!1)})]})},bi=()=>{const{t:n}=I(),s=_(),[t,d]=ds(zt),[o,l]=f.useState(!0),[u,g]=f.useState(void 0);f.useEffect(()=>{l(!0),s(_t("login")),s(is()).then(i=>{g(i)}).finally(()=>{l(!1)})},[]);const a=f.useMemo(()=>{const i=[];return i.push({label:n("application:setting.profile"),value:"profile",icon:e.jsx(fs,{})},{label:n("application:setting.preference"),value:"preference",icon:e.jsx(Ts,{})},{label:n("application:setting.security"),value:"security",icon:e.jsx(zs,{})}),i},[n]);return e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{title:n("application:navbar.setting")}),e.jsx(Ft,{value:t??"profile",onChange:(i,r)=>d(r),tabs:a}),e.jsx(st,{children:e.jsx(it,{addEndListener:(i,r)=>i.addEventListener("transitionend",r,!1),classNames:"fade",children:e.jsxs(E,{children:[o&&e.jsx(E,{sx:{pt:20,height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(at,{})}),!o&&u&&e.jsxs(E,{sx:{mt:3},children:[(!t||t=="profile")&&e.jsx(ti,{setting:u,setSetting:g}),t=="preference"&&e.jsx(Ws,{setting:u,setSetting:g}),t=="security"&&e.jsx(di,{setting:u,setSetting:g})]})]})},`${o}`)})]})})},hi=50,Si=()=>{const{t:n}=I(),s=_(),[t,d]=f.useState(""),[o,l]=f.useState([]),[u,g]=f.useState(!1),[a,i]=f.useState("desc"),[r,c]=f.useState(),{id:h}=as();f.useEffect(()=>{h&&s(rs(h)).then(w=>{w&&c(w)})},[h]);const x=f.useCallback((w,j,C)=>()=>{g(!0),s(os({page_size:hi,order_direction:C??a,next_page_token:j},h??"")).then(y=>{var b;l([...w,...y.shares]),(b=y.pagination)!=null&&b.next_token?d(y.pagination.next_token):d(void 0)}).catch(()=>{d(void 0)}).finally(()=>{g(!1)})},[s,a,Mt]),p=w=>{x([],"",w)()},m=f.useCallback(w=>{l(j=>j.filter(C=>C.id!==w))},[l]),v=f.useCallback(w=>{i(w.target.value),p(w.target.value)},[p,i]);return e.jsx(ve,{children:e.jsxs(we,{maxWidth:"lg",children:[e.jsx(ie,{title:(r==null?void 0:r.nickname)??"-"}),e.jsx(E,{sx:{backgroundColor:w=>w.palette.mode=="light"?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",borderRadius:w=>`${w.shape.borderRadius}px`,mb:4,p:2},children:r&&e.jsx(ls,{user:r,open:!0,displayOnly:!0})}),e.jsx(ie,{secondaryAction:e.jsx(se,{variant:"outlined",children:e.jsxs(Pe,{variant:"outlined",value:a,onChange:v,children:[e.jsx(T,{value:"desc",children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:n("application:share.createdAtDesc")})}),e.jsx(T,{value:"asc",children:e.jsx(z,{slotProps:{primary:{variant:"body2"}},children:n("application:share.createdAtAsc")})})]})}),skipChangingDocumentTitle:!0,onRefresh:()=>p(),loading:u,title:n("application:share.somebodyShare",{name:(r==null?void 0:r.nickname)??"-"})}),e.jsxs(fe,{container:!0,spacing:1,children:[o.map(w=>e.jsx(_e,{share:w,onShareDeleted:m})),t!=null&&e.jsx(e.Fragment,{children:[...Array(4)].map((w,j)=>e.jsx(_e,{onShareDeleted:m,onLoad:j==0?x(o,t):void 0,loading:!0},j==0?t:j))})]}),t==null&&o.length==0&&e.jsx(E,{sx:{p:1,width:"100%",textAlign:"center"},children:e.jsx(me,{size:.8,top:63,primary:n("setting.listEmpty")})})]})})};export{Ci as Devices,vi as DownloadList,Si as Profile,bi as Setting,wi as ShareList,mi as TaskList};
